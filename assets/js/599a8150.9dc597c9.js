"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[81913],{38013:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>l,frontMatter:()=>n,metadata:()=>a,toc:()=>d});var s=r(11527),i=r(17279);const n={sidebar_position:2},o="\u2694\ufe0f Protect your API",a={id:"docs/recipes/protect-your-api/README",title:"\u2694\ufe0f Protect your API",description:"Logto is an off-the-shelf authorization service that enables you to enforce authorization on your backend API resources , enhancing their privacy protection.",source:"@site/docs/docs/recipes/protect-your-api/README.mdx",sourceDirName:"docs/recipes/protect-your-api",slug:"/docs/recipes/protect-your-api/",permalink:"/docs/recipes/protect-your-api/",draft:!1,unlisted:!1,editUrl:"https://github.com/logto-io/docs/tree/master/docs/docs/recipes/protect-your-api/README.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"docsSidebar",previous:{title:"\ud83d\udd17 Integrate Logto in your application",permalink:"/docs/recipes/integrate-logto/"},next:{title:"Node (Express)",permalink:"/docs/recipes/protect-your-api/node"}},c={},d=[{value:"Register the API resources",id:"register-the-api-resources",level:2},{value:"Permissions and RBAC",id:"permissions-and-rbac",level:3},{value:"Validate the API request&#39;s authorization token",id:"validate-the-api-requests-authorization-token",level:2},{value:"Understanding JWS token",id:"understanding-jws-token",level:3},{value:"Validate the authorization token",id:"validate-the-authorization-token",level:3},{value:"Reference",id:"reference",level:2}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h1,{id:"\ufe0f-protect-your-api",children:"\u2694\ufe0f Protect your API"}),"\n",(0,s.jsxs)(t.p,{children:["Logto is an off-the-shelf authorization service that enables you to enforce authorization on your backend ",(0,s.jsx)(t.a,{href:"/docs/references/resources/",children:"API resources"})," , enhancing their privacy protection."]}),"\n",(0,s.jsx)(t.h2,{id:"register-the-api-resources",children:"Register the API resources"}),"\n",(0,s.jsxs)(t.p,{children:["To obtain an audience-restricted ",(0,s.jsx)(t.code,{children:"access_token"})," from Logto, you must register your backend APIs. When an authorization request is received, Logto will identify the registered ",(0,s.jsx)(t.a,{href:"/docs/references/resources/",children:"API resources"})," and grant access accordingly."]}),"\n",(0,s.jsxs)(t.p,{children:["To register your APIs, navigate to the API Resources section in the console. You will see a built-in resource with the API identifier displayed as ",(0,s.jsx)(t.code,{children:"https://[your-tenant-id].logto.app/api"}),". This resource encompasses all the Management APIs of Logto and ensures that they are protected and accessible only to authorized users of Logto."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"API resources",src:r(64931).Z+"",width:"2844",height:"904"})}),"\n",(0,s.jsxs)(t.p,{children:["Click on the ",(0,s.jsx)(t.strong,{children:"Create API Resource"})," button and following the interactive form to create your own API resources:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["A human-readable ",(0,s.jsx)(t.strong,{children:"API Name"})," that may better helps you to identify this entity."]}),"\n",(0,s.jsxs)(t.li,{children:["A unique ",(0,s.jsx)(t.strong,{children:"API Identifier"})," (a.k.a. ",(0,s.jsx)(t.a,{href:"/docs/references/resources/#resource-indicator",children:"Resource Indicator"}),") in URI format. It represents the identity of the API resource."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"API resources",src:r(21103).Z+"",width:"1762",height:"792"})}),"\n",(0,s.jsx)(t.admonition,{type:"caution",children:(0,s.jsxs)(t.p,{children:["The API Identifier is unique and used as the single source of truth for Logto, and it's ",(0,s.jsx)(t.strong,{children:"NOT"})," editable once created. Be careful when you create it."]})}),"\n",(0,s.jsx)(t.p,{children:"The new API will show up on the list once created. You may manage or delete it at the API details page by clicking on the entity."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"API resource details",src:r(16642).Z+"",width:"2844",height:"1346"})}),"\n",(0,s.jsxs)(t.p,{children:["See ",(0,s.jsx)(t.a,{href:"/docs/references/resources/#logto-api-resource-schema",children:"API Resource Logto Schema"})," for detailed API setting definitions."]}),"\n",(0,s.jsx)(t.admonition,{type:"info",children:(0,s.jsx)(t.p,{children:"The API Resources registered in Logto Admin Console will be shared across all your applications."})}),"\n",(0,s.jsx)(t.h3,{id:"permissions-and-rbac",children:"Permissions and RBAC"}),"\n",(0,s.jsxs)(t.p,{children:["See ",(0,s.jsx)(t.a,{href:"/docs/recipes/rbac",children:"\ud83d\udd10 RBAC"})," for details."]}),"\n",(0,s.jsx)(t.h2,{id:"validate-the-api-requests-authorization-token",children:"Validate the API request's authorization token"}),"\n",(0,s.jsxs)(t.p,{children:["Logto issues a standard ",(0,s.jsx)(t.a,{href:"https://datatracker.ietf.org/doc/html/rfc7519",children:"JWT"})," format authorization token for each authorized API request. The token is encrypted and signed as a ",(0,s.jsx)(t.a,{href:"https://datatracker.ietf.org/doc/html/rfc7515",children:"JWS"})," token."]}),"\n",(0,s.jsx)(t.h3,{id:"understanding-jws-token",children:"Understanding JWS token"}),"\n",(0,s.jsxs)(t.p,{children:["An encoded ",(0,s.jsx)(t.a,{href:"https://datatracker.ietf.org/doc/html/rfc7515",children:"JWS"})," token is constructed with three parts:"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:"JOSE Header: Declares the code type and encoding algorithm"}),"\n",(0,s.jsx)(t.li,{children:"JWS Payload: Includes all the token's claims"}),"\n",(0,s.jsxs)(t.li,{children:["JWS Signature: Signature signed with ",(0,s.jsx)(t.a,{href:"https://datatracker.ietf.org/doc/html/rfc7517",children:"JWK"})]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"A standard schema of Logto issued JWS Payload: (claims may vary, based on your custom OIDC config)"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"key"}),(0,s.jsx)(t.th,{children:"description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"jti"}),(0,s.jsx)(t.td,{children:"unique JWT ID"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"sub"}),(0,s.jsx)(t.td,{children:"subject, usually user-id"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"iat"}),(0,s.jsx)(t.td,{children:"timestamp token issues at"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"exp"}),(0,s.jsx)(t.td,{children:"timestamp token expires at"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"client_id"}),(0,s.jsx)(t.td,{children:"application id"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"iss"}),(0,s.jsx)(t.td,{children:"token issuer identity"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"aud"}),(0,s.jsx)(t.td,{children:"audience of the token"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"scope"}),(0,s.jsx)(t.td,{children:"scopes (permissions) of the token"})]})]})]}),"\n",(0,s.jsx)(t.admonition,{type:"info",children:(0,s.jsxs)(t.p,{children:["For development, to visually inspect a JWT token, you could visit ",(0,s.jsx)(t.a,{href:"https://jwt.io/",children:"jwt.io"})," to decode and check the tokens you received. Be careful with or never use the tokens from a production environment. As this is a third party provided public online service, your token may be exposed."]})}),"\n",(0,s.jsx)(t.h3,{id:"validate-the-authorization-token",children:"Validate the authorization token"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"https://datatracker.ietf.org/doc/html/rfc7519#section-7.2",children:"Validating a JWT"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"https://datatracker.ietf.org/doc/html/rfc7515#section-5.2",children:"Validating the JWS signature"})}),"\n",(0,s.jsxs)(t.li,{children:["The token's issuer is ",(0,s.jsx)(t.code,{children:"https://<your-logto-domain>/oidc"})," (issued by your Logto auth server)"]}),"\n",(0,s.jsx)(t.li,{children:"The token's audience is equal to the current receiver's resource indicator registered in Logto Admin Console"}),"\n",(0,s.jsx)(t.li,{children:"The token is within its expiration time"}),"\n",(0,s.jsxs)(t.li,{children:["(",(0,s.jsx)(t.a,{href:"/docs/recipes/rbac/",children:"\ud83d\udd10 RBAC"})," only) The token has the desired ",(0,s.jsx)(t.code,{children:"scope"})]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"There are various open-source libraries and packages that can help you to validate and decode a JWT token easily. You may pick one and integrate with your backend application based on the language and framework you are using. Please check some of the examples we have:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"./node",children:"Node (Express)"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"./spring-boot",children:"Spring Boot"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"./python",children:"Python"})}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"reference",children:"Reference"}),"\n",(0,s.jsxs)(t.p,{children:["Logto uses the code-based OAuth 2.0 Authorization Protocol to make your API request safe. If you are interested in the strategy behind it, refer to OAuth 2.0's ",(0,s.jsx)(t.a,{href:"https://datatracker.ietf.org/doc/html/rfc6749#section-1.3.1",children:"specification"})," for more details."]})]})}function l(e={}){const{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},16642:(e,t,r)=>{r.d(t,{Z:()=>s});const s=r.p+"assets/images/api-resource-details-f8be72941953b8fa82637657795f0250.png"},64931:(e,t,r)=>{r.d(t,{Z:()=>s});const s=r.p+"assets/images/api-resources-0a5b16a995c7b97056705bd771b6f5f8.png"},21103:(e,t,r)=>{r.d(t,{Z:()=>s});const s=r.p+"assets/images/create-api-resource-a2e98874a9771059c219699784a1efd8.png"},17279:(e,t,r)=>{r.d(t,{Z:()=>a,a:()=>o});var s=r(50959);const i={},n=s.createContext(i);function o(e){const t=s.useContext(n);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(n.Provider,{value:t},e.children)}}}]);