"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[6774],{91120:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>a,metadata:()=>n,toc:()=>h});const n=JSON.parse('{"id":"user-management/user-migration","title":"User migration","description":"Logto supports manual migration of existing users from another platform, this guide will show you how to import existing users via Management API and talk about things that you should consider before migrating.","source":"@site/docs/user-management/user-migration.mdx","sourceDirName":"user-management","slug":"/user-management/user-migration","permalink":"/user-management/user-migration","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/docs/user-management/user-migration.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"docsSidebar","previous":{"title":"Personal access token","permalink":"/user-management/personal-access-token"},"next":{"title":"User management","permalink":"/user-management/"}}');var r=t(25105),o=t(79621);const a={sidebar_position:5},i="User migration",l={},h=[{value:"User schema",id:"user-schema",level:2},{value:"Password hashing",id:"password-hashing",level:2},{value:"General Legacy format",id:"general-legacy-format",level:3},{value:"PBKDF2 support",id:"pbkdf2-support",level:3},{value:"Steps to migrate",id:"steps-to-migrate",level:2},{value:"Related resources",id:"related-resources",level:2}];function d(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components},{Url:t}=s;return t||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"user-migration",children:"User migration"})}),"\n",(0,r.jsx)(s.p,{children:"Logto supports manual migration of existing users from another platform, this guide will show you how to import existing users via Management API and talk about things that you should consider before migrating."}),"\n",(0,r.jsx)(s.h2,{id:"user-schema",children:"User schema"}),"\n",(0,r.jsxs)(s.p,{children:["Before we start, let's take a look at the ",(0,r.jsx)(s.a,{href:"/user-management/user-data/#user-profile",children:"user schema"})," in Logto. There are 3 parts of the user schema that you should be aware of:"]}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Basic data"}),": is the basic info from the user profile, you can match the data from your existing user profile."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Custom data"}),": stores additional user info, you can use this to store files that are unable to match the basic data."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Social identities"}),": stores the user info retrieved from social sign-in."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["You can create a map to match the user info from your existing user profile to ",(0,r.jsx)(s.strong,{children:"basic data"})," and ",(0,r.jsx)(s.strong,{children:"custom data"}),". For social sign in, you'll need additional steps to import the social identities, please refer to the API of ",(0,r.jsx)(s.a,{href:"https://openapi.logto.io/operation/operation-createuseridentity",children:"Link social identity to user"}),"."]}),"\n",(0,r.jsx)(s.h2,{id:"password-hashing",children:"Password hashing"}),"\n",(0,r.jsxs)(s.p,{children:["Logto uses ",(0,r.jsx)(s.a,{href:"https://en.wikipedia.org/wiki/Argon2",children:"Argon2"})," to hash the user's password, and also supports other algorithms like ",(0,r.jsx)(s.code,{children:"MD5"}),", ",(0,r.jsx)(s.code,{children:"SHA1"}),", ",(0,r.jsx)(s.code,{children:"SHA256"})," and ",(0,r.jsx)(s.code,{children:"Bcrypt"})," for the convenience of migration. Those algorithms are considered insecure, the corrosponding password hashes will be migrated to Argon2 upon the user's first successful sign in."]}),"\n",(0,r.jsxs)(s.p,{children:["If you are using other hashing algorithms or salt, you can set the ",(0,r.jsx)(s.code,{children:"passwordAlgorithm"})," to ",(0,r.jsx)(s.code,{children:"Legacy"}),", this allows you to use any hash algorithm supported by Node.js. You can find the list of supported algorithms in the ",(0,r.jsx)(s.a,{href:"https://nodejs.org/api/crypto.html#cryptogethashes",children:"Node.js crypto documentation"}),". In this case, the ",(0,r.jsx)(s.code,{children:"passwordDigest"})," will be a JSON string that contains the hash algorithm and other algorithm-specific parameters."]}),"\n",(0,r.jsx)(s.h3,{id:"general-legacy-format",children:"General Legacy format"}),"\n",(0,r.jsx)(s.p,{children:"The format of the JSON string is as follows:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'["hash_algorithm", ["argument1", "argument2", ...], "expected_hashed_value"]\n'})}),"\n",(0,r.jsxs)(s.p,{children:["And you can use ",(0,r.jsx)(s.code,{children:"@"})," as a placeholder for the actual password value in the arguments."]}),"\n",(0,r.jsx)(s.p,{children:"For example, if you are using SHA256 with a salt, you can store the password in the following format:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'["sha256", ["salt123", "@"], "c465f66c6ac481a7a17e9ed5b4e2e7e7288d892f12bf1c95c140901e9a70436e"]\n'})}),"\n",(0,r.jsx)(s.p,{children:"This equals to the following code:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"const hash = crypto.createHash('sha256');\nhash.update('salt123' + 'password123');\nconst expectedHashedValue = hash.digest('hex');\n"})}),"\n",(0,r.jsx)(s.h3,{id:"pbkdf2-support",children:"PBKDF2 support"}),"\n",(0,r.jsxs)(s.p,{children:["Logto specifically supports ",(0,r.jsx)(s.a,{href:"https://en.wikipedia.org/wiki/PBKDF2",children:"PBKDF2"}),"."]}),"\n",(0,r.jsxs)(s.p,{children:["To migrate passwords hashed with PBKDF2, set the ",(0,r.jsx)(s.code,{children:"passwordAlgorithm"})," to ",(0,r.jsx)(s.code,{children:"Legacy"})," and format the ",(0,r.jsx)(s.code,{children:"passwordDigest"})," as follows:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'["pbkdf2", ["salt", "1000", "20", "sha512", "@"], "expected_hashed_value"]\n'})}),"\n",(0,r.jsx)(s.p,{children:"The parameters are:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.code,{children:"salt"})}),": The salt value used in the original hashing"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.code,{children:"iterations"})}),": Number of iterations (e.g., ",(0,r.jsx)(s.code,{children:'"1000"'}),")"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.code,{children:"keylen"})}),": Length of the derived key in bytes (e.g., ",(0,r.jsx)(s.code,{children:'"20"'}),")"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.code,{children:"digest"})}),": The hash function used (e.g., ",(0,r.jsx)(s.code,{children:'"sha512"'}),", ",(0,r.jsx)(s.code,{children:'"sha256"'}),", ",(0,r.jsx)(s.code,{children:'"sha1"'}),")"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.code,{children:"@"})}),": Placeholder for the actual password value"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:(0,r.jsx)(s.code,{children:"expected_hashed_value"})}),": The expected hash result as a hexadecimal string"]}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Example migration payload:"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'{\n  "username": "john_doe",\n  "primaryEmail": "john.doe@example.com",\n  "passwordAlgorithm": "Legacy",\n  "passwordDigest": "[\\"pbkdf2\\", [\\"mySalt123\\", \\"1000\\", \\"20\\", \\"sha512\\", \\"@\\"], \\"c465f66c6ac481a7a17e9ed5b4e2e7e7288d892f12bf1c95c140901e9a70436e\\"]"\n}\n'})}),"\n",(0,r.jsx)(s.h2,{id:"steps-to-migrate",children:"Steps to migrate"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Prepare the user data"}),"\nYou should first export the user data from your existing platform, and then map the user info to the Logto user schema. We recommend you to prepare the mapped data in a JSON format. Here is an example of the user data:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'[\n  {\n    "username": "user1",\n    "passwordDigest": "password-encrypted",\n    "passwordAlgorithm": "SHA256"\n  },\n  {\n    "username": "user2",\n    "passwordDigest": "password-encrypted",\n    "passwordAlgorithm": "SHA256"\n  }\n]\n'})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Create a Logto tenant"}),"\nYou'll need to setup a tenant in Logto. You can use either Logto Cloud or Logto OSS. If you haven't done this yet, please refer to the ",(0,r.jsx)(s.a,{href:"/introduction/set-up-logto-cloud/#create-logto-tenant",children:"Set up Logto cloud"})," guide."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Setup the connection of Management API"}),"\nWe'll use the Management API to import the user data, you can refer to the ",(0,r.jsx)(s.a,{href:"/integrate-logto/interact-with-management-api",children:"Management API"})," to learn how to setup the connection in your development environment."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Import the user data"}),"\nIt is recommended to prepare a script to import the user data one by one, we'll call ",(0,r.jsx)(s.a,{href:"https://openapi.logto.io/operation/operation-createuser",children:"create user"})," API to import the user data. Here is an example of the script:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-jsx",children:"const users = require('./users.json');\n\nconst importUsers = async () => {\n  for (const user of users) {\n    try {\n      await fetch('https://[tenant_id].logto.app/api/users', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: 'Bearer [your-access-token]',\n        },\n        body: JSON.stringify(user),\n      });\n      // Sleep for a while to avoid rate limit\n      await new Promise((resolve) => setTimeout(resolve, 200));\n    } catch (error) {\n      console.error(`Failed to import user ${user.username}: ${error.message}`);\n    }\n  }\n};\n\nimportUsers();\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Please noted that the API point is rate limited, you should add a sleep between each request to avoid the rate limit. Please review our ",(0,r.jsx)(s.a,{href:"/integrate-logto/interact-with-management-api/#rate-limit",children:"rate limits"})," page for details."]}),"\n",(0,r.jsxs)(s.p,{children:["If you have a large amount of user data (100k+ users), you can ",(0,r.jsx)(s.a,{href:"https://logto.io/contact",children:"reach out to us"})," to increase the rate limit."]}),"\n",(0,r.jsx)(s.h2,{id:"related-resources",children:"Related resources"}),"\n",(0,r.jsx)(t,{href:"https://blog.logto.io/general-migration-guide",children:(0,r.jsx)(s.p,{children:"A general guideline to migrate your existing user database to Logto"})})]})}function c(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},79621:(e,s,t)=>{t.d(s,{R:()=>a,x:()=>i});var n=t(58101);const r={},o=n.createContext(r);function a(e){const s=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),n.createElement(o.Provider,{value:s},e.children)}}}]);