"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[45912],{58138:(e,t,i)=>{i.d(t,{Ay:()=>l,RM:()=>o});var n=i(25105),s=i(79621);const o=[];function r(e){const{Url:t}={...(0,s.R)(),...e.components};return t||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t,{href:"/end-user-flows",children:" End-user flows: authentication flows, account flows, and organization flows "}),"\n",(0,n.jsx)(t,{href:"/connectors",children:" Configure connectors "}),"\n",(0,n.jsx)(t,{href:"/authorization/api-resources/protect-your-api",children:" Protect your API "})]})}function l(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(r,{...e})}):r(e)}},5126:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>p,frontMatter:()=>l,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"quick-starts/framework/wordpress/README","title":"Add authentication to your WordPress application","description":"This tutorial will show you how to integrate Logto into your Wordpress website.","source":"@site/docs/quick-starts/framework/wordpress/README.mdx","sourceDirName":"quick-starts/framework/wordpress","slug":"/quick-starts/wordpress","permalink":"/quick-starts/wordpress","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/docs/quick-starts/framework/wordpress/README.mdx","tags":[],"version":"current","frontMatter":{"slug":"/quick-starts/wordpress","sidebar_label":"WordPress","sidebar_custom_props":{"description":"WordPress is a free and open-source content management system."}},"sidebar":"quickStartSidebar","previous":{"title":"Webflow","permalink":"/quick-starts/webflow"},"next":{"title":"Machine-to-machine","permalink":"/quick-starts/m2m"}}');var s=i(25105),o=i(79621),r=i(58138);const l={slug:"/quick-starts/wordpress",sidebar_label:"WordPress",sidebar_custom_props:{description:"WordPress is a free and open-source content management system."}},d="Add authentication to your WordPress application",c={},a=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Integration",id:"integration",level:2},{value:"Install the plugin",id:"install-the-plugin",level:3},{value:"Configure redirect URI",id:"configure-redirect-uri",level:3},{value:"Set up the plugin",id:"set-up-the-plugin",level:3},{value:"Checkpoint: Test your application",id:"checkpoint-test-your-application",level:3},{value:"Roles mapping",id:"roles-mapping",level:2},{value:"Prerequisites",id:"prerequisites-1",level:3},{value:"Implement role mapping",id:"implement-role-mapping",level:3},{value:"Step 1: access your theme&#39;s functions.php",id:"step-1-access-your-themes-functionsphp",level:3},{value:"Step 2: write the role mapping function",id:"step-2-write-the-role-mapping-function",level:3},{value:"Step 3: understanding the code and customizing it",id:"step-3-understanding-the-code-and-customizing-it",level:3},{value:"Step 4: test your setup",id:"step-4-test-your-setup",level:3},{value:"Further readings",id:"further-readings",level:2},...r.RM];function h(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"add-authentication-to-your-wordpress-application",children:"Add authentication to your WordPress application"})}),"\n",(0,s.jsxs)(t.p,{children:["This tutorial will show you how to integrate Logto into your ",(0,s.jsx)(t.a,{href:"https://wordpress.org",children:"Wordpress"})," website."]}),"\n",(0,s.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["A ",(0,s.jsx)(t.a,{href:"https://cloud.logto.io",children:"Logto Cloud"})," account or a ",(0,s.jsx)(t.a,{href:"/introduction/set-up-logto-oss",children:"self-hosted Logto"}),"."]}),"\n",(0,s.jsx)(t.li,{children:"A Logto traditional application created."}),"\n",(0,s.jsxs)(t.li,{children:["A WordPress project: follow the official ",(0,s.jsx)(t.a,{href:"https://wordpress.org/support/article/how-to-install-wordpress/",children:"Wordpress installation guide"})," to set up your Wordpress website before proceeding."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"integration",children:"Integration"}),"\n",(0,s.jsx)(t.h3,{id:"install-the-plugin",children:"Install the plugin"}),"\n",(0,s.jsxs)(t.p,{children:["We will use the ",(0,s.jsx)(t.a,{href:"https://wordpress.org/plugins/generic-openid-connect/",children:"OpenID Connect Generic"})," plugin to integrate Logto via OIDC protocal into your Wordpress website."]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Log in to your WordPress site."}),"\n",(0,s.jsx)(t.li,{children:'Navigate to "Plugins" and click "Add New".'}),"\n",(0,s.jsx)(t.li,{children:'Search for "OpenID Connect Generic" and install the plugin by daggerhart.'}),"\n",(0,s.jsx)(t.li,{children:"Activate the plugin."}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"configure-redirect-uri",children:"Configure redirect URI"}),"\n",(0,s.jsx)(t.p,{children:'First, let\u2019s configure the redirect URI. You can find it in the plugin settings, scroll down to the "Notes" section, and copy the "Redirect URI" value.'}),"\n",(0,s.jsx)(t.p,{children:'Switch to the Application details page of Logto Console. Add a Redirect URI, and click "Save changes".'}),"\n",(0,s.jsx)(t.h3,{id:"set-up-the-plugin",children:"Set up the plugin"}),"\n",(0,s.jsx)(t.p,{children:"Refer to the following table for the necessary configuration details:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Plugin Field"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Client ID"}),(0,s.jsx)(t.td,{children:"The app ID of your Logto application"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Client Secret"}),(0,s.jsx)(t.td,{children:"The app secret of your Logto application"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"OpenID Scope"}),(0,s.jsxs)(t.td,{children:["Enter ",(0,s.jsx)(t.code,{children:"email profile openid offline_access"})]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Login Endpoint URL"}),(0,s.jsx)(t.td,{children:'The authorization endpoint URL of your Logto application, which is https://[tenant-id].logto.app/oidc/auth, you can click "show endpoint details" in the Logto application page to get the URL.'})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Userinfo Endpoint URL"}),(0,s.jsx)(t.td,{children:"The userinfo endpoint URL of your Logto application, which is https://[tenant-id].logto.app/oidc/me."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Token Validation Endpoint URL"}),(0,s.jsx)(t.td,{children:"The token validation endpoint URL of your Logto application, which is https://[tenant-id].logto.app/oidc/token."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"End Session Endpoint URL"}),(0,s.jsx)(t.td,{children:"The end session endpoint URL of your Logto application, which is https://[tenant-id].logto.app/oidc/session/end."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Identity Key"}),(0,s.jsx)(t.td,{children:"The unique key in the ID token that contains the user's identity, it can be email or sub, depending on your configuration."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Nickname Key"}),(0,s.jsx)(t.td,{children:"The key in the ID token that contains the user's nickname, you can set it to sub and change it later."})]})]})]}),"\n",(0,s.jsx)(t.h3,{id:"checkpoint-test-your-application",children:"Checkpoint: Test your application"}),"\n",(0,s.jsx)(t.p,{children:"Now, you can test your application:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Log out of your WordPress site."}),"\n",(0,s.jsx)(t.li,{children:'Visit the WordPress login page and click the "Sign in with Logto" button.'}),"\n",(0,s.jsx)(t.li,{children:"You will be redirected to the Logto sign-in page."}),"\n",(0,s.jsx)(t.li,{children:"Sign in with your Logto account."}),"\n",(0,s.jsx)(t.li,{children:"You will be redirected back to the WordPress site and logged in automatically."}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"roles-mapping",children:"Roles mapping"}),"\n",(0,s.jsx)(t.p,{children:"WordPress has a built-in user role management system that defines what actions (capabilities) a user can perform on a site. The default user roles include Administrator, Editor, Author, Contributor, and Subscriber, each with its own set of capabilities."}),"\n",(0,s.jsx)(t.p,{children:'Logto employs Role-Based Access Control (RBAC) as its authorization model, utilizing "scopes" as the smallest unit of permission. These scopes define the specific actions that an authenticated user is allowed to perform within an application. However, WordPress operates on a different principle for managing user permissions, relying on predefined "roles" that bundle various capabilities together.'}),"\n",(0,s.jsx)(t.p,{children:"Given this fundamental difference, we suggest creating special roles within Logto that correspond to the roles defined in WordPress. Thoes roles may not have any scopes, they are only used as a reference for mapping users to WordPress roles."}),"\n",(0,s.jsx)(t.h3,{id:"prerequisites-1",children:"Prerequisites"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Setup roles in Logto that correspond to the roles in WordPress. For example, if you have an 'editor' role in WordPress, create a 'group",":editors","' role in Logto."]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"implement-role-mapping",children:"Implement role mapping"}),"\n",(0,s.jsxs)(t.p,{children:["To implement role mapping, we will add custom code to the WordPress theme's ",(0,s.jsx)(t.code,{children:"functions.php"})," file. This involves using the ",(0,s.jsx)(t.code,{children:"wp_login"})," action hook, which triggers when a user logs in. Here's a step-by-step guide on how to set this up:"]}),"\n",(0,s.jsx)(t.h3,{id:"step-1-access-your-themes-functionsphp",children:"Step 1: access your theme's functions.php"}),"\n",(0,s.jsxs)(t.p,{children:["Open your theme\u2019s ",(0,s.jsx)(t.code,{children:"functions.php"})," file. You can access this file through the WordPress admin panel by navigating to Appearance > Theme Editor and selecting ",(0,s.jsx)(t.code,{children:"functions.php"})," from the right-hand side files list. Or in the source code, navigate to your WordPress theme directory and locate the ",(0,s.jsx)(t.code,{children:"functions.php"})," file. This file allows you to add custom PHP functions that extend the functionality of your WordPress site."]}),"\n",(0,s.jsx)(t.h3,{id:"step-2-write-the-role-mapping-function",children:"Step 2: write the role mapping function"}),"\n",(0,s.jsxs)(t.p,{children:["Below is a simple example of a function that you might add to functions.php. This function will be triggered upon user login, and it will assign roles based on the user's ",(0,s.jsx)(t.code,{children:"roles"})," claim fetched from Logto."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-php",children:"function logto_handler($user_login, $user = null) {\n\tif (!$user) {\n\t\t$user = get_user_by('login', $user_login);\n\t}\n\n\t$oidc_claims = get_user_meta($user->ID, 'openid-connect-generic-last-user-claim', true);\n\n\tif (in_array('group:editors', $oidc_claims['roles'])) {\n\t\t$user->set_role('editor');\n\t} else {\n\t\t$user->set_role('subscriber');\n\t}\n}\n\nadd_action('wp_login', 'logto_handler', 10, 2);\n"})}),"\n",(0,s.jsx)(t.h3,{id:"step-3-understanding-the-code-and-customizing-it",children:"Step 3: understanding the code and customizing it"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"logto_handler"})," function: This function takes two parameters: ",(0,s.jsx)(t.code,{children:"$user_login"})," (username) and ",(0,s.jsx)(t.code,{children:"$user"})," (user object). It retrieves roles from Logto which stored in user meta as ",(0,s.jsx)(t.code,{children:"openid-connect-generic-last-user-claim"}),", maps this role to a corresponding WordPress role, and assigns it to the user."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"add_action"}),": This line hooks the ",(0,s.jsx)(t.code,{children:"logto_handler"})," function to the ",(0,s.jsx)(t.code,{children:"wp_login"})," action, which is triggered after a user logs in. The ",(0,s.jsx)(t.code,{children:"10"})," is the priority (default), and ",(0,s.jsx)(t.code,{children:"2"})," indicates the number of arguments the function accepts."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["The example above assigns the 'editor' role to users authenticated via Logto with role name ",(0,s.jsx)(t.code,{children:"group:editors"}),". However, in a real-world scenario, you'll likely need to implement more kinds of role mappings."]}),"\n",(0,s.jsxs)(t.p,{children:["You can find the list of WordPress roles and their capabilities ",(0,s.jsx)(t.a,{href:"https://wordpress.org/support/article/roles-and-capabilities/",children:"here"}),"."]}),"\n",(0,s.jsx)(t.h3,{id:"step-4-test-your-setup",children:"Step 4: test your setup"}),"\n",(0,s.jsxs)(t.p,{children:["Now, let's test the role mapping function by logging in with a user that has the ",(0,s.jsx)(t.code,{children:"group:editors"})," role in Logto. After logging in, check the user's role in WordPress to ensure that the mapping is working correctly."]}),"\n",(0,s.jsx)(t.h2,{id:"further-readings",children:"Further readings"}),"\n",(0,s.jsx)(r.Ay,{})]})}function p(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},79621:(e,t,i)=>{i.d(t,{R:()=>r,x:()=>l});var n=i(58101);const s={},o=n.createContext(s);function r(e){const t=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);