"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[6376],{49613:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var o=n(59496);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=o.createContext({}),u=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return o.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=u(n),m=r,h=d["".concat(l,".").concat(m)]||d[m]||c[m]||a;return n?o.createElement(h,i(i({ref:t},p),{},{components:n})):o.createElement(h,i({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var u=2;u<a;u++)i[u]=n[u];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},67293:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return s},metadata:function(){return u},toc:function(){return c}});var o=n(665),r=n(40151),a=(n(59496),n(49613)),i=["components"],s={slug:"ciam-102-authz-and-rbac",authors:"gao",tags:["ciam","auth","authorization"]},l="CIAM 102: Authorization & Role-based Access Control",u={permalink:"/blog/ciam-102-authz-and-rbac",source:"@site/blog/2023-02-05-ciam-102-authz-and-rbac/index.md",title:"CIAM 102: Authorization & Role-based Access Control",description:"Background",date:"2023-02-05T00:00:00.000Z",formattedDate:"February 5, 2023",tags:[{label:"ciam",permalink:"/blog/tags/ciam"},{label:"auth",permalink:"/blog/tags/auth"},{label:"authorization",permalink:"/blog/tags/authorization"}],readingTime:5.925,hasTruncateMarker:!0,authors:[{name:"Gao",title:"Founder of Silverhand",url:"https://github.com/gao-sun",imageURL:"https://github.com/gao-sun.png",key:"gao"}],frontMatter:{slug:"ciam-102-authz-and-rbac",authors:"gao",tags:["ciam","auth","authorization"]},prevItem:{title:"Do you need to build your own auth for apps?",permalink:"/blog/do-you-need-to-build-auth"},nextItem:{title:"Logto 2023 February Update",permalink:"/blog/releases/2023-feb"}},p={authorsImageUrls:[void 0]},c=[{value:"Background",id:"background",level:2},{value:"Why do we need authorization?",id:"why-do-we-need-authorization",level:3},{value:"The basic authorization model",id:"the-basic-authorization-model",level:2},{value:"Role-based Access Control",id:"role-based-access-control",level:2},{value:"Define resources",id:"define-resources",level:3},{value:"Define permissions",id:"define-permissions",level:3},{value:"Define roles",id:"define-roles",level:3},{value:"Assign roles to users",id:"assign-roles-to-users",level:3},{value:"Connect to dots",id:"connect-to-dots",level:3},{value:"Other RBAC levels",id:"other-rbac-levels",level:3},{value:"In practice",id:"in-practice",level:2},{value:"Closing notes",id:"closing-notes",level:2}],d={toc:c};function m(e){var t=e.components,n=(0,r.Z)(e,i);return(0,a.kt)("wrapper",(0,o.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"background"},"Background"),(0,a.kt)("p",null,"In the ",(0,a.kt)("a",{parentName:"p",href:"/blog/ciam-101-intro-authn-sso"},"previous article"),", we introduced the concept of authentication (AuthN) and authorization (AuthZ), along with some headachy terms: Identity, Organization, Tenant, etc."),(0,a.kt)("p",null,"Organization and Tenant are great for grouping Identities, but they lead to an absolute democracy: everyone can do anything in this system. While utopia is still a mystery, let\u2019s take a look at the governance of access: Authorization (AuthZ)."),(0,a.kt)("h3",{id:"why-do-we-need-authorization"},"Why do we need authorization?"),(0,a.kt)("admonition",{title:"Recall",type:"info"},(0,a.kt)("p",{parentName:"admonition"},"Authorization (AuthZ) answers the question \u201cWhat can you do?\u201d")),(0,a.kt)("p",null,"Notion is a great example. For each page you own, you can choose to keep it private, accessible only to you, or share it with friends, or even the public."),(0,a.kt)("p",null,"Or, for an online bookstore, you want everyone to be able to view all books, but customers to only view their own orders, and sellers to manage only the books in their stores."),(0,a.kt)("p",null,"AuthZ and AuthN are essential components of a complex business model. They often go hand-in-hand; AuthZ verifies a user's access, while AuthN authenticates identities. Both are necessary for a secure system."),(0,a.kt)("h2",{id:"the-basic-authorization-model"},"The basic authorization model"),(0,a.kt)("p",null,"Here\u2019s one of the most common AuthZ models: If ",(0,a.kt)("strong",{parentName:"p"},"IDENTITY")," performs ",(0,a.kt)("strong",{parentName:"p"},"ACTION")," on ",(0,a.kt)("strong",{parentName:"p"},"RESOURCE"),", then ",(0,a.kt)("strong",{parentName:"p"},"ACCEPT")," or ",(0,a.kt)("strong",{parentName:"p"},"DENY"),"."),(0,a.kt)("p",null,"In the Notion example, the model is ",(0,a.kt)("strong",{parentName:"p"},"PERSON")," performs ",(0,a.kt)("strong",{parentName:"p"},"VIEW")," on ",(0,a.kt)("strong",{parentName:"p"},"PAGE.")),(0,a.kt)("p",null,"If the page is private:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"You\u2019ll receive ",(0,a.kt)("strong",{parentName:"li"},"ACCEPT")," when performing ",(0,a.kt)("strong",{parentName:"li"},"VIEW")," on your ",(0,a.kt)("strong",{parentName:"li"},"PAGE"),"."),(0,a.kt)("li",{parentName:"ul"},"Everyone else should receive ",(0,a.kt)("strong",{parentName:"li"},"DENY")," when performing ",(0,a.kt)("strong",{parentName:"li"},"VIEW")," on your ",(0,a.kt)("strong",{parentName:"li"},"PAGE"),".")),(0,a.kt)("p",null,"Based on consensus, the industry developed various authorization technologies, such as Role-based Access Control (RBAC), Attribute-based Access Control (ABAC). Today, we will focus on the ",(0,a.kt)("a",{parentName:"p",href:"https://csrc.nist.gov/CSRC/media/Publications/conference-paper/2000/07/26/the-nist-model-for-role-based-access-control-towards-a-unified-/documents/sandhu-ferraiolo-kuhn-00.pdf"},"NIST RBAC model")," Level 1: Flat RBAC."),(0,a.kt)("h2",{id:"role-based-access-control"},"Role-based Access Control"),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},'The NIST RBAC model left many things open to provide flexibility and adaptability for various scenarios. Logto now adopts the Level 1 definition with an additional concept "Resource" (i.e. API Resource).')),(0,a.kt)("p",null,"Let's extend the bookstore example. Say we have many customers, but only one seller:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Customers can view and order books, as well as view their own orders."),(0,a.kt)("li",{parentName:"ul"},"The seller can view, create, and delete books, and manage customer orders.")),(0,a.kt)("h3",{id:"define-resources"},"Define resources"),(0,a.kt)("p",null,"In Logto, a resource (i.e. API Resource) usually represents a set of entities or items, since it\u2019s required to use a valid URL as the indicator. Hence we define two resources:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Books: ",(0,a.kt)("inlineCode",{parentName:"li"},"https://api.bookstore.io/books")),(0,a.kt)("li",{parentName:"ul"},"Orders: ",(0,a.kt)("inlineCode",{parentName:"li"},"https://api.bookstore.io/orders"))),(0,a.kt)("p",null,"One of the advantages of enforcing the URL format is it can map to a real address of your API service, which improves the readability and recognizability when integrating with other components in the system."),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"\ud83e\udd14 Resources should be divided according to the needs of the business. There is no one-size-fits-all approach; the decision should be made on a case-by-case basis. The example in this article that divides Books and Orders may be suitable for microservices, but not for a monolithic architecture.")),(0,a.kt)("h3",{id:"define-permissions"},"Define permissions"),(0,a.kt)("p",null,"Since we introduced the concept of resource, in Logto, we also enforce that permissions must belong to a resource, in reverse, resources can have permissions."),(0,a.kt)("p",null,"Let\u2019s add some permissions the the resources:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Books: ",(0,a.kt)("inlineCode",{parentName:"li"},"read"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"create"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"delete")),(0,a.kt)("li",{parentName:"ul"},"Orders: ",(0,a.kt)("inlineCode",{parentName:"li"},"read"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"read:self"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"create:self"),", ",(0,a.kt)("inlineCode",{parentName:"li"},"delete"))),(0,a.kt)("p",null,"Although there\u2019s no requirement of the name of a permission, we have the convention as below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"<action>[:<target>]\n")),(0,a.kt)("p",null,"While ",(0,a.kt)("inlineCode",{parentName:"p"},"<action>")," is required to describe a permission, ",(0,a.kt)("inlineCode",{parentName:"p"},":<target>")," can be ignored to describe a general target, i.e. to all entities or items in the resource. For example:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Permission ",(0,a.kt)("inlineCode",{parentName:"li"},"read")," in resource Books means the action to read arbitrary books."),(0,a.kt)("li",{parentName:"ul"},"Permission ",(0,a.kt)("inlineCode",{parentName:"li"},"create:self")," in resource Orders means the action to create orders that belong to the current user.")),(0,a.kt)("h3",{id:"define-roles"},"Define roles"),(0,a.kt)("p",null,"In short, a role is a group of permissions. Let\u2019s create two roles ",(0,a.kt)("inlineCode",{parentName:"p"},"customer")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"seller")," and assign permissions to them as below:"),(0,a.kt)("mermaid",{value:'erDiagram\n\t"Role: customer" {\n\t\tpermission Books "read"\n\t\tpermission Orders "read:self"\n\t\tpermission Orders "create:self"\n\t}\n\n\t"Role: seller" {\n\t\tpermission Books "read"\n\t\tpermission Books "create"\n\t\tpermission Books "delete"\n\t\tpermission Orders "read"\n\t\tpermission Orders "delete"\n\t}\n'}),(0,a.kt)("p",null,"You may notice the permission-role assignment is many-to-many relations."),(0,a.kt)("h3",{id:"assign-roles-to-users"},"Assign roles to users"),(0,a.kt)("p",null,"Just like role-permission assignment, user-role assignment is also a many-to-many relationship. Therefore, you can assign multiple roles to a single user, and a single role can be assigned to multiple users."),(0,a.kt)("h3",{id:"connect-to-dots"},"Connect to dots"),(0,a.kt)("p",null,"Here\u2019s a complete relationship diagram for the Level 1 RBAC model in Logto:"),(0,a.kt)("mermaid",{value:'erDiagram\n\tUser }|--|{ Role : maps\n\tRole }|--|{ Permission : maps\n\t"API Resource" ||--|{ Permission : contains'}),(0,a.kt)("p",null,'In the RBAC model, permissions are always "positive", meaning the authorization judgement is simple: if a user has the permission, then accept; otherwise, reject.'),(0,a.kt)("p",null,"Let's say Alice has the role ",(0,a.kt)("inlineCode",{parentName:"p"},"seller"),", Bob and Carol have the role ",(0,a.kt)("inlineCode",{parentName:"p"},"customer"),". We'll describe actions in natural language first, and transpile them to the standard authorization format: ",(0,a.kt)("strong",{parentName:"p"},"IDENTITY")," performs ",(0,a.kt)("strong",{parentName:"p"},"ACTION")," on ",(0,a.kt)("strong",{parentName:"p"},"RESOURCE"),", finally giving the conclusion."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Alice wants to add a new book for sale:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"User Alice performs ",(0,a.kt)("inlineCode",{parentName:"li"},"create")," on resource Books (",(0,a.kt)("inlineCode",{parentName:"li"},"https://api.bookstore.io/books"),")."),(0,a.kt)("li",{parentName:"ul"},"Since Alice has been assigned the permission ",(0,a.kt)("inlineCode",{parentName:"li"},"create")," of Books according to their role ",(0,a.kt)("inlineCode",{parentName:"li"},"seller"),", the result is \u2705 ",(0,a.kt)("strong",{parentName:"li"},"ACCEPT"),"."))),(0,a.kt)("li",{parentName:"ul"},"Alice wants to view all orders to see if the sale meets their expectation:",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"User Alice performs ",(0,a.kt)("inlineCode",{parentName:"li"},"read")," on resource Orders (",(0,a.kt)("inlineCode",{parentName:"li"},"https://api.bookstore.io/orders"),")."),(0,a.kt)("li",{parentName:"ul"},"Since Alice has been assigned the permission ",(0,a.kt)("inlineCode",{parentName:"li"},"read")," of Orders according to their role ",(0,a.kt)("inlineCode",{parentName:"li"},"seller"),", the result is \u2705 ",(0,a.kt)("strong",{parentName:"li"},"ACCEPT"),"."))),(0,a.kt)("li",{parentName:"ul"},"Bob wants to browse the book list to see if there\u2019s any books they want to purchase.",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"User Bob performs ",(0,a.kt)("inlineCode",{parentName:"li"},"read")," on resource Books (",(0,a.kt)("inlineCode",{parentName:"li"},"https://api.bookstore.io/books"),")."),(0,a.kt)("li",{parentName:"ul"},"Since Bob has been assigned the permission ",(0,a.kt)("inlineCode",{parentName:"li"},"read")," of Books according to their role ",(0,a.kt)("inlineCode",{parentName:"li"},"cusomter"),", the result is \u2705 ",(0,a.kt)("strong",{parentName:"li"},"ACCEPT"),"."))),(0,a.kt)("li",{parentName:"ul"},"Bob wants to view Carol\u2019s order.",(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},"Since it\u2019s someone else\u2019s order, the permission ",(0,a.kt)("inlineCode",{parentName:"li"},"read:self")," of ",(0,a.kt)("inlineCode",{parentName:"li"},"Orders")," does not work here."),(0,a.kt)("li",{parentName:"ul"},"User Bob performs ",(0,a.kt)("inlineCode",{parentName:"li"},"read")," on resource Orders (",(0,a.kt)("inlineCode",{parentName:"li"},"https://api.bookstore.io/order"),")."),(0,a.kt)("li",{parentName:"ul"},"Since Bob has no permission ",(0,a.kt)("inlineCode",{parentName:"li"},"read")," of Orders, the result is \u274c ",(0,a.kt)("strong",{parentName:"li"},"DENY"),".")))),(0,a.kt)("h3",{id:"other-rbac-levels"},"Other RBAC levels"),(0,a.kt)("p",null,"There are four levels in the NIST RBAC model:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Flat RBAC"),(0,a.kt)("li",{parentName:"ul"},"Hierarchical RBAC"),(0,a.kt)("li",{parentName:"ul"},"Constrained RBAC"),(0,a.kt)("li",{parentName:"ul"},"Symmetric RBAC")),(0,a.kt)("p",null,"See the ",(0,a.kt)("a",{parentName:"p",href:"https://csrc.nist.gov/CSRC/media/Publications/conference-paper/2000/07/26/the-nist-model-for-role-based-access-control-towards-a-unified-/documents/sandhu-ferraiolo-kuhn-00.pdf"},"paper")," for details if you are interested."),(0,a.kt)("p",null,"Logto now has the Level 1 implementation and will progress to higher levels based on community feedback. Don\u2019t hesitate to let us know if a higher level fits your need!"),(0,a.kt)("h2",{id:"in-practice"},"In practice"),(0,a.kt)("p",null,"Beside the theory, we still have heavy technical works to complete in order to make the model work as expected:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Client and auth server development"),(0,a.kt)("li",{parentName:"ul"},"Database design for RBAC"),(0,a.kt)("li",{parentName:"ul"},"Validation across different services"),(0,a.kt)("li",{parentName:"ul"},"Security and open-standard compliance"),(0,a.kt)("li",{parentName:"ul"},"Role, permission, resource management and assignment")),(0,a.kt)("p",null,"Don\u2019t panic. We've taken this into account and added out-of-the-box support to cover all of the above. Check out the ",(0,a.kt)("a",{parentName:"p",href:"/docs/recipes/rbac/"},"\ud83d\udd10 RBAC recipe")," to learn how to use RBAC in Logto."),(0,a.kt)("h2",{id:"closing-notes"},"Closing notes"),(0,a.kt)("p",null,"RBAC is a powerful access management model for most cases, but there\u2019s no silver bullet. We still have some questions:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Do I need high levels of RBAC?"),(0,a.kt)("li",{parentName:"ul"},"How does RBAC compare to other authorization models?"),(0,a.kt)("li",{parentName:"ul"},"How to define authorization model between different Organizations?")),(0,a.kt)("admonition",{type:"note"},(0,a.kt)("p",{parentName:"admonition"},"\ud83d\udd25 Stay tuned. We\u2019ll see you in CIAM 103!")))}m.isMDXComponent=!0}}]);