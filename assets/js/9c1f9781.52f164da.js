"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[45891],{85157:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>p,frontMatter:()=>r,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"end-user-flows/enterprise-sso/idp-initiated-sso","title":"idp-initiated-sso","description":"IdP-initiated SSO is a single sign-on process where the Identity Provider (IdP) primarily controls the authentication flow. This process begins when a user logs into the IdP\'s platform, such as a company portal or a centralized identity dashboard. Once authenticated, the IdP generates an SAML assertion and directs the user to the Service Provider (SP) to access the application or service.","source":"@site/docs/end-user-flows/enterprise-sso/idp-initiated-sso.mdx","sourceDirName":"end-user-flows/enterprise-sso","slug":"/end-user-flows/enterprise-sso/idp-initiated-sso","permalink":"/end-user-flows/enterprise-sso/idp-initiated-sso","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/docs/end-user-flows/enterprise-sso/idp-initiated-sso.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_label":"IdP-initiated SSO","sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"SP-initiated SSO","permalink":"/end-user-flows/enterprise-sso/sp-initiated-sso"},"next":{"title":"Enterprise SSO identity","permalink":"/end-user-flows/enterprise-sso/enterprise-sso-identity"}}');var s=i(25105),o=i(79621),a=i(77399);const r={sidebar_label:"IdP-initiated SSO",sidebar_position:2},d="IdP-initiated SSO (SAML only)",c={},l=[{value:"Risks and considerations",id:"risks-and-considerations",level:2},{value:"Connect IdP-initiated SSO with Logto OIDC applications",id:"connect-idp-initiated-sso-with-logto-oidc-applications",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Enable IdP-initiated SSO",id:"enable-idp-initiated-sso",level:3},{value:"Select the SP application",id:"select-the-sp-application",level:3},{value:"Configure IdP-initiated authentication flow",id:"configure-idp-initiated-authentication-flow",level:2},{value:"Option A: Redirect to the default SP application (Recommended)",id:"option-a-redirect-to-the-default-sp-application-recommended",level:3},{value:"Option B: Directly authenticate the user with IdP-initiated SSO",id:"option-b-directly-authenticate-the-user-with-idp-initiated-sso",level:3}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components},{CloudLink:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("CloudLink",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.A,{cloud:"comingSoon",oss:!1}),"\n",(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"idp-initiated-sso-saml-only",children:"IdP-initiated SSO (SAML only)"})}),"\n",(0,s.jsx)(t.p,{children:"IdP-initiated SSO is a single sign-on process where the Identity Provider (IdP) primarily controls the authentication flow. This process begins when a user logs into the IdP's platform, such as a company portal or a centralized identity dashboard. Once authenticated, the IdP generates an SAML assertion and directs the user to the Service Provider (SP) to access the application or service."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"IdP-initiated SSO",src:i(75648).A+"",width:"2250",height:"1530"})}),"\n",(0,s.jsx)(t.h2,{id:"risks-and-considerations",children:"Risks and considerations"}),"\n",(0,s.jsxs)(t.p,{children:["IdP-initiated SSO can introduce several security vulnerabilities that organizations should be aware of. Since the authentication process is initiated by the IdP without a direct request from the user, it can be susceptible to various attacks, including ",(0,s.jsx)(t.a,{href:"https://blog.logto.io/csrf",children:"Cross-Site Request Forgery"})," (CSRF)."]}),"\n",(0,s.jsx)(t.p,{children:"This lack of user-initiated authentication can lead to unauthorized access if proper safeguards are not in place. Additionally, the reliance on a single point of authentication increases the risk of a security breach, as compromising the IdP could expose all connected applications."}),"\n",(0,s.jsx)(t.p,{children:"Therefore, it is highly recommended to use SP-initiated SSO, which provides a more secure and controlled authentication flow, ensuring that users explicitly request access to services."}),"\n",(0,s.jsx)(t.h2,{id:"connect-idp-initiated-sso-with-logto-oidc-applications",children:"Connect IdP-initiated SSO with Logto OIDC applications"}),"\n",(0,s.jsx)(t.p,{children:"Logto as an OpenID Connect (OIDC) provider does not support IdP-initiated SSO. However, you can configure Logto as a SP to support IdP-initiated SSO with your enterprise IdP using SAML. This setup allows you to leverage Logto's authentication capabilities while maintaining the IdP's control over the authentication flow."}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsxs)(t.p,{children:["By default, this feature is not enabled in Logto. If you need IdP-initiated SSO enabled for your tenant, please contact our ",(0,s.jsx)(t.a,{href:"https://logto.io/contact?src=docs.sso",children:"support team"}),"."]})}),"\n",(0,s.jsx)(t.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(t.p,{children:["Before configuring IdP-initiated SSO, you need to create a SAML connector first. Navigate to the ",(0,s.jsx)(n,{to:"/enterprise-sso",children:"Console > Enterprise SSO"})," and follow the step-by-step guide to set up a ",(0,s.jsx)(t.a,{href:"/integrations/saml-sso/",children:"SAML"})," connector with your IdP."]}),"\n",(0,s.jsxs)(t.p,{children:["Once the SAML connector is set up, you can enable the SSO sign-in method in the ",(0,s.jsx)(n,{to:"/sign-in-experience",children:"Sign-in experience"})," section, and test the SP-initiated SSO flow to ensure that the configuration is correct. Make sure the SP-initiated SSO is working as expected before proceeding with IdP-initiated SSO."]}),"\n",(0,s.jsx)(t.h3,{id:"enable-idp-initiated-sso",children:"Enable IdP-initiated SSO"}),"\n",(0,s.jsxs)(t.p,{children:["Once the IdP-initiated SSO feature is enabled for your tenant, you should see an extra tab in your SAML connector's settings page, called ",(0,s.jsx)(t.strong,{children:"IdP-initiated SSO"}),". Enable the ",(0,s.jsx)(t.strong,{children:"IdP-initiated SSO"})," toggle to activate the feature for the connector."]}),"\n",(0,s.jsx)(t.h3,{id:"select-the-sp-application",children:"Select the SP application"}),"\n",(0,s.jsxs)(t.p,{children:["Unlike SP-initiated SSO, where the authentication flow starts from the SP, IdP-initiated SSO requires a client side SP application to redirect users after the authentication process. You can select the SP application from the list of registered applications in the ",(0,s.jsx)(t.strong,{children:"Default application"})," dropdown."]}),"\n",(0,s.jsxs)(t.p,{children:["Only ",(0,s.jsx)(t.strong,{children:"Traditional Web App"})," and ",(0,s.jsx)(t.strong,{children:"Single Page App"})," applications are supported for IdP-initiated SSO. Make sure to select the appropriate application type based on your use case."]}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsxs)(t.p,{children:["On you IdP's side, leave the ",(0,s.jsx)(t.code,{children:"RelayState"})," parameter to ",(0,s.jsx)(t.strong,{children:"EMPTY"})," for the IdP-initiated SSO flow to work correctly. Logto will handle the redirection based on the default SP application selected."]})}),"\n",(0,s.jsx)(t.h2,{id:"configure-idp-initiated-authentication-flow",children:"Configure IdP-initiated authentication flow"}),"\n",(0,s.jsx)(t.p,{children:"In order to connect IdP-initiated SAML SSO with OIDC, Logto provides two configuration options to handle the authentication request."}),"\n",(0,s.jsx)(t.h3,{id:"option-a-redirect-to-the-default-sp-application-recommended",children:"Option A: Redirect to the default SP application (Recommended)"}),"\n",(0,s.jsx)(t.p,{children:"When the IdP initiates the SSO flow, and sends the SAML assertion to Logto, an IdP-initiated SSO assertion session will be created. Logto will redirect the user to the default SP application to initiate a standard OIDC authentication request at the client side."}),"\n",(0,s.jsx)(t.mermaid,{value:"sequenceDiagram\n    actor User\n    participant IdP as IdP\n    participant Logto as Logto\n    participant Experience as sign-in experience\n    participant SP as Client\n\n    User->>IdP: Log in and select SP application\n    IdP->>Logto: Redirect to Logto with SAML assertion\n    Logto--\x3e>Logto: Preserve IdP-initiated SSO assertion session\n    Logto->>SP: Redirect to default SP application\n    SP->>Logto: OIDC authentication request\n    Logto->>Experience: Redirect user to sign-in experience\n    Experience--\x3e>Logto: Validate IdP-initiated SSO assertion session (silent authentication)\n    Logto->>SP: Authenticate and redirect to SP application with authorization code\n    SP->>Logto: OIDC token request\n    Logto->>SP: token response\n    SP->>User: Authenticate user"}),"\n",(0,s.jsxs)(t.p,{children:["To setup this option, select the ",(0,s.jsx)(t.strong,{children:"Redirect to client for SP-initiated authentication"})," card in the ",(0,s.jsx)(t.strong,{children:"IdP-initiated SSO"})," tab of the SAML connector settings."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"SP-initiated SSO flow",src:i(52130).A+"",width:"2336",height:"1070"})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Provide a ",(0,s.jsx)(t.strong,{children:"Client redirect URL"})," to redirect the user to the default SP application after the IdP-initiated SSO flow. Logto will redirect the user to this URL with the ",(0,s.jsx)(t.code,{children:"?ssoConnectorId={connectorId}"})," query parameter appended to the URL. The client application should handle the redirection and initiate the OIDC authentication request. (We recommend using a dedicated route or page in your client application to handle the IdP-initiated SSO authentication request.)"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Handle the OIDC authentication request at the client side using the ",(0,s.jsx)(t.code,{children:"ssoConnectorId"})," query parameter to identify the SAML connector that initiated the IdP-initiated SSO authentication flow."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Pass the ",(0,s.jsx)(t.a,{href:"/end-user-flows/authentication-parameters/direct-sign-in/",children:"direct sign-in"})," authentication parameter in the sign-in request to Logto to complete the SSO authentication flow."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-typescript",children:"// React example\nimport { Prompt, useLogto } from '@logto/react';\nimport { useEffect } from 'react';\nimport { useNavigate, useSearchParams } from 'react-router-dom';\n\nconst SsoDirectSignIn = () => {\n  const { signIn } = useLogto();\n  const [searchParams] = useSearchParams();\n\n  useEffect(() => {\n    const ssoConnectorId = searchParams.get('ssoConnectorId');\n    if (ssoConnectorId) {\n      void signIn({\n        redirectUri,\n        prompt: Prompt.Login,\n        directSignIn: {\n          method: 'sso',\n          target: ssoConnectorId,\n        },\n      });\n    }\n  }, [searchParams, signIn]);\n};\n"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"redirectUri"}),": The ",(0,s.jsx)(t.code,{children:"redirect_uri"})," to redirect the user after the OIDC authentication flow is completed."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"prompt=login"}),": Forces the user to log in using the IdP-initiated SSO identity."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"directSignIn=sso:{connectorId}"}),": Specifies the direct sign-in method as ",(0,s.jsx)(t.code,{children:"sso"})," and the target SAML connector ID. This parameter will trigger the SSO authentication flow directly without showing the login page. User will be automatically authenticated using the preserved IdP-initiated SSO assertion session if the connector ID matches and the session is valid."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["This method ensures that the authentication flow is secure and follows the standard OIDC protocol, while maintaining the IdP's control over the authentication process. Client app can take advantage of the IdP-initiated SSO assertion session to authenticate the user without additional login steps, while keeping the authentication flow secure and controlled. The client app can still validate the ",(0,s.jsx)(t.code,{children:"state"})," and ",(0,s.jsx)(t.code,{children:"PKCE"})," parameters to ensure the authentication request is secure."]}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsxs)(t.p,{children:["This method is available for both ",(0,s.jsx)(t.strong,{children:"Traditional Web App"})," and ",(0,s.jsx)(t.strong,{children:"Single Page App"})," applications. And it is recommended for all the use cases."]})}),"\n",(0,s.jsx)(t.h3,{id:"option-b-directly-authenticate-the-user-with-idp-initiated-sso",children:"Option B: Directly authenticate the user with IdP-initiated SSO"}),"\n",(0,s.jsx)(t.p,{children:"For certain circumstances, SP may not be able to handle the IdP-initiated SSO callback and initiate the OIDC authentication request. In this case, Logto provides an alternative option to directly authenticate the user with the IdP-initiated SSO assertion session."}),"\n",(0,s.jsxs)(t.p,{children:["This option is considered less secure and not recommended. The authentication flow bypasses the standard OIDC protocol. As the authentication request is initiated by the IdP, the client app may not be able to validate the authentication request securely. E.g. the client app can not validate the ",(0,s.jsx)(t.code,{children:"state"})," and ",(0,s.jsx)(t.code,{children:"PKCE"})," parameters to ensure the authentication request is secure."]}),"\n",(0,s.jsx)(t.admonition,{type:"warning",children:(0,s.jsxs)(t.p,{children:["This method is not available for ",(0,s.jsx)(t.strong,{children:"Single Page App"})," applications, as it requires the client app to handle the authentication request securely using the ",(0,s.jsx)(t.code,{children:"PKCE"})," parameter. If you need to implement IdP-initiated SSO for a SPA application, please use the above option instead."]})}),"\n",(0,s.jsx)(t.mermaid,{value:"  sequenceDiagram\n\n  actor User\n  participant IdP as IdP\n  participant Logto as Logto\n  participant Experience as sign-in experience\n  participant SP as Client\n\n  User->>IdP: Log in and select SP application\n  IdP->>Logto: Redirect to Logto with SAML assertion\n  Logto--\x3e>Logto: Preserve IdP-initiated SSO assertion session\n  Logto--\x3e>Logto: Initiate OIDC authentication request\n  Logto->>Experience: Redirect user to sign-in experience\n  Experience--\x3e>Logto: Validate IdP-initiated SSO assertion session (silent authentication)\n  Logto->>SP: Authenticate and redirect to SP application with authorization code (No state or PKCE validation)\n  SP->>Logto: OIDC token request\n  Logto->>SP: token response\n  SP->>User: Authenticate user"}),"\n",(0,s.jsxs)(t.p,{children:["To configure this option, select the ",(0,s.jsx)(t.strong,{children:"Directly sign-in using IdP-initiated SSO"})," option in the ",(0,s.jsx)(t.strong,{children:"IdP-initiated SSO"})," tab of the SAML connector settings."]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"IdP-initiated SSO flow",src:i(34821).A+"",width:"2336",height:"1422"})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Select the ",(0,s.jsx)(t.strong,{children:"Post sign-in redirect URI"})," to redirect the user back to the client application after successful authentication. This URL will be used as the ",(0,s.jsx)(t.code,{children:"redirect_uri"})," in the OIDC authentication request. The URI must be one of the allowed redirect URIs registered in the client application."]}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsxs)(t.p,{children:["It is highly recommended to use a dedicated ",(0,s.jsx)(t.strong,{children:"redirect URI"})," for IdP-initiated SSO. Given that the authentication request is unsolicited, the client application should manage the response independently, separate from the standard SP-initiated authentication flow."]})}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Customize the authorization request parameters if needed using the ",(0,s.jsx)(t.strong,{children:"Additional authentication parameters"})," json editor (following the type ",(0,s.jsx)(t.code,{children:"Map<string,string>"}),")."]}),"\n",(0,s.jsxs)(t.p,{children:["E.g. By default Logto only requests the ",(0,s.jsx)(t.code,{children:"openid"})," and ",(0,s.jsx)(t.code,{children:"profile"})," scopes. You can add additional scopes or parameters to the authentication request."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",children:'{\n  "scope": "email offline_access"\n}\n'})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["add additional ",(0,s.jsx)(t.code,{children:"email"})," scope to request the user's email address."]}),"\n",(0,s.jsxs)(t.li,{children:["add ",(0,s.jsx)(t.code,{children:"offline_access"})," scope to request the refresh token."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["We also recommend you to provide a custom ",(0,s.jsx)(t.code,{children:"state"})," parameter to validate the authentication response securely."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",children:'{\n  "state": "custom-state-value"\n}\n'})}),"\n",(0,s.jsxs)(t.p,{children:["The client app should validate the ",(0,s.jsx)(t.code,{children:"state"})," parameter in the authorization code response to ensure the authentication request is valid."]}),"\n"]}),"\n"]})]})}function p(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},77399:(e,t,i)=>{i.d(t,{A:()=>a});const n="availability_kRMk";var s=i(25105);const o=e=>"comingSoon"===e?"coming soon-blue":"boolean"==typeof e?e?"\u2713 available-4EA254":"not applicable-78767F":`since v${e.major}.${e.minor}-4EA254`,a=e=>{let{cloud:t,oss:i}=e;return(0,s.jsxs)("div",{className:n,children:[(0,s.jsx)("img",{alt:"Cloud availability",src:`https://img.shields.io/badge/Cloud-${o(t)}`}),(0,s.jsx)("img",{alt:"OSS availability",src:`https://img.shields.io/badge/OSS-${o(i)}`})]})}},75648:(e,t,i)=>{i.d(t,{A:()=>n});const n=i.p+"assets/images/idp-initiated-sso-portal-1b3deb662e1a548801c88fb3a3bbbc25.png"},52130:(e,t,i)=>{i.d(t,{A:()=>n});const n=i.p+"assets/images/idp-initiated-sso-redirect-69783e23ee4e33ca7f1cf4e78045d8f9.png"},34821:(e,t,i)=>{i.d(t,{A:()=>n});const n=i.p+"assets/images/idp-initiated-sso-sign-in-3abafcd93461508577bada1a50df912f.png"},79621:(e,t,i)=>{i.d(t,{R:()=>a,x:()=>r});var n=i(58101);const s={},o=n.createContext(s);function a(e){const t=n.useContext(o);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),n.createElement(o.Provider,{value:t},e.children)}}}]);