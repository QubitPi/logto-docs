"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[4327],{13524:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>r,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"end-user-flows/one-time-token","title":"Magic link (One-time token)","description":"Similar to one-time password (OTP), a one-time token is another passwordless authentication method that can be used to verify a user\'s identity.","source":"@site/docs/end-user-flows/one-time-token.mdx","sourceDirName":"end-user-flows","slug":"/end-user-flows/one-time-token","permalink":"/end-user-flows/one-time-token","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/docs/end-user-flows/one-time-token.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"docsSidebar","previous":{"title":"Direct sign-in","permalink":"/end-user-flows/authentication-parameters/direct-sign-in"},"next":{"title":"Consent screen","permalink":"/end-user-flows/consent-screen"}}');var a=i(25105),o=i(79621),s=i(88969);const r={sidebar_position:5},l="Magic link (One-time token)",c={},d=[{value:"One-time token flow",id:"one-time-token-flow",level:2},{value:"Implementation guide",id:"implementation-guide",level:2},{value:"Step 1: Request one-time token",id:"step-1-request-one-time-token",level:3},{value:"Step 2: Compose your magic link",id:"step-2-compose-your-magic-link",level:3},{value:"Step 3: Trigger the authentication flow via Logto SDK",id:"step-3-trigger-the-authentication-flow-via-logto-sdk",level:3},{value:"Step 4: (Optional) Clear cached tokens in sign-in callback page",id:"step-4-clear-cached-tokens-in-sign-in-callback-page",level:3},{value:"FAQs",id:"faqs",level:2},{value:"Can I use the magic link to invite new users to my organizations?",id:"can-i-use-the-magic-link-to-invite-new-users-to-my-organizations",level:3},{value:"Does the one-time token expire?",id:"does-the-one-time-token-expire",level:3},{value:"If I disable user registration in &quot;Sign-in Experience&quot;, can I still use magic link to invite users?",id:"if-i-disable-user-registration-in-sign-in-experience-can-i-still-use-magic-link-to-invite-users",level:3},{value:"What will happen if a user already signed in, and then click another magic link?",id:"what-will-happen-if-a-user-already-signed-in-and-then-click-another-magic-link",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",...(0,o.R)(),...e.components},{Details:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"magic-link-one-time-token",children:"Magic link (One-time token)"})}),"\n","\n",(0,a.jsx)(s.A,{cloud:!0,oss:{major:1,minor:27}}),"\n",(0,a.jsx)(n.p,{children:"Similar to one-time password (OTP), a one-time token is another passwordless authentication method that can be used to verify a user's identity.\nThe token is valid for a limited period of time, and associated with an email address of the end user."}),"\n",(0,a.jsx)(n.p,{children:'Sometimes you may want to invite new users to your application / organization without requiring them to create an account first.\nOr you may forget your password and want to sign-in / reset your password by quickly verifying your identify via email.\nIn such cases, the application can send a "magic link" to your email. And you will be authenticated immediately when you click the link.'}),"\n",(0,a.jsx)(n.p,{children:"Application developers can use the one-time token to compose a magic link, and send it to the end user's email address."}),"\n",(0,a.jsx)(n.h2,{id:"one-time-token-flow",children:"One-time token flow"}),"\n",(0,a.jsx)(n.p,{children:"Here is the sequence diagram of the authentication flow using one-time token:"}),"\n",(0,a.jsx)(n.mermaid,{value:"sequenceDiagram\n  participant U as End user\n  participant C as Your application\n  participant L as Logto\n\n  U ->> C: (Optional) User requests a magic link from your application\n  C ->> L: Request one-time token\n  L --\x3e> C: Return one-time token\n  C --\x3e> U: Compose a magic link that contains one-time token and send it to end user's email\n  U ->> C: User clicks magic link and gets redirected to a landing page of your application\n  C ->> L: Extract the one-time token from the magic link and triggers the authentication flow\n  L --\x3e> C: Logto verifies the one-time token and returns result\n  C --\x3e> U: User is authenticated and returns userinfo to user"}),"\n",(0,a.jsx)(n.h2,{id:"implementation-guide",children:"Implementation guide"}),"\n",(0,a.jsx)(n.p,{children:"Logto offers a set of both Management APIs and Experience APIs to ease the implementation of your magic link."}),"\n",(0,a.jsxs)(n.p,{children:["Before you start, make sure you have a Logto instance ready, and have established the Machine-to-Machine connection between your application server\nand Logto endpoint (required for the Management APIs). Learn more about ",(0,a.jsx)(n.a,{href:"/integrate-logto/interact-with-management-api",children:"Logto Management API"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"step-1-request-one-time-token",children:"Step 1: Request one-time token"}),"\n",(0,a.jsx)(n.p,{children:"Use Logto Management API to create a one-time token."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"POST /api/one-time-tokens\n"})}),"\n",(0,a.jsx)(n.p,{children:"Sample request body payload:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "email": "user@example.com",\n  // Optional. Defaults to 600 (10 mins).\n  "expiresIn": 3600,\n  // Optional. User will be provisioned to the specified organizations upon successful verification.\n  "context": {\n    "jitOrganizationIds": ["abcdefgh1234"]\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"step-2-compose-your-magic-link",children:"Step 2: Compose your magic link"}),"\n",(0,a.jsxs)(n.p,{children:["After you get the one-time token, you can compose a magic link and send it to the end user's email address.\nThe magic link should at least contain the token and the user email as parameters, and should navigate to a landing page in your own application.\nE.g. ",(0,a.jsx)(n.code,{children:"https://yourapp.com/landing-page"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"Here's a simple example of what the magic link may look like:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"https://yourapp.com/landing-page?token=YHwbXSXxQfL02IoxFqr1hGvkB13uTqcd&email=user@example.com\n"})}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsx)(n.p,{children:"The parameter names in the magic link can be fully customized.\nYou may add additional information to the magic link based on your application's requirements,\nas well as encoding all the URL parameters."})}),"\n",(0,a.jsx)(n.h3,{id:"step-3-trigger-the-authentication-flow-via-logto-sdk",children:"Step 3: Trigger the authentication flow via Logto SDK"}),"\n",(0,a.jsxs)(n.p,{children:["After the end user clicks the magic link and navigated to your application, you can extract the ",(0,a.jsx)(n.code,{children:"token"})," and ",(0,a.jsx)(n.code,{children:"email"})," parameters from the URL, and then call the ",(0,a.jsx)(n.code,{children:"signIn()"})," function from Logto SDK to trigger the auth flow."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",metastring:'title="TokenLandingPage.tsx"',children:"// React example\nimport { useLogto } from '@logto/react';\nimport { useEffect } from 'react';\nimport { useSearchParams } from 'react-router-dom';\n\nconst TokenLandingPage = () => {\n  const { signIn } = useLogto();\n  const [searchParams] = useSearchParams();\n\n  useEffect(() => {\n    // Extract the token and email from the magic link\n    const oneTimeToken = searchParams.get('token');\n    const email = searchParams.get('email');\n\n    // Assuming this is your sign-in redirect URI\n    const redirectUri = 'https://yourapp.com/callback';\n\n    if (oneTimeToken && email) {\n      signIn({\n        redirectUri,\n        clearTokens: false, // Optional. See warning message below\n        extraParams: {\n          'one_time_token': oneTimeToken,\n          'login_hint': email,\n        },\n      });\n    }\n  }, [searchParams, signIn]);\n\n  return <>Please wait...</>;\n};\n"})}),"\n",(0,a.jsxs)(n.admonition,{type:"warning",children:[(0,a.jsxs)(n.p,{children:["If a user is already signed-in, calling the",(0,a.jsx)(n.code,{children:"signIn()"})," function from SDK will automatically clear all cached tokens (ID token, access token, and refresh token) from client storage,\nwhich ends up losing the authentication status of the current user."]}),(0,a.jsxs)(n.p,{children:["Therefore, you should specify an additional sign-in parameter ",(0,a.jsx)(n.code,{children:"clearTokens: false"})," to avoid clearing the existing tokens.\nIf this is specified, you'll also need to manually clear the tokens in the sign-in callback page."]}),(0,a.jsx)(n.p,{children:"Ignore this if your magic links are not designed for authenticated users."})]}),"\n",(0,a.jsx)(n.h3,{id:"step-4-clear-cached-tokens-in-sign-in-callback-page",children:"Step 4: (Optional) Clear cached tokens in sign-in callback page"}),"\n",(0,a.jsxs)(n.p,{children:["If you specify ",(0,a.jsx)(n.code,{children:"clearTokens: false"})," in the sign-in function, you need to manually clear the tokens in the sign-in callback page."]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",metastring:'title="Callback.tsx"',children:"// React example\nimport { useHandleSignInCallback, useLogto } from '@logto/react';\nimport { useEffect } from 'react';\n\nconst Callback = () => {\n  const { clearAllTokens } = useLogto();\n\n  useEffect(() => {\n    void clearAllTokens();\n  }, [clearAllTokens]);\n\n  useHandleSignInCallback(() => {\n    // Navigate to your home page\n  });\n\n  return <>Please wait...</>;\n};\n"})}),"\n",(0,a.jsx)(n.h2,{id:"faqs",children:"FAQs"}),"\n",(0,a.jsxs)(i,{children:[(0,a.jsx)("summary",{children:(0,a.jsx)(n.h3,{id:"can-i-use-the-magic-link-to-invite-new-users-to-my-organizations",children:"Can I use the magic link to invite new users to my organizations?"})}),(0,a.jsxs)(n.p,{children:["Yes, you can use the magic link to invite new users to your application, as well as organizations.\nIf you want to invite new users to your organization, simply specify the ",(0,a.jsx)(n.code,{children:"jitOrganizationIds"})," in the request body."]}),(0,a.jsx)(n.p,{children:'The user will automatically join the organizations upon successful verification, and default organization roles will be assigned.\nCheck out the "Just-in-time provisioning" section in your organization details page, and configure the default roles for your organizations.'})]}),"\n",(0,a.jsxs)(i,{children:[(0,a.jsx)("summary",{children:(0,a.jsx)(n.h3,{id:"does-the-one-time-token-expire",children:"Does the one-time token expire?"})}),(0,a.jsxs)(n.p,{children:["Yes, the one-time token will expire after the specified ",(0,a.jsx)(n.code,{children:"expiresIn"})," time (in seconds). The default expiration time is 10 minutes."]})]}),"\n",(0,a.jsxs)(i,{children:[(0,a.jsx)("summary",{children:(0,a.jsx)(n.h3,{id:"if-i-disable-user-registration-in-sign-in-experience-can-i-still-use-magic-link-to-invite-users",children:'If I disable user registration in "Sign-in Experience", can I still use magic link to invite users?'})}),(0,a.jsx)(n.p,{children:'Yes, you can still use magic link to invite users even if you disable user registration in "Sign-in Experience".'})]}),"\n",(0,a.jsxs)(i,{children:[(0,a.jsx)("summary",{children:(0,a.jsx)(n.h3,{id:"what-will-happen-if-a-user-already-signed-in-and-then-click-another-magic-link",children:"What will happen if a user already signed in, and then click another magic link?"})}),(0,a.jsx)(n.p,{children:"There are a number of possible scenarios:"}),(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"The user is already signed in, and then clicks a magic link that associates with the current user account. In this case, Logto will still verify the one-time token, and provision the user to specified organizations if needed."}),"\n",(0,a.jsxs)(n.li,{children:["The user is already signed in, and then clicks a magic link that associates with a different account. In this case, Logto will prompt the user to continue as the new account, or go back to the application with the current account.","\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"If the user chooses to continue as the new account, Logto will switch to the new account after the token verification is successful."}),"\n",(0,a.jsx)(n.li,{children:"If the user chooses to stick to the current account, Logto will not verify the token and return to the application with the current account."}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(n.li,{children:'If your sign-in prompt is set to "login" or contains "login", Logto will automatically sign-in the account associated with the one-time token without prompting switch.'}),"\n"]})]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},88969:(e,n,i)=>{i.d(n,{A:()=>s});const t="availability_kRMk";var a=i(25105);const o=e=>"comingSoon"===e?"coming soon-blue":"boolean"==typeof e?e?"\u2713 available-4EA254":"not applicable-78767F":`since v${e.major}.${e.minor}-4EA254`,s=e=>{let{cloud:n,oss:i}=e;return(0,a.jsxs)("div",{className:t,children:[(0,a.jsx)("img",{alt:"Cloud availability",src:`https://img.shields.io/badge/Cloud-${o(n)}`}),(0,a.jsx)("img",{alt:"OSS availability",src:`https://img.shields.io/badge/OSS-${o(i)}`})]})}},79621:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>r});var t=i(58101);const a={},o=t.createContext(a);function s(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);