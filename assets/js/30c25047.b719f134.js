"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[95589],{49613:function(e,t,r){r.d(t,{Zo:function(){return u},kt:function(){return h}});var a=r(59496);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=a.createContext({}),c=function(e){var t=a.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},u=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=c(r),h=n,m=d["".concat(l,".").concat(h)]||d[h]||p[h]||o;return r?a.createElement(m,i(i({ref:t},u),{},{components:r})):a.createElement(m,i({ref:t},u))}));function h(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:n,i[1]=s;for(var c=2;c<o;c++)i[c]=r[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,r)}d.displayName="MDXCreateElement"},77855:function(e,t,r){r.r(t),r.d(t,{assets:function(){return u},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return p}});var a=r(665),n=r(40151),o=(r(59496),r(49613)),i=["components"],s={sidebar_position:2},l="\u2694\ufe0f Protect your API",c={unversionedId:"docs/recipes/protect-your-api/README",id:"version-1.x/docs/recipes/protect-your-api/README",title:"\u2694\ufe0f Protect your API",description:"Logto is an off-the-shelf authorization service that enables you to enforce authorization on your backend API resources , enhancing their privacy protection.",source:"@site/versioned_docs/version-1.x/docs/recipes/protect-your-api/README.mdx",sourceDirName:"docs/recipes/protect-your-api",slug:"/docs/recipes/protect-your-api/",permalink:"/logto-docs/docs/recipes/protect-your-api/",draft:!1,editUrl:"https://github.com/logto-io/docs/tree/master/versioned_docs/version-1.x/docs/recipes/protect-your-api/README.mdx",tags:[],version:"1.x",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"docsSidebar",previous:{title:"Vue",permalink:"/logto-docs/docs/recipes/integrate-logto/vue"},next:{title:"Node (Express)",permalink:"/logto-docs/docs/recipes/protect-your-api/node"}},u={},p=[{value:"Register the API resources",id:"register-the-api-resources",level:2},{value:"Permissions and RBAC",id:"permissions-and-rbac",level:3},{value:"Validate the API request&#39;s authorization token",id:"validate-the-api-requests-authorization-token",level:2},{value:"Understanding JWS token",id:"understanding-jws-token",level:3},{value:"Validate the authorization token",id:"validate-the-authorization-token",level:3},{value:"Reference",id:"reference",level:2}],d={toc:p};function h(e){var t=e.components,s=(0,n.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"\ufe0f-protect-your-api"},"\u2694\ufe0f Protect your API"),(0,o.kt)("p",null,"Logto is an off-the-shelf authorization service that enables you to enforce authorization on your backend ",(0,o.kt)("a",{parentName:"p",href:"/logto-docs/docs/references/resources/"},"API resources")," , enhancing their privacy protection."),(0,o.kt)("h2",{id:"register-the-api-resources"},"Register the API resources"),(0,o.kt)("p",null,"To obtain an audience-restricted ",(0,o.kt)("inlineCode",{parentName:"p"},"access_token")," from Logto, you must register your backend APIs. When an authorization request is received, Logto will identify the registered ",(0,o.kt)("a",{parentName:"p",href:"/logto-docs/docs/references/resources/"},"API resources")," and grant access accordingly."),(0,o.kt)("p",null,"To register your APIs, navigate to the API Resources section in the console. You will see a built-in resource with the API identifier displayed as ",(0,o.kt)("inlineCode",{parentName:"p"},"https://[your-tenant-id].logto.app/api"),". This resource encompasses all the management APIs of Logto and ensures that they are protected and accessible only to authorized users of Logto."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"API resources",src:r(65208).Z,width:"2880",height:"1492"})),(0,o.kt)("p",null,"Click on the ",(0,o.kt)("strong",{parentName:"p"},"Create API Resource")," button and following the interactive form to create your own API resources:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"A human-readable ",(0,o.kt)("strong",{parentName:"li"},"API Name")," that may better helps you to identify this entity."),(0,o.kt)("li",{parentName:"ul"},"A unique ",(0,o.kt)("strong",{parentName:"li"},"API Identifier")," (a.k.a. ",(0,o.kt)("a",{parentName:"li",href:"/logto-docs/docs/references/resources/#resource-indicator"},"Resource Indicator"),") in URI format. It represents the identity of the API resource.")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"API resources",src:r(38401).Z,width:"1762",height:"792"})),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"The API Identifier is unique and used as the single source of truth for Logto, and it's ",(0,o.kt)("strong",{parentName:"p"},"NOT")," editable once created. Be careful when you create it.")),(0,o.kt)("p",null,"The new API will show up on the list once created. You may manage or delete it at the API details page by clicking on the entity."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"API resource details",src:r(78415).Z,width:"2880",height:"1492"})),(0,o.kt)("p",null,"See ",(0,o.kt)("a",{parentName:"p",href:"/logto-docs/docs/references/resources/#logto-api-resource-schema"},"API Resource Logto Schema")," for detailed API setting definitions."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"The API Resources registered in Logto Admin Console will be shared across all your applications.")),(0,o.kt)("h3",{id:"permissions-and-rbac"},"Permissions and RBAC"),(0,o.kt)("p",null,"See ",(0,o.kt)("a",{parentName:"p",href:"/docs/recipes/rbac"},"\ud83d\udd10 RBAC")," for details."),(0,o.kt)("h2",{id:"validate-the-api-requests-authorization-token"},"Validate the API request's authorization token"),(0,o.kt)("p",null,"Logto issues a standard ",(0,o.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc7519"},"JWT")," format authorization token for each authorized API request. The token is encrypted and signed as a ",(0,o.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc7515"},"JWS")," token."),(0,o.kt)("h3",{id:"understanding-jws-token"},"Understanding JWS token"),(0,o.kt)("p",null,"An encoded ",(0,o.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc7515"},"JWS")," token is constructed with three parts:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"JOSE Header: Declares the code type and encoding algorithm"),(0,o.kt)("li",{parentName:"ul"},"JWS Payload: Includes all the token's claims"),(0,o.kt)("li",{parentName:"ul"},"JWS Signature: Signature signed with ",(0,o.kt)("a",{parentName:"li",href:"https://datatracker.ietf.org/doc/html/rfc7517"},"JWK"))),(0,o.kt)("p",null,"A standard schema of Logto issued JWS Payload: (claims may vary, based on your custom OIDC config)"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"key"),(0,o.kt)("th",{parentName:"tr",align:null},"description"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"jti"),(0,o.kt)("td",{parentName:"tr",align:null},"unique JWT ID")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"sub"),(0,o.kt)("td",{parentName:"tr",align:null},"subject, usually user-id")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"iat"),(0,o.kt)("td",{parentName:"tr",align:null},"timestamp token issues at")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"exp"),(0,o.kt)("td",{parentName:"tr",align:null},"timestamp token expires at")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"client_id"),(0,o.kt)("td",{parentName:"tr",align:null},"application id")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"iss"),(0,o.kt)("td",{parentName:"tr",align:null},"token issuer identity")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"aud"),(0,o.kt)("td",{parentName:"tr",align:null},"audience of the token")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"scope"),(0,o.kt)("td",{parentName:"tr",align:null},"scopes (permissions) of the token")))),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"For development, to visually inspect a JWT token, you could visit ",(0,o.kt)("a",{parentName:"p",href:"https://jwt.io/"},"jwt.io")," to decode and check the tokens you received. Be careful with or never use the tokens from a production environment. As this is a third party provided public online service, your token may be exposed.")),(0,o.kt)("h3",{id:"validate-the-authorization-token"},"Validate the authorization token"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"https://datatracker.ietf.org/doc/html/rfc7519#section-7.2"},"Validating a JWT")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"https://datatracker.ietf.org/doc/html/rfc7515#section-5.2"},"Validating the JWS signature")),(0,o.kt)("li",{parentName:"ol"},"The token's issuer is ",(0,o.kt)("inlineCode",{parentName:"li"},"https://<your-logto-domain>/oidc")," (issued by your Logto auth server)"),(0,o.kt)("li",{parentName:"ol"},"The token's audience is equal to the current receiver's resource indicator registered in Logto Admin Console"),(0,o.kt)("li",{parentName:"ol"},"The token is within its expiration time"),(0,o.kt)("li",{parentName:"ol"},"(",(0,o.kt)("a",{parentName:"li",href:"/docs/recipes/rbac/"},"\ud83d\udd10 RBAC")," only) The token has the desired ",(0,o.kt)("inlineCode",{parentName:"li"},"scope"))),(0,o.kt)("p",null,"There are various open-source libraries and packages that can help you to validate and decode a JWT token easily. You may pick one and integrate with your backend application based on the language and framework you are using. Please check some of the examples we have:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"./node"},"Node (Express)")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"./spring-boot"},"Spring Boot")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"./python"},"Python"))),(0,o.kt)("h2",{id:"reference"},"Reference"),(0,o.kt)("p",null,"Logto uses the code-based OAuth 2.0 Authorization Protocol to make your API request safe. If you are interested in the strategy behind it, refer to OAuth 2.0's ",(0,o.kt)("a",{parentName:"p",href:"https://datatracker.ietf.org/doc/html/rfc6749#section-1.3.1"},"specification")," for more details."))}h.isMDXComponent=!0},78415:function(e,t,r){t.Z=r.p+"assets/images/api-resource-details-fa67296fcedab7fcae41082b050325e9.png"},65208:function(e,t,r){t.Z=r.p+"assets/images/api-resources-225dd948c0a53676065541a7045b8dd0.png"},38401:function(e,t,r){t.Z=r.p+"assets/images/create-api-resource-0524881d6a917a5517693b0ce2bbb66d.png"}}]);