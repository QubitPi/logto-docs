"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[278],{5054:(e,n,t)=>{t.d(n,{Ay:()=>c,RM:()=>o});var s=t(25105),r=t(79621);const o=[];function i(e){const n={a:"a",p:"p",...(0,r.R)(),...e.components};return(0,s.jsxs)(n.p,{children:["We recommend to read ",(0,s.jsx)(n.a,{href:"/authorization/role-based-access-control",children:"\ud83d\udd10 Role-Based Access Control (RBAC)"})," first to understand the basic concepts of Logto RBAC and how to set up API resources properly."]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(i,{...e})}):i(e)}},61770:(e,n,t)=>{t.d(n,{Ay:()=>c,RM:()=>o});var s=t(25105),r=t(79621);const o=[];function i(e){const n={a:"a",admonition:"admonition",code:"code",p:"p",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Once you have set up the API resources, you can add them when configuring Logto in your app:"}),"\n",e.configResourcesCode,"\n",(0,s.jsx)(n.p,{children:"Each API resource has its own permissions (scopes)."}),"\n",(0,s.jsxs)(n.p,{children:["For example, the ",(0,s.jsx)(n.code,{children:"https://shopping.your-app.com/api"})," resource has the ",(0,s.jsx)(n.code,{children:"shopping:read"})," and ",(0,s.jsx)(n.code,{children:"shopping:write"})," permissions, and the ",(0,s.jsx)(n.code,{children:"https://store.your-app.com/api"})," resource has the ",(0,s.jsx)(n.code,{children:"store:read"})," and ",(0,s.jsx)(n.code,{children:"store:write"})," permissions."]}),"\n",(0,s.jsx)(n.p,{children:"To request these permissions, you can add them when configuring Logto in your app:"}),"\n",e.configResourcesWithScopesCode,"\n",(0,s.jsxs)(n.p,{children:["You may notice that scopes are defined separately from API resources. This is because ",(0,s.jsx)(n.a,{href:"https://www.rfc-editor.org/rfc/rfc8707.html",children:"Resource Indicators for OAuth 2.0"})," specifies the final scopes for the request will be the cartesian product of all the scopes at all the target services."]}),"\n",e.configResourcesWithSharedScopesCode&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("p",{children:["Thus, in the above case, scopes can be simplified from the definition in Logto, both of the API resources can have ",(0,s.jsx)("code",{children:"read"})," and ",(0,s.jsx)("code",{children:"write"})," scopes without the prefix. Then, in the Logto config:"]}),e.configResourcesWithSharedScopesCode,(0,s.jsxs)("p",{children:["For every API resource, it will request for both ",(0,s.jsx)("code",{children:"read"})," and ",(0,s.jsx)("code",{children:"write"})," scopes."]})]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["It is fine to request scopes that are not defined in the API resources. For example, you can request the ",(0,s.jsx)(n.code,{children:"email"})," scope even if the API resources don't have the ",(0,s.jsx)(n.code,{children:"email"})," scope available. Unavailable scopes will be safely ignored."]})}),"\n",(0,s.jsx)(n.p,{children:"After the successful sign-in, Logto will issue proper scopes to API resources according to the user's roles."})]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(i,{...e})}):i(e)}},2531:(e,n,t)=>{t.d(n,{Ay:()=>c,RM:()=>o});var s=t(25105),r=t(79621);const o=[];function i(e){const n={p:"p",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["Let's switch to the Application details page of Logto Console. Add a Redirect URI ",(0,s.jsx)("code",{children:e.redirectUri}),' and click "Save changes".']}),"\n",(0,s.jsx)("img",{alt:"Redirect URI in Logto Console",src:e.figureSrc,width:"600px"})]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(i,{...e})}):i(e)}},87181:(e,n,t)=>{t.d(n,{Ay:()=>c,RM:()=>o});var s=t(25105),r=t(79621);const o=[];function i(e){const n={a:"a",p:"p",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["If organization is new to you, please read ",(0,s.jsx)(n.a,{href:"/organizations",children:"\ud83c\udfe2 Organizations (Multi-tenancy)"})," to get started."]}),"\n",(0,s.jsxs)(n.p,{children:["You need to add ",(0,s.jsx)("code",{children:e.organizationScope})," scope when configuring the Logto client:"]}),"\n",e.configOrganizationCode,"\n",(0,s.jsx)(n.p,{children:"Once the user is signed in, you can fetch the organization token for the user:"}),"\n",e.getOrganizationAccessTokenCode]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(i,{...e})}):i(e)}},73984:(e,n,t)=>{t.d(n,{Ay:()=>c,RM:()=>o});var s=t(25105),r=t(79621);const o=[];function i(e){const n={p:"p",...(0,r.R)(),...e.components};return(0,s.jsxs)(n.p,{children:["You may find some user information are missing in the returned object from ",(0,s.jsx)("code",{children:e.method}),". This is because OAuth 2.0 and OpenID Connect (OIDC) are designed to follow the principle of least privilege (PoLP), and Logto is built on top of these standards."]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(i,{...e})}):i(e)}},38517:(e,n,t)=>{t.d(n,{Ay:()=>c,RM:()=>o});var s=t(25105),r=t(79621);const o=[];function i(e){const{Url:n}={...(0,r.R)(),...e.components};return n||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n,{href:"/end-user-flows",children:" End-user flows: authentication flows, account flows, and organization flows "}),"\n",(0,s.jsx)(n,{href:"/connectors",children:" Configure connectors "}),"\n",(0,s.jsx)(n,{href:"/authorization",children:" Authorization "})]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(i,{...e})}):i(e)}},14812:(e,n,t)=>{t.d(n,{Ay:()=>c,RM:()=>o});var s=t(25105),r=t(79621);const o=[];function i(e){const n={admonition:"admonition",...(0,r.R)(),...e.components};return(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsx)("p",{children:'You can find and copy "App Secret" from application details page in Admin Console:'}),(0,s.jsx)("img",{alt:"App Secret",src:"/img/assets/app-secret.png",width:"586px"})]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(i,{...e})}):i(e)}},71019:(e,n,t)=>{t.d(n,{Ay:()=>c,RM:()=>o});var s=t(25105),r=t(79621);const o=[{value:"Regarding redirect-based sign-in",id:"regarding-redirect-based-sign-in",level:3}];function i(e){const n={a:"a",h3:"h3",li:"li",ol:"ol",p:"p",...(0,r.R)(),...e.components},{Details:t,MainSiteUrl:o}=n;return t||a("Details",!0),o||a("MainSiteUrl",!0),(0,s.jsxs)(t,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)(n.h3,{id:"regarding-redirect-based-sign-in",children:"Regarding redirect-based sign-in"})}),(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["This authentication process follows the ",(0,s.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html",children:"OpenID Connect (OIDC)"})," protocol, and Logto enforces strict security measures to protect user sign-in."]}),"\n",(0,s.jsx)(n.li,{children:"If you have multiple apps, you can use the same identity provider (Logto). Once the user signs in to one app, Logto will automatically complete the sign-in process when the user accesses another app."}),"\n"]}),(0,s.jsxs)(n.p,{children:["To learn more about the rationale and benefits of redirect-based sign-in, see ",(0,s.jsx)(o,{href:"/concepts/sign-in-experience",children:"Logto sign-in experience explained"}),"."]})]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(i,{...e})}):i(e)}function a(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},99205:(e,n,t)=>{t.d(n,{Ay:()=>c,RM:()=>o});var s=t(25105),r=t(79621);const o=[];function i(e){const n={a:"a",admonition:"admonition",code:"code",hr:"hr",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Here's the list of supported scopes and the corresponding claims:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"openid"})})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Claim name"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Needs userinfo?"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"sub"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})}),(0,s.jsx)(n.td,{children:"The unique identifier of the user"}),(0,s.jsx)(n.td,{children:"No"})]})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"profile"})})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Claim name"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Needs userinfo?"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"name"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})}),(0,s.jsx)(n.td,{children:"The full name of the user"}),(0,s.jsx)(n.td,{children:"No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"username"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})}),(0,s.jsx)(n.td,{children:"The username of the user"}),(0,s.jsx)(n.td,{children:"No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"picture"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})}),(0,s.jsx)(n.td,{children:"URL of the End-User's profile picture. This URL MUST refer to an image file (for example, a PNG, JPEG, or GIF image file), rather than to a Web page containing an image. Note that this URL SHOULD specifically reference a profile photo of the End-User suitable for displaying when describing the End-User, rather than an arbitrary photo taken by the End-User."}),(0,s.jsx)(n.td,{children:"No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"created_at"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"number"})}),(0,s.jsx)(n.td,{children:"Time the End-User was created. The time is represented as the number of milliseconds since the Unix epoch (1970-01-01T00:00:00Z)."}),(0,s.jsx)(n.td,{children:"No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"updated_at"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"number"})}),(0,s.jsx)(n.td,{children:"Time the End-User's information was last updated. The time is represented as the number of milliseconds since the Unix epoch (1970-01-01T00:00:00Z)."}),(0,s.jsx)(n.td,{children:"No"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["Other ",(0,s.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#StandardClaims",children:"standard claims"})," include ",(0,s.jsx)(n.code,{children:"family_name"}),", ",(0,s.jsx)(n.code,{children:"given_name"}),", ",(0,s.jsx)(n.code,{children:"middle_name"}),", ",(0,s.jsx)(n.code,{children:"nickname"}),", ",(0,s.jsx)(n.code,{children:"preferred_username"}),", ",(0,s.jsx)(n.code,{children:"profile"}),", ",(0,s.jsx)(n.code,{children:"website"}),", ",(0,s.jsx)(n.code,{children:"gender"}),", ",(0,s.jsx)(n.code,{children:"birthdate"}),", ",(0,s.jsx)(n.code,{children:"zoneinfo"}),", and ",(0,s.jsx)(n.code,{children:"locale"})," will be also included in the ",(0,s.jsx)(n.code,{children:"profile"})," scope without the need for requesting the userinfo endpoint. A difference compared to the claims above is that these claims will only be returned when their values are not empty, while the claims above will return ",(0,s.jsx)(n.code,{children:"null"})," if the values are empty."]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["Unlike the standard claims, the ",(0,s.jsx)(n.code,{children:"created_at"})," and ",(0,s.jsx)(n.code,{children:"updated_at"})," claims are using milliseconds instead of seconds."]})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"email"})})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Claim name"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Needs userinfo?"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"email"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})}),(0,s.jsx)(n.td,{children:"The email address of the user"}),(0,s.jsx)(n.td,{children:"No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"email_verified"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"boolean"})}),(0,s.jsx)(n.td,{children:"Whether the email address has been verified"}),(0,s.jsx)(n.td,{children:"No"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"phone"})})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Claim name"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Needs userinfo?"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"phone_number"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})}),(0,s.jsx)(n.td,{children:"The phone number of the user"}),(0,s.jsx)(n.td,{children:"No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"phone_number_verified"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"boolean"})}),(0,s.jsx)(n.td,{children:"Whether the phone number has been verified"}),(0,s.jsx)(n.td,{children:"No"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"address"})})}),"\n",(0,s.jsxs)(n.p,{children:["Please refer to the ",(0,s.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#AddressClaim",children:"OpenID Connect Core 1.0"})," for the details of the address claim."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"custom_data"})})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Claim name"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Needs userinfo?"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"custom_data"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"object"})}),(0,s.jsx)(n.td,{children:"The custom data of the user"}),(0,s.jsx)(n.td,{children:"Yes"})]})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"identities"})})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Claim name"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Needs userinfo?"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"identities"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"object"})}),(0,s.jsx)(n.td,{children:"The linked identities of the user"}),(0,s.jsx)(n.td,{children:"Yes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"sso_identities"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"array"})}),(0,s.jsx)(n.td,{children:"The linked SSO identities of the user"}),(0,s.jsx)(n.td,{children:"Yes"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"roles"})})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Claim name"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Needs userinfo?"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"roles"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string[]"})}),(0,s.jsx)(n.td,{children:"The roles of the user"}),(0,s.jsx)(n.td,{children:"No"})]})})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"urn:logto:scope:organizations"})})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Claim name"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Needs userinfo?"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"organizations"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string[]"})}),(0,s.jsx)(n.td,{children:"The organization IDs the user belongs to"}),(0,s.jsx)(n.td,{children:"No"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"organization_data"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"object[]"})}),(0,s.jsx)(n.td,{children:"The organization data the user belongs to"}),(0,s.jsx)(n.td,{children:"Yes"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"urn:logto:scope:organization_roles"})})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Claim name"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Needs userinfo?"})]})}),(0,s.jsx)(n.tbody,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"organization_roles"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string[]"})}),(0,s.jsxs)(n.td,{children:["The organization roles the user belongs to with the format of ",(0,s.jsx)(n.code,{children:"<organization_id>:<role_name>"})]}),(0,s.jsx)(n.td,{children:"No"})]})})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:['Considering performance and the data size, if "Needs userinfo?" is "Yes", it means the claim will not show up in the ID token, but will be returned in the ',(0,s.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#UserInfo",children:"userinfo endpoint"})," response."]})]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(i,{...e})}):i(e)}},36608:(e,n,t)=>{t.d(n,{Ay:()=>a,RM:()=>i});var s=t(25105),r=t(79621),o=t(99205);const i=[...o.RM];function c(e){const n={a:"a",p:"p",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["Logto uses OIDC ",(0,s.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html#Claims",children:"scopes and claims conventions"})," to define the scopes and claims for retrieving user information from the ID token and OIDC ",(0,s.jsx)("a",{href:"https://openid.net/specs/openid-connect-core-1_0.html#UserInfo",children:"userinfo endpoint"}),'. Both of the "scope" and the "claim" are terms from the OAuth 2.0 and OpenID Connect (OIDC) specifications.']}),"\n","\n",e.configScopesCode&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{children:"In short, when you request a scope, you will get the corresponding claims in the user information. For example, if you request the `email` scope, you will get the `email` and `email_verified` data of the user."}),(0,s.jsx)("p",{children:"By default, Logto SDK will always request three scopes: `openid`, `profile`. And `offline_access`, and there is no way to remove these default scopes. But you can add more scopes when configuring Logto:"}),e.configScopesCode]}),"\n",(0,s.jsx)(o.Ay,{})]})}function a(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},21841:(e,n,t)=>{t.d(n,{Ay:()=>c,RM:()=>o});var s=t(25105),r=t(79621);const o=[];function i(e){const n={admonition:"admonition",code:"code",mermaid:"mermaid",p:"p",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"By default, limited claims are returned. If you need more information, you can request additional scopes to access more claims."}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:'A "claim" is an assertion made about a subject; a "scope" is a group of claims. In the current case, a claim is a piece of information about the user.'})}),"\n",(0,s.jsx)(n.p,{children:"Here's a non-normative example the scope - claim relationship:"}),"\n",(0,s.jsx)(n.mermaid,{value:"classDiagram\n  class openid {\n    +sub\n  }\n\n  class profile {\n    +name\n    +username\n    +picture\n    +...\n  }\n\n  class email {\n    +email\n    +email_verified\n  }\n\n  class phone {\n    +phone_number\n    +phone_number_verified\n  }"}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsx)(n.p,{children:'The "sub" claim means "subject", which is the unique identifier of the user (i.e. user ID).'})}),"\n",(0,s.jsxs)(n.p,{children:["Logto SDK will always request three scopes: ",(0,s.jsx)(n.code,{children:"openid"}),", ",(0,s.jsx)(n.code,{children:"profile"}),", and ",(0,s.jsx)(n.code,{children:"offline_access"}),"."]})]})}function c(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(i,{...e})}):i(e)}},68547:(e,n,t)=>{t.d(n,{Ay:()=>a,Ip:()=>o,RM:()=>i});var s=t(25105),r=t(79621);const o="http://localhost:3000/",i=[];function c(e){const n={admonition:"admonition",p:"p",...(0,r.R)(),...e.components};return(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["In the following code snippets, we assume your app is running on ",(0,s.jsx)("code",{children:o}),"."]})})}function a(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},79825:(e,n,t)=>{t.d(n,{Ay:()=>a,RM:()=>i});var s=t(25105),r=t(79621),o=t(71019);const i=[...o.RM];function c(e){const n={hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Before we dive into the details, here's a quick overview of the end-user experience. The sign-in process can be simplified as follows:"}),"\n",(0,s.jsx)(n.mermaid,{value:"graph LR\n    A(Your app) --\x3e|1. Invoke sign-in| B(Logto)\n    B --\x3e|2. Finish sign-in| A"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Your app invokes the sign-in method."}),"\n",(0,s.jsx)(n.li,{children:"The user is redirected to the Logto sign-in page. For native apps, the system browser is opened."}),"\n",(0,s.jsx)(n.li,{children:"The user signs in and is redirected back to your app (configured as the redirect URI)."}),"\n"]}),"\n",(0,s.jsx)(o.Ay,{}),"\n",(0,s.jsx)(n.hr,{})]})}function a(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},1409:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>Q,contentTitle:()=>J,default:()=>ne,frontMatter:()=>Z,metadata:()=>s,toc:()=>X});const s=JSON.parse('{"id":"quick-starts/framework/next-auth/README","title":"Add authentication to your Auth.js (Next Auth) application","description":"This guide will show you how to integrate Logto into your Next.js application with Auth.js, previously known as Next Auth.","source":"@site/docs/quick-starts/framework/next-auth/README.mdx","sourceDirName":"quick-starts/framework/next-auth","slug":"/quick-starts/next-auth","permalink":"/quick-starts/next-auth","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/docs/quick-starts/framework/next-auth/README.mdx","tags":[],"version":"current","frontMatter":{"slug":"/quick-starts/next-auth","sidebar_label":"Auth.js (Next Auth)","sidebar_custom_props":{"logoFilename":"next-auth.svg","description":"Authentication for Next.js."}},"sidebar":"quickStartSidebar","previous":{"title":"Next.js (App Router)","permalink":"/quick-starts/next-app-router"},"next":{"title":"Nuxt","permalink":"/quick-starts/nuxt"}}');var r=t(25105),o=t(79621),i=t(5054),c=t(38517),a=t(73984),d=t(36608),l=t(21841);const h=[{value:"Display user information",id:"display-user-information",level:3},{value:"Request additional claims",id:"request-additional-claims",level:3},...a.RM,...l.RM,{value:"Claims that need network requests",id:"claims-that-need-network-requests",level:3},{value:"Get access token",id:"get-access-token",level:4},{value:"Fetch user info",id:"fetch-user-info",level:4},{value:"Access token refresh",id:"access-token-refresh",level:4},{value:"Scopes and claims",id:"scopes-and-claims",level:3},...d.RM];function u(e){const n={a:"a",code:"code",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h3,{id:"display-user-information",children:"Display user information"}),"\n",(0,r.jsxs)(n.p,{children:["When user is signed in, the return value of ",(0,r.jsx)(n.code,{children:"auth()"})," will be an object containing the user's information. You can display this information in your app:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",metastring:'title="app/page.tsx"',children:"import { auth } from '@/auth';\n\nexport default async function Home() {\n  const session = await auth();\n\n  return (\n    <main>\n      {session?.user && (\n        <div>\n          <h2>Claims:</h2>\n          <table>\n            <thead>\n              <tr>\n                <th>Name</th>\n                <th>Value</th>\n              </tr>\n            </thead>\n            <tbody>\n              {Object.entries(session.user).map(([key, value]) => (\n                <tr key={key}>\n                  <td>{key}</td>\n                  <td>{String(value)}</td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      )}\n    </main>\n  );\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"request-additional-claims",children:"Request additional claims"}),"\n",(0,r.jsx)(a.Ay,{method:"auth()"}),"\n",(0,r.jsx)(l.Ay,{hideDefaultScopes:!0}),"\n",(0,r.jsx)(n.p,{children:"To request additional scopes, you can configure the params of Logto provider:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="./auth.ts"',children:"import NextAuth from 'next-auth';\nimport Logto from 'next-auth/providers/logto';\n\nexport const { handlers, signIn, signOut, auth } = NextAuth({\n  providers: [\n    Logto({\n      // ...\n      authorization: {\n        params: {\n          // highlight-next-line\n          scope: 'openid offline_access profile email',\n        },\n      },\n      // ...\n    }),\n  ],\n});\n"})}),"\n",(0,r.jsx)(n.h3,{id:"claims-that-need-network-requests",children:"Claims that need network requests"}),"\n",(0,r.jsxs)(n.p,{children:["To prevent bloating the ID token, some claims require network requests to fetch. For example, the ",(0,r.jsx)(n.code,{children:"custom_data"})," claim is not included in the user object even if it's requested in the scopes. To access these claims, you need to make a network request to fetch the user info."]}),"\n",(0,r.jsx)(n.h4,{id:"get-access-token",children:"Get access token"}),"\n",(0,r.jsxs)(n.p,{children:["Update the ",(0,r.jsx)(n.code,{children:"NextAuth"})," config so that we can get the access token:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="./auth.ts"',children:"export const { handlers, signIn, signOut, auth } = NextAuth({\n  // ...\n  callbacks: {\n    async jwt({ token, account }) {\n      if (account) {\n        token.accessToken = account.access_token;\n      }\n      return token;\n    },\n    async session({ session, token }) {\n      // Inject the access token into the session object\n      session.accessToken = token.accessToken;\n      return session;\n    },\n  },\n});\n"})}),"\n",(0,r.jsx)(n.h4,{id:"fetch-user-info",children:"Fetch user info"}),"\n",(0,r.jsx)(n.p,{children:"Now access the OIDC user info endpoint with the access token:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="./app/page.tsx"',children:"// ...\n\nexport default async function Home() {\n  const session = await auth();\n  // Replace the URL with your Logto endpoint, should ends with `/oidc/me`\n  const response = await fetch('https://xxx.logto.app/oidc/me', {\n    headers: {\n      Authorization: `Bearer ${session?.accessToken}`,\n    },\n  });\n  const user = await response.json();\n  console.log(user);\n\n  // ...\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Above is a simple example. Remember to handle the error cases."}),"\n",(0,r.jsx)(n.h4,{id:"access-token-refresh",children:"Access token refresh"}),"\n",(0,r.jsxs)(n.p,{children:["An access token is valid for a short period of time. By defualt, Next.js will only fetch one when the session is created. To implement auto access token refresh, see ",(0,r.jsx)(n.a,{href:"https://next-auth.js.org/v3/tutorials/refresh-token-rotation",children:"Refresh token rotation"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"scopes-and-claims",children:"Scopes and claims"}),"\n",(0,r.jsx)(d.Ay,{})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}function x(e){const n={a:"a",admonition:"admonition",li:"li",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["In this guide, we assume you have set up Next Auth in your Next.js project. If you haven't, check out the ",(0,r.jsx)(n.a,{href:"https://next-auth.js.org/getting-started/introduction",children:"Next Auth documentation"})," to get started."]}),"\n"]})})}function j(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(x,{...e})}):x(e)}var m=t(38552),g=t(22002);function f(e){const n={a:"a",p:"p",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Install Auth.js via your favorite package manager:"}),"\n",(0,r.jsxs)(g.A,{children:[(0,r.jsx)(m.A,{value:"npm",label:"npm",children:(0,r.jsx)("pre",{children:(0,r.jsx)("code",{className:"language-bash",children:"npm i next-auth@beta"})})}),(0,r.jsx)(m.A,{value:"pnpm",label:"pnpm",children:(0,r.jsx)("pre",{children:(0,r.jsx)("code",{className:"language-bash",children:"pnpm add next-auth@beta"})})}),(0,r.jsx)(m.A,{value:"yarn",label:"yarn",children:(0,r.jsx)("pre",{children:(0,r.jsx)("code",{className:"language-bash",children:"yarn add next-auth@beta"})})})]}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"https://authjs.dev/getting-started/installation",children:"Auth.js documentation"})," for more details."]})]})}function v(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(f,{...e})}):f(e)}var b=t(2531),y=t(14812),w=t(68547),A=t(79825);const k=[{value:"Set up Auth.js provider",id:"set-up-authjs-provider",level:3},...y.RM,{value:"Configure sign-in redirect URI",id:"configure-sign-in-redirect-uri",level:3},...A.RM,...w.RM,...b.RM,{value:"Implement sign-in and sign-out",id:"implement-sign-in-and-sign-out",level:3},{value:"Implement sign-in and sign-out button",id:"implement-sign-in-and-sign-out-button",level:4},{value:"Show sign-in and sign-out button in the page",id:"show-sign-in-and-sign-out-button-in-the-page",level:4},{value:"Checkpoint",id:"checkpoint",level:3}];function R(e){const n={a:"a",code:"code",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h3,{id:"set-up-authjs-provider",children:"Set up Auth.js provider"}),"\n",(0,r.jsx)(y.Ay,{}),"\n",(0,r.jsx)(n.p,{children:"Modify your API route config of Auth.js, add Logto as an OIDC provider:"}),"\n",(0,r.jsxs)(g.A,{children:[(0,r.jsxs)(m.A,{value:"v5",label:"Auth.js v5",children:[(0,r.jsx)(n.p,{children:"Setup environment variables:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-env",children:"AUTH_LOGTO_ISSUER=https://xxxx.logto.app/oidc\nAUTH_LOGTO_ID=your-logto-app-id\nAUTH_LOGTO_SECRET=your-logto-app-secret\n"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="./app/api/auth/[...nextauth]/route.ts"',children:"import { handlers } from '@/auth';\nexport const { GET, POST } = handlers;\n"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="./auth.ts"',children:"import NextAuth from 'next-auth';\nimport Logto from 'next-auth/providers/logto';\n\nexport const { handlers, signIn, signOut, auth } = NextAuth({\n  providers: [Logto],\n});\n"})}),(0,r.jsx)(n.p,{children:"Then you can also add an optional Middleware to keep the session alive:"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="./middleware.ts"',children:"export { auth as middleware } from '@/auth';\n"})})]}),(0,r.jsxs)(m.A,{value:"v4",label:"Next Auth v4",children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="app/api/auth/[...nextauth]/route.ts"',children:"import NextAuth from 'next-auth';\n\nconst handler = NextAuth({\n  providers: [\n    {\n      id: 'logto',\n      name: 'Logto',\n      type: 'oauth',\n      // You can get the well-known URL from the Logto Application Details page,\n      // in the field \"OpenID Provider configuration endpoint\"\n      wellKnown: 'https://xxxx.logto.app/oidc/.well-known/openid-configuration',\n      authorization: { params: { scope: 'openid offline_access profile email' } },\n      clientId: '<logto-app-id>',\n      clientSecret: '<logto-app-secret>',\n      client: {\n        id_token_signed_response_alg: 'ES384',\n      },\n      profile(profile) {\n        // You can customize the user profile mapping here\n        return {\n          id: profile.sub,\n          name: profile.name ?? profile.username,\n          email: profile.email,\n          image: profile.picture,\n        };\n      },\n    },\n  ],\n});\n\nexport { handler as GET, handler as POST };\n"})}),(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Replace the ",(0,r.jsx)(n.code,{children:"wellKnown"}),' URL with your Logto application\'s "OpenID Provider configuration endpoint".']}),"\n",(0,r.jsxs)(n.li,{children:["Replace the ",(0,r.jsx)(n.code,{children:"clientId"})," and ",(0,r.jsx)(n.code,{children:"clientSecret"})," with your Logto application's ID and secret."]}),"\n",(0,r.jsxs)(n.li,{children:["Customize the ",(0,r.jsx)(n.code,{children:"profile"})," function to map the user profile to the Next Auth user object, the default mapping is shown in the example."]}),"\n",(0,r.jsxs)(n.li,{children:["Remember to set the ",(0,r.jsx)(n.code,{children:"id_token_signed_response_alg"})," to ",(0,r.jsx)(n.code,{children:"ES384"}),"."]}),"\n"]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["You can find more details in the ",(0,r.jsx)(n.a,{href:"https://authjs.dev/getting-started/installation",children:"Auth.js documentation"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"configure-sign-in-redirect-uri",children:"Configure sign-in redirect URI"}),"\n",(0,r.jsx)(A.Ay,{}),"\n",(0,r.jsx)(w.Ay,{}),"\n",(0,r.jsx)(b.Ay,{figureSrc:"/img/assets/next-auth-redirect-uri.png",redirectUri:"http://localhost:3000/api/auth/callback/logto"}),"\n",(0,r.jsx)(n.h3,{id:"implement-sign-in-and-sign-out",children:"Implement sign-in and sign-out"}),"\n",(0,r.jsx)(n.h4,{id:"implement-sign-in-and-sign-out-button",children:"Implement sign-in and sign-out button"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",metastring:'title="app/components/sign-in.tsx"',children:"import { signIn } from '@/auth';\n\nexport default function SignIn() {\n  return (\n    <form\n      action={async () => {\n        'use server';\n        await signIn('logto');\n      }}\n    >\n      <button type=\"submit\">Sign In</button>\n    </form>\n  );\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",metastring:'title="app/components/sign-out.tsx"',children:"import { signOut } from '@/auth';\n\nexport function SignOut() {\n  return (\n    <form\n      action={async () => {\n        'use server';\n        await signOut();\n      }}\n    >\n      <button type=\"submit\">Sign Out</button>\n    </form>\n  );\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"show-sign-in-and-sign-out-button-in-the-page",children:"Show sign-in and sign-out button in the page"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",metastring:'title="app/page.tsx"',children:"import SignIn from './components/sign-in';\nimport SignOut from './components/sign-out';\nimport { auth } from '@/auth';\n\nexport default function Home() {\n  const session = await auth();\n\n  return <div>{session?.user ? <SignOut /> : <SignIn />}</div>;\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Above is a simple example, you can check the ",(0,r.jsx)(n.a,{href:"https://authjs.dev/getting-started/session-management/login",children:"Auth.js documentation"})," for more details."]}),"\n",(0,r.jsx)(n.h3,{id:"checkpoint",children:"Checkpoint"}),"\n",(0,r.jsx)(n.p,{children:"Now, you can test your application to see if the authentication works as expected."})]})}function I(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(R,{...e})}):R(e)}var N=t(61770);function T(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="./auth.ts"',children:"import NextAuth from 'next-auth';\nimport Logto from 'next-auth/providers/logto';\n\nexport const { handlers, signIn, signOut, auth } = NextAuth({\n  providers: [\n    Logto({\n      // ...\n      authorization: {\n        params: {\n          scope: 'openid offline_access profile email',\n          // highlight-next-line\n          resource: 'https://shopping.your-app.com/api',\n        },\n      },\n      // ...\n    }),\n  ],\n});\n"})})}function _(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(T,{...e})}):T(e)}function S(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="./auth.ts"',children:"import NextAuth from 'next-auth';\nimport Logto from 'next-auth/providers/logto';\n\nexport const { handlers, signIn, signOut, auth } = NextAuth({\n  providers: [\n    Logto({\n      // ...\n      authorization: {\n        params: {\n          // highlight-next-line\n          scope: 'openid offline_access profile email shopping:read shopping:write',\n          resource: 'https://shopping.your-app.com/api',\n        },\n      },\n      // ...\n    }),\n  ],\n});\n"})})}function L(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(S,{...e})}):S(e)}function C(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="./auth.ts"',children:"import NextAuth from 'next-auth';\nimport Logto from 'next-auth/providers/logto';\n\nexport const { handlers, signIn, signOut, auth } = NextAuth({\n  providers: [\n    Logto({\n      // ...\n      authorization: {\n        params: {\n          // highlight-next-line\n          scope: 'openid offline_access profile read write',\n          resource: 'https://shopping.your-app.com/api',\n        },\n      },\n      // ...\n    }),\n  ],\n});\n"})})}function O(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(C,{...e})}):C(e)}const D=[...N.RM];function q(e){return(0,r.jsx)(N.Ay,{configResourcesCode:(0,r.jsx)(_,{}),configResourcesWithScopesCode:(0,r.jsx)(L,{}),configResourcesWithSharedScopesCode:(0,r.jsx)(O,{})})}function z(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(q,{...e})}):q()}function U(e){const n={code:"code",h4:"h4",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Auth.js will only fetch the access token once without resource parameter. We need to implement the access token fetching by ourselves."}),"\n",(0,r.jsx)(n.h4,{id:"get-refresh-token",children:"Get refresh token"}),"\n",(0,r.jsxs)(n.p,{children:['Update Logto provider config, add "prompt" parameter and set it to ',(0,r.jsx)(n.code,{children:"consent"}),", and ensure ",(0,r.jsx)(n.code,{children:"offline_access"})," scope is included:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="./auth.ts"',children:"import NextAuth from 'next-auth';\n\nexport const { handlers, signIn, signOut, auth } = NextAuth({\n  // ...\n  authorization: {\n    params: {\n      // highlight-next-line\n      prompt: 'consent',\n      scope: 'openid offline_access shopping:read shopping:write',\n      resource: 'https://shopping.your-app.com/api',\n      // ...\n    },\n  },\n  // ...\n});\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Then add a callback to save the ",(0,r.jsx)(n.code,{children:"refresh_token"})," to the session:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="./auth.ts"',children:"export const { handlers, signIn, signOut, auth } = NextAuth({\n  // ...\n  callbacks: {\n    async jwt({ token, account }) {\n      if (account) {\n        // ...\n        // highlight-next-line\n        token.refreshToken = account.refresh_token;\n      }\n      return token;\n    },\n    async session({ session, token }) {\n      // ...\n      // highlight-next-line\n      session.refreshToken = token.refreshToken;\n      return session;\n    },\n  },\n});\n"})}),"\n",(0,r.jsx)(n.h4,{id:"fetch-access-token",children:"Fetch access token"}),"\n",(0,r.jsxs)(n.p,{children:["With the ",(0,r.jsx)(n.code,{children:"refresh_token"}),", we can fetch the access token from Logto's OIDC token endpoint."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="./app/page.tsx"',children:"// ...\n\nexport default async function Home() {\n  const session = await auth();\n\n  if (session?.refreshToken) {\n    // Replace the app ID and secret with your own, you can check the \"Integration\" section.\n    const basicAuth = Buffer.from('<logto-app-id>:<logto-app-secret>').toString('base64');\n\n    // Replace the URL with your Logto endpoint, should ends with `/oidc/token`\n    const response = await fetch('https://xxx.logto.app/oidc/token', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        Authorization: `Basic ${basicAuth}`,\n      },\n      body: new URLSearchParams({\n        grant_type: 'refresh_token',\n        refresh_token: session.refreshToken,\n        resource: 'https://shopping.your-app.com/api',\n      }).toString(),\n    });\n\n    const data = await response.json();\n    console.log(data.access_token);\n  }\n\n  // ...\n}\n"})})]})}function E(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(U,{...e})}):U(e)}const M=[{value:"Get refresh token",id:"get-refresh-token",level:4},{value:"Fetch access token",id:"fetch-access-token",level:4}];function F(e){return(0,r.jsx)(E,{})}function P(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(F,{...e})}):F()}var V=t(87181);function B(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="./auth.ts"',children:"import NextAuth from 'next-auth';\nimport Logto from 'next-auth/providers/logto';\n\nexport const { handlers, signIn, signOut, auth } = NextAuth({\n  providers: [\n    Logto({\n      // ...\n      authorization: {\n        params: {\n          // highlight-next-line\n          scope: 'openid offline_access urn:logto:scope:organizations',\n        },\n      },\n      // ...\n    }),\n  ],\n});\n"})})}function Y(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(B,{...e})}):B(e)}function W(e){const n={code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Similar to the access token for API resources, we can use the refresh token to fetch the organization access token."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="./app/page.tsx"',children:"// ...\n\nexport default async function Home() {\n  const session = await auth();\n\n  if (session?.refreshToken) {\n    // Replace the app ID and secret with your own, you can check the \"Integration\" section.\n    const basicAuth = Buffer.from('<logto-app-id>:<logto-app-secret>').toString('base64');\n\n    // Replace the URL with your Logto endpoint, should ends with `/oidc/token`\n    const response = await fetch('https://xxx.logto.app/oidc/token', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        Authorization: `Basic ${basicAuth}`,\n      },\n      body: new URLSearchParams({\n        grant_type: 'refresh_token',\n        refresh_token: session.refreshToken,\n        // highlight-next-line\n        resource: 'urn:logto:scope:organizations',\n        // highlight-next-line\n        organization_id: 'organization-id',\n      }).toString(),\n    });\n\n    const data = await response.json();\n    console.log(data.access_token);\n  }\n\n  // ...\n}\n"})})]})}function G(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(W,{...e})}):W(e)}const H=[...V.RM];function $(e){return(0,r.jsx)(V.Ay,{organizationScope:"urn:logto:scope:organizations",configOrganizationCode:(0,r.jsx)(Y,{}),getOrganizationAccessTokenCode:(0,r.jsx)(G,{})})}function K(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)($,{...e})}):$()}const Z={slug:"/quick-starts/next-auth",sidebar_label:"Auth.js (Next Auth)",sidebar_custom_props:{logoFilename:"next-auth.svg",description:"Authentication for Next.js."}},J="Add authentication to your Auth.js (Next Auth) application",Q={},X=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Installation",id:"installation",level:2},{value:"Integration",id:"integration",level:2},...k,{value:"Fetch user information",id:"fetch-user-information",level:2},...h,{value:"API resources",id:"api-resources",level:2},...i.RM,{value:"Configure Logto provider",id:"configure-logto-provider",level:3},...D,{value:"Fetch access token for the API resource",id:"fetch-access-token-for-the-api-resource",level:3},...M,{value:"Fetch organization tokens",id:"fetch-organization-tokens",level:3},...H,{value:"Further readings",id:"further-readings",level:2},...c.RM];function ee(e){const n={a:"a",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",ul:"ul",...(0,o.R)(),...e.components},{Url:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"add-authentication-to-your-authjs-next-auth-application",children:"Add authentication to your Auth.js (Next Auth) application"})}),"\n",(0,r.jsxs)(n.p,{children:["This guide will show you how to integrate Logto into your Next.js application with ",(0,r.jsx)(n.a,{href:"https://authjs.dev/",children:"Auth.js"}),", previously known as Next Auth."]}),"\n",(0,r.jsx)(j,{}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["A ",(0,r.jsx)(n.a,{href:"https://cloud.logto.io",children:"Logto Cloud"})," account or a ",(0,r.jsx)(n.a,{href:"/introduction/set-up-logto-oss",children:"self-hosted Logto"}),"."]}),"\n",(0,r.jsx)(n.li,{children:"A Logto traditional application created."}),"\n",(0,r.jsxs)(n.li,{children:["A Next.js project with Auth.js, check out the ",(0,r.jsx)(n.a,{href:"https://authjs.dev/getting-started/installation",children:"Auth.js documentation"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,r.jsx)(v,{}),"\n",(0,r.jsx)(n.h2,{id:"integration",children:"Integration"}),"\n",(0,r.jsx)(I,{}),"\n",(0,r.jsx)(n.h2,{id:"fetch-user-information",children:"Fetch user information"}),"\n",(0,r.jsx)(p,{}),"\n",(0,r.jsx)(n.h2,{id:"api-resources",children:"API resources"}),"\n",(0,r.jsx)(i.Ay,{}),"\n",(0,r.jsx)(n.h3,{id:"configure-logto-provider",children:"Configure Logto provider"}),"\n",(0,r.jsx)(z,{}),"\n",(0,r.jsx)(n.h3,{id:"fetch-access-token-for-the-api-resource",children:"Fetch access token for the API resource"}),"\n",(0,r.jsx)(P,{}),"\n",(0,r.jsx)(n.h3,{id:"fetch-organization-tokens",children:"Fetch organization tokens"}),"\n",(0,r.jsx)(K,{}),"\n",(0,r.jsx)(n.h2,{id:"further-readings",children:"Further readings"}),"\n",(0,r.jsx)(c.Ay,{}),"\n",(0,r.jsx)(t,{href:"https://blog.logto.io/next-auth-v5",children:(0,r.jsx)(n.p,{children:"Migrating Logto integration from NextAuth.js v4 to v5"})})]})}function ne(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(ee,{...e})}):ee(e)}},38552:(e,n,t)=>{t.d(n,{A:()=>i});t(58101);var s=t(13526);const r={tabItem:"tabItem_dgSZ"};var o=t(25105);function i(e){let{children:n,hidden:t,className:i}=e;return(0,o.jsx)("div",{role:"tabpanel",className:(0,s.A)(r.tabItem,i),hidden:t,children:n})}},22002:(e,n,t)=>{t.d(n,{A:()=>w});var s=t(58101),r=t(13526),o=t(60755),i=t(55234),c=t(6635),a=t(4100),d=t(35661),l=t(42752);function h(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:n,children:t}=e;return(0,s.useMemo)((()=>{const e=n??function(e){return h(e).map((e=>{let{props:{value:n,label:t,attributes:s,default:r}}=e;return{value:n,label:t,attributes:s,default:r}}))}(t);return function(e){const n=(0,d.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function p(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function x(e){let{queryString:n=!1,groupId:t}=e;const r=(0,i.W6)(),o=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,a.aZ)(o),(0,s.useCallback)((e=>{if(!o)return;const n=new URLSearchParams(r.location.search);n.set(o,e),r.replace({...r.location,search:n.toString()})}),[o,r])]}function j(e){const{defaultValue:n,queryString:t=!1,groupId:r}=e,o=u(e),[i,a]=(0,s.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const s=t.find((e=>e.default))??t[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:n,tabValues:o}))),[d,h]=x({queryString:t,groupId:r}),[j,m]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[r,o]=(0,l.Dv)(t);return[r,(0,s.useCallback)((e=>{t&&o.set(e)}),[t,o])]}({groupId:r}),g=(()=>{const e=d??j;return p({value:e,tabValues:o})?e:null})();(0,c.A)((()=>{g&&a(g)}),[g]);return{selectedValue:i,selectValue:(0,s.useCallback)((e=>{if(!p({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);a(e),h(e),m(e)}),[h,m,o]),tabValues:o}}var m=t(21929);const g={tabList:"tabList_osvQ",tabItem:"tabItem_dc4O"};var f=t(25105);function v(e){let{className:n,block:t,selectedValue:s,selectValue:i,tabValues:c}=e;const a=[],{blockElementScrollPositionUntilNextRender:d}=(0,o.a_)(),l=e=>{const n=e.currentTarget,t=a.indexOf(n),r=c[t].value;r!==s&&(d(n),i(r))},h=e=>{let n=null;switch(e.key){case"Enter":l(e);break;case"ArrowRight":{const t=a.indexOf(e.currentTarget)+1;n=a[t]??a[0];break}case"ArrowLeft":{const t=a.indexOf(e.currentTarget)-1;n=a[t]??a[a.length-1];break}}n?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":t},n),children:c.map((e=>{let{value:n,label:t,attributes:o}=e;return(0,f.jsx)("li",{role:"tab",tabIndex:s===n?0:-1,"aria-selected":s===n,ref:e=>{a.push(e)},onKeyDown:h,onClick:l,...o,className:(0,r.A)("tabs__item",g.tabItem,o?.className,{"tabs__item--active":s===n}),children:t??n},n)}))})}function b(e){let{lazy:n,children:t,selectedValue:o}=e;const i=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=i.find((e=>e.props.value===o));return e?(0,s.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:i.map(((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==o})))})}function y(e){const n=j(e);return(0,f.jsxs)("div",{className:(0,r.A)("tabs-container",g.tabList),children:[(0,f.jsx)(v,{...n,...e}),(0,f.jsx)(b,{...n,...e})]})}function w(e){const n=(0,m.A)();return(0,f.jsx)(y,{...e,children:h(e.children)},String(n))}},79621:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>c});var s=t(58101);const r={},o=s.createContext(r);function i(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);