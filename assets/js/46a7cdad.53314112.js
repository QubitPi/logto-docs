"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[903],{39069:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"end-user-flows/organization-experience/invite-organization-members","title":"Invite organization members","description":"As a multi-organization application, one common requirement is to invite members to your organization. In this guide, we will walk you through the steps and technical details to implement this feature in your application.","source":"@site/docs/end-user-flows/organization-experience/invite-organization-members.mdx","sourceDirName":"end-user-flows/organization-experience","slug":"/end-user-flows/organization-experience/invite-organization-members","permalink":"/end-user-flows/organization-experience/invite-organization-members","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/docs/end-user-flows/organization-experience/invite-organization-members.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Create organization","permalink":"/end-user-flows/organization-experience/create-organization"},"next":{"title":"Organization management","permalink":"/end-user-flows/organization-experience/organization-management"}}');var o=i(25105),a=i(79621);const s={sidebar_position:2},r="Invite organization members",l={},c=[{value:"Flow overview",id:"flow-overview",level:2},{value:"Create organization roles",id:"create-organization-roles",level:2},{value:"Configure your email connector",id:"configure-your-email-connector",level:2},{value:"Handle invitations with Logto Management API",id:"handle-invitations-with-logto-management-api",level:2},{value:"For Cloud and OSS v1.27.0+ users",id:"for-cloud-and-oss-v1-27-0-users",level:3},{value:"For OSS v1.26.0- users",id:"for-oss-v1-26-0--users",level:3},{value:"Use organization role-based access control (RBAC) to manage user permissions",id:"use-organization-role-based-access-control-rbac-to-manage-user-permissions",level:2},{value:"Handle scope updates in organization tokens",id:"handle-scope-updates-in-organization-tokens",level:2},{value:"Revoking existing scopes",id:"revoking-existing-scopes",level:3},{value:"Granting new scopes",id:"granting-new-scopes",level:3},{value:"Grant new scopes that already defined in your auth system",id:"grant-new-scopes-that-already-defined-in-your-auth-system",level:4},{value:"Grant new scopes that are newly introduced your auth system",id:"grant-new-scopes-that-are-newly-introduced-your-auth-system",level:4},{value:"Implement real-time permission check and update organization token",id:"implement-real-time-permission-check-and-update-organization-token",level:3},{value:"Related resources",id:"related-resources",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components},{Url:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"invite-organization-members",children:"Invite organization members"})}),"\n",(0,o.jsx)(n.p,{children:"As a multi-organization application, one common requirement is to invite members to your organization. In this guide, we will walk you through the steps and technical details to implement this feature in your application."}),"\n",(0,o.jsx)(n.h2,{id:"flow-overview",children:"Flow overview"}),"\n",(0,o.jsx)(n.p,{children:"The overall process is illustrated in the diagram below:"}),"\n",(0,o.jsx)(n.mermaid,{value:"sequenceDiagram\n\tParticipant U as End user\n  Participant A as Organization admin\n  Participant C as Your multi-organization app\n\tParticipant L as Logto\n\n  A ->> C: Input invitee email and role\n  C ->> L: Create organization invitation with Management API\n  L --\x3e> C: Return invitation ID\n  C ->> C: Compose invitation link with invitation ID\n  C ->> L: Request sending invitation email with invitation link\n  L --\x3e> U: Send invitation email with invitation link\n  U ->> C: Click invitation link and navigate to your landing page,<br /> accept or reject the invitation\n  C ->> L: Update invitation status with Management API"}),"\n",(0,o.jsx)(n.h2,{id:"create-organization-roles",children:"Create organization roles"}),"\n",(0,o.jsxs)(n.p,{children:["Before inviting members to your organization, you need to create organization roles. Check out the ",(0,o.jsx)(n.a,{href:"/authorization/organization-template",children:"Organization template"})," to learn more about organization roles and permissions."]}),"\n",(0,o.jsxs)(n.p,{children:["In this guide, let's create two typical organization roles: ",(0,o.jsx)(n.code,{children:"admin"})," and ",(0,o.jsx)(n.code,{children:"member"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"admin"})," role has full access to all resources in the organization, while the ",(0,o.jsx)(n.code,{children:"member"})," role has limited access. For example, each role can have a set of permissions as follows:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"admin"})," role:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"read:data"})," - Read access to all organization data resources."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"write:data"})," - Write access to all organization data resources."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"delete:data"})," - Delete access to all organization data resources."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"invite:member"})," - Invite members to the organization."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"manage:member"})," - Manage members in the organization."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"delete:member"})," - Remove members from the organization."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"member"})," role:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"read:data"})," - Read access to all organization data resources."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"write:data"})," - Write access to all organization data resources."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"invite:member"})," - Invite members to the organization."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["This can be done easily in the ",(0,o.jsx)(n.a,{href:"https://cloud.logto.io/",children:"Logto Console"}),". You can also use the ",(0,o.jsx)(n.a,{href:"https://openapi.logto.io/operation/operation-createorganizationrole",children:"Logto Management API"})," to create organization roles programmatically."]}),"\n",(0,o.jsx)(n.h2,{id:"configure-your-email-connector",children:"Configure your email connector"}),"\n",(0,o.jsxs)(n.p,{children:["Since invitations are sent via email, ensure your ",(0,o.jsx)(n.a,{href:"/connectors/email-connectors",children:"email connector"})," is properly configured. To send invitations, you need to configure an ",(0,o.jsx)(n.a,{href:"/connectors/email-connectors/email-templates#email-template-types",children:"email templat"})," usage type - ",(0,o.jsx)(n.code,{children:"OrganizationInvitation"}),". You can also include organization (e.g., organization name, logo) and inviter (e.g., inviter email, name) ",(0,o.jsx)(n.a,{href:"/connectors/email-connectors/email-templates#email-template-variables",children:"variables"})," in the content, or customize ",(0,o.jsx)(n.a,{href:"/connectors/email-connectors/email-templates#email-template-localization",children:"multi-language templates"})," as needed."]}),"\n",(0,o.jsxs)(n.p,{children:["A sample email template for the ",(0,o.jsx)(n.code,{children:"OrganizationInvitation"})," usage type is shown below:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "subject": "Welcome to my organization",\n  "content": "<p>Join {{organization.name}} by this <a href=\\"{{link}}\\" target=\\"_blank\\">link</a>.</p>",\n  "usageType": "OrganizationInvitation",\n  "type": "text/html"\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"{{link}}"})," placeholder in the email content will be replaced with the actual invitation link when sending the email. In this guide, let's say it would be ",(0,o.jsx)(n.code,{children:"https://your-app.com/invitation/accept/{your-invitation-id}"}),"."]}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:['Logto Cloud\'s built-in "Logto email service" does not support the ',(0,o.jsx)(n.code,{children:"OrganizationInvitation"})," usage type at the moment. Instead, you need to configure your email connector (e.g. Sendgrid) and set up the ",(0,o.jsx)(n.code,{children:"OrganizationInvitation"})," template."]})}),"\n",(0,o.jsx)(n.h2,{id:"handle-invitations-with-logto-management-api",children:"Handle invitations with Logto Management API"}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["If you haven't set up the Logto Management API yet, check out ",(0,o.jsx)(n.a,{href:"/integrate-logto/interact-with-management-api",children:"Interact with Management API"})," for details."]})}),"\n",(0,o.jsx)(n.h3,{id:"for-cloud-and-oss-v1-27-0-users",children:"For Cloud and OSS v1.27.0+ users"}),"\n",(0,o.jsxs)(n.p,{children:["We can now use the ",(0,o.jsx)(n.a,{href:"/end-user-flows/one-time-token",children:"Magic link (One-time token)"})," feature to handle the invitation flow."]}),"\n",(0,o.jsxs)(n.p,{children:["Simply call the Management API to create a one-time token, and compose a invitation magic link with the token and invitee email.\nInsert the link into the ",(0,o.jsx)(n.code,{children:"{{link}}"})," placeholder in the above email template, and send the email to the invitee.\nYou can compose a link like ",(0,o.jsx)(n.code,{children:"https://your-app.com/landing-page?token={your-one-time-token}&email={invitee-email}"})," instead of the one containing the invitation ID."]}),"\n",(0,o.jsx)(n.p,{children:"This is the recommended approach, as it will automatically register the invitee with the magic link if they don't have an account yet."}),"\n",(0,o.jsxs)(n.p,{children:["Check out the ",(0,o.jsx)(n.a,{href:"/end-user-flows/one-time-token",children:"Magic link (One-time token)"})," page for more details."]}),"\n",(0,o.jsx)(n.h3,{id:"for-oss-v1-26-0--users",children:"For OSS v1.26.0- users"}),"\n",(0,o.jsx)(n.p,{children:"We've provided a set of invitation-related Management APIs in the organizations feature. With these APIs, you can:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"POST /api/organization-invitations"})," create an organization invitation with an assigned organization role."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"POST /api/organization-invitations/{id}/message"})," send the organization invitation to invitee via email.\nNote: This API payload supports a ",(0,o.jsx)(n.code,{children:"link"})," property, you can compose your invitation link based on the invitation ID. For example:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "link": "https://your-app.com/invitation/accept/{your-invitation-id}"\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"Accordingly, you need to implement a landing page when your invitee navigates through the invitation link to your application."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"GET /api/organization-invitations"})," & ",(0,o.jsx)(n.code,{children:"GET /api/organization-invitations/{id}"})," get all your invitations or a specific one by ID.\nOn your landing page, use these APIs to list all invitations or details of an invitation that a user has received."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"PUT /api/organization-invitations/{id}/status"})," accept or reject the invitation by updating the invitation status.\nUse this API to handle the user's response to the invitation."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"use-organization-role-based-access-control-rbac-to-manage-user-permissions",children:"Use organization role-based access control (RBAC) to manage user permissions"}),"\n",(0,o.jsx)(n.p,{children:"With the above setups, you can now send invitations via email, and invitees can join the organization with the assigned role."}),"\n",(0,o.jsx)(n.p,{children:"Users with different organization roles will have different scopes (permissions) in their organization tokens. Thus, both your client app and backend services should check these scopes to determine visible features and permitted actions."}),"\n",(0,o.jsx)(n.h2,{id:"handle-scope-updates-in-organization-tokens",children:"Handle scope updates in organization tokens"}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["This section involves advanced topics about managing organization template and authorization scenarios. If you are not familiar with these concepts, please read ",(0,o.jsx)(n.a,{href:"/authorization",children:"Authorization"})," and ",(0,o.jsx)(n.a,{href:"/authorization/organization-template",children:"Organization template"})," first."]})}),"\n",(0,o.jsx)(n.p,{children:"Managing scope updates in organization tokens involves:"}),"\n",(0,o.jsx)(n.h3,{id:"revoking-existing-scopes",children:"Revoking existing scopes"}),"\n",(0,o.jsx)(n.p,{children:"For instance, demoting an admin to a non-admin member should remove scopes from the user. In such case, you can simply clear the cached organization token and fetch a new one with refresh token. The shrunk scopes will be reflected immediately in the newly issued organization token."}),"\n",(0,o.jsx)(n.h3,{id:"granting-new-scopes",children:"Granting new scopes"}),"\n",(0,o.jsx)(n.p,{children:"This can be further divided into two scenarios:"}),"\n",(0,o.jsx)(n.h4,{id:"grant-new-scopes-that-already-defined-in-your-auth-system",children:"Grant new scopes that already defined in your auth system"}),"\n",(0,o.jsx)(n.p,{children:"Similar to revoking scopes, if the newly granted scope is already registered with the auth server, you can simply issue a new organization token, and the new scopes will be reflected immediately."}),"\n",(0,o.jsx)(n.h4,{id:"grant-new-scopes-that-are-newly-introduced-your-auth-system",children:"Grant new scopes that are newly introduced your auth system"}),"\n",(0,o.jsxs)(n.p,{children:["In this case, you need to trigger a re-login or re-consent process to update the user's organization token. E.g., calling the ",(0,o.jsx)(n.code,{children:"signIn"})," method in Logto SDK."]}),"\n",(0,o.jsx)(n.h3,{id:"implement-real-time-permission-check-and-update-organization-token",children:"Implement real-time permission check and update organization token"}),"\n",(0,o.jsx)(n.p,{children:"Logto provides Management API to fetch real-time user permissions in the organization."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"GET /api/organizations/{id}/users/{userId}/scopes"})," (",(0,o.jsx)(n.a,{href:"https://openapi.logto.io/operation/operation-listorganizationuserscopes",children:"API references"}),")"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"You can then compare the scopes in the user's organization token with the real-time permissions to determine if the user has been promoted or demoted."}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"If demoted, you can simply clear the cached organization token and the SDK will automatically issue a new one with the updated scopes."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"const { clearAccessToken } = useLogto();\n\n...\n// If fetched real-time scopes have fewer scopes than the organization token scopes\nawait clearAccessToken();\n"})}),"\n",(0,o.jsx)(n.p,{children:"This does not require a re-login or re-consent process. New organization tokens will be issued automatically by the Logto SDK."}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"If new scope is introduced into your auth system, trigger a re-login or re-consent process to update the user's organization token. Let's take the React SDK for example:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"const { clearAllTokens, signIn } = useLogto();\n\n...\n// If fetched real-time scopes have newly assigned scopes than the organization token scopes\nawait clearAllTokens();\nsignIn({\n  redirectUri: '<your-sign-in-redirect-uri>',\n  prompt: 'consent',\n});\n"})}),"\n",(0,o.jsx)(n.p,{children:"The above code will trigger a page navigation to the consent screen and auto-redirect back to your app, with updated scopes in the user's organization token."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"related-resources",children:"Related resources"}),"\n",(0,o.jsx)(i,{href:"https://blog.logto.io/implement-user-collaboration-in-your-app",children:(0,o.jsx)(n.p,{children:"How we implement user collaboration within a multi-tenant app"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},79621:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>r});var t=i(58101);const o={},a=t.createContext(o);function s(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);