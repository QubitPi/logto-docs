"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[9335],{36416:(e,n,i)=>{i.d(n,{Ay:()=>a,RM:()=>r});var o=i(25105),t=i(79621);const r=[];function s(e){const n={admonition:"admonition",code:"code",p:"p",...(0,t.R)(),...e.components};return(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["Inspect the ",(0,o.jsx)(n.code,{children:"organizations"})," claim in the ID token to get a list of organization IDs the user belongs to. This claim lists all organizations the user is a member of, making it easy to enumerate or switch organizations in your app."]})})}function a(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(s,{...e})}):s(e)}},22619:(e,n,i)=>{i.d(n,{Ay:()=>a,RM:()=>r});var o=i(25105),t=i(79621);const r=[];function s(e){const n={admonition:"admonition",p:"p",...(0,t.R)(),...e.components};return(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsx)(n.p,{children:"At the moment, Logto does not support fetching organization tokens directly from the authorization code flow. You will need to use the refresh token flow to obtain an organization token."})})}function a(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(s,{...e})}):s(e)}},85788:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>x,contentTitle:()=>m,default:()=>b,frontMatter:()=>p,metadata:()=>o,resource:()=>j,toc:()=>f});const o=JSON.parse('{"id":"authorization/organization-level-api-resources","title":"Protect organization-level API resources","description":"Combine API resources with the organization template to restrict access to APIs and data within each organization, ensuring tenant-level isolation in your SaaS.","source":"@site/docs/authorization/organization-level-api-resources.mdx","sourceDirName":"authorization","slug":"/authorization/organization-level-api-resources","permalink":"/authorization/organization-level-api-resources","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/docs/authorization/organization-level-api-resources.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"docsSidebar","previous":{"title":"Protect organization (non-API) permissions","permalink":"/authorization/organization-permissions"},"next":{"title":"Validate access tokens in API","permalink":"/authorization/validate-access-tokens/"}}');var t=i(25105),r=i(79621),s=i(1242),a=i(39088),l=i(78506),c=i(42372),d=i(38552),h=i(22002),u=i(36416),g=i(22619);const p={sidebar_position:5},m="Protect organization-level API resources",x={},j="https://api.your-app.com/organizations",f=[{value:"What are organization-level API resources?",id:"what-are-organization-level-api-resources",level:2},{value:"How it works in Logto",id:"how-it-works-in-logto",level:2},{value:"Implementation overview",id:"implementation-overview",level:3},{value:"How Logto applies organization RBAC",id:"how-logto-applies-organization-rbac",level:3},{value:"Authorization flow: authenticating and securing APIs with organization context",id:"authorization-flow-authenticating-and-securing-apis-with-organization-context",level:3},{value:"Implementation steps",id:"implementation-steps",level:2},{value:"Register your API resource",id:"register-your-api-resource",level:3},{value:"Set up organization roles",id:"set-up-organization-roles",level:3},{value:"Obtain organization tokens for API resources",id:"obtain-organization-tokens-for-api-resources",level:3},{value:"Refresh token flow",id:"refresh-token-flow",level:4},...u.RM,...g.RM,...u.RM,{value:"Client credentials flow",id:"client-credentials-flow",level:4},{value:"Validate organization tokens",id:"validate-organization-tokens",level:3},{value:"Best practices and security tips",id:"best-practices-and-security-tips",level:2},{value:"FAQs",id:"faqs",level:2},{value:"What if I don&#39;t include <code>organization_id</code> in my token request?",id:"what-if-i-don-t-include-organization-id-in-my-token-request",level:3},{value:"Can I mix organization and non-organization permissions in a single role?",id:"can-i-mix-organization-and-non-organization-permissions-in-a-single-role",level:3},{value:"Further reading",id:"further-reading",level:2}];function z(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{CloudLink:i,Details:o,Url:p}=n;return i||v("CloudLink",!0),o||v("Details",!0),p||v("Url",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"protect-organization-level-api-resources",children:"Protect organization-level API resources"})}),"\n","\n",(0,t.jsx)(n.p,{children:"Combine API resources with the organization template to restrict access to APIs and data within each organization, ensuring tenant-level isolation in your SaaS."}),"\n",(0,t.jsx)(n.h2,{id:"what-are-organization-level-api-resources",children:"What are organization-level API resources?"}),"\n",(0,t.jsxs)(n.p,{children:["Organization-level API resources are endpoints or services in your application that are ",(0,t.jsx)(n.strong,{children:"scoped to a specific organization"}),". These APIs enforce authorization and access based on the organization context-ensuring that users or clients only access data and actions relevant to their organization."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Use cases include"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["APIs for managing organization members, roles, or settings (e.g., ",(0,t.jsx)(n.code,{children:"/organizations/{organizationId}/members"}),")"]}),"\n",(0,t.jsx)(n.li,{children:"Organization-scoped dashboards, analytics, or reports"}),"\n",(0,t.jsx)(n.li,{children:"Billing, subscription, or audit endpoints tied to an organization"}),"\n",(0,t.jsx)(n.li,{children:"Any API where actions and data are isolated per tenant"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Logto allows you to secure these organization APIs using OAuth 2.1 and RBAC, while supporting multi-tenant SaaS architectures."}),"\n",(0,t.jsxs)(n.p,{children:["These permissions are managed through ",(0,t.jsx)(n.strong,{children:"organization roles"})," defined in the ",(0,t.jsx)(n.a,{href:"/authorization/organization-template",children:"organization template"}),". Every organization uses the same template, ensuring a consistent permission model across all organizations."]}),"\n",(0,t.jsx)(n.h2,{id:"how-it-works-in-logto",children:"How it works in Logto"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"API resources and permissions are registered globally:"})," Each API resource is defined with a unique resource indicator (URI) and a set of permissions (scopes) in Logto."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Roles at the organization level:"})," Organization roles are defined in the organization template. API resource permissions (scopes) are assigned to organization roles, which are then assigned to users or clients ",(0,t.jsx)(n.strong,{children:"within each organization"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Context-aware authorization:"})," When a client requests an access token with both an API resource and an ",(0,t.jsx)(n.code,{children:"organization_id"}),", Logto issues a token that includes both the organization context and the API audience. The token\u2019s permissions (scopes) are determined by the user\u2019s organization roles for the specified organization."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Separation from global resources:"})," API resources can be accessed with or without an organization context. Organization RBAC is only applied if an ",(0,t.jsx)(n.code,{children:"organization_id"})," is included in the request. For APIs that are shared across all users, see ",(0,t.jsx)(n.a,{href:"/authorization/global-api-resources",children:"Protect global API resources"}),"."]}),"\n"]}),"\n",(0,t.jsx)("img",{src:s.A,alt:"Organization-level API resources RBAC",style:{maxWidth:"100%"}}),"\n",(0,t.jsx)(n.h3,{id:"implementation-overview",children:"Implementation overview"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Register your API resource"})," and define its permissions (scopes) in Logto."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Define organization roles"})," in the organization template and assign relevant API permissions."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Assign roles"})," to users or clients within each organization."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Request an access token"})," for the API with an ",(0,t.jsx)(n.code,{children:"organization_id"})," to include organization context."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Validate access tokens"})," in your API, enforcing both organization context and permissions."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"how-logto-applies-organization-rbac",children:"How Logto applies organization RBAC"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["If you request an access token ",(0,t.jsx)(n.strong,{children:"without"})," an ",(0,t.jsx)(n.code,{children:"organization_id"}),", only global roles/permissions are considered."]}),"\n",(0,t.jsxs)(n.li,{children:["If you request an access token ",(0,t.jsx)(n.strong,{children:"with"})," an ",(0,t.jsx)(n.code,{children:"organization_id"}),", Logto evaluates the user\u2019s organization roles and their associated permissions for that organization."]}),"\n",(0,t.jsxs)(n.li,{children:["The resulting JWT will contain both the API audience (",(0,t.jsx)(n.code,{children:"aud"})," claim) and the organization context (",(0,t.jsx)(n.code,{children:"organization_id"})," claim), with scopes filtered to those granted by the user\u2019s organization roles."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"authorization-flow-authenticating-and-securing-apis-with-organization-context",children:"Authorization flow: authenticating and securing APIs with organization context"}),"\n",(0,t.jsx)(n.p,{children:"The following flow shows how a client (web, mobile, or backend) obtains and uses organization tokens to access organization-level API resources."}),"\n",(0,t.jsx)(n.p,{children:"Please note that the flow does not include exhaustive details about the required parameters or headers, but focuses on the key steps involved. Continue reading to see how the flow works in practice."}),"\n",(0,t.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Client\n    participant Logto\n    participant API as API Resource\n\n    alt User authentication\n        Client->>Logto: GET /oidc/auth\n        Logto->>Logto: Redirects user to sign-in page\n        Logto->>Client: Redirects back with `authorization_code`\n        Client->>Logto: POST /oidc/token with `grant_type=authorization_code`\n        Logto->>Client: Returns refresh token\n        Client->>Logto: POST /oidc/token with `grant_type=refresh_token`<br/>+ resource + organization_id\n    else Machine-to-machine (M2M) client authentication\n        Client->>Logto: POST /oidc/token with `grant_type=client_credentials`<br/>+ resource + organization_id\n    end\n\n    Logto->>Client: Returns access token (JWT)\n    Client->>API: Request with Bearer token\n    API->>API: Validates token, checks organization context and permissions\n\n    alt Token is valid\n      API->>Client: Returns organization data\n    else Token is invalid\n      API->>Client: 401 Unauthorized\n    end"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"User authentication = browser/app. M2M = backend service or script using client credentials + organization context."})}),"\n",(0,t.jsx)(n.h2,{id:"implementation-steps",children:"Implementation steps"}),"\n",(0,t.jsx)(n.h3,{id:"register-your-api-resource",children:"Register your API resource"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Go to ",(0,t.jsx)(i,{to:"/api-resources",children:"Console \u2192 API resources"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Create a new API resource (e.g., ",(0,t.jsx)(n.code,{children:"https://api.yourapp.com/org"}),") and define its permissions (scopes)."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["For full configuration steps, see ",(0,t.jsx)(n.a,{href:"/authorization/role-based-access-control#define-api-resources-with-permissions",children:"Define API resources with permissions"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"set-up-organization-roles",children:"Set up organization roles"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Go to ",(0,t.jsx)(i,{to:"/organization-template/organization-roles",children:"Console \u2192 Organization template \u2192 Organization roles"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Create organization roles (e.g., ",(0,t.jsx)(n.code,{children:"admin"}),", ",(0,t.jsx)(n.code,{children:"member"}),") and assign API permissions to each role"]}),"\n",(0,t.jsx)(n.li,{children:"Assign roles to users or clients within each organization. If they\u2019re not members yet, invite or add them first."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["For full configuration steps, see ",(0,t.jsx)(n.a,{href:"/authorization/role-based-access-control#configure-organization-roles",children:"Use organization roles"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"obtain-organization-tokens-for-api-resources",children:"Obtain organization tokens for API resources"}),"\n",(0,t.jsxs)(n.p,{children:["Your client/app should request a token with both ",(0,t.jsx)(n.code,{children:"resource"})," and ",(0,t.jsx)(n.code,{children:"organization_id"})," to access organization-level APIs. Logto issues organization tokens as ",(0,t.jsx)(n.a,{href:"https://auth.wiki/jwt",children:"JSON Web Tokens (JWTs)"}),". You can obtain these using either the ",(0,t.jsx)(n.a,{href:"https://auth.wiki/refresh-token",children:"refresh token flow"})," or ",(0,t.jsx)(n.a,{href:"https://auth.wiki/client-credentials-flow",children:"client credentials flow"}),"."]}),"\n",(0,t.jsx)(n.h4,{id:"refresh-token-flow",children:"Refresh token flow"}),"\n",(0,t.jsx)(n.p,{children:"Almost all Logto official SDKs support obtaining organization tokens using the refresh token flow out of the box. A standard OAuth 2.0 / OIDC client library can also be used to implement this flow."}),"\n",(0,t.jsxs)(h.A,{groupId:"user-client",children:[(0,t.jsxs)(d.A,{value:"logto-sdk",label:"Logto SDK",children:[(0,t.jsxs)(n.p,{children:["When initializing the Logto SDK, add the ",(0,t.jsx)(n.code,{children:"urn:logto:scope:organizations"})," and desired organization permissions (scopes) to the ",(0,t.jsx)(n.code,{children:"scopes"})," parameter."]}),(0,t.jsxs)(n.p,{children:["Some Logto SDKs have a predefined scope for organizations, such as ",(0,t.jsx)(n.code,{children:"UserScope.Organizations"})," in JavaScript SDKs."]}),(0,t.jsx)(u.Ay,{}),(0,t.jsxs)(n.p,{children:["When calling ",(0,t.jsx)(n.code,{children:"getAccessToken()"}),", specify both the API resource (",(0,t.jsx)(n.code,{children:"resource"}),") and the organization ID (",(0,t.jsx)(n.code,{children:"organizationId"}),") to obtain an organization token."]}),(0,t.jsxs)(n.p,{children:["For details on each SDK, see ",(0,t.jsx)(n.a,{href:"/quick-starts",children:"Quick starts"}),"."]})]}),(0,t.jsxs)(d.A,{value:"oauth-client",label:"OAuth 2.0 / OIDC client library",children:[(0,t.jsx)(n.p,{children:"When configuring your OAuth 2.0 client or initializing the authorization code flow, ensure you include the following parameters:"}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"resource"}),": Set to the API resource identifier registered in Logto (e.g., ",(0,t.jsx)(n.code,{children:"https://api.your-app.com/organizations"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"scope"}),": Include the predefined organization scope (",(0,t.jsx)(n.code,{children:"urn:logto:scope:organizations"}),"), ",(0,t.jsx)(n.code,{children:"offline_access"})," (to obtain refresh tokens), and any specific API permissions you need (e.g., ",(0,t.jsx)(n.code,{children:"manage:members view:analytics"}),")."]}),"\n"]}),(0,t.jsxs)(n.p,{children:["Some libraries may not support the ",(0,t.jsx)(n.code,{children:"resource"})," parameter natively, but usually allow you to pass additional parameters in the authorization request. Check your library's documentation for details."]}),(0,t.jsx)(n.p,{children:"Here's a non-normative example of how the authorization request might look:"}),(0,t.jsx)(a.A,{resource:j,scope:"urn:logto:scope:organizations invite:member manage:billing"}),(0,t.jsxs)(n.p,{children:["Once the user is authenticated, you will receive an authorization code. Use this code by making a POST request to Logto's ",(0,t.jsx)(n.code,{children:"/oidc/token"})," endpoint."]}),(0,t.jsx)(n.p,{children:"Here's a non-normative example of the token request:"}),(0,t.jsx)(c.A,{grantType:"authorization_code"}),(0,t.jsx)(g.Ay,{}),(0,t.jsx)(n.p,{children:"You'll receive a refresh token that can be used to obtain organization tokens."}),(0,t.jsx)(u.Ay,{}),(0,t.jsxs)(n.p,{children:["Finally, use the refresh token to obtain an organization token by making a POST request to Logto's ",(0,t.jsx)(n.code,{children:"/oidc/token"})," endpoint. Remember to include:"]}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"resource"})," parameter set to the API resource identifier (e.g., ",(0,t.jsx)(n.code,{children:"https://api.yourapp.com/org"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"organization_id"})," parameter set to the desired organization ID."]}),"\n",(0,t.jsxs)(n.li,{children:["(Optional) The ",(0,t.jsx)(n.code,{children:"scope"})," parameter to further downscope the permissions you need (e.g., ",(0,t.jsx)(n.code,{children:"manage:members view:reports"}),")."]}),"\n"]}),(0,t.jsx)(n.p,{children:"Here's a non-normative example of how the token request might look:"}),(0,t.jsx)(c.A,{grantType:"refresh_token",resource:j,organizationId:"your-organization-id"})]})]}),"\n",(0,t.jsx)(n.h4,{id:"client-credentials-flow",children:"Client credentials flow"}),"\n",(0,t.jsxs)(n.p,{children:["For machine-to-machine (M2M) scenarios, you can use the client credentials flow to obtain an access token for organization-level API resource permissions. By making a POST request to Logto's ",(0,t.jsx)(n.code,{children:"/oidc/token"})," endpoint with organization parameters, you can request an organization token using your client ID and secret."]}),"\n",(0,t.jsx)(n.p,{children:"Here are the key parameters to include in the request:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"resource"}),": The API resource identifier (e.g., ",(0,t.jsx)(n.code,{children:"https://api.yourapp.com/org"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"organization_id"}),": The ID of the organization you want the token for."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"scope"}),": The organization-level API resource permissions you want to request (e.g., ",(0,t.jsx)(n.code,{children:"invite:member"}),", ",(0,t.jsx)(n.code,{children:"manage:billing"}),")."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Here's a non-normative example of the token request using the client credentials grant type:"}),"\n",(0,t.jsx)(l.A,{resource:"https://api.yourapp.com/org",organizationId:"your-organization-id",scope:"invite:member manage:billing"}),"\n",(0,t.jsx)(n.h3,{id:"validate-organization-tokens",children:"Validate organization tokens"}),"\n",(0,t.jsx)(n.p,{children:"Logto-issued organization tokens (JWTs) contain claims that your API can use to enforce organization-level access control."}),"\n",(0,t.jsx)(n.p,{children:"When your app receives an organization token, you should:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Verify the token signature (using Logto's JWKs)."}),"\n",(0,t.jsxs)(n.li,{children:["Confirm the token is not expired (",(0,t.jsx)(n.code,{children:"exp"})," claim)."]}),"\n",(0,t.jsxs)(n.li,{children:["Check that the ",(0,t.jsx)(n.code,{children:"iss"})," (issuer) matches your Logto endpoint."]}),"\n",(0,t.jsxs)(n.li,{children:["Ensure the ",(0,t.jsx)(n.code,{children:"aud"})," (audience) matches the API resource identifier you registered (e.g., ",(0,t.jsx)(n.code,{children:"https://api.yourapp.com/org"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Validate the ",(0,t.jsx)(n.code,{children:"organization_id"})," claim to ensure the token is scoped to the correct organization."]}),"\n",(0,t.jsxs)(n.li,{children:["Split the ",(0,t.jsx)(n.code,{children:"scope"})," claim (space-separated) and check for required permissions."]}),"\n",(0,t.jsxs)(n.li,{children:["If your API path includes the organization ID (e.g., ",(0,t.jsx)(n.code,{children:"/organizations/{organizationId}/members"}),"), ensure the ",(0,t.jsx)(n.code,{children:"organization_id"})," claim matches the path parameter."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["For step-by-step and language-specific guides, see ",(0,t.jsx)(n.a,{href:"/authorization/validate-access-tokens",children:"How to validate access tokens"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"best-practices-and-security-tips",children:"Best practices and security tips"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Always validate the organization context:"})," Don\u2019t trust just the token; check the ",(0,t.jsx)(n.code,{children:"organization_id"})," claim for every organization-scoped API call."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use audience restrictions"}),": Always check the ",(0,t.jsx)(n.code,{children:"aud"})," claim to ensure the token is for the intended organization."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Keep permissions business-driven:"})," Use clear names that map to real actions; only grant what is needed for each organization role."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Separate API and non-API permissions"})," where possible (but both can be in a single role)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Keep token lifetimes short:"})," Reduces risk if a token is leaked."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Regularly review your organization template:"})," Update roles and permissions as your product evolves."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"faqs",children:"FAQs"}),"\n",(0,t.jsxs)(o,{children:[(0,t.jsx)("summary",{children:(0,t.jsxs)(n.h3,{id:"what-if-i-don-t-include-organization-id-in-my-token-request",children:["What if I don't include ",(0,t.jsx)(n.code,{children:"organization_id"})," in my token request?"]})}),(0,t.jsx)(n.p,{children:"Only global roles/permissions will be evaluated. Organization RBAC will not be enforced."})]}),"\n",(0,t.jsxs)(o,{children:[(0,t.jsx)("summary",{children:(0,t.jsx)(n.h3,{id:"can-i-mix-organization-and-non-organization-permissions-in-a-single-role",children:"Can I mix organization and non-organization permissions in a single role?"})}),(0,t.jsx)(n.p,{children:"No, organization permissions (including organization-level API permissions) are defined by the organization template and cannot be mixed with global API permissions. However, you can create roles that include both organization permissions and organization-level API permissions."})]}),"\n",(0,t.jsx)(n.h2,{id:"further-reading",children:"Further reading"}),"\n",(0,t.jsx)(p,{href:"/authorization/validate-access-tokens",children:"How to validate access tokens"}),"\n",(0,t.jsx)(p,{href:"/developers/custom-token-claims",children:"Customizing token claims"}),"\n",(0,t.jsx)(p,{href:"/use-cases/multi-tenancy/build-multi-tenant-saas-application",children:(0,t.jsx)(n.p,{children:"Use case: Build a multi-tenant SaaS application"})}),"\n",(0,t.jsx)(p,{href:"https://www.rfc-editor.org/rfc/rfc8707.html",children:"RFC 8707: Resource Indicators"})]})}function b(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(z,{...e})}):z(e)}function v(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},39088:(e,n,i)=>{i.d(n,{A:()=>r});var o=i(80173),t=i(25105);const r=e=>{let{resource:n,scope:i}=e;return(0,t.jsx)(o.A,{language:"http",children:`GET /oidc/auth?response_type=code\n&client_id=your-client-id\n&redirect_uri=https://your-app.com/callback\n&scope=openid profile offline_access ${i}\n&resource=${n}\n&code_challenge=abc123\n&code_challenge_method=S256\n&state=xyz\nHTTP/1.1\nHost: your.logto.endpoint\n`})}},78506:(e,n,i)=>{i.d(n,{A:()=>r});var o=i(80173),t=i(25105);const r=e=>{let{resource:n,organizationId:i,scope:r}=e;return(0,t.jsxs)(o.A,{language:"http",children:["POST /oidc/token HTTP/1.1\nHost: your.logto.endpoint\nContent-Type: application/x-www-form-urlencoded\nAuthorization: Basic base64(client_id:client_secret)\n\ngrant_type=client_credentials\n",n&&`&resource=${n}\n`,i&&`&organization_id=${i}\n`,`&scope=${r}\n`]})}},42372:(e,n,i)=>{i.d(n,{A:()=>r});var o=i(80173),t=i(25105);const r=e=>{let{grantType:n,resource:i,organizationId:r}=e;const s=[`grant_type=${n}`,"authorization_code"===n&&"code=authorization-code-received","authorization_code"===n&&"redirect_uri=https://your-app.com/callback","refresh_token"===n&&"refresh_token=your-refresh-token",i&&`resource=${i}`,r&&`organization_id=${r}`].filter(Boolean);return(0,t.jsx)(o.A,{language:"http",children:`POST /oidc/token HTTP/1.1\nHost: your.logto.endpoint\nContent-Type: application/x-www-form-urlencoded\nAuthorization: Basic base64(client_id:client_secret)\n\n${s.join("\n&")}`})}},38552:(e,n,i)=>{i.d(n,{A:()=>s});i(58101);var o=i(13526);const t={tabItem:"tabItem_dgSZ"};var r=i(25105);function s(e){let{children:n,hidden:i,className:s}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,o.A)(t.tabItem,s),hidden:i,children:n})}},22002:(e,n,i)=>{i.d(n,{A:()=>k});var o=i(58101),t=i(13526),r=i(60755),s=i(55234),a=i(6635),l=i(4100),c=i(35661),d=i(42752);function h(e){return o.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:n,children:i}=e;return(0,o.useMemo)((()=>{const e=n??function(e){return h(e).map((e=>{let{props:{value:n,label:i,attributes:o,default:t}}=e;return{value:n,label:i,attributes:o,default:t}}))}(i);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,i])}function g(e){let{value:n,tabValues:i}=e;return i.some((e=>e.value===n))}function p(e){let{queryString:n=!1,groupId:i}=e;const t=(0,s.W6)(),r=function(e){let{queryString:n=!1,groupId:i}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!i)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return i??null}({queryString:n,groupId:i});return[(0,l.aZ)(r),(0,o.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(t.location.search);n.set(r,e),t.replace({...t.location,search:n.toString()})}),[r,t])]}function m(e){const{defaultValue:n,queryString:i=!1,groupId:t}=e,r=u(e),[s,l]=(0,o.useState)((()=>function(e){let{defaultValue:n,tabValues:i}=e;if(0===i.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!g({value:n,tabValues:i}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${i.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const o=i.find((e=>e.default))??i[0];if(!o)throw new Error("Unexpected error: 0 tabValues");return o.value}({defaultValue:n,tabValues:r}))),[c,h]=p({queryString:i,groupId:t}),[m,x]=function(e){let{groupId:n}=e;const i=function(e){return e?`docusaurus.tab.${e}`:null}(n),[t,r]=(0,d.Dv)(i);return[t,(0,o.useCallback)((e=>{i&&r.set(e)}),[i,r])]}({groupId:t}),j=(()=>{const e=c??m;return g({value:e,tabValues:r})?e:null})();(0,a.A)((()=>{j&&l(j)}),[j]);return{selectedValue:s,selectValue:(0,o.useCallback)((e=>{if(!g({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);l(e),h(e),x(e)}),[h,x,r]),tabValues:r}}var x=i(21929);const j={tabList:"tabList_osvQ",tabItem:"tabItem_dc4O"};var f=i(25105);function z(e){let{className:n,block:i,selectedValue:o,selectValue:s,tabValues:a}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,r.a_)(),d=e=>{const n=e.currentTarget,i=l.indexOf(n),t=a[i].value;t!==o&&(c(n),s(t))},h=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const i=l.indexOf(e.currentTarget)+1;n=l[i]??l[0];break}case"ArrowLeft":{const i=l.indexOf(e.currentTarget)-1;n=l[i]??l[l.length-1];break}}n?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,t.A)("tabs",{"tabs--block":i},n),children:a.map((e=>{let{value:n,label:i,attributes:r}=e;return(0,f.jsx)("li",{role:"tab",tabIndex:o===n?0:-1,"aria-selected":o===n,ref:e=>{l.push(e)},onKeyDown:h,onClick:d,...r,className:(0,t.A)("tabs__item",j.tabItem,r?.className,{"tabs__item--active":o===n}),children:i??n},n)}))})}function b(e){let{lazy:n,children:i,selectedValue:r}=e;const s=(Array.isArray(i)?i:[i]).filter(Boolean);if(n){const e=s.find((e=>e.props.value===r));return e?(0,o.cloneElement)(e,{className:(0,t.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:s.map(((e,n)=>(0,o.cloneElement)(e,{key:n,hidden:e.props.value!==r})))})}function v(e){const n=m(e);return(0,f.jsxs)("div",{className:(0,t.A)("tabs-container",j.tabList),children:[(0,f.jsx)(z,{...n,...e}),(0,f.jsx)(b,{...n,...e})]})}function k(e){const n=(0,x.A)();return(0,f.jsx)(v,{...e,children:h(e.children)},String(n))}},55138:(e,n,i)=>{i.d(n,{A:()=>m});var o=i(28259),t=i(6097),r=i(58574),s=i(9484),a=i(76566),l=i(26346),c=i(17867),d=i(17510),h=i(13526),u=i(72355);const g={codeBlockContent:"codeBlockContent_m3Ux",codeBlockTitle:"codeBlockTitle_P25_",codeBlock:"codeBlock_qGQc",codeBlockStandalone:"codeBlockStandalone_zC50",codeBlockLines:"codeBlockLines_p187",codeBlockLinesWithNumbering:"codeBlockLinesWithNumbering_OFgW",buttonGroup:"buttonGroup_6DOT"};var p=i(25105);function m(e){let{children:n,className:i="",metastring:m,title:x,showLineNumbers:j,language:f}=e;const{prism:{defaultLanguage:z,magicComments:b}}=(0,o.p)(),v=function(e){return e?.toLowerCase()}(f??(0,r.Op)(i)??z),k=(0,t.A)(),w=(0,s.f)(),y=(0,r.wt)(m)||x,{lineClassNames:A,code:I}=(0,r.Li)(n,{metastring:m,language:v,magicComments:b}),P=j??(0,r._u)(m);return(0,p.jsxs)(a.A,{as:"div",className:(0,h.A)(i,v&&!i.includes(`language-${v}`)&&`language-${v}`),children:[y&&(0,p.jsx)("div",{className:g.codeBlockTitle,children:y}),(0,p.jsxs)("div",{className:g.codeBlockContent,children:[(0,p.jsx)(u.f4,{theme:k,code:I,language:v??"text",children:e=>{let{className:n,tokens:i,getLineProps:o,getTokenProps:t}=e;return(0,p.jsx)("pre",{ref:w.codeBlockRef,tabIndex:0,className:(0,h.A)(n,g.codeBlock,"thin-scrollbar"),children:(0,p.jsx)("code",{className:(0,h.A)(g.codeBlockLines,P&&g.codeBlockLinesWithNumbering),children:i.map(((e,n)=>(0,p.jsx)(c.A,{line:e,getLineProps:o,getTokenProps:t,classNames:A[n],showLineNumbers:P},n)))})})}}),(0,p.jsxs)("div",{className:g.buttonGroup,children:[(w.isEnabled||w.isCodeScrollable)&&(0,p.jsx)(d.A,{className:g.codeButton,isEnabled:w.isEnabled,onClick:()=>{w.toggle()}}),(0,p.jsx)(l.A,{className:g.codeButton,code:I})]})]})]})}},1242:(e,n,i)=>{i.d(n,{A:()=>o});const o=i.p+"assets/images/rbac-organization-level-api-resources-9533c281f3ee1cf52aefe821717e1fef.png"}}]);