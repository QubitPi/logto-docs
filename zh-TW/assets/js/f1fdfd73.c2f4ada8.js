"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[8406],{41833:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"use-cases/authorization/rbac-in-practice","title":"rbac-in-practice","description":"\u89d2\u8272\u578b\u5b58\u53d6\u63a7\u5236 (RBAC, Role-based Access Control) \u5be6\u52d9\u6307\u5357\uff1a\u5b78\u7fd2\u5982\u4f55\u8a2d\u8a08\u6b0a\u9650\u3001\u7ba1\u7406\u89d2\u8272\uff0c\u4e26\u5728\u4f60\u7684 CMS \u4e2d\u5efa\u7acb\u5b89\u5168\u7684\u6388\u6b0a (Authorization) \u6a5f\u5236\u3002","source":"@site/i18n/zh-TW/docusaurus-plugin-content-docs/current/use-cases/authorization/rbac-in-practice.mdx","sourceDirName":"use-cases/authorization","slug":"/use-cases/authorization/rbac-in-practice","permalink":"/zh-TW/use-cases/authorization/rbac-in-practice","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/zh-TW/docusaurus-plugin-content-docs/current/use-cases/authorization/rbac-in-practice.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"\u5be6\u52d9\u4e0a\u7684\u89d2\u8272\u578b\u5b58\u53d6\u63a7\u5236 (RBAC in practice)","description":"\u89d2\u8272\u578b\u5b58\u53d6\u63a7\u5236 (RBAC, Role-based Access Control) \u5be6\u52d9\u6307\u5357\uff1a\u5b78\u7fd2\u5982\u4f55\u8a2d\u8a08\u6b0a\u9650\u3001\u7ba1\u7406\u89d2\u8272\uff0c\u4e26\u5728\u4f60\u7684 CMS \u4e2d\u5efa\u7acb\u5b89\u5168\u7684\u6388\u6b0a (Authorization) \u6a5f\u5236\u3002"},"sidebar":"useCasesSidebar","previous":{"title":"\u6388\u6b0a (Authorization)","permalink":"/zh-TW/use-cases/authorization/"},"next":{"title":"\u591a\u79df\u6236 (Multi-tenancy)","permalink":"/zh-TW/use-cases/multi-tenancy/"}}');var r=s(25105),t=s(79621);const c={sidebar_position:1,sidebar_label:"\u5be6\u52d9\u4e0a\u7684\u89d2\u8272\u578b\u5b58\u53d6\u63a7\u5236 (RBAC in practice)",description:"\u89d2\u8272\u578b\u5b58\u53d6\u63a7\u5236 (RBAC, Role-based Access Control) \u5be6\u52d9\u6307\u5357\uff1a\u5b78\u7fd2\u5982\u4f55\u8a2d\u8a08\u6b0a\u9650\u3001\u7ba1\u7406\u89d2\u8272\uff0c\u4e26\u5728\u4f60\u7684 CMS \u4e2d\u5efa\u7acb\u5b89\u5168\u7684\u6388\u6b0a (Authorization) \u6a5f\u5236\u3002"},l="\u5be6\u52d9\u4e0a\u7684\u89d2\u8272\u578b\u5b58\u53d6\u63a7\u5236 (RBAC in practice)\uff1a\u70ba\u4f60\u7684\u61c9\u7528\u7a0b\u5f0f\u5be6\u4f5c\u5b89\u5168\u7684\u6388\u6b0a (Authorization)",o={},d=[{value:"\u7406\u89e3 RBAC \u57fa\u790e",id:"understanding-rbac-fundamentals",level:2},{value:"\u7d30\u7dfb\u6b0a\u9650\u8a2d\u8a08",id:"fine-grained-permission-design",level:3},{value:"\u8cc7\u6e90\u64c1\u6709\u6b0a\u8207\u5b58\u53d6\u63a7\u5236",id:"resource-ownership-and-access-control",level:3},{value:"\u8a2d\u8a08\u5b89\u5168\u7684 API",id:"designing-a-secure-apis",level:2},{value:"\u70ba API \u5be6\u4f5c\u5b58\u53d6\u63a7\u5236",id:"implement-access-control-for-your-api",level:3},{value:"\u5efa\u7acb\u53ef\u64f4\u5c55\u7684\u6b0a\u9650\u7cfb\u7d71",id:"creating-a-permission-system-that-scales",level:3},{value:"\u5efa\u7acb\u6709\u6548\u7684\u89d2\u8272",id:"building-effective-roles",level:2},{value:"\u5728 Logto \u8a2d\u5b9a RBAC",id:"config-rbac-in-logto",level:2},{value:"\u5efa\u7acb\u61c9\u7528\u7a0b\u5f0f",id:"setting-up-your-application",level:3},{value:"\u8a2d\u5b9a API \u8cc7\u6e90\u8207\u6b0a\u9650",id:"configuring-api-resources-and-permissions",level:3},{value:"\u5efa\u7acb\u89d2\u8272",id:"creating-roles",level:3},{value:"\u6307\u6d3e\u89d2\u8272\u7d66\u4f7f\u7528\u8005",id:"assigning-roles-to-users",level:3},{value:"\u524d\u7aef\u6574\u5408 Logto RBAC",id:"integrate-your-frontend-with-logto-rbac",level:2},{value:"\u5f8c\u7aef\u6574\u5408 Logto RBAC",id:"integrate-your-backend-with-logto-rbac",level:2},{value:"\u5f8c\u7aef\u6388\u6b0a (Authorization) \u4e2d\u4ecb\u8edf\u9ad4",id:"backend-authorization-middleware",level:3},{value:"\u4fdd\u8b77 API \u7aef\u9ede",id:"protecting-api-endpoints",level:3},{value:"\u6e2c\u8a66 CMS RBAC \u5be6\u4f5c",id:"test-the-cms-rbac-implementation",level:2},{value:"\u7d50\u8ad6",id:"conclusion",level:2}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components},{Head:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s,{children:(0,r.jsx)("link",{rel:"canonical",href:"https://blog.logto.io/rbac-in-practice"})}),"\n",(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"\u5be6\u52d9\u4e0a\u7684\u89d2\u8272\u578b\u5b58\u53d6\u63a7\u5236-rbac-in-practice\u70ba\u4f60\u7684\u61c9\u7528\u7a0b\u5f0f\u5be6\u4f5c\u5b89\u5168\u7684\u6388\u6b0a-authorization",children:"\u5be6\u52d9\u4e0a\u7684\u89d2\u8272\u578b\u5b58\u53d6\u63a7\u5236 (RBAC in practice)\uff1a\u70ba\u4f60\u7684\u61c9\u7528\u7a0b\u5f0f\u5be6\u4f5c\u5b89\u5168\u7684\u6388\u6b0a (Authorization)"})}),"\n",(0,r.jsxs)(n.p,{children:["\u4f60\u662f\u5426\u5728\u70ba\u61c9\u7528\u7a0b\u5f0f\u5be6\u4f5c\u5b89\u5168\u4e14\u53ef\u64f4\u5c55\u7684\u6388\u6b0a (Authorization) \u7cfb\u7d71\u800c\u82e6\u60f1\uff1f",(0,r.jsx)(n.strong,{children:"\u89d2\u8272\u578b\u5b58\u53d6\u63a7\u5236 (RBAC, Role-based Access Control)"})," \u662f\u7ba1\u7406\u4f7f\u7528\u8005\u6b0a\u9650\u7684\u696d\u754c\u6a19\u6e96\uff0c\u4f46\u6b63\u78ba\u5be6\u4f5c\u4e26\u4e0d\u5bb9\u6613\u3002\u672c\u6559\u5b78\u5c07\u4ee5\u5be6\u969b\u7684\u5167\u5bb9\u7ba1\u7406\u7cfb\u7d71\uff08CMS, Content Management System\uff09\u70ba\u4f8b\uff0c\u5e36\u4f60\u5efa\u7acb\u4e00\u5957\u5065\u5168\u7684 RBAC \u7cfb\u7d71\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u8ddf\u8457\u672c\u6307\u5357\uff0c\u4f60\u5c07\u5b78\u6703\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2728 \u5982\u4f55\u8a2d\u8a08\u8207\u5be6\u4f5c\u7d30\u7dfb\u7684\u6b0a\u9650\uff0c\u7cbe\u78ba\u638c\u63a7\u5b58\u53d6\u884c\u70ba"}),"\n",(0,r.jsx)(n.li,{children:"\ud83d\udd12 \u5c07\u6b0a\u9650\u6709\u610f\u7fa9\u5730\u7d44\u7e54\u6210\u89d2\u8272\u7684\u6700\u4f73\u5be6\u8e10"}),"\n",(0,r.jsx)(n.li,{children:"\ud83d\udc64 \u6709\u6548\u8655\u7406\u8cc7\u6e90\u64c1\u6709\u6b0a\u7684\u6280\u5de7"}),"\n",(0,r.jsx)(n.li,{children:"\ud83d\ude80 \u8b93\u4f60\u7684\u6388\u6b0a (Authorization) \u7cfb\u7d71\u5177\u5099\u53ef\u64f4\u5c55\u6027\u8207\u53ef\u7dad\u8b77\u6027\u7684\u65b9\u6cd5"}),"\n",(0,r.jsx)(n.li,{children:"\ud83d\udca1 \u4ee5\u771f\u5be6 CMS \u7bc4\u4f8b\u5be6\u4f5c"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u672c\u6559\u5b78\u5b8c\u6574\u539f\u59cb\u78bc\u53ef\u5728 ",(0,r.jsx)(n.a,{href:"https://github.com/logto-io/rbac-sample",children:"GitHub"})," \u53d6\u5f97\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"understanding-rbac-fundamentals",children:"\u7406\u89e3 RBAC \u57fa\u790e"}),"\n",(0,r.jsx)(n.p,{children:"\u89d2\u8272\u578b\u5b58\u53d6\u63a7\u5236 (RBAC) \u4e0d\u50c5\u50c5\u662f\u5c07\u6b0a\u9650\u5206\u914d\u7d66\u4f7f\u7528\u8005\uff0c\u66f4\u662f\u5efa\u7acb\u4e00\u5957\u7d50\u69cb\u5316\u7684\u6388\u6b0a (Authorization) \u65b9\u6cd5\uff0c\u517c\u9867\u5b89\u5168\u6027\u8207\u53ef\u7dad\u8b77\u6027\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u4f60\u53ef\u4ee5\u5728 Auth Wiki \u9032\u4e00\u6b65\u77ad\u89e3 ",(0,r.jsx)(n.a,{href:"https://auth-wiki.logto.io/rbac",children:"\u4ec0\u9ebc\u662f RBAC"}),"\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u4ee5\u4e0b\u662f\u6211\u5011\u5be6\u4f5c\u6642\u9075\u5faa\u7684\u95dc\u9375\u539f\u5247\uff1a"}),"\n",(0,r.jsx)(n.h3,{id:"fine-grained-permission-design",children:"\u7d30\u7dfb\u6b0a\u9650\u8a2d\u8a08"}),"\n",(0,r.jsx)(n.p,{children:"\u7d30\u7dfb\u7684\u6b0a\u9650\u8b93\u4f60\u80fd\u7cbe\u78ba\u63a7\u5236\u4f7f\u7528\u8005\u5728\u7cfb\u7d71\u4e2d\u7684\u64cd\u4f5c\u3002\u8207\u5176\u50c5\u7528\u300cadmin\u300d\u6216\u300cuser\u300d\u9019\u985e\u5ee3\u6cdb\u6b0a\u9650\uff0c\u6211\u5011\u6703\u5b9a\u7fa9\u4f7f\u7528\u8005\u53ef\u5c0d\u8cc7\u6e90\u57f7\u884c\u7684\u5177\u9ad4\u52d5\u4f5c\u3002\u4f8b\u5982\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"read:articles"})," - \u6aa2\u8996\u7cfb\u7d71\u4e2d\u4efb\u4e00\u6587\u7ae0"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"create:articles"})," - \u5efa\u7acb\u65b0\u6587\u7ae0"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"update:articles"})," - \u4fee\u6539\u73fe\u6709\u6587\u7ae0"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"publish:articles"})," - \u8b8a\u66f4\u6587\u7ae0\u767c\u4f48\u72c0\u614b"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"resource-ownership-and-access-control",children:"\u8cc7\u6e90\u64c1\u6709\u6b0a\u8207\u5b58\u53d6\u63a7\u5236"}),"\n",(0,r.jsx)(n.p,{children:"\u8cc7\u6e90\u64c1\u6709\u6b0a\u662f\u6211\u5011 CMS \u6388\u6b0a (Authorization) \u8a2d\u8a08\u7684\u6838\u5fc3\u6982\u5ff5\u3002RBAC \u5b9a\u7fa9\u4e0d\u540c\u89d2\u8272\u53ef\u57f7\u884c\u7684\u52d5\u4f5c\uff0c\u800c\u64c1\u6709\u6b0a\u5247\u70ba\u5b58\u53d6\u63a7\u5236\u589e\u6dfb\u500b\u4eba\u5c64\u9762\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4f5c\u8005\u81ea\u52d5\u64c1\u6709\u81ea\u5df1\u5275\u5efa\u7684\u6587\u7ae0\u7684\u5b58\u53d6\u6b0a"}),"\n",(0,r.jsx)(n.li,{children:"\u9019\u7a2e\u81ea\u7136\u7684\u64c1\u6709\u6b0a\u6a21\u578b\u8b93\u4f5c\u8005\u6c38\u9060\u80fd\u6aa2\u8996\u8207\u7de8\u8f2f\u81ea\u5df1\u7684\u5167\u5bb9"}),"\n",(0,r.jsx)(n.li,{children:"\u7cfb\u7d71\u5728\u8655\u7406\u6587\u7ae0\u64cd\u4f5c\u6642\u6703\u540c\u6642\u6aa2\u67e5\u89d2\u8272\u6b0a\u9650\u6216\u64c1\u6709\u6b0a"}),"\n",(0,r.jsxs)(n.li,{children:["\u4f8b\u5982\uff0c\u5373\u4f7f\u6c92\u6709 ",(0,r.jsx)(n.code,{children:"update:articles"})," \u6b0a\u9650\uff0c\u4f5c\u8005\u4ecd\u53ef\u7de8\u8f2f\u81ea\u5df1\u7684\u6587\u7ae0"]}),"\n",(0,r.jsx)(n.li,{children:"\u9019\u7a2e\u8a2d\u8a08\u6e1b\u5c11\u4e86\u984d\u5916\u89d2\u8272\u6b0a\u9650\u7684\u9700\u6c42\uff0c\u540c\u6642\u7dad\u6301\u5b89\u5168\u6027"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u9019\u7a2e\u96d9\u5c64\uff08\u89d2\u8272 + \u64c1\u6709\u6b0a\uff09\u8a2d\u8a08\u8b93\u7cfb\u7d71\u66f4\u76f4\u89ba\u4e14\u5b89\u5168\u3002\u767c\u4f48\u8005\u8207\u7ba1\u7406\u54e1\u53ef\u900f\u904e\u89d2\u8272\u6b0a\u9650\u7ba1\u7406\u6240\u6709\u5167\u5bb9\uff0c\u800c\u4f5c\u8005\u5247\u638c\u63a7\u81ea\u5df1\u7684\u4f5c\u54c1\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"designing-a-secure-apis",children:"\u8a2d\u8a08\u5b89\u5168\u7684 API"}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u5011\u5148\u5f9e\u8a2d\u8a08 CMS \u6838\u5fc3\u529f\u80fd\u7684 API \u7aef\u9ede\u958b\u59cb\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"GET    /api/articles         # \u5217\u51fa\u6240\u6709\u6587\u7ae0\nGET    /api/articles/:id     # \u53d6\u5f97\u7279\u5b9a\u6587\u7ae0\nPOST   /api/articles         # \u5efa\u7acb\u65b0\u6587\u7ae0\nPATCH  /api/articles/:id     # \u66f4\u65b0\u6587\u7ae0\nDELETE /api/articles/:id     # \u522a\u9664\u6587\u7ae0\nPATCH  /api/articles/:id/published  # \u8b8a\u66f4\u767c\u4f48\u72c0\u614b\n"})}),"\n",(0,r.jsx)(n.h3,{id:"implement-access-control-for-your-api",children:"\u70ba API \u5be6\u4f5c\u5b58\u53d6\u63a7\u5236"}),"\n",(0,r.jsx)(n.p,{children:"\u5c0d\u6bcf\u500b\u7aef\u9ede\uff0c\u6211\u5011\u9700\u8003\u616e\u5169\u500b\u5b58\u53d6\u63a7\u5236\u9762\u5411\uff1a"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u8cc7\u6e90\u64c1\u6709\u6b0a \u2014\u2014 \u4f7f\u7528\u8005\u662f\u5426\u64c1\u6709\u8a72\u8cc7\u6e90\uff1f"}),"\n",(0,r.jsx)(n.li,{children:"\u89d2\u8272\u578b\u6b0a\u9650 \u2014\u2014 \u4f7f\u7528\u8005\u7684\u89d2\u8272\u662f\u5426\u5141\u8a31\u6b64\u64cd\u4f5c\uff1f"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u4ee5\u4e0b\u662f\u5404\u7aef\u9ede\u7684\u5b58\u53d6\u908f\u8f2f\uff1a"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u7aef\u9ede"}),(0,r.jsx)(n.th,{children:"\u5b58\u53d6\u63a7\u5236\u908f\u8f2f"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"GET /api/articles"}),(0,r.jsxs)(n.td,{children:["- \u5177\u5099 ",(0,r.jsx)(n.code,{children:"list:articles"})," \u6b0a\u9650\u8005\uff0c\u6216\u4f5c\u8005\u53ef\u898b\u81ea\u5df1\u6587\u7ae0"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["GET /api/articles/",":id"]}),(0,r.jsxs)(n.td,{children:["- \u5177\u5099 ",(0,r.jsx)(n.code,{children:"read:articles"})," \u6b0a\u9650\u8005\uff0c\u6216\u8a72\u6587\u7ae0\u4f5c\u8005"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"POST /api/articles"}),(0,r.jsxs)(n.td,{children:["- \u5177\u5099 ",(0,r.jsx)(n.code,{children:"create:articles"})," \u6b0a\u9650\u8005"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["PATCH /api/articles/",":id"]}),(0,r.jsxs)(n.td,{children:["- \u5177\u5099 ",(0,r.jsx)(n.code,{children:"update:articles"})," \u6b0a\u9650\u8005\uff0c\u6216\u8a72\u6587\u7ae0\u4f5c\u8005"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["DELETE /api/articles/",":id"]}),(0,r.jsxs)(n.td,{children:["- \u5177\u5099 ",(0,r.jsx)(n.code,{children:"delete:articles"})," \u6b0a\u9650\u8005\uff0c\u6216\u8a72\u6587\u7ae0\u4f5c\u8005"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["PATCH /api/articles/",":id","/published"]}),(0,r.jsxs)(n.td,{children:["- \u50c5\u9650\u5177\u5099 ",(0,r.jsx)(n.code,{children:"publish:articles"})," \u6b0a\u9650\u8005"]})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"creating-a-permission-system-that-scales",children:"\u5efa\u7acb\u53ef\u64f4\u5c55\u7684\u6b0a\u9650\u7cfb\u7d71"}),"\n",(0,r.jsx)(n.p,{children:"\u6839\u64da API \u5b58\u53d6\u9700\u6c42\uff0c\u6211\u5011\u53ef\u5b9a\u7fa9\u4ee5\u4e0b\u6b0a\u9650\uff1a"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u6b0a\u9650"}),(0,r.jsx)(n.th,{children:"\u8aaa\u660e"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["list",":articles"]}),(0,r.jsx)(n.td,{children:"\u6aa2\u8996\u7cfb\u7d71\u4e2d\u6240\u6709\u6587\u7ae0\u5217\u8868"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["read",":articles"]}),(0,r.jsx)(n.td,{children:"\u95b1\u8b80\u4efb\u4e00\u6587\u7ae0\u5b8c\u6574\u5167\u5bb9"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["create",":articles"]}),(0,r.jsx)(n.td,{children:"\u5efa\u7acb\u65b0\u6587\u7ae0"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["update",":articles"]}),(0,r.jsx)(n.td,{children:"\u4fee\u6539\u4efb\u4e00\u6587\u7ae0"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["delete",":articles"]}),(0,r.jsx)(n.td,{children:"\u522a\u9664\u4efb\u4e00\u6587\u7ae0"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["publish",":articles"]}),(0,r.jsx)(n.td,{children:"\u8b8a\u66f4\u767c\u4f48\u72c0\u614b"})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"\u6ce8\u610f\uff0c\u9019\u4e9b\u6b0a\u9650\u50c5\u5728\u5b58\u53d6\u975e\u81ea\u5df1\u64c1\u6709\u7684\u8cc7\u6e90\u6642\u624d\u9700\u8981\u3002\u6587\u7ae0\u64c1\u6709\u8005\u81ea\u52d5\u64c1\u6709\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u6aa2\u8996\u81ea\u5df1\u6587\u7ae0\uff08\u4e0d\u9700 ",(0,r.jsx)(n.code,{children:"read:articles"}),"\uff09"]}),"\n",(0,r.jsxs)(n.li,{children:["\u7de8\u8f2f\u81ea\u5df1\u6587\u7ae0\uff08\u4e0d\u9700 ",(0,r.jsx)(n.code,{children:"update:articles"}),"\uff09"]}),"\n",(0,r.jsxs)(n.li,{children:["\u522a\u9664\u81ea\u5df1\u6587\u7ae0\uff08\u4e0d\u9700 ",(0,r.jsx)(n.code,{children:"delete:articles"}),"\uff09"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"building-effective-roles",children:"\u5efa\u7acb\u6709\u6548\u7684\u89d2\u8272"}),"\n",(0,r.jsx)(n.p,{children:"API \u8207\u6b0a\u9650\u5b9a\u7fa9\u597d\u5f8c\uff0c\u6211\u5011\u53ef\u5efa\u7acb\u908f\u8f2f\u5206\u7d44\u7684\u89d2\u8272\uff1a"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u6b0a\u9650 / \u89d2\u8272"}),(0,r.jsx)(n.th,{children:"\ud83d\udc51 \u7ba1\u7406\u54e1 (Admin)"}),(0,r.jsx)(n.th,{children:"\ud83d\udcdd \u767c\u4f48\u8005 (Publisher)"}),(0,r.jsx)(n.th,{children:"\u270d\ufe0f \u4f5c\u8005 (Author)"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"\u8aaa\u660e"})}),(0,r.jsx)(n.td,{children:"\u5b8c\u6574\u5167\u5bb9\u7ba1\u7406\u6b0a\u9650"}),(0,r.jsx)(n.td,{children:"\u53ef\u6aa2\u8996\u6240\u6709\u6587\u7ae0\u4e26\u63a7\u7ba1\u767c\u4f48\u72c0\u614b"}),(0,r.jsx)(n.td,{children:"\u53ef\u5728\u7cfb\u7d71\u4e2d\u5efa\u7acb\u65b0\u6587\u7ae0"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["list",":articles"]}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"\u274c"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["read",":articles"]}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"\u274c"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["create",":articles"]}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u2705"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["update",":articles"]}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u274c"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["delete",":articles"]}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u274c"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:["publish",":articles"]}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"\u274c"})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u6ce8\u610f"}),"\uff1a\u4f5c\u8005\u81ea\u52d5\u64c1\u6709\u81ea\u5df1\u6587\u7ae0\u7684\u8b80 / \u7de8\u8f2f / \u522a\u9664\u6b0a\u9650\uff0c\u7121\u8ad6\u89d2\u8272\u6b0a\u9650\u70ba\u4f55\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u6bcf\u500b\u89d2\u8272\u7686\u91dd\u5c0d\u7279\u5b9a\u8077\u8cac\u8a2d\u8a08\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u7ba1\u7406\u54e1 (Admin)"}),"\uff1a\u5168\u9762\u638c\u63a7 CMS\uff0c\u5305\u62ec\u6240\u6709\u6587\u7ae0\u64cd\u4f5c"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u767c\u4f48\u8005 (Publisher)"}),"\uff1a\u5c08\u6ce8\u65bc\u5167\u5bb9\u5be9\u6838\u8207\u767c\u4f48\u7ba1\u7406"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u4f5c\u8005 (Author)"}),"\uff1a\u5c08\u8077\u5167\u5bb9\u5275\u4f5c"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u9019\u6a23\u7684\u89d2\u8272\u7d50\u69cb\u660e\u78ba\u5206\u5de5\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4f5c\u8005\u5c08\u6ce8\u65bc\u5167\u5bb9\u5275\u4f5c"}),"\n",(0,r.jsx)(n.li,{children:"\u767c\u4f48\u8005\u7ba1\u7406\u5167\u5bb9\u54c1\u8cea\u8207\u53ef\u898b\u6027"}),"\n",(0,r.jsx)(n.li,{children:"\u7ba1\u7406\u54e1\u7dad\u8b77\u6574\u9ad4\u7cfb\u7d71"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"config-rbac-in-logto",children:"\u5728 Logto \u8a2d\u5b9a RBAC"}),"\n",(0,r.jsxs)(n.p,{children:["\u958b\u59cb\u524d\uff0c\u4f60\u9700\u8981\u5728 ",(0,r.jsx)(n.a,{href:"https://cloud.logto.io",children:"Logto Cloud"})," \u5efa\u7acb\u5e33\u865f\uff0c\u6216\u4f7f\u7528 ",(0,r.jsx)(n.a,{href:"/logto-oss",children:"Logto OSS \u7248\u672c"})," \u81ea\u884c\u67b6\u8a2d Logto\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u672c\u6559\u5b78\u70ba\u7c21\u5316\u6d41\u7a0b\uff0c\u5c07\u4ee5 Logto Cloud \u70ba\u4f8b\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"setting-up-your-application",children:"\u5efa\u7acb\u61c9\u7528\u7a0b\u5f0f"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\u524d\u5f80 Logto Console \u7684\u300c\u61c9\u7528\u7a0b\u5f0f\u300d\u5efa\u7acb\u65b0 React \u61c9\u7528\u7a0b\u5f0f","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u61c9\u7528\u7a0b\u5f0f\u540d\u7a31\uff1aContent Management System"}),"\n",(0,r.jsx)(n.li,{children:"\u61c9\u7528\u7a0b\u5f0f\u985e\u578b\uff1a\u50b3\u7d71\u7db2\u9801\u61c9\u7528\u7a0b\u5f0f"}),"\n",(0,r.jsxs)(n.li,{children:["Redirect URIs: ",(0,r.jsx)(n.a,{href:"http://localhost:5173/callback",children:"http://localhost:5173/callback"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://uploads.strapi.logto.io/cms_application_3ed42f2256.png",alt:"CMS React application"})}),"\n",(0,r.jsx)(n.h3,{id:"configuring-api-resources-and-permissions",children:"\u8a2d\u5b9a API \u8cc7\u6e90\u8207\u6b0a\u9650"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\u524d\u5f80 Logto Console \u7684\u300cAPI \u8cc7\u6e90\u300d\u5efa\u7acb\u65b0 API \u8cc7\u6e90","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"API \u540d\u7a31\uff1aCMS API"}),"\n",(0,r.jsxs)(n.li,{children:["API \u8b58\u5225\u78bc\uff1a",(0,r.jsx)(n.a,{href:"https://api.cms.com",children:"https://api.cms.com"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u65b0\u589e\u6b0a\u9650\u81f3 API \u8cc7\u6e90","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"list:articles"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"read:articles"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"create:articles"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"update:articles"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"publish:articles"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"delete:articles"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://uploads.strapi.logto.io/cms_api_resource_b15ae2b91a.png",alt:"CMS API resource details"})}),"\n",(0,r.jsx)(n.h3,{id:"creating-roles",children:"\u5efa\u7acb\u89d2\u8272"}),"\n",(0,r.jsx)(n.p,{children:"\u524d\u5f80 Logto Console \u7684\u300c\u89d2\u8272\u300d\u5efa\u7acb\u4e0b\u5217 CMS \u89d2\u8272"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u7ba1\u7406\u54e1 (Admin)","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u64c1\u6709\u6240\u6709\u6b0a\u9650"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u767c\u4f48\u8005 (Publisher)","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u64c1\u6709 ",(0,r.jsx)(n.code,{children:"read:articles"}),"\u3001",(0,r.jsx)(n.code,{children:"list:articles"}),"\u3001",(0,r.jsx)(n.code,{children:"publish:articles"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u4f5c\u8005 (Author)","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u64c1\u6709 ",(0,r.jsx)(n.code,{children:"create:articles"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://uploads.strapi.logto.io/admin_role_53edb35ecf.png",alt:"Admin role"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://uploads.strapi.logto.io/publisher_role_2ac205cc32.png",alt:"Publisher role"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://uploads.strapi.logto.io/author_role_f89cd99543.png",alt:"Author role"})}),"\n",(0,r.jsx)(n.h3,{id:"assigning-roles-to-users",children:"\u6307\u6d3e\u89d2\u8272\u7d66\u4f7f\u7528\u8005"}),"\n",(0,r.jsx)(n.p,{children:"\u524d\u5f80 Logto Console \u7684\u300c\u4f7f\u7528\u8005\u7ba1\u7406\u300d\u5efa\u7acb\u4f7f\u7528\u8005\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u4f7f\u7528\u8005\u8a73\u7d30\u8cc7\u6599\u7684\u300c\u89d2\u8272\u300d\u5206\u9801\u4e2d\uff0c\u53ef\u6307\u6d3e\u89d2\u8272\u7d66\u8a72\u4f7f\u7528\u8005\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u672c\u7bc4\u4f8b\u5efa\u7acb 3 \u4f4d\u4f7f\u7528\u8005\u53ca\u5176\u89d2\u8272\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Alex\uff1a\u7ba1\u7406\u54e1 (Admin)"}),"\n",(0,r.jsx)(n.li,{children:"Bob\uff1a\u767c\u4f48\u8005 (Publisher)"}),"\n",(0,r.jsx)(n.li,{children:"Charlie\uff1a\u4f5c\u8005 (Author)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://uploads.strapi.logto.io/user_management_c0bc17119f.png",alt:"User management"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://uploads.strapi.logto.io/user_details_alex_702f96ef9a.png",alt:"User details - Alex"})}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["\u70ba\u65b9\u4fbf\u5c55\u793a\uff0c\u6211\u5011\u900f\u904e Logto Console \u5efa\u7acb\u9019\u4e9b\u8cc7\u6e90\u8207\u8a2d\u5b9a\u3002\u5be6\u969b\u5c08\u6848\u4e2d\uff0c\u4f60\u4e5f\u53ef\u4ee5\u900f\u904e Logto \u63d0\u4f9b\u7684 ",(0,r.jsx)(n.a,{href:"/integrate-logto/interact-with-management-api",children:"Management API"})," \u7a0b\u5f0f\u5316\u5efa\u7acb\u9019\u4e9b\u8cc7\u6e90\u8207\u8a2d\u5b9a\u3002"]})}),"\n",(0,r.jsx)(n.h2,{id:"integrate-your-frontend-with-logto-rbac",children:"\u524d\u7aef\u6574\u5408 Logto RBAC"}),"\n",(0,r.jsx)(n.p,{children:"\u73fe\u5728\u6211\u5011\u5df2\u5728 Logto \u8a2d\u5b9a\u597d RBAC\uff0c\u53ef\u4ee5\u958b\u59cb\u6574\u5408\u5230\u524d\u7aef\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u9996\u5148\uff0c\u4f9d\u7167 ",(0,r.jsx)(n.a,{href:"/quick-starts",children:"Logto \u5feb\u901f\u4e0a\u624b"})," \u5c07 Logto \u6574\u5408\u9032\u4f60\u7684\u61c9\u7528\u7a0b\u5f0f\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u672c\u7bc4\u4f8b\u4ee5 ",(0,r.jsx)(n.a,{href:"/quick-starts/react",children:"React"})," \u793a\u7bc4\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u5b8c\u6210 Logto \u8a2d\u5b9a\u5f8c\uff0c\u9700\u65b0\u589e RBAC \u8a2d\u5b9a\u8b93 Logto \u6b63\u5e38\u904b\u4f5c\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"// frontend/src/App.tsx\n\nconst logtoConfig: LogtoConfig = {\n  appId: LOGTO_APP_ID, // \u4f60\u5728 Logto Console \u5efa\u7acb\u7684 app ID\n  endpoint: LOGTO_ENDPOINT, // \u4f60\u5728 Logto Console \u5efa\u7acb\u7684 endpoint\n  resources: [API_RESOURCE], // \u4f60\u5728 Logto Console \u5efa\u7acb\u7684 API \u8cc7\u6e90\u8b58\u5225\u78bc\uff0c\u4f8b\u5982 https://api.cms.com\n  // \u524d\u7aef\u53ef\u80fd\u6703\u5411 API \u8cc7\u6e90\u8acb\u6c42\u7684\u6240\u6709\u6b0a\u9650\u7bc4\u570d (scopes)\n  scopes: [\n    'list:articles',\n    'create:articles',\n    'read:articles',\n    'update:articles',\n    'delete:articles',\n    'publish:articles',\n  ],\n};\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u4f60\u5df2\u767b\u5165\uff0c\u8a18\u5f97\u767b\u51fa\u518d\u767b\u5165\u8b93\u8a2d\u5b9a\u751f\u6548\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u7576\u4f7f\u7528\u8005\u900f\u904e Logto \u767b\u5165\u4e26\u8acb\u6c42\u4e0a\u8ff0 API \u8cc7\u6e90\u7684\u5b58\u53d6\u6b0a\u6756 (Access token) \u6642\uff0cLogto \u6703\u5c07\u8207\u4f7f\u7528\u8005\u89d2\u8272\u76f8\u95dc\u7684\u6b0a\u9650\u7bc4\u570d (scopes) \u52a0\u5165\u5b58\u53d6\u6b0a\u6756\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u4f60\u53ef\u4ee5\u900f\u904e ",(0,r.jsx)(n.code,{children:"useLogto"})," hook \u7684 ",(0,r.jsx)(n.code,{children:"getAccessTokenClaims"})," \u53d6\u5f97\u5b58\u53d6\u6b0a\u6756\u4e2d\u7684\u6b0a\u9650\u7bc4\u570d\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"// frontend/src/hooks/use-user-data.ts\n\nimport { useLogto } from '@logto/react';\nimport { API_RESOURCE } from '../config';\nimport { useState, useEffect } from 'react';\n\nexport const useUserData = () => {\n  const { getAccessTokenClaims } = useLogto();\n  const [userScopes, setUserScopes] = useState<string[]>([]);\n  const [userId, setUserId] = useState<string>();\n\n  useEffect(() => {\n    const fetchScopes = async () => {\n      const token = await getAccessTokenClaims(API_RESOURCE);\n      setUserScopes(token?.scope?.split(' ') ?? []);\n      setUserId(token?.sub);\n    };\n\n    fetchScopes();\n  }, [getAccessTokenClaims]);\n\n  return { userId, userScopes };\n};\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u4f60\u53ef\u4ee5\u5229\u7528 ",(0,r.jsx)(n.code,{children:"userScopes"})," \u5224\u65b7\u4f7f\u7528\u8005\u662f\u5426\u6709\u6b0a\u5b58\u53d6\u8cc7\u6e90\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",children:"// frontend/src/pages/Dashboard.tsx\n\nconst Dashboard = () => {\n  const { userId, userScopes } = useUserData();\n  // ...\n\n  return (\n    <div>\n      {/* ... */}\n      {(userScopes.includes('delete:articles') || article.ownerId === userId) && (\n        <button\n          onClick={() => handleDelete(article.id)}\n          className=\"text-red-600 hover:text-red-900\"\n        >\n          Delete\n        </button>\n      )}\n    </div>\n  );\n};\n"})}),"\n",(0,r.jsx)(n.h2,{id:"integrate-your-backend-with-logto-rbac",children:"\u5f8c\u7aef\u6574\u5408 Logto RBAC"}),"\n",(0,r.jsx)(n.p,{children:"\u63a5\u4e0b\u4f86\uff0c\u5c07 Logto RBAC \u6574\u5408\u9032\u5f8c\u7aef\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"backend-authorization-middleware",children:"\u5f8c\u7aef\u6388\u6b0a (Authorization) \u4e2d\u4ecb\u8edf\u9ad4"}),"\n",(0,r.jsx)(n.p,{children:"\u9996\u5148\uff0c\u5728\u5f8c\u7aef\u65b0\u589e\u4e2d\u4ecb\u8edf\u9ad4\uff0c\u6aa2\u67e5\u4f7f\u7528\u8005\u6b0a\u9650\u3001\u9a57\u8b49\u662f\u5426\u767b\u5165\uff0c\u4ee5\u53ca\u662f\u5426\u6709\u6b0a\u5b58\u53d6\u7279\u5b9a API\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// backend/src/middleware/auth.js\n\nconst { createRemoteJWKSet, jwtVerify } = require('jose');\n\nconst getTokenFromHeader = (headers) => {\n  const { authorization } = headers;\n  const bearerTokenIdentifier = 'Bearer';\n\n  if (!authorization) {\n    throw new Error('Authorization header missing');\n  }\n\n  if (!authorization.startsWith(bearerTokenIdentifier)) {\n    throw new Error('Authorization token type not supported');\n  }\n\n  return authorization.slice(bearerTokenIdentifier.length + 1);\n};\n\nconst hasScopes = (tokenScopes, requiredScopes) => {\n  if (!requiredScopes || requiredScopes.length === 0) {\n    return true;\n  }\n  const scopeSet = new Set(tokenScopes);\n  return requiredScopes.every((scope) => scopeSet.has(scope));\n};\n\nconst verifyJwt = async (token) => {\n  const JWKS = createRemoteJWKSet(new URL(process.env.LOGTO_JWKS_URL));\n\n  const { payload } = await jwtVerify(token, JWKS, {\n    issuer: process.env.LOGTO_ISSUER,\n    audience: process.env.LOGTO_API_RESOURCE,\n  });\n\n  return payload;\n};\n\nconst requireAuth = (requiredScopes = []) => {\n  return async (req, res, next) => {\n    try {\n      // \u53d6\u5f97\u6b0a\u6756\n      const token = getTokenFromHeader(req.headers);\n\n      // \u9a57\u8b49\u6b0a\u6756\n      const payload = await verifyJwt(token);\n\n      // \u5c07\u4f7f\u7528\u8005\u8cc7\u8a0a\u52a0\u5165\u8acb\u6c42\n      req.user = {\n        id: payload.sub,\n        scopes: payload.scope?.split(' ') || [],\n      };\n\n      // \u9a57\u8b49\u6240\u9700\u6b0a\u9650\n      if (!hasScopes(req.user.scopes, requiredScopes)) {\n        throw new Error('Insufficient permissions');\n      }\n\n      next();\n    } catch (error) {\n      res.status(401).json({ error: 'Unauthorized' });\n    }\n  };\n};\n\nmodule.exports = {\n  requireAuth,\n  hasScopes,\n};\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u4e0a\u6240\u793a\uff0c\u6b64\u4e2d\u4ecb\u8edf\u9ad4\u6703\u9a57\u8b49\u524d\u7aef\u8acb\u6c42\u662f\u5426\u5e36\u6709\u6709\u6548\u7684\u5b58\u53d6\u6b0a\u6756\uff0c\u4e26\u6aa2\u67e5\u8a72\u6b0a\u6756\u7684\u53d7\u773e (audience) \u662f\u5426\u8207 Logto Console \u5efa\u7acb\u7684 API \u8cc7\u6e90\u76f8\u7b26\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u9a57\u8b49 API \u8cc7\u6e90\u7684\u539f\u56e0\u5728\u65bc\uff0cAPI \u8cc7\u6e90\u5be6\u969b\u4e0a\u4ee3\u8868\u6211\u5011 CMS \u5f8c\u7aef\u7684\u8cc7\u6e90\uff0c\u6240\u6709 CMS \u6b0a\u9650\u90fd\u8207\u6b64 API \u8cc7\u6e90\u7d81\u5b9a\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u65e2\u7136\u6b64 API \u8cc7\u6e90\u4ee3\u8868 Logto \u4e2d\u7684 CMS \u8cc7\u6e90\uff0c\u524d\u7aef\u5728\u547c\u53eb\u5f8c\u7aef API \u6642\u6703\u5e36\u4e0a\u5c0d\u61c9\u7684\u5b58\u53d6\u6b0a\u6756 (Access token)\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// frontend/src/hooks/use-api.ts\nexport const useApi = () => {\n  const { getAccessToken } = useLogto();\n\n  return useMemo(\n    () =>\n      async (endpoint: string, options: RequestInit = {}) => {\n        try {\n          // \u53d6\u5f97 API \u8cc7\u6e90\u7684\u5b58\u53d6\u6b0a\u6756\n          const token = await getAccessToken(API_RESOURCE);\n\n          if (!token) {\n            throw new ApiRequestError('Failed to get access token');\n          }\n\n          const response = await fetch(`${API_BASE_URL}${endpoint}`, {\n            ...options,\n            headers: {\n              'Content-Type': 'application/json',\n              // \u5c07\u5b58\u53d6\u6b0a\u6756\u52a0\u5165\u8acb\u6c42\u6a19\u982d\n              Authorization: `Bearer ${token}`,\n              ...options.headers,\n            },\n          });\n\n          // ... \u8655\u7406\u56de\u61c9\n\n          return await response.json();\n        } catch (error) {\n          // ... \u932f\u8aa4\u8655\u7406\n        }\n      },\n    [getAccessToken]\n  );\n};\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u73fe\u5728\u53ef\u4ee5\u7528 ",(0,r.jsx)(n.code,{children:"requireAuth"})," \u4e2d\u4ecb\u8edf\u9ad4\u4fdd\u8b77 API \u7aef\u9ede\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"protecting-api-endpoints",children:"\u4fdd\u8b77 API \u7aef\u9ede"}),"\n",(0,r.jsxs)(n.p,{children:["\u5c0d\u65bc\u50c5\u5141\u8a31\u7279\u5b9a\u6b0a\u9650\u4f7f\u7528\u8005\u5b58\u53d6\u7684 API\uff0c\u53ef\u76f4\u63a5\u5728\u4e2d\u4ecb\u8edf\u9ad4\u4e2d\u52a0\u4e0a\u9650\u5236\u3002\u4f8b\u5982\uff0c\u5efa\u7acb\u6587\u7ae0 API \u50c5\u5141\u8a31\u5177\u5099 ",(0,r.jsx)(n.code,{children:"create:articles"})," \u6b0a\u9650\u7684\u4f7f\u7528\u8005\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// backend/src/routes/articles.js\n\nconst { requireAuth } = require('../middleware/auth');\n\nrouter.post('/articles', requireAuth(['create:articles']), async (req, res) => {\n  // ...\n});\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5c0d\u65bc\u9700\u540c\u6642\u6aa2\u67e5\u6b0a\u9650\u8207\u8cc7\u6e90\u64c1\u6709\u6b0a\u7684 API\uff0c\u53ef\u7528 ",(0,r.jsx)(n.code,{children:"hasScopes"})," \u51fd\u5f0f\u3002\u4f8b\u5982\uff0c\u6587\u7ae0\u5217\u8868 API\uff0c\u5177\u5099 ",(0,r.jsx)(n.code,{children:"list:articles"})," \u6b0a\u9650\u8005\u53ef\u5b58\u53d6\u6240\u6709\u6587\u7ae0\uff0c\u5426\u5247\u50c5\u80fd\u5b58\u53d6\u81ea\u5df1\u5275\u5efa\u7684\u6587\u7ae0\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"// backend/src/routes/articles.js\n\nconst { requireAuth, hasScopes } = require('../middleware/auth');\n\nrouter.get('/articles', requireAuth(), async (req, res) => {\n  try {\n    // \u6709 list:articles \u6b0a\u9650\u5247\u56de\u50b3\u6240\u6709\u6587\u7ae0\n    if (hasScopes(req.user.scopes, ['list:articles'])) {\n      const articles = await articleDB.list();\n      return res.json(articles);\n    }\n\n    // \u5426\u5247\u50c5\u56de\u50b3\u4f7f\u7528\u8005\u81ea\u5df1\u7684\u6587\u7ae0\n    const articles = await articleDB.listByOwner(req.user.id);\n    res.json(articles);\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to fetch articles' });\n  }\n});\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u81f3\u6b64\uff0c\u6211\u5011\u5df2\u5b8c\u6210 RBAC \u5be6\u4f5c\u3002\u4f60\u53ef\u4ee5\u53c3\u8003 ",(0,r.jsx)(n.a,{href:"https://github.com/logto-io/rbac-sample",children:"\u5b8c\u6574\u539f\u59cb\u78bc"})," \u4e86\u89e3\u5168\u90e8\u7d30\u7bc0\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"test-the-cms-rbac-implementation",children:"\u6e2c\u8a66 CMS RBAC \u5be6\u4f5c"}),"\n",(0,r.jsx)(n.p,{children:"\u73fe\u5728\uff0c\u8b93\u6211\u5011\u7528\u525b\u525b\u5efa\u7acb\u7684\u4e09\u4f4d\u4f7f\u7528\u8005\u6e2c\u8a66 CMS RBAC \u5be6\u4f5c\u3002"}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsx)(n.p,{children:"\u5982\u679c\u4f60\u767c\u73fe\u7121\u6cd5\u7528\u300c\u4f7f\u7528\u8005\u7ba1\u7406\u300d\u5efa\u7acb\u7684\u5e33\u865f\u767b\u5165\uff0c\u8acb\u5148\u555f\u7528\u5c0d\u61c9\u7684\u767b\u5165\u65b9\u5f0f\u3002\u524d\u5f80 Logto Console \u7684\u300c\u767b\u5165\u9ad4\u9a57 (Sign-in Experience)\u300d\u4e26\u555f\u7528\u4f60\u504f\u597d\u7684\u9a57\u8b49 (Authentication) \u65b9\u5f0f\uff08\u5982\u96fb\u5b50\u90f5\u4ef6 + \u5bc6\u78bc\u6216\u4f7f\u7528\u8005\u540d\u7a31 + \u5bc6\u78bc\uff09\u3002"})}),"\n",(0,r.jsx)(n.p,{children:"\u9996\u5148\uff0c\u5206\u5225\u4ee5 Alex \u8207 Charles \u767b\u5165\u4e26\u5efa\u7acb\u4e00\u4e9b\u6587\u7ae0\u3002"}),"\n",(0,r.jsx)(n.p,{children:"Alex \u64c1\u6709\u7ba1\u7406\u54e1 (Admin) \u89d2\u8272\uff0c\u53ef\u5efa\u7acb\u3001\u522a\u9664\u3001\u66f4\u65b0\u3001\u767c\u4f48\u4e26\u6aa2\u8996\u6240\u6709\u6587\u7ae0\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://uploads.strapi.logto.io/cms_dashboard_alex_a11863a94b.png",alt:"CMS dashboard - Alex"})}),"\n",(0,r.jsx)(n.p,{children:"Charles \u64c1\u6709\u4f5c\u8005 (Author) \u89d2\u8272\uff0c\u53ea\u80fd\u5efa\u7acb\u81ea\u5df1\u7684\u6587\u7ae0\uff0c\u4e14\u50c5\u80fd\u6aa2\u8996\u3001\u66f4\u65b0\u3001\u522a\u9664\u81ea\u5df1\u64c1\u6709\u7684\u6587\u7ae0\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://uploads.strapi.logto.io/cms_dashboard_charles_05f610066a.png",alt:"CMS dashboard - Charles - Article list"})}),"\n",(0,r.jsx)(n.p,{children:"Bob \u64c1\u6709\u767c\u4f48\u8005 (Publisher) \u89d2\u8272\uff0c\u53ef\u6aa2\u8996\u8207\u767c\u4f48\u6240\u6709\u6587\u7ae0\uff0c\u4f46\u7121\u6cd5\u5efa\u7acb\u3001\u66f4\u65b0\u6216\u522a\u9664\u6587\u7ae0\u3002"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://uploads.strapi.logto.io/cms_dashboard_bob_421a429b69.png",alt:"CMS dashboard - Bob"})}),"\n",(0,r.jsx)(n.h2,{id:"conclusion",children:"\u7d50\u8ad6"}),"\n",(0,r.jsx)(n.p,{children:"\u606d\u559c\u4f60\uff01\u4f60\u5df2\u5b78\u6703\u5982\u4f55\u5728\u61c9\u7528\u7a0b\u5f0f\u4e2d\u5be6\u4f5c\u5065\u5168\u7684 RBAC \u7cfb\u7d71\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u82e5\u9700\u66f4\u8907\u96dc\u7684\u60c5\u5883\uff08\u5982\u5efa\u69cb\u591a\u79df\u6236\u61c9\u7528\u7a0b\u5f0f\uff09\uff0cLogto \u63d0\u4f9b\u5b8c\u6574\u7684\u7d44\u7e54 (Organization) \u652f\u63f4\u3002\u6b61\u8fce\u53c3\u8003\u6211\u5011\u7684\u6307\u5357 ",(0,r.jsx)(n.a,{href:"/use-cases/multi-tenancy/build-multi-tenant-saas-application",children:"\u6253\u9020\u591a\u79df\u6236 SaaS \u61c9\u7528\u7a0b\u5f0f\uff1a\u5f9e\u8a2d\u8a08\u5230\u5be6\u4f5c\u7684\u5b8c\u6574\u6307\u5357"}),"\uff0c\u6df1\u5165\u77ad\u89e3\u7d44\u7e54\u5c64\u7d1a\u7684\u5b58\u53d6\u63a7\u5236\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u795d\u4f60\u5beb\u7a0b\u5f0f\u6109\u5feb\uff01\ud83d\ude80"})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},79621:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>l});var i=s(58101);const r={},t=i.createContext(r);function c(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);