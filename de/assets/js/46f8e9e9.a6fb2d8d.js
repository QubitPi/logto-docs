"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[6663],{37571:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>d,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"developers/custom-token-claims/create-script","title":"Erstelle ein benutzerdefiniertes Token-Claims-Skript","description":"Um benutzerdefinierte Anspr\xfcche zum Zugangstoken (Access token) hinzuzuf\xfcgen, musst du ein Skript bereitstellen, das ein Objekt mit diesen Anspr\xfcchen zur\xfcckgibt. Das Skript sollte als JavaScript-Funktion geschrieben werden, die ein Objekt mit den benutzerdefinierten Anspr\xfcchen zur\xfcckgibt.","source":"@site/i18n/de/docusaurus-plugin-content-docs/current/developers/custom-token-claims/create-script.mdx","sourceDirName":"developers/custom-token-claims","slug":"/developers/custom-token-claims/create-script","permalink":"/de/developers/custom-token-claims/create-script","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/de/docusaurus-plugin-content-docs/current/developers/custom-token-claims/create-script.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"create-script","title":"Erstelle ein benutzerdefiniertes Token-Claims-Skript","sidebar_label":"Erstelle ein benutzerdefiniertes Token-Claims-Skript","sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"H\xe4ufige Anwendungsf\xe4lle (Common use cases)","permalink":"/de/developers/custom-token-claims/common-use-cases"},"next":{"title":"Benutzermimikry","permalink":"/de/developers/user-impersonation"}}');var s=i(25105),r=i(79621);const d={id:"create-script",title:"Erstelle ein benutzerdefiniertes Token-Claims-Skript",sidebar_label:"Erstelle ein benutzerdefiniertes Token-Claims-Skript",sidebar_position:3},l="Erstelle ein benutzerdefiniertes Token-Claims-Skript",c={},a=[{value:"Implementiere die Funktion <code>getCustomJwtClaims()</code>",id:"implement-getcustomjwtclaims-function",level:2},{value:"Schritt 1: Skript bearbeiten",id:"step-1-edit-the-script",level:2},{value:"Schritt 2: Eingabeparameter",id:"step-2-input-parameters",level:2},{value:"token",id:"token",level:3},{value:"context (Nur verf\xfcgbar f\xfcr Benutzer-Zugangstoken)",id:"context-only-available-for-user-access-token",level:3},{value:"environmentVariables",id:"environmentvariables",level:3},{value:"api",id:"api",level:3},{value:"Schritt 3: Externe Daten abrufen",id:"step-3-fetch-external-data",level:2},{value:"Schritt 4: Skript testen",id:"step-4-test-the-script",level:2}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components},{CloudLink:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("CloudLink",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"erstelle-ein-benutzerdefiniertes-token-claims-skript",children:"Erstelle ein benutzerdefiniertes Token-Claims-Skript"})}),"\n",(0,s.jsxs)(n.p,{children:["Um ",(0,s.jsx)(n.a,{href:"/developers/custom-token-claims",children:"benutzerdefinierte Anspr\xfcche"})," zum ",(0,s.jsx)(n.a,{href:"https://auth.wiki/access-token",children:"Zugangstoken (Access token)"})," hinzuzuf\xfcgen, musst du ein Skript bereitstellen, das ein Objekt mit diesen Anspr\xfcchen zur\xfcckgibt. Das Skript sollte als ",(0,s.jsx)(n.code,{children:"JavaScript"}),"-Funktion geschrieben werden, die ein Objekt mit den benutzerdefinierten Anspr\xfcchen zur\xfcckgibt."]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Navigiere zu ",(0,s.jsx)(i,{to:"/customize-jwt",children:"Konsole > Benutzerdefiniertes JWT"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Es gibt zwei verschiedene Typen von Zugangstokens, f\xfcr die du die Zugangstoken-Anspr\xfcche anpassen kannst:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Benutzer-Zugangstoken"}),": Das Zugangstoken, das f\xfcr Endbenutzer ausgestellt wird. Z. B. f\xfcr Webanwendungen oder mobile Anwendungen."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Maschine-zu-Maschine-Zugangstoken"}),": Das Zugangstoken, das f\xfcr Dienste oder Anwendungen ausgestellt wird. Z. B. f\xfcr ",(0,s.jsx)(n.a,{href:"/quick-starts/m2m",children:"Maschine-zu-Maschine-Anwendungen"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Verschiedene Typen von Zugangstokens k\xf6nnen unterschiedliche Token-Payload-Kontexte haben. Du kannst die Token-Anspr\xfcche f\xfcr jeden Typ von Zugangstoken separat anpassen."}),"\n",(0,s.jsxs)(n.p,{children:["W\xe4hle den Typ des Zugangstokens aus, f\xfcr den du die Token-Anspr\xfcche anpassen m\xf6chtest, und klicke auf die Schaltfl\xe4che ",(0,s.jsx)(n.strong,{children:"Benutzerdefinierte Anspr\xfcche hinzuf\xfcgen"}),", um ein neues Skript zu erstellen."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.admonition,{type:"note",children:[(0,s.jsx)(n.p,{children:"Die Funktion f\xfcr benutzerdefinierte Token-Anspr\xfcche ist nur verf\xfcgbar f\xfcr:"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/logto-oss",children:"Logto OSS"})," Nutzer"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/logto-cloud/tenant-settings#development",children:"Logto Cloud-Mandanten mit Entwicklungsumgebung"})}),"\n",(0,s.jsxs)(n.li,{children:["Logto Cloud zahlende Mandanten mit Produktionsumgebung (einschlie\xdflich ",(0,s.jsx)(n.a,{href:"https://logto.io/pricing",children:"Pro-Mandanten und Enterprise-Mandanten"}),")"]}),"\n"]})]}),"\n",(0,s.jsxs)(n.h2,{id:"implement-getcustomjwtclaims-function",children:["Implementiere die Funktion ",(0,s.jsx)(n.code,{children:"getCustomJwtClaims()"})]}),"\n",(0,s.jsxs)(n.p,{children:["Auf der ",(0,s.jsx)(n.strong,{children:"Benutzerdefiniertes JWT"}),"-Detailseite findest du den Skripteditor, um dein benutzerdefiniertes Token-Claims-Skript zu schreiben. Das Skript sollte eine ",(0,s.jsx)(n.code,{children:"JavaScript"}),"-Funktion sein, die ein Objekt mit benutzerdefinierten Anspr\xfcchen zur\xfcckgibt."]}),"\n",(0,s.jsx)("img",{src:"/img/assets/custom-jwt-detail-page.png",alt:"Detailseite f\xfcr benutzerdefinierte Token-Anspr\xfcche"}),"\n",(0,s.jsx)(n.h2,{id:"step-1-edit-the-script",children:"Schritt 1: Skript bearbeiten"}),"\n",(0,s.jsxs)(n.p,{children:["Nutze den Code-Editor auf der linken Seite, um das Skript zu bearbeiten. Eine Standardfunktion ",(0,s.jsx)(n.code,{children:"getCustomJwtClaims"})," mit einem leeren Objekt als R\xfcckgabewert ist bereits vorgegeben. Du kannst die Funktion anpassen, um ein Objekt mit deinen eigenen benutzerdefinierten Anspr\xfcchen zur\xfcckzugeben."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",children:"const getCustomJwtClaims = async ({ token, context, environmentVariables }) => {\n  return {};\n};\n"})}),"\n",(0,s.jsx)(n.p,{children:"Dieser Editor verwendet den JavaScript Language Server, um grundlegendes Syntax-Highlighting, Code-Vervollst\xe4ndigung und Fehler\xfcberpr\xfcfung bereitzustellen. Die Eingabeparameter sind gut typisiert und im jsDoc-Stil dokumentiert. Du kannst die IntelliSense-Funktion des Editors nutzen, um korrekt auf die Eigenschaften des Eingabeobjekts zuzugreifen. Die detaillierten Parameterdefinitionen findest du auf der rechten Seite der Seite."}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["Diese Funktion wird als Modul exportiert. Stelle sicher, dass der Funktionsname ",(0,s.jsx)(n.code,{children:"getCustomJwtClaims"})," bleibt, damit das Modul die Funktion korrekt exportieren kann."]})}),"\n",(0,s.jsx)(n.h2,{id:"step-2-input-parameters",children:"Schritt 2: Eingabeparameter"}),"\n",(0,s.jsxs)(n.p,{children:["Die Funktion ",(0,s.jsx)(n.code,{children:"getCustomJwtClaims"})," nimmt ein Objekt als Eingabeparameter entgegen. Das Eingabeobjekt enth\xe4lt die folgenden Eigenschaften:"]}),"\n",(0,s.jsx)(n.h3,{id:"token",children:"token"}),"\n",(0,s.jsx)(n.p,{children:"Das Token-Payload-Objekt. Dieses Objekt enth\xe4lt die urspr\xfcnglichen Token-Anspr\xfcche und Metadaten, auf die du im Skript zugreifen kannst."}),"\n",(0,s.jsx)(n.p,{children:"Die detaillierte Typdefinition des Token-Payload-Objekts und des Benutzerdaten-Objekts findest du auf der rechten Seite der Seite. Die IntelliSense-Funktion des Editors hilft dir ebenfalls, auf diese Eigenschaften des Eingabeobjekts korrekt zuzugreifen."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Benutzer-Zugangstoken-Datenobjekt","\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Eigenschaft"}),(0,s.jsx)(n.th,{children:"Beschreibung"}),(0,s.jsx)(n.th,{children:"Typ"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"jti"})}),(0,s.jsx)(n.td,{children:"Die eindeutige JWT-ID"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"aud"})}),(0,s.jsx)(n.td,{children:"Die Zielgruppe (Audience) des Tokens"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"scope"})}),(0,s.jsx)(n.td,{children:"Die Berechtigungen (Scopes) des Tokens"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"clientId"})}),(0,s.jsx)(n.td,{children:"Die Client-ID des Tokens"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"accountId"})}),(0,s.jsx)(n.td,{children:"Die Benutzer-ID des Tokens"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"expiresWithSession"})}),(0,s.jsx)(n.td,{children:"Ob das Token mit der Sitzung abl\xe4uft"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"boolean"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"grantId"})}),(0,s.jsx)(n.td,{children:"Die aktuelle Authentifizierungs-Grant-ID des Tokens"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"gty"})}),(0,s.jsx)(n.td,{children:"Der Grant-Typ des Tokens"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"kind"})}),(0,s.jsx)(n.td,{children:"Die Token-Art"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AccessToken"})})]})]})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Maschine-zu-Maschine-Zugangstoken-Datenobjekt","\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Eigenschaft"}),(0,s.jsx)(n.th,{children:"Beschreibung"}),(0,s.jsx)(n.th,{children:"Typ"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"jti"})}),(0,s.jsx)(n.td,{children:"Die eindeutige JWT-ID"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"aud"})}),(0,s.jsx)(n.td,{children:"Die Zielgruppe (Audience) des Tokens"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"scope"})}),(0,s.jsx)(n.td,{children:"Die Berechtigungen (Scopes) des Tokens"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"clientId"})}),(0,s.jsx)(n.td,{children:"Die Client-ID des Tokens"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"kind"})}),(0,s.jsx)(n.td,{children:"Die Token-Art"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ClientCredentials"})})]})]})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"context-only-available-for-user-access-token",children:"context (Nur verf\xfcgbar f\xfcr Benutzer-Zugangstoken)"}),"\n",(0,s.jsx)(n.p,{children:"Das Kontextobjekt enth\xe4lt die Benutzerdaten und Grant-Daten, die f\xfcr den aktuellen Autorisierungsprozess relevant sind."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Benutzerdaten-Objekt"}),"\nF\xfcr Benutzer-Zugangstoken stellt Logto zus\xe4tzlichen Benutzerdaten-Kontext zur Verf\xfcgung. Das Benutzerdaten-Objekt enth\xe4lt alle Benutzerdaten und Organisationsmitgliedschaften, die du ben\xf6tigst, um die benutzerdefinierten Anspr\xfcche zu setzen. Siehe ",(0,s.jsx)(n.a,{href:"/user-management/user-data",children:"Benutzer"})," und ",(0,s.jsx)(n.a,{href:"/organizations/organization-data",children:"Organisationen"})," f\xfcr weitere Details."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Grant-Daten-Objekt"}),"\nF\xfcr Benutzer-Zugangstoken, die durch Benutzermimikry (User impersonation) Token-Austausch gew\xe4hrt wurden, stellt Logto zus\xe4tzlichen Grant-Daten-Kontext zur Verf\xfcgung. Das Grant-Daten-Objekt enth\xe4lt den benutzerdefinierten Kontext aus dem Subjekt-Token. Siehe ",(0,s.jsx)(n.a,{href:"/developers/user-impersonation",children:"Benutzermimikry"})," f\xfcr weitere Details."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Benutzerinteraktionsdaten-Objekt"}),"\nF\xfcr ein gegebenes Benutzer-Zugangstoken kann es F\xe4lle geben, in denen du auf die Interaktionsdetails des Benutzers f\xfcr die aktuelle Autorisierungssitzung zugreifen musst. Zum Beispiel k\xf6nntest du die Enterprise SSO-Identit\xe4t des Benutzers abrufen, die f\xfcr die Anmeldung verwendet wurde. Dieses Benutzerinteraktionsdaten-Objekt enth\xe4lt die zuletzt vom Benutzer \xfcbermittelten Interaktionsdaten, einschlie\xdflich:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Eigenschaft"}),(0,s.jsx)(n.th,{children:"Beschreibung"}),(0,s.jsx)(n.th,{children:"Typ"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"interactionEvent"})}),(0,s.jsx)(n.td,{children:"Das Interaktionsereignis der aktuellen Benutzerinteraktion"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"SignIn"})," oder ",(0,s.jsx)(n.code,{children:"Register"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"userId"})}),(0,s.jsx)(n.td,{children:"Die Benutzer-ID der aktuellen Benutzerinteraktion"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"verificationRecords"})}),(0,s.jsx)(n.td,{children:"Eine Liste von Verifizierungsdatens\xe4tzen, die vom Benutzer zur Identifizierung und Verifizierung seiner Identit\xe4t w\xe4hrend der Interaktionen eingereicht wurden."}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"VerificationRecord[]"})})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Verifizierungsdatensatz-Typ:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// VerificationType.Password\n{\n  id: string;\n  type: 'Password';\n  identifier: {\n    type: 'username' | 'email' | 'phone' | 'userId';\n    value: string;\n  }\n  verified: boolean;\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// VerificationType.EmailVerificationCode\n{\n  id: string;\n  templateType: 'SignIn' | 'Register' | 'ForgotPassword' | 'Generic';\n  verified: boolean;\n  type: 'EmailVerificationCode';\n  identifier: {\n    type: 'email';\n    value: string;\n  }\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// VerificationType.PhoneVerificationCode\n{\n  id: string;\n  templateType: 'SignIn' | 'Register' | 'ForgotPassword' | 'Generic';\n  verified: boolean;\n  type: 'PhoneVerificationCode';\n  identifier: {\n    type: 'phone';\n    value: string;\n  }\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// VerificationType.Social\n{\n  id: string;\n  type: 'Social';\n  connectorId: string;\n  socialUserInfo?: {\n    id: string;\n    email?: string | undefined;\n    phone?: string | undefined;\n    name?: string | undefined;\n    avatar?: string | undefined;\n    rawData?: Record<string, unknown> | undefined;\n  } | undefined;\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// VerificationType.EnterpriseSso\n{\n  id: string;\n  type: 'EnterpriseSso';\n  connectorId: string;\n  enterpriseUserInfo?: {\n    id: string;\n    email?: string | undefined;\n    phone?: string | undefined;\n    name?: string | undefined;\n    avatar?: string | undefined;\n    [key: string]?: unknown;\n  } | undefined;\n  issuer?: string | undefined;\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// VerificationType.Totp (MFA)\n{\n  id: string;\n  type: 'Totp';\n  userId: string;\n  verified: boolean;\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// VerificationType.WebAuthn (MFA)\n{\n  id: string;\n  type: 'WebAuthn';\n  userId: string;\n  verified: boolean;\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'// VerificationType.BackupCode (MFA)\n{\n  id: string;\n  type: "BackupCode";\n  userId: string;\n  code?: string | undefined;\n}\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:'// VerificationType.OneTimeToken\n{\n  id: string;\n  type: "OneTimeToken";\n  verified: boolean;\n  identifier: {\n    type: "email";\n    value: string;\n  };\n  oneTimeTokenContext?: {\n    jitOrganizationIds?: string[] | undefined;\n  } | undefined;\n}\n'})}),"\n",(0,s.jsxs)(n.admonition,{type:"note",children:[(0,s.jsx)(n.p,{children:"Es kann mehrere Verifizierungsdatens\xe4tze im Benutzerinteraktionsdaten-Objekt geben, insbesondere wenn der Benutzer mehrere Anmelde- oder Registrierungsprozesse durchlaufen hat."}),(0,s.jsxs)(n.p,{children:["Zum Beispiel: Der Benutzer hat sich mit einem ",(0,s.jsx)(n.code,{children:"Social"}),"-Verifizierungsdatensatz angemeldet, dann eine neue E-Mail-Adresse \xfcber einen ",(0,s.jsx)(n.code,{children:"EmailVerificationCode"}),"-Verifizierungsdatensatz gebunden und anschlie\xdfend den MFA-Status mit einem ",(0,s.jsx)(n.code,{children:"Totp"}),"-Verifizierungsdatensatz verifiziert. In diesem Fall musst du alle Verifizierungsdatens\xe4tze entsprechend in deinem Skript behandeln."]}),(0,s.jsx)(n.p,{children:"Jeder Typ von Verifizierungsdatensatz ist nur einmal im Benutzerinteraktionsdaten-Objekt vorhanden."})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"environmentvariables",children:"environmentVariables"}),"\n",(0,s.jsxs)(n.p,{children:["Nutze den Bereich ",(0,s.jsx)(n.strong,{children:"Umgebungsvariablen festlegen"})," auf der rechten Seite, um die Umgebungsvariablen f\xfcr dein Skript einzurichten. Du kannst diese Variablen verwenden, um sensible Informationen oder Konfigurationsdaten zu speichern, die du nicht im Skript fest codieren m\xf6chtest, z. B. API-Schl\xfcssel, Geheimnisse oder URLs."]}),"\n",(0,s.jsxs)(n.p,{children:["Alle hier festgelegten Umgebungsvariablen stehen im Skript zur Verf\xfcgung. Verwende das Objekt ",(0,s.jsx)(n.code,{children:"environmentVariables"})," im Eingabeparameter, um auf diese Variablen zuzugreifen."]}),"\n",(0,s.jsx)(n.h3,{id:"api",children:"api"}),"\n",(0,s.jsxs)(n.p,{children:["Das ",(0,s.jsx)(n.code,{children:"api"}),"-Objekt stellt eine Reihe von Hilfsfunktionen bereit, die du in deinem Skript f\xfcr zus\xe4tzliche Zugangskontrolle \xfcber den Token-Ausgabeprozess verwenden kannst. Das ",(0,s.jsx)(n.code,{children:"api"}),"-Objekt enth\xe4lt die folgenden Funktionen:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",children:"api.denyAccess(message?: string): void\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Die Funktion ",(0,s.jsx)(n.code,{children:"api.denyAccess()"})," erm\xf6glicht es dir, den Token-Ausgabeprozess mit einer benutzerdefinierten Nachricht zu verweigern. Du kannst diese Funktion verwenden, um zus\xe4tzliche Zugriffsvalidierungen \xfcber den Token-Ausgabeprozess durchzusetzen."]}),"\n",(0,s.jsx)(n.h2,{id:"step-3-fetch-external-data",children:"Schritt 3: Externe Daten abrufen"}),"\n",(0,s.jsxs)(n.p,{children:["Du kannst die node-eigene ",(0,s.jsx)(n.code,{children:"fetch"}),"-Funktion verwenden, um externe Daten in deinem Skript abzurufen. Die ",(0,s.jsx)(n.code,{children:"fetch"}),"-Funktion ist eine Promise-basierte Funktion, mit der du HTTP-Anfragen an externe APIs stellen kannst."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jsx",children:"const getCustomJwtClaims = async ({ environmentVariables }) => {\n  const response = await fetch('https://api.example.com/data', {\n    headers: {\n      Authorization: `Bearer ${environmentVariables.API_KEY}`,\n    },\n  });\n\n  const data = await response.json();\n\n  return {\n    data,\n  };\n};\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"note",children:[(0,s.jsx)(n.p,{children:"Beachte, dass das Abrufen externer Daten zu einer Verz\xf6gerung beim Token-Ausgabeprozess f\xfchren kann. Stelle sicher, dass die externe API zuverl\xe4ssig und schnell genug ist, um deine Anforderungen zu erf\xfcllen."}),(0,s.jsx)(n.p,{children:"Au\xdferdem gilt:"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Behandle Fehler und Timeouts in deinem Skript ordnungsgem\xe4\xdf, um zu vermeiden, dass der Token-Ausgabeprozess blockiert wird."}),"\n",(0,s.jsx)(n.li,{children:"Verwende geeignete Autorisierungs-Header, um deine externe API vor unbefugtem Zugriff zu sch\xfctzen."}),"\n"]})]}),"\n",(0,s.jsx)(n.h2,{id:"step-4-test-the-script",children:"Schritt 4: Skript testen"}),"\n",(0,s.jsxs)(n.p,{children:["Stelle sicher, dass du dein Skript vor dem Speichern testest. Klicke auf den Tab ",(0,s.jsx)(n.strong,{children:"Testkontext"})," auf der rechten Seite der Seite, um das Mock-Token-Payload und den Benutzerdaten-Kontext f\xfcr Tests zu bearbeiten."]}),"\n",(0,s.jsxs)(n.p,{children:["Klicke auf ",(0,s.jsx)(n.strong,{children:"Test ausf\xfchren"})," in der rechten oberen Ecke des Editors, um das Skript mit den Mock-Daten auszuf\xfchren. Die Ausgabe des Skripts wird im ",(0,s.jsx)(n.strong,{children:"Testergebnis"}),"-Drawer angezeigt."]}),"\n",(0,s.jsx)("img",{src:"/img/assets/test-custom-jwt-script.png",alt:"Benutzerdefiniertes JWT-Skript testen"}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["Das Testergebnis ist die Ausgabe der Funktion ",(0,s.jsx)(n.code,{children:"getCustomJwtClaims"})," mit den von dir festgelegten Mock-Daten (\u201ezus\xe4tzliche Token-Anspr\xfcche\u201c, die nach Abschluss von Schritt 3 im ",(0,s.jsx)(n.a,{href:"/developers/custom-token-claims/#how-do-custom-token-claims-work",children:"Ablaufdiagramm"})," erhalten wurden). Die tats\xe4chliche Token-Payload und der Benutzerdaten-Kontext werden unterschiedlich sein, wenn das Skript im Token-Ausgabeprozess ausgef\xfchrt wird."]})}),"\n",(0,s.jsxs)(n.p,{children:["Klicke auf die Schaltfl\xe4che ",(0,s.jsx)(n.strong,{children:"Erstellen"}),", um das Skript zu speichern. Das benutzerdefinierte Token-Claims-Skript wird gespeichert und im Zugangstoken-Ausgabeprozess angewendet."]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},79621:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>l});var t=i(58101);const s={},r=t.createContext(s);function d(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);