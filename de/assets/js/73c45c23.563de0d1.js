"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[6953],{66867:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>u,default:()=>c,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"quick-starts/database/hasura/README","title":"Authentifizierung zu deiner Hasura-Anwendung hinzuf\xfcgen","description":"Hasura ist ein Tool, das schnell entsprechende GraphQL- und REST-APIs f\xfcr deine Daten bereitstellen kann. In Anbetracht der Datensicherheit bietet Hasura auch die M\xf6glichkeit, den Zugriff f\xfcr jede API fein abzustimmen.","source":"@site/i18n/de/docusaurus-plugin-content-docs/current/quick-starts/database/hasura/README.mdx","sourceDirName":"quick-starts/database/hasura","slug":"/quick-starts/hasura","permalink":"/de/quick-starts/hasura","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/de/docusaurus-plugin-content-docs/current/quick-starts/database/hasura/README.mdx","tags":[],"version":"current","frontMatter":{"slug":"/quick-starts/hasura","sidebar_label":"Hasura","sidebar_custom_props":{"description":"Logto mit Hasura integrieren."}},"sidebar":"quickStartSidebar","previous":{"title":"Traditionelles Web","permalink":"/de/quick-starts/traditional-web"},"next":{"title":"Supabase","permalink":"/de/quick-starts/supabase"}}');var s=r(25105),t=r(79621);const a={slug:"/quick-starts/hasura",sidebar_label:"Hasura",sidebar_custom_props:{description:"Logto mit Hasura integrieren."}},u="Authentifizierung zu deiner Hasura-Anwendung hinzuf\xfcgen",o={},d=[{value:"Hintergrund",id:"background",level:2},{value:"Erste Schritte",id:"get-started",level:2},{value:"1. Hasura-API-Ressource in Logto erstellen",id:"1-create-hasura-api-resource-in-logto",level:3},{value:"2. Rollen gem\xe4\xdf Hasura-Setup in Logto erstellen",id:"2-create-roles-according-to-hasura-setup-in-logto",level:3},{value:"3. Hasura-Umgebungsvariable <code>HASURA_GRAPHQL_JWT_SECRET</code> konfigurieren, um den JWT-Modus zu aktivieren",id:"3-configure-hasura-environment-variable-hasura_graphql_jwt_secret-to-enable-jwt-mode",level:3},{value:"4. Benutzerzugangstoken mit zus\xe4tzlichen Anspr\xfcchen anpassen",id:"4-customize-user-access-token-extra-claims",level:3},{value:"5. Logto SDK integrieren",id:"5-integrate-logto-sdk",level:3},{value:"Fazit",id:"conclusion",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"authentifizierung-zu-deiner-hasura-anwendung-hinzuf\xfcgen",children:"Authentifizierung zu deiner Hasura-Anwendung hinzuf\xfcgen"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://hasura.io/",children:"Hasura"})," ist ein Tool, das schnell entsprechende GraphQL- und REST-APIs f\xfcr deine Daten bereitstellen kann. In Anbetracht der Datensicherheit bietet Hasura auch die M\xf6glichkeit, den Zugriff f\xfcr jede API fein abzustimmen."]}),"\n",(0,s.jsx)(n.p,{children:"Normalerweise nutzen Hasura-Benutzer andere Identit\xe4tsmanagement- und Authentifizierungsdienste, wobei Logto einer der beliebtesten ist."}),"\n",(0,s.jsx)(n.p,{children:"In diesem Blogbeitrag gehen wir davon aus, dass du bereits Hasura-Dienste nutzt. Wir werden erkl\xe4ren, wie man Hasura und Logto integriert, um die Sicherheit deiner Daten zu maximieren. Wenn du noch kein Logto-Konto hast, melde dich an und beginne jetzt damit!"}),"\n",(0,s.jsx)(n.h2,{id:"background",children:"Hintergrund"}),"\n",(0,s.jsxs)(n.p,{children:["Hasura verwendet ",(0,s.jsx)(n.a,{href:"https://hasura.io/docs/latest/auth/overview/",children:"rollenbasierte Zugriffsverwaltung"}),", w\xe4hrend Logto die standardm\xe4\xdfige ",(0,s.jsx)(n.a,{href:"/authorization/role-based-access-control",children:"Rollenbasierte Zugangskontrolle (RBAC)"})," nutzt."]}),"\n",(0,s.jsxs)(n.p,{children:["Im Logto-Modell und den Best Practices f\xfcr RBAC empfehlen wir Benutzern, ",(0,s.jsx)(n.code,{children:"Berechtigung"})," zu verwenden, um die feinste Granularit\xe4t von Berechtigungen darzustellen, ",(0,s.jsx)(n.code,{children:"Rolle"})," als eine Gruppe von ",(0,s.jsx)(n.code,{children:"Berechtigungen"})," f\xfcr bequeme Batch-Operationen zu verwenden und letztendlich ",(0,s.jsx)(n.code,{children:"Berechtigung"})," (normalerweise auf der Seite der Ressourcenanbieter) zu \xfcberpr\xfcfen, um zu verifizieren, ob ein Benutzer eine bestimmte Operation ausf\xfchren kann."]}),"\n",(0,s.jsxs)(n.p,{children:["In Hasura entspricht eine ",(0,s.jsx)(n.code,{children:"Rolle"})," der feinsten Granularit\xe4t von Berechtigungen, und Berechtigungspr\xfcfungen werden gegen ",(0,s.jsx)(n.code,{children:"Rollen"})," durchgef\xfchrt. Daher empfehlen wir bei der Konfiguration von Logto, eine ",(0,s.jsx)(n.code,{children:"Rolle"})," genau einer ",(0,s.jsx)(n.code,{children:"Berechtigung"})," zuzuordnen. Dieser Ansatz kann die Berechtigungen von Logto und Hasura miteinander verkn\xfcpfen, um Verwirrung und Missbrauch zu vermeiden."]}),"\n",(0,s.jsxs)(n.p,{children:["Hasura kann die Zugangskontrolle mit Webhooks oder JWT unterst\xfctzen. Unser vorheriger ",(0,s.jsx)(n.a,{href:"https://blog.logto.io/logto-x-hasura",children:"Blogbeitrag"})," f\xfchrte ein, wie man Webhooks verwendet, und in den folgenden Abschnitten erkl\xe4ren wir, wie man den JWT-Modus der Zugangskontrolle von Hasura nutzt."]}),"\n",(0,s.jsx)(n.h2,{id:"get-started",children:"Erste Schritte"}),"\n",(0,s.jsxs)(n.p,{children:["Beginnen wir mit einem einfachen Beispiel. Angenommen, ein Benutzer hat bereits zwei APIs in Hasura, ",(0,s.jsx)(n.code,{children:"GET /user"})," und ",(0,s.jsx)(n.code,{children:"PATCH /user"}),", die jeweils zwei Rollen entsprechen: ",(0,s.jsx)(n.code,{children:"user:reader"})," und ",(0,s.jsx)(n.code,{children:"user:maintainer"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"1-create-hasura-api-resource-in-logto",children:"1. Hasura-API-Ressource in Logto erstellen"}),"\n",(0,s.jsx)(n.p,{children:"Erstelle eine Hasura-API-Ressource in Logto."}),"\n",(0,s.jsx)("img",{src:"/img/assets/hasura-api.webp",alt:"Hasura API"}),"\n",(0,s.jsx)(n.h3,{id:"2-create-roles-according-to-hasura-setup-in-logto",children:"2. Rollen gem\xe4\xdf Hasura-Setup in Logto erstellen"}),"\n",(0,s.jsxs)(n.p,{children:["Wir m\xfcssen zwei ",(0,s.jsx)(n.code,{children:"Berechtigungen"})," f\xfcr die in Schritt 1 erw\xe4hnte Hasura-API-Ressource erstellen, n\xe4mlich ",(0,s.jsx)(n.code,{children:"read:user"})," und ",(0,s.jsx)(n.code,{children:"maintain:user"}),", und dann zwei Rollen erstellen: ",(0,s.jsx)(n.code,{children:"user:reader"})," (enth\xe4lt die ",(0,s.jsx)(n.code,{children:"read:user"})," Berechtigung) und ",(0,s.jsx)(n.code,{children:"user:maintainer"})," (einschlie\xdflich der ",(0,s.jsx)(n.code,{children:"maintain:user"})," Berechtigung), um eins zu eins mit den Rollen von Hasura zu korrespondieren. Und diese Rollen nach Bedarf Logto-Benutzern zuweisen."]}),"\n",(0,s.jsx)("img",{src:"/img/assets/hasura-api-with-scopes.webp",alt:"Hasura API mit Berechtigungen"}),"\n",(0,s.jsx)("img",{src:"/img/assets/user-reader-role.webp",alt:"Benutzerleserrolle"}),"\n",(0,s.jsx)("img",{src:"/img/assets/user-maintainer-role.webp",alt:"Benutzerbetreuerrolle"}),"\n",(0,s.jsxs)(n.h3,{id:"3-configure-hasura-environment-variable-hasura_graphql_jwt_secret-to-enable-jwt-mode",children:["3. Hasura-Umgebungsvariable ",(0,s.jsx)(n.code,{children:"HASURA_GRAPHQL_JWT_SECRET"})," konfigurieren, um den JWT-Modus zu aktivieren"]}),"\n",(0,s.jsxs)(n.p,{children:["Durch das Studium der ",(0,s.jsx)(n.a,{href:"https://hasura.io/docs/latest/auth/authentication/jwt/#hasura-jwt-configuration-options",children:"Hasura JWT-Konfigurationsoptionen"})," m\xfcssen wir die Umgebungsvariable ",(0,s.jsx)(n.code,{children:"HASURA_GRAPHQL_JWT_SECRET"})," hinzuf\xfcgen und konfigurieren, bevor wir JWT f\xfcr die Zugangskontrolle verwenden k\xf6nnen."]}),"\n",(0,s.jsxs)(n.p,{children:["Es gibt viele verschiedene Optionen, die konfiguriert werden k\xf6nnen, aber hier stellen wir den einfachsten Fall vor: nur die ",(0,s.jsx)(n.code,{children:"jwk_url"})," muss konfiguriert werden. Dieser Wert kann von deinem Logto OpenID-Konfigurationsendpunkt (",(0,s.jsx)(n.a,{href:"https://your.logto.domain/oidc/.well-known/openid-configuration",children:"https://your.logto.domain/oidc/.well-known/openid-configuration"}),") abgerufen werden."]}),"\n",(0,s.jsx)("img",{src:"/img/assets/hasura-jwt-config.webp",alt:"Hasura JWT-Konfiguration"}),"\n",(0,s.jsx)(n.h3,{id:"4-customize-user-access-token-extra-claims",children:"4. Benutzerzugangstoken mit zus\xe4tzlichen Anspr\xfcchen anpassen"}),"\n",(0,s.jsx)(n.p,{children:"Verwende die benutzerdefinierte Token-Anspr\xfcche-Funktion von Logto, um die Logik anzupassen, um zus\xe4tzliche Anspr\xfcche zum Benutzerzugangstoken hinzuzuf\xfcgen."}),"\n",(0,s.jsx)("img",{src:"/img/assets/user-access-token-script.webp",alt:"Benutzerzugangstoken-Skript"}),"\n",(0,s.jsxs)(n.p,{children:["Passe die Methode ",(0,s.jsx)(n.code,{children:"getCustomJwtClaims"})," an, um Daten im JWT hinzuzuf\xfcgen, auf die sich Hasura zur Implementierung der Zugangskontrolle st\xfctzt. Dies kann Daten im Zusammenhang mit dem Benutzer umfassen, der in diesem Fall autorisiert wird, einschlie\xdflich der ",(0,s.jsx)(n.code,{children:"Rollen"}),", die sie besitzen, auf die \xfcber ",(0,s.jsx)(n.code,{children:"context"})," zugegriffen werden kann."]}),"\n",(0,s.jsxs)(n.p,{children:["Wir haben auch eine Umgebungsvariable ",(0,s.jsx)(n.code,{children:"USER_DEFAULT_ROLE_NAMES"})," definiert, um Hardcoding zu vermeiden."]}),"\n",(0,s.jsx)(n.h3,{id:"5-integrate-logto-sdk",children:"5. Logto SDK integrieren"}),"\n",(0,s.jsx)(n.p,{children:"Nach der Konfiguration von Logto und Hasura integriere deine App mit dem Logto SDK. Hier verwenden wir ein React-Beispiel, um das Benutzerzugangstoken anzuzeigen, das von Logto nach der Benutzeranmeldung ausgegeben wird."}),"\n",(0,s.jsx)("img",{src:"/img/assets/user-with-roles.webp",alt:"Benutzer mit Rollen"}),"\n",(0,s.jsxs)(n.p,{children:["Zuerst weisen wir dem Benutzer die zuvor erstellten Rollen ",(0,s.jsx)(n.code,{children:"user:reader"})," und ",(0,s.jsx)(n.code,{children:"user:maintainer"})," zu und melden uns dann als dieser Benutzer an."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"const config: LogtoConfig = {\n  endpoint: 'http://localhost:3001',\n  appId: '<your-application-id>',\n  appSecret: '<your-application-secret>',\n  scopes: [\n    ...// bestehende Berechtigungen\n    'read:user',\n    'maintain:user',\n  ],\n  resources: [\n    ...// bestehende Ressourcen\n    'https://*.hasura.app/api',\n  ],\n};\n"})}),"\n",(0,s.jsx)(n.p,{children:"Erhalte das Benutzerzugangstoken und fordere Hasura-APIs an:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-tsx",children:"const accessToken = await logto.getAccessToken('https://*.hasura.app/api');\n\n// Bevor die Anfrage an Hasura gesendet wird\nrequest.headers.set('Authorization', `Bearer ${accessToken}`);\nrequest.headers.set('x-Hasura-Role', '<erforderliche-Rolle-f\xfcr-den-Endpunkt>');\n"})}),"\n",(0,s.jsx)(n.h2,{id:"conclusion",children:"Fazit"}),"\n",(0,s.jsx)(n.p,{children:"In diesem Artikel bieten wir eine weitere Methode der JWT-basierten Zugangskontrolle, die von Hasura unterst\xfctzt wird, zus\xe4tzlich zu Webhook."}),"\n",(0,s.jsxs)(n.p,{children:["Durch den Vergleich der Prozesse von Hasuras ",(0,s.jsx)(n.a,{href:"https://hasura.io/docs/latest/auth/authentication/webhook/",children:"Webhook"})," und ",(0,s.jsx)(n.a,{href:"https://hasura.io/docs/latest/auth/authentication/jwt/",children:"JWT"})," Zugangskontrolle k\xf6nnen wir sehen, dass der Webhook-Ansatz bei jeder Hasura-Anfrage einen Webhook an Logto sendet und auf eine Antwort wartet; w\xe4hrend der JWT-basierte Ansatz kontinuierlich verwendet werden kann, bis das JWT abl\xe4uft."]}),"\n",(0,s.jsx)(n.p,{children:"Der JWT-Ansatz kann die Netzwerklast reduzieren und die durch Webhooks verursachte Netzwerklatenz eliminieren; w\xe4hrend der Webhook-Ansatz \xc4nderungen in den Benutzerberechtigungen in Echtzeit synchronisieren kann."}),"\n",(0,s.jsx)(n.p,{children:"Benutzer k\xf6nnen den geeigneten Ansatz basierend auf diesen Schlussfolgerungen und ihren tats\xe4chlichen gesch\xe4ftlichen Anforderungen w\xe4hlen."})]})}function c(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},79621:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>u});var i=r(58101);const s={},t=i.createContext(s);function a(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function u(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);