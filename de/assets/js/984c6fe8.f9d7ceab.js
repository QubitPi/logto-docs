"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[4884],{62697:(e,n,r)=>{r.d(n,{Ay:()=>a,RM:()=>i});var s=r(25105),t=r(79621);const i=[];function o(e){const n={admonition:"admonition",p:"p",...(0,t.R)(),...e.components};return(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:['Diese Anleitung geht davon aus, dass du eine Anwendung des Typs "',e.type,'" in der Admin-Konsole erstellt hast.']})})}function a(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},28887:(e,n,r)=>{r.d(n,{Ay:()=>a,RM:()=>i});var s=r(25105),t=r(79621);const i=[];function o(e){const n={p:"p",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:['Wechseln wir zur Seite "Anwendungsdetails" der Logto-Konsole. F\xfcge eine Redirect-URI ',(0,s.jsx)("code",{children:e.redirectUri}),' hinzu und klicke auf "\xc4nderungen speichern".']}),"\n",(0,s.jsx)("img",{alt:"Redirect-URI in Logto-Konsole",src:e.figureSrc,width:"600px"})]})}function a(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},99409:(e,n,r)=>{r.d(n,{Ay:()=>a,RM:()=>i});var s=r(25105),t=r(79621);const i=[];function o(e){const{Url:n}={...(0,t.R)(),...e.components};return n||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n,{href:"/end-user-flows",children:" Endbenutzerfl\xfcsse: Authentifizierungsfl\xfcsse, Kontofl\xfcsse und Organisationsfl\xfcsse "}),"\n",(0,s.jsx)(n,{href:"/connectors",children:" Connectors konfigurieren "}),"\n",(0,s.jsx)(n,{href:"/authorization",children:" Autorisierung (Authorization) "})]})}function a(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},11080:(e,n,r)=>{r.d(n,{Ay:()=>a,RM:()=>i});var s=r(25105),t=r(79621);const i=[];function o(e){const n={admonition:"admonition",p:"p",...(0,t.R)(),...e.components};return(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsx)("p",{children:(0,s.jsx)(n.p,{children:'Du kannst das "App Secret" auf der Anwendungsdetailseite in der Admin-Konsole finden und kopieren:'})}),(0,s.jsx)("img",{alt:"App Secret",src:"/img/assets/app-secret.png",width:"586px"})]})}function a(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},88423:(e,n,r)=>{r.d(n,{Ay:()=>a,RM:()=>i});var s=r(25105),t=r(79621);const i=[{value:"Bez\xfcglich der umleitungsbasierten Anmeldung",id:"regarding-redirect-based-sign-in",level:3}];function o(e){const n={a:"a",h3:"h3",li:"li",ol:"ol",p:"p",...(0,t.R)(),...e.components},{Details:r,MainSiteUrl:i}=n;return r||l("Details",!0),i||l("MainSiteUrl",!0),(0,s.jsxs)(r,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)(n.h3,{id:"regarding-redirect-based-sign-in",children:"Bez\xfcglich der umleitungsbasierten Anmeldung"})}),(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Dieser Authentifizierungsprozess folgt dem ",(0,s.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html",children:"OpenID Connect (OIDC)"})," Protokoll, und Logto erzwingt strenge Sicherheitsma\xdfnahmen, um die Benutzeranmeldung zu sch\xfctzen."]}),"\n",(0,s.jsx)(n.li,{children:"Wenn du mehrere Apps hast, kannst du denselben Identit\xe4tsanbieter (Logto) verwenden. Sobald sich der Benutzer bei einer App anmeldet, wird Logto den Anmeldeprozess automatisch abschlie\xdfen, wenn der Benutzer auf eine andere App zugreift."}),"\n"]}),(0,s.jsxs)(n.p,{children:["Um mehr \xfcber die Gr\xfcnde und Vorteile der umleitungsbasierten Anmeldung zu erfahren, siehe ",(0,s.jsx)(i,{href:"/concepts/sign-in-experience",children:"Logto-Anmeldeerfahrung erkl\xe4rt"}),"."]})]})}function a(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}function l(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},73961:(e,n,r)=>{r.d(n,{Ay:()=>a,RM:()=>i});var s=r(25105),t=r(79621);const i=[];function o(e){const n={admonition:"admonition",p:"p",...(0,t.R)(),...e.components};return(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["Bevor du ",(0,s.jsx)("code",{children:e.calling})," aufrufst, stelle sicher, dass du die Redirect-URI im Admin Console korrekt konfiguriert hast."]})})}function a(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},71725:(e,n,r)=>{r.d(n,{Ay:()=>l,RM:()=>o});var s=r(25105),t=r(79621),i=r(88423);const o=[...i.RM];function a(e){const n={hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Bevor wir ins Detail gehen, hier ein schneller \xdcberblick \xfcber die Endbenutzererfahrung. Der Anmeldeprozess l\xe4sst sich wie folgt vereinfachen:"}),"\n",(0,s.jsx)(n.mermaid,{value:"graph LR\n    A(Deine App) --\x3e|1\\. Anmeldung ausl\xf6sen| B(Logto)\n    B --\x3e|2\\. Anmeldung abschlie\xdfen| A"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Deine App l\xf6st die Anmeldemethode aus."}),"\n",(0,s.jsx)(n.li,{children:"Der Benutzer wird auf die Logto-Anmeldeseite umgeleitet. Bei nativen Apps wird der Systembrowser ge\xf6ffnet."}),"\n",(0,s.jsx)(n.li,{children:"Der Benutzer meldet sich an und wird zur\xfcck zu deiner App umgeleitet (konfiguriert als Redirect-URI)."}),"\n"]}),"\n",(0,s.jsx)(i.Ay,{}),"\n",(0,s.jsx)(n.hr,{})]})}function l(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},63081:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>f,contentTitle:()=>m,default:()=>b,frontMatter:()=>g,metadata:()=>s,toc:()=>x});const s=JSON.parse('{"id":"quick-starts/generic/traditional/README","title":"Authentifizierung zu deiner traditionellen Webanwendung hinzuf\xfcgen","description":"Deine App l\xe4uft m\xf6glicherweise auf der Serverseite anstatt im Browser und verwendet Frameworks wie Django, Laravel usw. Das wird als traditionelle Web-App bezeichnet. Wenn du auf dieser Seite kein geeignetes SDK findest, musst du wahrscheinlich manuell integrieren.","source":"@site/i18n/de/docusaurus-plugin-content-docs/current/quick-starts/generic/traditional/README.mdx","sourceDirName":"quick-starts/generic/traditional","slug":"/quick-starts/traditional-web","permalink":"/de/quick-starts/traditional-web","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/de/docusaurus-plugin-content-docs/current/quick-starts/generic/traditional/README.mdx","tags":[],"version":"current","frontMatter":{"slug":"/quick-starts/traditional-web","sidebar_label":"Traditionelles Web","sidebar_custom_props":{"description":"Integriere Logto mit traditionellen Web-Apps, die auf dem Server laufen."}},"sidebar":"quickStartSidebar","previous":{"title":"Maschine-zu-Maschine","permalink":"/de/quick-starts/m2m"},"next":{"title":"Hasura","permalink":"/de/quick-starts/hasura"}}');var t=r(25105),i=r(79621),o=r(38552),a=r(22002),l=r(62697),d=r(28887),c=r(99409),u=r(11080),h=r(73961),p=r(71725);const g={slug:"/quick-starts/traditional-web",sidebar_label:"Traditionelles Web",sidebar_custom_props:{description:"Integriere Logto mit traditionellen Web-Apps, die auf dem Server laufen."}},m="Authentifizierung zu deiner traditionellen Webanwendung hinzuf\xfcgen",f={},x=[...l.RM,{value:"Quellcode erhalten",id:"get-source-code",level:2},{value:"Ein Express-Projekt starten",id:"start-an-express-project",level:2},{value:"Abh\xe4ngigkeiten installieren",id:"install-dependencies",level:2},{value:"Session verwenden",id:"use-session",level:2},{value:"Funktionen zur Authentifizierung von Benutzern implementieren",id:"implement-functions-to-authenticate-users",level:2},...u.RM,{value:"Anmelden",id:"sign-in",level:2},...p.RM,{value:"Redirect-URI konfigurieren",id:"configure-redirect-uri",level:3},...d.RM,{value:"Anmelderoute implementieren",id:"implement-sign-in-route",level:3},...h.RM,{value:"Abmelden",id:"sign-out",level:2},{value:"Auf gesch\xfctzte Ressourcen zugreifen",id:"access-protected-resource",level:2},{value:"Weiterf\xfchrende Lekt\xfcre",id:"further-readings",level:2},...c.RM];function j(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components},{Url:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"authentifizierung-zu-deiner-traditionellen-webanwendung-hinzuf\xfcgen",children:"Authentifizierung zu deiner traditionellen Webanwendung hinzuf\xfcgen"})}),"\n",(0,t.jsx)(l.Ay,{type:"Traditional web"}),"\n",(0,t.jsx)(n.p,{children:"Deine App l\xe4uft m\xf6glicherweise auf der Serverseite anstatt im Browser und verwendet Frameworks wie Django, Laravel usw. Das wird als traditionelle Web-App bezeichnet. Wenn du auf dieser Seite kein geeignetes SDK findest, musst du wahrscheinlich manuell integrieren."}),"\n",(0,t.jsx)(n.p,{children:"Dieser Artikel f\xfchrt dich Schritt f\xfcr Schritt durch den Prozess. Wir nehmen Express in Node.js als Beispiel."}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["Dieser Artikel ist nicht nur f\xfcr Express gedacht. Wenn du andere Frameworks oder sogar andere Sprachen verwendest, kannst du ",(0,t.jsx)(n.code,{children:"@logto/js"})," durch das Core-SDK der jeweiligen Sprache ersetzen und einige der Schritte anpassen."]})}),"\n",(0,t.jsx)(n.h2,{id:"get-source-code",children:"Quellcode erhalten"}),"\n",(0,t.jsxs)(n.p,{children:["Du kannst auf ",(0,t.jsx)(n.a,{href:"https://github.com/logto-io/express-example",children:"GitHub"})," gehen, um den endg\xfcltigen Code f\xfcr diese Anleitung zu erhalten."]}),"\n",(0,t.jsx)(n.h2,{id:"start-an-express-project",children:"Ein Express-Projekt starten"}),"\n",(0,t.jsxs)(n.p,{children:["Mit ",(0,t.jsx)(n.code,{children:"express-generator"})," kannst du schnell ein Express-Projekt starten."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"mkdir express-logto\ncd express-logto\nnpx express-generator\n"})}),"\n",(0,t.jsx)(n.h2,{id:"install-dependencies",children:"Abh\xe4ngigkeiten installieren"}),"\n",(0,t.jsx)(n.p,{children:"Die Demo-App ben\xf6tigt 4 Abh\xe4ngigkeiten:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"@logto/js"}),": Logtos Core-SDK f\xfcr JavaScript."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"node-fetch"}),": Minimaler Code f\xfcr eine ",(0,t.jsx)(n.code,{children:"window.fetch"})," kompatible API in der Node.js-Laufzeit."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"express-session"}),": Eine Session-Middleware, wir verwenden die Session, um Benutzertokens zu speichern."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"js-base64"}),": Ein weiterer Base64-Transcoder."]}),"\n"]}),"\n",(0,t.jsxs)(a.A,{children:[(0,t.jsx)(o.A,{value:"npm",label:"npm",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm i @logto/js node-fetch@v2 express-session js-base64\n"})})}),(0,t.jsx)(o.A,{value:"yarn",label:"Yarn",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"yarn add @logto/js node-fetch@v2 express-session js-base64\n"})})}),(0,t.jsx)(o.A,{value:"pnpm",label:"pnpm",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pnpm add @logto/js node-fetch@v2 express-session js-base64\n"})})})]}),"\n",(0,t.jsx)(n.h2,{id:"use-session",children:"Session verwenden"}),"\n",(0,t.jsx)(n.p,{children:"Wenn Benutzer angemeldet sind, erhalten sie eine Reihe von Tokens (Zugangstoken, ID-Token, Auffrischungstoken) und Interaktionsdaten, und die Session ist ein ausgezeichneter Ort, um sie zu speichern."}),"\n",(0,t.jsxs)(n.p,{children:["Wir haben ",(0,t.jsx)(n.a,{href:"https://github.com/expressjs/session",children:"express-session"})," im vorherigen Schritt installiert, also lass uns jetzt einfach den folgenden Code hinzuf\xfcgen, um es einzurichten:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// app.js\n\nconst session = require('express-session');\n\napp.use(\n  session({\n    secret: 'keyboard cat', // \xc4ndere es zu deinem eigenen geheimen Schl\xfcssel\n    cookie: { maxAge: 86400 },\n  })\n);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"implement-functions-to-authenticate-users",children:"Funktionen zur Authentifizierung von Benutzern implementieren"}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["Wir gehen davon aus, dass die Anwendung auf ",(0,t.jsx)(n.code,{children:"http://localhost:3000"})," l\xe4uft in den folgenden Code-Snippets."]})}),"\n",(0,t.jsx)(n.p,{children:"In diesem Schritt m\xfcssen wir die folgenden Authentifizierungsfunktionen implementieren:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"getSignInUrl"}),": erstellt und gibt eine vollst\xe4ndige URL des Logto Authorization Servers zur\xfcck, zu der Benutzer weitergeleitet werden."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"handleSignIn"}),": analysiert die Callback-URL, nachdem der Authentifizierungsprozess abgeschlossen ist, erh\xe4lt den Code-Query-Parameter und holt dann Tokens (ein Zugangstoken, das Auffrischungstoken und ein ID-Token), um den Anmeldeprozess abzuschlie\xdfen."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"refreshTokens"}),": tauscht ein neues Zugangstoken mit dem Auffrischungstoken aus."]}),"\n"]}),"\n",(0,t.jsx)(u.Ay,{}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// logto.js\n\nconst {\n  withReservedScopes,\n  fetchOidcConfig,\n  discoveryPath,\n  generateSignInUri,\n  verifyAndParseCodeFromCallbackUri,\n  fetchTokenByAuthorizationCode,\n  fetchTokenByRefreshToken,\n} = require('@logto/js');\nconst fetch = require('node-fetch');\nconst { randomFillSync, createHash } = require('crypto');\nconst { fromUint8Array } = require('js-base64');\n\nconst config = {\n  endpoint: 'https://logto.dev',\n  appId: 'foo',\n  appSecret: '<your-app-secret-copied-from-console>',\n  redirectUri: 'http://localhost:3000/callback', // Du musst es m\xf6glicherweise mit der Produktionsadresse deiner App ersetzen\n  scopes: withReservedScopes().split(' '),\n};\n\nconst requester = (input, init) => {\n  const { appId, appSecret } = config;\n\n  return fetch(input, {\n    ...init,\n    headers: {\n      ...init?.headers,\n      authorization: `Basic ${Buffer.from(`${appId}:${appSecret}`, 'utf8').toString('base64')}`,\n    },\n  });\n};\n\nconst generateRandomString = (length = 64) => {\n  return fromUint8Array(randomFillSync(new Uint8Array(length)), true);\n};\n\nconst generateCodeChallenge = async (codeVerifier) => {\n  const encodedCodeVerifier = new TextEncoder().encode(codeVerifier);\n  const hash = createHash('sha256');\n  hash.update(encodedCodeVerifier);\n  const codeChallenge = hash.digest();\n  return fromUint8Array(codeChallenge, true);\n};\n\nconst getOidcConfig = async () => {\n  return fetchOidcConfig(new URL(discoveryPath, config.endpoint).toString(), requester);\n};\n\nexports.getSignInUrl = async () => {\n  const { authorizationEndpoint } = await getOidcConfig();\n  const codeVerifier = generateRandomString();\n  const codeChallenge = await generateCodeChallenge(codeVerifier);\n  const state = generateRandomString();\n\n  const { redirectUri, scopes, appId: clientId } = config;\n\n  const signInUri = generateSignInUri({\n    authorizationEndpoint,\n    clientId,\n    redirectUri: redirectUri,\n    codeChallenge,\n    state,\n    scopes,\n  });\n\n  return { redirectUri, codeVerifier, state, signInUri };\n};\n\nexports.handleSignIn = async (signInSession, callbackUri) => {\n  const { redirectUri, state, codeVerifier } = signInSession;\n  const code = verifyAndParseCodeFromCallbackUri(callbackUri, redirectUri, state);\n\n  const { appId: clientId } = config;\n  const { tokenEndpoint } = await getOidcConfig();\n  const codeTokenResponse = await fetchTokenByAuthorizationCode(\n    {\n      clientId,\n      tokenEndpoint,\n      redirectUri,\n      codeVerifier,\n      code,\n    },\n    requester\n  );\n\n  return codeTokenResponse;\n};\n\nexports.refreshTokens = async (refreshToken) => {\n  const { appId: clientId, scopes } = config;\n  const { tokenEndpoint } = await getOidcConfig();\n  const tokenResponse = await fetchTokenByRefreshToken(\n    {\n      clientId,\n      tokenEndpoint,\n      refreshToken,\n      scopes,\n    },\n    requester\n  );\n\n  return tokenResponse;\n};\n"})}),"\n",(0,t.jsx)(n.h2,{id:"sign-in",children:"Anmelden"}),"\n",(0,t.jsx)(p.Ay,{}),"\n",(0,t.jsx)(n.h3,{id:"configure-redirect-uri",children:"Redirect-URI konfigurieren"}),"\n",(0,t.jsx)(d.Ay,{figureSrc:"/img/assets/web-redirect-uri.png",redirectUri:"http://localhost:3000/callback"}),"\n",(0,t.jsx)(n.h3,{id:"implement-sign-in-route",children:"Anmelderoute implementieren"}),"\n",(0,t.jsx)(h.Ay,{calling:"getSignInUrl()"}),"\n",(0,t.jsx)(n.p,{children:"Erstelle eine Route in Express zur Anmeldung:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const { getSignInUrl } = require('./logto');\n\napp.get('/sign-in', async (req, res) => {\n  const { redirectUri, codeVerifier, state, signInUri } = await getSignInUrl();\n  req.session.signIn = { codeVerifier, state, redirectUri };\n  res.redirect(signInUri);\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:"und eine Route, um den Callback zu verarbeiten:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"app.get('/callback', async (req, res) => {\n  if (!req.session.signIn) {\n    res.send('Bad request.');\n    return;\n  }\n\n  const response = await handleSignIn(\n    req.session.signIn,\n    `${req.protocol}://${req.get('host')}${req.originalUrl}`\n  );\n  req.session.tokens = {\n    ...response,\n    expiresAt: response.expiresIn + Date.now(),\n    idToken: decodeIdToken(response.idToken),\n  };\n  req.session.signIn = null;\n\n  res.redirect('/');\n});\n"})}),"\n",(0,t.jsx)(n.h2,{id:"sign-out",children:"Abmelden"}),"\n",(0,t.jsx)(n.p,{children:'TODO: Link zum Kapitel "Session & Cookies" in der Benutzerreferenz.'}),"\n",(0,t.jsx)(n.p,{children:'Du kannst Tokens in der Session l\xf6schen, um einen Benutzer von dieser Anwendung abzumelden. Und folge diesem Link, um mehr \xfcber "Abmelden" zu lesen.'}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"app.get('/sign-out', (req, res) => {\n  req.session.tokens = null;\n  res.send('Abmeldung erfolgreich');\n});\n"})}),"\n",(0,t.jsx)(n.h2,{id:"access-protected-resource",children:"Auf gesch\xfctzte Ressourcen zugreifen"}),"\n",(0,t.jsxs)(n.p,{children:["Erstelle eine Middleware namens ",(0,t.jsx)(n.code,{children:"withAuth"}),", um ein ",(0,t.jsx)(n.code,{children:"auth"}),"-Objekt an ",(0,t.jsx)(n.code,{children:"req"})," anzuh\xe4ngen und zu \xfcberpr\xfcfen, ob ein Benutzer angemeldet ist."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"// auth.js\n\nconst { decodeIdToken } = require('@logto/js');\nconst { refreshTokens } = require('./logto');\n\nconst withAuth =\n  ({ requireAuth } = { requireAuth: true }) =>\n  async (req, res, next) => {\n    if (requireAuth && !req.session.tokens) {\n      res.redirect('/sign-in');\n      return;\n    }\n\n    if (req.session.tokens) {\n      if (req.session.tokens.expiresAt >= Date.now()) {\n        // Zugangstoken abgelaufen, neue Tokens anfordern\n        try {\n          const response = await refreshTokens(req.session.tokens.refreshToken);\n          req.session.tokens = {\n            ...response,\n            expiresAt: response.expiresIn + Date.now(),\n            idToken: decodeIdToken(response.idToken),\n          };\n        } catch {\n          // Austausch fehlgeschlagen, zur Anmeldung umleiten\n          res.redirect('/sign-in');\n          return;\n        }\n      }\n\n      req.auth = req.session.tokens.idToken.sub;\n    }\n\n    next();\n  };\n\nmodule.exports = withAuth;\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Erstelle eine ",(0,t.jsx)(n.code,{children:"index"}),"-Seite, zeige einen Anmeldelink f\xfcr G\xe4ste und einen Link zum Profil f\xfcr bereits angemeldete Benutzer:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"router.get('/', withAuth({ requireAuth: false }), function (req, res, next) {\n  res.render('index', { auth: Boolean(req.auth) });\n});\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jade",children:'extends layout\n\nblock content\n  h1 Hallo Logto\n  if auth\n    p: a(href="/user") Zum Profil gehen\n  else\n    p: a(href="/sign-in") Hier klicken, um sich anzumelden\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Erstelle eine ",(0,t.jsx)(n.code,{children:"user"}),"-Seite, um die ",(0,t.jsx)(n.code,{children:"userId"})," (",(0,t.jsx)(n.code,{children:"Subjekt"}),") anzuzeigen:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"app.get('/user', withAuth(), (req, res, next) => {\n  res.render('user', { userId: req.auth });\n});\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jade",children:"extends layout\n\nblock content\n  h1 Hallo Logto\n  p userId: #{userId}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"further-readings",children:"Weiterf\xfchrende Lekt\xfcre"}),"\n",(0,t.jsx)(c.Ay,{}),"\n",(0,t.jsx)(r,{href:"https://blog.logto.io/gpt-action-oauth",children:(0,t.jsx)(n.p,{children:"Benutzer in GPT-Aktionen authentifizieren: Baue einen pers\xf6nlichen Agenda-Assistenten"})})]})}function b(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(j,{...e})}):j(e)}},38552:(e,n,r)=>{r.d(n,{A:()=>o});r(58101);var s=r(13526);const t={tabItem:"tabItem_dgSZ"};var i=r(25105);function o(e){let{children:n,hidden:r,className:o}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,s.A)(t.tabItem,o),hidden:r,children:n})}},22002:(e,n,r)=>{r.d(n,{A:()=>v});var s=r(58101),t=r(13526),i=r(60755),o=r(55234),a=r(6635),l=r(4100),d=r(35661),c=r(42752);function u(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:r}=e;return(0,s.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:r,attributes:s,default:t}}=e;return{value:n,label:r,attributes:s,default:t}}))}(r);return function(e){const n=(0,d.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,r])}function p(e){let{value:n,tabValues:r}=e;return r.some((e=>e.value===n))}function g(e){let{queryString:n=!1,groupId:r}=e;const t=(0,o.W6)(),i=function(e){let{queryString:n=!1,groupId:r}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:n,groupId:r});return[(0,l.aZ)(i),(0,s.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(t.location.search);n.set(i,e),t.replace({...t.location,search:n.toString()})}),[i,t])]}function m(e){const{defaultValue:n,queryString:r=!1,groupId:t}=e,i=h(e),[o,l]=(0,s.useState)((()=>function(e){let{defaultValue:n,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const s=r.find((e=>e.default))??r[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:n,tabValues:i}))),[d,u]=g({queryString:r,groupId:t}),[m,f]=function(e){let{groupId:n}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(n),[t,i]=(0,c.Dv)(r);return[t,(0,s.useCallback)((e=>{r&&i.set(e)}),[r,i])]}({groupId:t}),x=(()=>{const e=d??m;return p({value:e,tabValues:i})?e:null})();(0,a.A)((()=>{x&&l(x)}),[x]);return{selectedValue:o,selectValue:(0,s.useCallback)((e=>{if(!p({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),f(e)}),[u,f,i]),tabValues:i}}var f=r(21929);const x={tabList:"tabList_osvQ",tabItem:"tabItem_dc4O"};var j=r(25105);function b(e){let{className:n,block:r,selectedValue:s,selectValue:o,tabValues:a}=e;const l=[],{blockElementScrollPositionUntilNextRender:d}=(0,i.a_)(),c=e=>{const n=e.currentTarget,r=l.indexOf(n),t=a[r].value;t!==s&&(d(n),o(t))},u=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const r=l.indexOf(e.currentTarget)+1;n=l[r]??l[0];break}case"ArrowLeft":{const r=l.indexOf(e.currentTarget)-1;n=l[r]??l[l.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,t.A)("tabs",{"tabs--block":r},n),children:a.map((e=>{let{value:n,label:r,attributes:i}=e;return(0,j.jsx)("li",{role:"tab",tabIndex:s===n?0:-1,"aria-selected":s===n,ref:e=>{l.push(e)},onKeyDown:u,onClick:c,...i,className:(0,t.A)("tabs__item",x.tabItem,i?.className,{"tabs__item--active":s===n}),children:r??n},n)}))})}function k(e){let{lazy:n,children:r,selectedValue:i}=e;const o=(Array.isArray(r)?r:[r]).filter(Boolean);if(n){const e=o.find((e=>e.props.value===i));return e?(0,s.cloneElement)(e,{className:(0,t.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:o.map(((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==i})))})}function A(e){const n=m(e);return(0,j.jsxs)("div",{className:(0,t.A)("tabs-container",x.tabList),children:[(0,j.jsx)(b,{...n,...e}),(0,j.jsx)(k,{...n,...e})]})}function v(e){const n=(0,f.A)();return(0,j.jsx)(A,{...e,children:u(e.children)},String(n))}},79621:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var s=r(58101);const t={},i=s.createContext(t);function o(e){const n=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(i.Provider,{value:n},e.children)}}}]);