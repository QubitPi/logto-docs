"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[22716],{26573:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>c,frontMatter:()=>d,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"integrate-logto/protected-app","title":"Gesch\xfctzte App","description":"Die Gesch\xfctzte App ist darauf ausgelegt, die Komplexit\xe4t von SDK-Integrationen zu beseitigen, indem sie die Authentifizierung von deiner Anwendung trennt. Wir \xfcbernehmen die Authentifizierung, sodass du dich auf deine Kernfunktionalit\xe4t konzentrieren kannst. Sobald ein Benutzer authentifiziert ist, liefert die Gesch\xfctzte App den Inhalt von deinem Server.","source":"@site/i18n/de/docusaurus-plugin-content-docs/current/integrate-logto/protected-app.mdx","sourceDirName":"integrate-logto","slug":"/integrate-logto/protected-app","permalink":"/de/integrate-logto/protected-app","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/de/docusaurus-plugin-content-docs/current/integrate-logto/protected-app.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Authentifizierungsablauf verstehen","permalink":"/de/integrate-logto/integrate-logto-into-your-application/understand-authentication-flow"},"next":{"title":"Drittanbieteranwendungen","permalink":"/de/integrate-logto/third-party-applications/"}}');var r=t(25105),s=t(79621);const d={sidebar_position:2},o="Gesch\xfctzte App",a={},l=[{value:"Wie die Gesch\xfctzte App funktioniert",id:"how-protected-app-works",level:2},{value:"Sch\xfctze deinen Ursprungsserver",id:"protect-your-origin-server",level:2},{value:"HTTP-Header-Validierung",id:"http-header-validation",level:3},{value:"JSON Web Tokens (JWT) Validierung",id:"json-web-tokens-jwt-validation",level:3},{value:"Authentifizierungsstatus und Benutzerinformationen abrufen",id:"get-authentication-state-and-user-information",level:2},{value:"Den urspr\xfcnglichen Host abrufen",id:"get-the-original-host",level:2},{value:"Authentifizierungsregeln anpassen",id:"customize-authentication-rules",level:2},{value:"Lokale Entwicklung",id:"local-development",level:2},{value:"\xdcbergang zur SDK-Integration",id:"transition-to-sdk-integration",level:2},{value:"Verwandte Ressourcen",id:"related-resources",level:2}];function u(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...e.components},{Url:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"gesch\xfctzte-app",children:"Gesch\xfctzte App"})}),"\n",(0,r.jsxs)(n.p,{children:["Die Gesch\xfctzte App ist darauf ausgelegt, die Komplexit\xe4t von ",(0,r.jsx)(n.a,{href:"/quick-starts",children:"SDK-Integrationen"})," zu beseitigen, indem sie die ",(0,r.jsx)(n.a,{href:"https://auth.wiki/authentication",children:"Authentifizierung"})," von deiner Anwendung trennt. Wir \xfcbernehmen die Authentifizierung, sodass du dich auf deine Kernfunktionalit\xe4t konzentrieren kannst. Sobald ein Benutzer authentifiziert ist, liefert die Gesch\xfctzte App den Inhalt von deinem Server."]}),"\n",(0,r.jsx)(n.h2,{id:"how-protected-app-works",children:"Wie die Gesch\xfctzte App funktioniert"}),"\n",(0,r.jsx)(n.p,{children:"Die Gesch\xfctzte App, betrieben von Cloudflare, arbeitet weltweit auf Edge-Netzwerken und sorgt f\xfcr niedrige Latenz und hohe Verf\xfcgbarkeit deiner Anwendung."}),"\n",(0,r.jsx)(n.p,{children:"Die Gesch\xfctzte App verwaltet den Sitzungsstatus und die Benutzerinformationen. Wenn ein Benutzer nicht authentifiziert ist, leitet die Gesch\xfctzte App ihn zur Anmeldeseite weiter. Sobald er authentifiziert ist, erg\xe4nzt die Gesch\xfctzte App die Anfrage des Benutzers mit Authentifizierungs- und Benutzerinformationen und leitet sie dann an den Ursprungsserver weiter."}),"\n",(0,r.jsx)(n.p,{children:"Dieser Prozess wird im folgenden Flussdiagramm visualisiert:"}),"\n",(0,r.jsx)(n.mermaid,{value:'graph LR\n  A("Client<br/>(Browser)") --\x3e|Anfrage| B(Logto<br/>Gesch\xfctzte App)\n  B --\x3e Condition{{Route<br/>stimmt \xfcberein?}}\n  Condition --\x3e|Ja| Matched{{Ist authentifiziert?}}\n  Matched --\x3e|Ja| C(Ursprungsserver)\n  Matched --\x3e|Nein| D(Logto-Anmeldung)\n  Condition --\x3e|Nein| C'}),"\n",(0,r.jsx)(n.h2,{id:"protect-your-origin-server",children:"Sch\xfctze deinen Ursprungsserver"}),"\n",(0,r.jsx)(n.p,{children:"Der Ursprungsserver, der entweder ein physisches oder virtuelles Ger\xe4t sein kann, das nicht der Gesch\xfctzten App von Logto geh\xf6rt, ist der Ort, an dem sich deine Anwendungsinhalte befinden. \xc4hnlich wie ein Content Delivery Network (CDN)-Server verwaltet die Gesch\xfctzte App Authentifizierungsprozesse und ruft Inhalte von deinem Ursprungsserver ab. Wenn Benutzer direkten Zugriff auf deinen Ursprungsserver erhalten, k\xf6nnen sie die Authentifizierung umgehen und deine Anwendung ist nicht mehr gesch\xfctzt."}),"\n",(0,r.jsx)(n.p,{children:"Es ist daher wichtig, Ursprungsverbindungen zu sichern, um zu verhindern, dass Angreifer deinen Ursprungsserver ohne Authentifizierung entdecken und darauf zugreifen. Es gibt mehrere M\xf6glichkeiten, dies zu tun:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"HTTP-Header-Validierung"}),"\n",(0,r.jsx)(n.li,{children:"JSON Web Tokens (JWT) Validierung"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"http-header-validation",children:"HTTP-Header-Validierung"}),"\n",(0,r.jsxs)(n.p,{children:["Die Sicherung deines Ursprungsservers kann durch ",(0,r.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Authentication#basic_authentication_scheme",children:"HTTP Basic Authentication"})," erreicht werden."]}),"\n",(0,r.jsx)(n.p,{children:"Jede Anfrage von der Gesch\xfctzten App enth\xe4lt den folgenden Header:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Authorization: Basic base64(appId:appSecret)\n"})}),"\n",(0,r.jsx)(n.p,{children:"Durch die Validierung dieses Headers kannst du best\xe4tigen, dass die Anfrage von der Gesch\xfctzten App stammt, und alle Anfragen ablehnen, die diesen Header nicht enthalten."}),"\n",(0,r.jsx)(n.p,{children:"Wenn du Nginx oder Apache verwendest, kannst du auf die folgenden Anleitungen verweisen, um HTTP Basic Authentication auf deinem Ursprungsserver zu implementieren:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Nginx: ",(0,r.jsx)(n.a,{href:"https://docs.nginx.com/nginx/admin-guide/security-controls/configuring-http-basic-authentication/",children:"Konfiguration der HTTP Basic Authentication"})]}),"\n",(0,r.jsxs)(n.li,{children:["Apache: ",(0,r.jsx)(n.a,{href:"https://httpd.apache.org/docs/2.4/howto/auth.html",children:"Authentifizierung und Autorisierung"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Um die Header innerhalb deiner Anwendung zu \xfcberpr\xfcfen, siehe das ",(0,r.jsx)(n.a,{href:"https://developers.cloudflare.com/workers/examples/basic-auth/",children:"HTTP Basic Authentication Beispiel"})," von Cloudflare, um zu lernen, wie man den Zugriff mit dem HTTP Basic Schema einschr\xe4nkt."]}),"\n",(0,r.jsx)(n.h3,{id:"json-web-tokens-jwt-validation",children:"JSON Web Tokens (JWT) Validierung"}),"\n",(0,r.jsx)(n.p,{children:"Eine weitere M\xf6glichkeit, deinen Ursprungsserver zu sichern, ist die Verwendung von JSON Web Tokens (JWT)."}),"\n",(0,r.jsx)(n.p,{children:"Jede authentifizierte Anfrage von der Gesch\xfctzten App enth\xe4lt den folgenden Header:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Logto-ID-Token: <JWT>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Das JWT wird ",(0,r.jsx)(n.a,{href:"https://auth.wiki/id-token",children:"ID-Token"})," genannt, das von Logto signiert ist und Benutzerinformationen enth\xe4lt. Durch die Validierung dieses JWT kannst du best\xe4tigen, dass die Anfrage von der Gesch\xfctzten App stammt, und alle Anfragen ablehnen, die diesen Header nicht enthalten."]}),"\n",(0,r.jsxs)(n.p,{children:["Das Token ist als ",(0,r.jsx)(n.a,{href:"https://auth.wiki/jws",children:"JWS"})," Token verschl\xfcsselt und signiert."]}),"\n",(0,r.jsx)(n.p,{children:"Die Validierungsschritte:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc7519#section-7.2",children:"Validierung eines JWT"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc7515#section-5.2",children:"Validierung der JWS-Signatur"})}),"\n",(0,r.jsxs)(n.li,{children:["Der Aussteller des Tokens ist ",(0,r.jsx)(n.code,{children:"https://<your-logto-domain>/oidc"})," (ausgestellt von deinem Logto-Auth-Server)"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const express = require('express');\nconst jwksClient = require('jwks-rsa');\nconst jwt = require('jsonwebtoken');\n\nconst ISSUER = 'https://<your-logto-domain>/oidc';\nconst CERTS_URL = 'https://<your-logto-domain>/oidc/jwks';\n\nconst client = jwksClient({\n  jwksUri: CERTS_URL,\n});\n\nconst getKey = (header, callback) => {\n  client.getSigningKey(header.kid, function (err, key) {\n    callback(err, key?.getPublicKey());\n  });\n};\n\nconst verifyToken = (req, res, next) => {\n  const token = req.headers['Logto-ID-Token'];\n\n  // Stelle sicher, dass die eingehende Anfrage unseren Token-Header hat\n  if (!token) {\n    return res\n      .status(403)\n      .send({ status: false, message: 'fehlender erforderlicher Logto-ID-Token-Header' });\n  }\n\n  jwt.verify(token, getKey, { issuer: ISSUER }, (err, decoded) => {\n    if (err) {\n      return res.status(403).send({ status: false, message: 'ung\xfcltiges ID-Token' });\n    }\n\n    req.user = decoded;\n    next();\n  });\n};\n\nconst app = express();\n\napp.use(verifyToken);\n\napp.get('/', (req, res) => {\n  res.send('Hallo Welt!');\n});\n\napp.listen(3000);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"get-authentication-state-and-user-information",children:"Authentifizierungsstatus und Benutzerinformationen abrufen"}),"\n",(0,r.jsxs)(n.p,{children:["Wenn du Authentifizierungs- und Benutzerinformationen f\xfcr deine Anwendung ben\xf6tigst, kannst du auch den ",(0,r.jsx)(n.code,{children:"Logto-ID-Token"})," Header verwenden."]}),"\n",(0,r.jsx)(n.p,{children:"Wenn du das Token nur dekodieren m\xf6chtest, kannst du den folgenden Code verwenden:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const express = require('express');\n\nconst decodeIdToken = (req, res, next) => {\n  const token = req.headers['Logto-ID-Token'];\n\n  if (!token) {\n    return res.status(403).send({\n      status: false,\n      message: 'fehlender erforderlicher Logto-ID-Token-Header',\n    });\n  }\n\n  const parts = token.split('.');\n  if (parts.length !== 3) {\n    throw new Error('Ung\xfcltiges ID-Token');\n  }\n\n  const payload = parts[1];\n  const decodedPayload = atob(payload.replace(/-/g, '+').replace(/_/g, '/'));\n  const claims = JSON.parse(decodedPayload);\n\n  req.user = claims;\n  next();\n};\n\nconst app = express();\n\napp.use(decodeIdToken);\n\napp.get('/', (req, res) => {\n  res.json(req.user);\n});\n\napp.listen(3000);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"get-the-original-host",children:"Den urspr\xfcnglichen Host abrufen"}),"\n",(0,r.jsxs)(n.p,{children:["Wenn du den urspr\xfcnglichen Host abrufen musst, der vom Client angefordert wurde, kannst du den ",(0,r.jsx)(n.code,{children:"Logto-Host"})," oder ",(0,r.jsx)(n.code,{children:"x-forwarded-host"})," Header verwenden."]}),"\n",(0,r.jsx)(n.h2,{id:"customize-authentication-rules",children:"Authentifizierungsregeln anpassen"}),"\n",(0,r.jsx)(n.p,{children:'Standardm\xe4\xdfig sch\xfctzt die Gesch\xfctzte App alle Routen. Wenn du die Authentifizierungsregeln anpassen musst, kannst du das Feld "Benutzerdefinierte Authentifizierungsregeln" in der Konsole festlegen.'}),"\n",(0,r.jsx)(n.p,{children:"Es unterst\xfctzt regul\xe4re Ausdr\xfccke, hier sind zwei Fallbeispiele:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Um nur die Routen ",(0,r.jsx)(n.code,{children:"/admin"})," und ",(0,r.jsx)(n.code,{children:"/privacy"})," mit Authentifizierung zu sch\xfctzen: ",(0,r.jsx)(n.code,{children:"^/(admin|privacy)/.*"})]}),"\n",(0,r.jsxs)(n.li,{children:["Um JPG-Bilder von der Authentifizierung auszuschlie\xdfen: ",(0,r.jsx)(n.code,{children:"^(?!.*\\.jpg$).*$"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"local-development",children:"Lokale Entwicklung"}),"\n",(0,r.jsxs)(n.p,{children:["Die Gesch\xfctzte App ist darauf ausgelegt, mit deinem Ursprungsserver zu arbeiten. Wenn dein Ursprungsserver jedoch nicht \xf6ffentlich zug\xe4nglich ist, kannst du ein Tool wie ",(0,r.jsx)(n.a,{href:"https://ngrok.com/",children:"ngrok"})," oder ",(0,r.jsx)(n.a,{href:"https://developers.cloudflare.com/pages/how-to/preview-with-cloudflare-tunnel/",children:"Cloudflare Tunnels"})," verwenden, um deinen lokalen Server im Internet verf\xfcgbar zu machen."]}),"\n",(0,r.jsx)(n.h2,{id:"transition-to-sdk-integration",children:"\xdcbergang zur SDK-Integration"}),"\n",(0,r.jsxs)(n.p,{children:["Die Gesch\xfctzte App ist darauf ausgelegt, den Authentifizierungsprozess zu vereinfachen. Wenn du jedoch zur SDK-Integration wechseln m\xf6chtest, um mehr Kontrolle und Anpassungsm\xf6glichkeiten zu haben, kannst du ",(0,r.jsx)(n.a,{href:"/integrate-logto/integrate-logto-into-your-application",children:"eine neue Anwendung erstellen"})," in Logto und die ",(0,r.jsx)(n.a,{href:"/quick-starts",children:"SDK-Integration"}),' konfigurieren. F\xfcr einen reibungslosen \xdcbergang kannst du die Anwendungskonfigurationen aus der Gesch\xfctzten App wiederverwenden. Die Gesch\xfctzte App ist tats\xe4chlich eine "Traditionelle Web-App" in Logto, du kannst die "',(0,r.jsx)(n.a,{href:"/integrate-logto/application-data-structure#application-id",children:"AppId"}),'" und "',(0,r.jsx)(n.a,{href:"/integrate-logto/application-data-structure#application-secret",children:"AppSecret"}),'" in den Anwendungseinstellungen finden. Nach Abschluss des \xdcbergangs kannst du die Gesch\xfctzte App aus deiner Anwendung entfernen.']}),"\n",(0,r.jsx)(n.h2,{id:"related-resources",children:"Verwandte Ressourcen"}),"\n",(0,r.jsx)(t,{href:"https://www.youtube.com/watch?v=ZBrXW3iZyKY",children:(0,r.jsx)(n.p,{children:"Gesch\xfctzte App: Baue die Authentifizierung deiner App in wenigen Klicks. Kein Code erforderlich."})}),"\n",(0,r.jsx)(t,{href:"https://blog.logto.io/protected-app",children:"Die Motivation hinter der Gesch\xfctzten App"}),"\n",(0,r.jsx)(t,{href:"https://blog.logto.io/fastest-way-to-build-auth-system",children:(0,r.jsx)(n.p,{children:"Der schnellste Weg, ein Authentifizierungssystem zu erstellen"})})]})}function c(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},79621:(e,n,t)=>{t.d(n,{R:()=>d,x:()=>o});var i=t(58101);const r={},s=i.createContext(r);function d(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);