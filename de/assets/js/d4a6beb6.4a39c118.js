"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[3069],{48484:(e,n,i)=>{i.d(n,{Ay:()=>a,RM:()=>t});var r=i(25105),s=i(79621);const t=[];function o(e){const n={admonition:"admonition",code:"code",p:"p",...(0,s.R)(),...e.components};return(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["\xdcberpr\xfcfe den ",(0,r.jsx)(n.code,{children:"organizations"}),"-Anspruch im ID-Token, um eine Liste der Organisations-IDs zu erhalten, denen der Benutzer angeh\xf6rt. Dieser Anspruch listet alle Organisationen auf, bei denen der Benutzer Mitglied ist, was es einfach macht, Organisationen in deiner App aufzulisten oder zu wechseln."]})})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},54183:(e,n,i)=>{i.d(n,{Ay:()=>a,RM:()=>t});var r=i(25105),s=i(79621);const t=[];function o(e){const n={admonition:"admonition",p:"p",...(0,s.R)(),...e.components};return(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:"Derzeit unterst\xfctzt Logto nicht das direkte Abrufen von Organisationstoken (Organization token) aus dem Autorisierungscode-Flow. Du musst den Auffrischungstoken-Flow (Refresh token) verwenden, um ein Organisationstoken (Organization token) zu erhalten."})})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},67833:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>f,contentTitle:()=>m,default:()=>k,frontMatter:()=>p,metadata:()=>r,resource:()=>x,toc:()=>j});const r=JSON.parse('{"id":"authorization/organization-level-api-resources","title":"Organisationsebene API-Ressourcen sch\xfctzen","description":"Kombiniere API-Ressourcen mit der Organisationstemplate, um den Zugriff auf APIs und Daten innerhalb jeder Organisation zu beschr\xe4nken und so eine Mandantenisolation in deinem SaaS sicherzustellen.","source":"@site/i18n/de/docusaurus-plugin-content-docs/current/authorization/organization-level-api-resources.mdx","sourceDirName":"authorization","slug":"/authorization/organization-level-api-resources","permalink":"/de/authorization/organization-level-api-resources","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/de/docusaurus-plugin-content-docs/current/authorization/organization-level-api-resources.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"docsSidebar","previous":{"title":"Organisation (Nicht-API) Berechtigungen sch\xfctzen","permalink":"/de/authorization/organization-permissions"},"next":{"title":"Zugangstokens in API validieren","permalink":"/de/authorization/validate-access-tokens/"}}');var s=i(25105),t=i(79621),o=i(1242),a=i(39088),l=i(78506),d=i(42372),c=i(38552),u=i(22002),h=i(48484),g=i(54183);const p={sidebar_position:5},m="Organisationsebene API-Ressourcen sch\xfctzen",f={},x="https://api.your-app.com/organizations",j=[{value:"Was sind API-Ressourcen auf Organisationsebene?",id:"what-are-organization-level-api-resources",level:2},{value:"So funktioniert es in Logto",id:"how-it-works-in-logto",level:2},{value:"\xdcberblick \xfcber die Implementierung",id:"implementation-overview",level:3},{value:"Wie Logto Organisation RBAC anwendet",id:"how-logto-applies-organization-rbac",level:3},{value:"Autorisierungsablauf: Authentifizierung und Absicherung von APIs mit Organisationskontext",id:"authorization-flow-authenticating-and-securing-apis-with-organization-context",level:3},{value:"Implementierungsschritte",id:"implementation-steps",level:2},{value:"Registriere deine API-Ressource",id:"register-your-api-resource",level:3},{value:"Organisationsrollen einrichten",id:"set-up-organization-roles",level:3},{value:"Organisationstokens f\xfcr API-Ressourcen erhalten",id:"obtain-organization-tokens-for-api-resources",level:3},{value:"Auffrischungstoken-Flow",id:"refresh-token-flow",level:4},...h.RM,...g.RM,...h.RM,{value:"Client-Credentials-Flow",id:"client-credentials-flow",level:4},{value:"Organisationstokens validieren",id:"validate-organization-tokens",level:3},{value:"Best Practices und Sicherheitstipps",id:"best-practices-and-security-tips",level:2},{value:"FAQs",id:"faqs",level:2},{value:"Was passiert, wenn ich <code>organization_id</code> nicht in meiner Token-Anfrage angebe?",id:"what-if-i-don-t-include-organization-id-in-my-token-request",level:3},{value:"Kann ich Organisations- und Nicht-Organisationsberechtigungen in einer Rolle mischen?",id:"can-i-mix-organization-and-non-organization-permissions-in-a-single-role",level:3},{value:"Weiterf\xfchrende Literatur",id:"further-reading",level:2}];function b(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,t.R)(),...e.components},{CloudLink:i,Details:r,Url:p}=n;return i||z("CloudLink",!0),r||z("Details",!0),p||z("Url",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"organisationsebene-api-ressourcen-sch\xfctzen",children:"Organisationsebene API-Ressourcen sch\xfctzen"})}),"\n","\n",(0,s.jsx)(n.p,{children:"Kombiniere API-Ressourcen mit der Organisationstemplate, um den Zugriff auf APIs und Daten innerhalb jeder Organisation zu beschr\xe4nken und so eine Mandantenisolation in deinem SaaS sicherzustellen."}),"\n",(0,s.jsx)(n.h2,{id:"what-are-organization-level-api-resources",children:"Was sind API-Ressourcen auf Organisationsebene?"}),"\n",(0,s.jsxs)(n.p,{children:["API-Ressourcen auf Organisationsebene sind Endpunkte oder Dienste in deiner Anwendung, die ",(0,s.jsx)(n.strong,{children:"auf eine bestimmte Organisation beschr\xe4nkt"})," sind. Diese APIs erzwingen Autorisierung und Zugriff basierend auf dem Organisationskontext \u2013 so wird sichergestellt, dass Benutzer oder Clients nur auf Daten und Aktionen zugreifen, die f\xfcr ihre Organisation relevant sind."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Anwendungsf\xe4lle umfassen"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["APIs zur Verwaltung von Organisationsmitgliedern, Rollen oder Einstellungen (z. B. ",(0,s.jsx)(n.code,{children:"/organizations/{organizationId}/members"}),")"]}),"\n",(0,s.jsx)(n.li,{children:"Organisationsbezogene Dashboards, Analysen oder Berichte"}),"\n",(0,s.jsx)(n.li,{children:"Abrechnungs-, Abonnement- oder Audit-Endpunkte, die an eine Organisation gebunden sind"}),"\n",(0,s.jsx)(n.li,{children:"Jede API, bei der Aktionen und Daten pro Mandant isoliert sind"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Logto erm\xf6glicht es dir, diese Organisations-APIs mit OAuth 2.1 und rollenbasierter Zugangskontrolle (RBAC) abzusichern und unterst\xfctzt dabei Multi-Tenant-SaaS-Architekturen."}),"\n",(0,s.jsxs)(n.p,{children:["Diese Berechtigungen werden \xfcber ",(0,s.jsx)(n.strong,{children:"Organisationsrollen"})," verwaltet, die in der ",(0,s.jsx)(n.a,{href:"/authorization/organization-template",children:"Organisationstemplate"})," definiert sind. Jede Organisation verwendet die gleiche Vorlage, was ein konsistentes Berechtigungsmodell \xfcber alle Organisationen hinweg gew\xe4hrleistet."]}),"\n",(0,s.jsx)(n.h2,{id:"how-it-works-in-logto",children:"So funktioniert es in Logto"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"API-Ressourcen und Berechtigungen werden global registriert:"})," Jede API-Ressource wird mit einem eindeutigen Ressourcenindikator (URI) und einem Satz von Berechtigungen (Scopes) in Logto definiert."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Rollen auf Organisationsebene:"})," Organisationsrollen werden in der Organisationstemplate definiert. API-Ressourcenberechtigungen (Scopes) werden den Organisationsrollen zugewiesen, die dann Benutzern oder Clients ",(0,s.jsx)(n.strong,{children:"innerhalb jeder Organisation"})," zugewiesen werden."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Kontextbewusste Autorisierung:"})," Wenn ein Client ein Zugangstoken mit sowohl einer API-Ressource als auch einer ",(0,s.jsx)(n.code,{children:"organization_id"})," anfordert, stellt Logto ein Token aus, das sowohl den Organisationskontext als auch die API-Zielgruppe enth\xe4lt. Die Berechtigungen (Scopes) des Tokens werden durch die Organisationsrollen des Benutzers f\xfcr die angegebene Organisation bestimmt."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Trennung von globalen Ressourcen:"})," API-Ressourcen k\xf6nnen mit oder ohne Organisationskontext aufgerufen werden. Organisation RBAC wird nur angewendet, wenn eine ",(0,s.jsx)(n.code,{children:"organization_id"})," in der Anfrage enthalten ist. F\xfcr APIs, die f\xfcr alle Benutzer freigegeben sind, siehe ",(0,s.jsx)(n.a,{href:"/authorization/global-api-resources",children:"Globale API-Ressourcen sch\xfctzen"}),"."]}),"\n"]}),"\n",(0,s.jsx)("img",{src:o.A,alt:"Organisationsebene API-Ressourcen RBAC",style:{maxWidth:"100%"}}),"\n",(0,s.jsx)(n.h3,{id:"implementation-overview",children:"\xdcberblick \xfcber die Implementierung"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Registriere deine API-Ressource"})," und definiere deren Berechtigungen (Scopes) in Logto."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Definiere Organisationsrollen"})," in der Organisationstemplate und weise relevante API-Berechtigungen zu."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Weise Rollen"})," Benutzern oder Clients innerhalb jeder Organisation zu."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Fordere ein Zugangstoken"})," f\xfcr die API mit einer ",(0,s.jsx)(n.code,{children:"organization_id"})," an, um den Organisationskontext einzubeziehen."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Validiere Zugangstokens"})," in deiner API und erzwinge sowohl Organisationskontext als auch Berechtigungen."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"how-logto-applies-organization-rbac",children:"Wie Logto Organisation RBAC anwendet"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Wenn du ein Zugangstoken ",(0,s.jsx)(n.strong,{children:"ohne"})," eine ",(0,s.jsx)(n.code,{children:"organization_id"})," anforderst, werden nur globale Rollen / Berechtigungen ber\xfccksichtigt."]}),"\n",(0,s.jsxs)(n.li,{children:["Wenn du ein Zugangstoken ",(0,s.jsx)(n.strong,{children:"mit"})," einer ",(0,s.jsx)(n.code,{children:"organization_id"})," anforderst, bewertet Logto die Organisationsrollen des Benutzers und deren zugeh\xf6rige Berechtigungen f\xfcr diese Organisation."]}),"\n",(0,s.jsxs)(n.li,{children:["Das resultierende JWT enth\xe4lt sowohl die API-Zielgruppe (",(0,s.jsx)(n.code,{children:"aud"})," Anspruch) als auch den Organisationskontext (",(0,s.jsx)(n.code,{children:"organization_id"})," Anspruch), wobei die Scopes auf diejenigen gefiltert werden, die durch die Organisationsrollen des Benutzers gew\xe4hrt werden."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"authorization-flow-authenticating-and-securing-apis-with-organization-context",children:"Autorisierungsablauf: Authentifizierung und Absicherung von APIs mit Organisationskontext"}),"\n",(0,s.jsx)(n.p,{children:"Der folgende Ablauf zeigt, wie ein Client (Web, Mobile oder Backend) Organisationstokens erh\xe4lt und verwendet, um auf API-Ressourcen auf Organisationsebene zuzugreifen."}),"\n",(0,s.jsx)(n.p,{children:"Beachte, dass der Ablauf keine vollst\xe4ndigen Details zu den erforderlichen Parametern oder Headern enth\xe4lt, sondern sich auf die wichtigsten Schritte konzentriert. Lies weiter, um zu sehen, wie der Ablauf in der Praxis funktioniert."}),"\n",(0,s.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Client\n    participant Logto\n    participant API as API-Ressource\n\n    alt Benutzer-Authentifizierung\n        Client->>Logto: GET /oidc/auth\n        Logto->>Logto: Leitet Benutzer zur Anmeldeseite weiter\n        Logto->>Client: Leitet zur\xfcck mit `authorization_code`\n        Client->>Logto: POST /oidc/token mit `grant_type=authorization_code`\n        Logto->>Client: Gibt Auffrischungstoken zur\xfcck\n        Client->>Logto: POST /oidc/token mit `grant_type=refresh_token`<br/>+ resource + organization_id\n    else Maschine-zu-Maschine (M2M) Client-Authentifizierung\n        Client->>Logto: POST /oidc/token mit `grant_type=client_credentials`<br/>+ resource + organization_id\n    end\n\n    Logto->>Client: Gibt Zugangstoken (JWT) zur\xfcck\n    Client->>API: Anfrage mit Bearer-Token\n    API->>API: Validiert Token, pr\xfcft Organisationskontext und Berechtigungen\n\n    alt Token ist g\xfcltig\n      API->>Client: Gibt Organisationsdaten zur\xfcck\n    else Token ist ung\xfcltig\n      API->>Client: 401 Nicht autorisiert\n    end"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Benutzer-Authentifizierung = Browser / App. M2M = Backend-Service oder Skript mit Client-Credentials + Organisationskontext."})}),"\n",(0,s.jsx)(n.h2,{id:"implementation-steps",children:"Implementierungsschritte"}),"\n",(0,s.jsx)(n.h3,{id:"register-your-api-resource",children:"Registriere deine API-Ressource"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Gehe zu ",(0,s.jsx)(i,{to:"/api-resources",children:"Konsole \u2192 API-Ressourcen"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Erstelle eine neue API-Ressource (z. B. ",(0,s.jsx)(n.code,{children:"https://api.yourapp.com/org"}),") und definiere deren Berechtigungen (Scopes)."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["F\xfcr vollst\xe4ndige Konfigurationsschritte siehe ",(0,s.jsx)(n.a,{href:"/authorization/role-based-access-control#define-api-resources-with-permissions",children:"API-Ressourcen mit Berechtigungen definieren"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"set-up-organization-roles",children:"Organisationsrollen einrichten"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Gehe zu ",(0,s.jsx)(i,{to:"/organization-template/organization-roles",children:"Konsole \u2192 Organisationstemplate \u2192 Organisationsrollen"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Erstelle Organisationsrollen (z. B. ",(0,s.jsx)(n.code,{children:"admin"}),", ",(0,s.jsx)(n.code,{children:"member"}),") und weise jeder Rolle API-Berechtigungen zu."]}),"\n",(0,s.jsx)(n.li,{children:"Weise Rollen Benutzern oder Clients innerhalb jeder Organisation zu. Falls sie noch keine Mitglieder sind, lade sie zuerst ein oder f\xfcge sie hinzu."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["F\xfcr vollst\xe4ndige Konfigurationsschritte siehe ",(0,s.jsx)(n.a,{href:"/authorization/role-based-access-control#configure-organization-roles",children:"Organisationsrollen verwenden"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"obtain-organization-tokens-for-api-resources",children:"Organisationstokens f\xfcr API-Ressourcen erhalten"}),"\n",(0,s.jsxs)(n.p,{children:["Dein Client / deine App sollte ein Token mit sowohl ",(0,s.jsx)(n.code,{children:"resource"})," als auch ",(0,s.jsx)(n.code,{children:"organization_id"})," anfordern, um auf APIs auf Organisationsebene zuzugreifen. Logto stellt Organisationstokens als ",(0,s.jsx)(n.a,{href:"https://auth.wiki/jwt",children:"JSON Web Tokens (JWTs)"})," aus. Du kannst diese entweder \xfcber den ",(0,s.jsx)(n.a,{href:"https://auth.wiki/refresh-token",children:"Auffrischungstoken-Flow"})," oder den ",(0,s.jsx)(n.a,{href:"https://auth.wiki/client-credentials-flow",children:"Client-Credentials-Flow"})," erhalten."]}),"\n",(0,s.jsx)(n.h4,{id:"refresh-token-flow",children:"Auffrischungstoken-Flow"}),"\n",(0,s.jsx)(n.p,{children:"Fast alle offiziellen Logto SDKs unterst\xfctzen das Abrufen von Organisationstokens \xfcber den Auffrischungstoken-Flow direkt. Eine Standard-OAuth 2.0 / OIDC-Clientbibliothek kann ebenfalls verwendet werden, um diesen Flow zu implementieren."}),"\n",(0,s.jsxs)(u.A,{groupId:"user-client",children:[(0,s.jsxs)(c.A,{value:"logto-sdk",label:"Logto SDK",children:[(0,s.jsxs)(n.p,{children:["Beim Initialisieren des Logto SDK f\xfcge ",(0,s.jsx)(n.code,{children:"urn:logto:scope:organizations"})," und die gew\xfcnschten Organisationsberechtigungen (Scopes) zum ",(0,s.jsx)(n.code,{children:"scopes"}),"-Parameter hinzu."]}),(0,s.jsxs)(n.p,{children:["Einige Logto SDKs haben einen vordefinierten Scope f\xfcr Organisationen, wie z. B. ",(0,s.jsx)(n.code,{children:"UserScope.Organizations"})," in JavaScript SDKs."]}),(0,s.jsx)(h.Ay,{}),(0,s.jsxs)(n.p,{children:["Beim Aufruf von ",(0,s.jsx)(n.code,{children:"getAccessToken()"})," gib sowohl die API-Ressource (",(0,s.jsx)(n.code,{children:"resource"}),") als auch die Organisations-ID (",(0,s.jsx)(n.code,{children:"organizationId"}),") an, um ein Organisationstoken zu erhalten."]}),(0,s.jsxs)(n.p,{children:["F\xfcr Details zu jedem SDK siehe ",(0,s.jsx)(n.a,{href:"/quick-starts",children:"Quick starts"}),"."]})]}),(0,s.jsxs)(c.A,{value:"oauth-client",label:"OAuth 2.0 / OIDC Client-Bibliothek",children:[(0,s.jsx)(n.p,{children:"Beim Konfigurieren deines OAuth 2.0 Clients oder beim Initialisieren des Authorization-Code-Flows stelle sicher, dass du folgende Parameter einschlie\xdft:"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"resource"}),": Setze dies auf den in Logto registrierten API-Ressourcenbezeichner (z. B. ",(0,s.jsx)(n.code,{children:"https://api.your-app.com/organizations"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"scope"}),": F\xfcge den vordefinierten Organisationsscope (",(0,s.jsx)(n.code,{children:"urn:logto:scope:organizations"}),"), ",(0,s.jsx)(n.code,{children:"offline_access"})," (um Auffrischungstokens zu erhalten) und alle spezifischen API-Berechtigungen hinzu, die du ben\xf6tigst (z. B. ",(0,s.jsx)(n.code,{children:"manage:members view:analytics"}),")."]}),"\n"]}),(0,s.jsxs)(n.p,{children:["Einige Bibliotheken unterst\xfctzen den ",(0,s.jsx)(n.code,{children:"resource"}),"-Parameter nicht nativ, erlauben aber in der Regel das \xdcbergeben zus\xe4tzlicher Parameter in der Autorisierungsanfrage. Pr\xfcfe die Dokumentation deiner Bibliothek f\xfcr Details."]}),(0,s.jsx)(n.p,{children:"Hier ist ein nicht-normatives Beispiel, wie die Autorisierungsanfrage aussehen k\xf6nnte:"}),(0,s.jsx)(a.A,{resource:x,scope:"urn:logto:scope:organizations invite:member manage:billing"}),(0,s.jsxs)(n.p,{children:["Sobald der Benutzer authentifiziert ist, erh\xe4ltst du einen Authorization-Code. Verwende diesen Code, indem du eine POST-Anfrage an Logtos ",(0,s.jsx)(n.code,{children:"/oidc/token"}),"-Endpunkt stellst."]}),(0,s.jsx)(n.p,{children:"Hier ist ein nicht-normatives Beispiel f\xfcr die Token-Anfrage:"}),(0,s.jsx)(d.A,{grantType:"authorization_code"}),(0,s.jsx)(g.Ay,{}),(0,s.jsx)(n.p,{children:"Du erh\xe4ltst ein Auffrischungstoken, das verwendet werden kann, um Organisationstokens zu erhalten."}),(0,s.jsx)(h.Ay,{}),(0,s.jsxs)(n.p,{children:["Verwende schlie\xdflich das Auffrischungstoken, um ein Organisationstoken zu erhalten, indem du eine POST-Anfrage an Logtos ",(0,s.jsx)(n.code,{children:"/oidc/token"}),"-Endpunkt stellst. Denke daran, Folgendes einzuschlie\xdfen:"]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Den ",(0,s.jsx)(n.code,{children:"resource"}),"-Parameter, gesetzt auf den API-Ressourcenbezeichner (z. B. ",(0,s.jsx)(n.code,{children:"https://api.yourapp.com/org"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:["Den ",(0,s.jsx)(n.code,{children:"organization_id"}),"-Parameter, gesetzt auf die gew\xfcnschte Organisations-ID."]}),"\n",(0,s.jsxs)(n.li,{children:["(Optional) Den ",(0,s.jsx)(n.code,{children:"scope"}),"-Parameter, um die ben\xf6tigten Berechtigungen weiter einzuschr\xe4nken (z. B. ",(0,s.jsx)(n.code,{children:"manage:members view:reports"}),")."]}),"\n"]}),(0,s.jsx)(n.p,{children:"Hier ist ein nicht-normatives Beispiel, wie die Token-Anfrage aussehen k\xf6nnte:"}),(0,s.jsx)(d.A,{grantType:"refresh_token",resource:x,organizationId:"your-organization-id"})]})]}),"\n",(0,s.jsx)(n.h4,{id:"client-credentials-flow",children:"Client-Credentials-Flow"}),"\n",(0,s.jsxs)(n.p,{children:["F\xfcr Maschine-zu-Maschine (M2M)-Szenarien kannst du den Client-Credentials-Flow verwenden, um ein Zugangstoken f\xfcr API-Ressourcenberechtigungen auf Organisationsebene zu erhalten. Durch eine POST-Anfrage an Logtos ",(0,s.jsx)(n.code,{children:"/oidc/token"}),"-Endpunkt mit Organisationsparametern kannst du ein Organisationstoken mit deiner Client-ID und deinem Secret anfordern."]}),"\n",(0,s.jsx)(n.p,{children:"Hier sind die wichtigsten Parameter, die in der Anfrage enthalten sein sollten:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"resource"}),": Der API-Ressourcenbezeichner (z. B. ",(0,s.jsx)(n.code,{children:"https://api.yourapp.com/org"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"organization_id"}),": Die ID der Organisation, f\xfcr die du das Token m\xf6chtest."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"scope"}),": Die API-Ressourcenberechtigungen auf Organisationsebene, die du anfordern m\xf6chtest (z. B. ",(0,s.jsx)(n.code,{children:"invite:member"}),", ",(0,s.jsx)(n.code,{children:"manage:billing"}),")."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Hier ist ein nicht-normatives Beispiel f\xfcr die Token-Anfrage mit dem Client-Credentials-Grant-Typ:"}),"\n",(0,s.jsx)(l.A,{resource:"https://api.yourapp.com/org",organizationId:"your-organization-id",scope:"invite:member manage:billing"}),"\n",(0,s.jsx)(n.h3,{id:"validate-organization-tokens",children:"Organisationstokens validieren"}),"\n",(0,s.jsx)(n.p,{children:"Von Logto ausgestellte Organisationstokens (JWTs) enthalten Anspr\xfcche, die deine API zur Durchsetzung der Zugangskontrolle auf Organisationsebene verwenden kann."}),"\n",(0,s.jsx)(n.p,{children:"Wenn deine App ein Organisationstoken erh\xe4lt, solltest du:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Die Signatur des Tokens \xfcberpr\xfcfen (mit Logtos JWKs)."}),"\n",(0,s.jsxs)(n.li,{children:["Best\xe4tigen, dass das Token nicht abgelaufen ist (",(0,s.jsx)(n.code,{children:"exp"})," Anspruch)."]}),"\n",(0,s.jsxs)(n.li,{children:["Pr\xfcfen, dass der ",(0,s.jsx)(n.code,{children:"iss"})," (Aussteller) mit deinem Logto-Endpunkt \xfcbereinstimmt."]}),"\n",(0,s.jsxs)(n.li,{children:["Sicherstellen, dass der ",(0,s.jsx)(n.code,{children:"aud"})," (Zielgruppe) mit dem registrierten API-Ressourcenbezeichner \xfcbereinstimmt (z. B. ",(0,s.jsx)(n.code,{children:"https://api.yourapp.com/org"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:["Den ",(0,s.jsx)(n.code,{children:"organization_id"}),"-Anspruch validieren, um sicherzustellen, dass das Token auf die richtige Organisation beschr\xe4nkt ist."]}),"\n",(0,s.jsxs)(n.li,{children:["Den ",(0,s.jsx)(n.code,{children:"scope"}),"-Anspruch (durch Leerzeichen getrennt) aufteilen und auf erforderliche Berechtigungen pr\xfcfen."]}),"\n",(0,s.jsxs)(n.li,{children:["Wenn dein API-Pfad die Organisations-ID enth\xe4lt (z. B. ",(0,s.jsx)(n.code,{children:"/organizations/{organizationId}/members"}),"), stelle sicher, dass der ",(0,s.jsx)(n.code,{children:"organization_id"}),"-Anspruch mit dem Pfadparameter \xfcbereinstimmt."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["F\xfcr Schritt-f\xfcr-Schritt- und sprachspezifische Anleitungen siehe ",(0,s.jsx)(n.a,{href:"/authorization/validate-access-tokens",children:"Wie man Zugangstokens validiert"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"best-practices-and-security-tips",children:"Best Practices und Sicherheitstipps"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Validiere immer den Organisationskontext:"})," Vertraue nicht nur dem Token; pr\xfcfe den ",(0,s.jsx)(n.code,{children:"organization_id"}),"-Anspruch bei jedem organisationsbezogenen API-Aufruf."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Verwende Zielgruppenbeschr\xe4nkungen:"})," Pr\xfcfe immer den ",(0,s.jsx)(n.code,{children:"aud"}),"-Anspruch, um sicherzustellen, dass das Token f\xfcr die beabsichtigte Organisation bestimmt ist."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Halte Berechtigungen gesch\xe4ftsgetrieben:"})," Verwende klare Namen, die echten Aktionen entsprechen; gew\xe4hre nur das, was f\xfcr jede Organisationsrolle ben\xf6tigt wird."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Trenne API- und Nicht-API-Berechtigungen"}),", wo m\xf6glich (aber beide k\xf6nnen in einer Rolle enthalten sein)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Halte Token-Lebensdauern kurz:"})," Reduziert das Risiko, falls ein Token kompromittiert wird."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"\xdcberpr\xfcfe regelm\xe4\xdfig deine Organisationstemplate:"})," Aktualisiere Rollen und Berechtigungen, w\xe4hrend sich dein Produkt weiterentwickelt."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"faqs",children:"FAQs"}),"\n",(0,s.jsxs)(r,{children:[(0,s.jsx)("summary",{children:(0,s.jsxs)(n.h3,{id:"what-if-i-don-t-include-organization-id-in-my-token-request",children:["Was passiert, wenn ich ",(0,s.jsx)(n.code,{children:"organization_id"})," nicht in meiner Token-Anfrage angebe?"]})}),(0,s.jsx)(n.p,{children:"Es werden nur globale Rollen / Berechtigungen ausgewertet. Organisation RBAC wird nicht angewendet."})]}),"\n",(0,s.jsxs)(r,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)(n.h3,{id:"can-i-mix-organization-and-non-organization-permissions-in-a-single-role",children:"Kann ich Organisations- und Nicht-Organisationsberechtigungen in einer Rolle mischen?"})}),(0,s.jsx)(n.p,{children:"Nein, Organisationsberechtigungen (einschlie\xdflich API-Berechtigungen auf Organisationsebene) werden durch die Organisationstemplate definiert und k\xf6nnen nicht mit globalen API-Berechtigungen gemischt werden. Du kannst jedoch Rollen erstellen, die sowohl Organisationsberechtigungen als auch API-Berechtigungen auf Organisationsebene enthalten."})]}),"\n",(0,s.jsx)(n.h2,{id:"further-reading",children:"Weiterf\xfchrende Literatur"}),"\n",(0,s.jsx)(p,{href:"/authorization/validate-access-tokens",children:"Wie man Zugangstokens validiert"}),"\n",(0,s.jsx)(p,{href:"/developers/custom-token-claims",children:"Token-Anspr\xfcche anpassen"}),"\n",(0,s.jsx)(p,{href:"/use-cases/multi-tenancy/build-multi-tenant-saas-application",children:(0,s.jsx)(n.p,{children:"Anwendungsfall: Multi-Tenant-SaaS-Anwendung bauen"})}),"\n",(0,s.jsx)(p,{href:"https://www.rfc-editor.org/rfc/rfc8707.html",children:"RFC 8707: Ressourcenindikatoren"})]})}function k(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(b,{...e})}):b(e)}function z(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},39088:(e,n,i)=>{i.d(n,{A:()=>t});var r=i(80173),s=i(25105);const t=e=>{let{resource:n,scope:i}=e;return(0,s.jsx)(r.A,{language:"http",children:`GET /oidc/auth?response_type=code\n&client_id=your-client-id\n&redirect_uri=https://your-app.com/callback\n&scope=openid profile offline_access ${i}\n&resource=${n}\n&code_challenge=abc123\n&code_challenge_method=S256\n&state=xyz\nHTTP/1.1\nHost: your.logto.endpoint\n`})}},78506:(e,n,i)=>{i.d(n,{A:()=>t});var r=i(80173),s=i(25105);const t=e=>{let{resource:n,organizationId:i,scope:t}=e;return(0,s.jsxs)(r.A,{language:"http",children:["POST /oidc/token HTTP/1.1\nHost: your.logto.endpoint\nContent-Type: application/x-www-form-urlencoded\nAuthorization: Basic base64(client_id:client_secret)\n\ngrant_type=client_credentials\n",n&&`&resource=${n}\n`,i&&`&organization_id=${i}\n`,`&scope=${t}\n`]})}},42372:(e,n,i)=>{i.d(n,{A:()=>t});var r=i(80173),s=i(25105);const t=e=>{let{grantType:n,resource:i,organizationId:t}=e;const o=[`grant_type=${n}`,"authorization_code"===n&&"code=authorization-code-received","authorization_code"===n&&"redirect_uri=https://your-app.com/callback","refresh_token"===n&&"refresh_token=your-refresh-token",i&&`resource=${i}`,t&&`organization_id=${t}`].filter(Boolean);return(0,s.jsx)(r.A,{language:"http",children:`POST /oidc/token HTTP/1.1\nHost: your.logto.endpoint\nContent-Type: application/x-www-form-urlencoded\nAuthorization: Basic base64(client_id:client_secret)\n\n${o.join("\n&")}`})}},38552:(e,n,i)=>{i.d(n,{A:()=>o});i(58101);var r=i(13526);const s={tabItem:"tabItem_dgSZ"};var t=i(25105);function o(e){let{children:n,hidden:i,className:o}=e;return(0,t.jsx)("div",{role:"tabpanel",className:(0,r.A)(s.tabItem,o),hidden:i,children:n})}},22002:(e,n,i)=>{i.d(n,{A:()=>A});var r=i(58101),s=i(13526),t=i(60755),o=i(55234),a=i(6635),l=i(4100),d=i(35661),c=i(42752);function u(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:i}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:i,attributes:r,default:s}}=e;return{value:n,label:i,attributes:r,default:s}}))}(i);return function(e){const n=(0,d.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,i])}function g(e){let{value:n,tabValues:i}=e;return i.some((e=>e.value===n))}function p(e){let{queryString:n=!1,groupId:i}=e;const s=(0,o.W6)(),t=function(e){let{queryString:n=!1,groupId:i}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!i)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return i??null}({queryString:n,groupId:i});return[(0,l.aZ)(t),(0,r.useCallback)((e=>{if(!t)return;const n=new URLSearchParams(s.location.search);n.set(t,e),s.replace({...s.location,search:n.toString()})}),[t,s])]}function m(e){const{defaultValue:n,queryString:i=!1,groupId:s}=e,t=h(e),[o,l]=(0,r.useState)((()=>function(e){let{defaultValue:n,tabValues:i}=e;if(0===i.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!g({value:n,tabValues:i}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${i.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const r=i.find((e=>e.default))??i[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:t}))),[d,u]=p({queryString:i,groupId:s}),[m,f]=function(e){let{groupId:n}=e;const i=function(e){return e?`docusaurus.tab.${e}`:null}(n),[s,t]=(0,c.Dv)(i);return[s,(0,r.useCallback)((e=>{i&&t.set(e)}),[i,t])]}({groupId:s}),x=(()=>{const e=d??m;return g({value:e,tabValues:t})?e:null})();(0,a.A)((()=>{x&&l(x)}),[x]);return{selectedValue:o,selectValue:(0,r.useCallback)((e=>{if(!g({value:e,tabValues:t}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),f(e)}),[u,f,t]),tabValues:t}}var f=i(21929);const x={tabList:"tabList_osvQ",tabItem:"tabItem_dc4O"};var j=i(25105);function b(e){let{className:n,block:i,selectedValue:r,selectValue:o,tabValues:a}=e;const l=[],{blockElementScrollPositionUntilNextRender:d}=(0,t.a_)(),c=e=>{const n=e.currentTarget,i=l.indexOf(n),s=a[i].value;s!==r&&(d(n),o(s))},u=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const i=l.indexOf(e.currentTarget)+1;n=l[i]??l[0];break}case"ArrowLeft":{const i=l.indexOf(e.currentTarget)-1;n=l[i]??l[l.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":i},n),children:a.map((e=>{let{value:n,label:i,attributes:t}=e;return(0,j.jsx)("li",{role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:e=>{l.push(e)},onKeyDown:u,onClick:c,...t,className:(0,s.A)("tabs__item",x.tabItem,t?.className,{"tabs__item--active":r===n}),children:i??n},n)}))})}function k(e){let{lazy:n,children:i,selectedValue:t}=e;const o=(Array.isArray(i)?i:[i]).filter(Boolean);if(n){const e=o.find((e=>e.props.value===t));return e?(0,r.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:o.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==t})))})}function z(e){const n=m(e);return(0,j.jsxs)("div",{className:(0,s.A)("tabs-container",x.tabList),children:[(0,j.jsx)(b,{...n,...e}),(0,j.jsx)(k,{...n,...e})]})}function A(e){const n=(0,f.A)();return(0,j.jsx)(z,{...e,children:u(e.children)},String(n))}},55138:(e,n,i)=>{i.d(n,{A:()=>m});var r=i(28259),s=i(6097),t=i(58574),o=i(9484),a=i(76566),l=i(26346),d=i(17867),c=i(17510),u=i(13526),h=i(72355);const g={codeBlockContent:"codeBlockContent_m3Ux",codeBlockTitle:"codeBlockTitle_P25_",codeBlock:"codeBlock_qGQc",codeBlockStandalone:"codeBlockStandalone_zC50",codeBlockLines:"codeBlockLines_p187",codeBlockLinesWithNumbering:"codeBlockLinesWithNumbering_OFgW",buttonGroup:"buttonGroup_6DOT"};var p=i(25105);function m(e){let{children:n,className:i="",metastring:m,title:f,showLineNumbers:x,language:j}=e;const{prism:{defaultLanguage:b,magicComments:k}}=(0,r.p)(),z=function(e){return e?.toLowerCase()}(j??(0,t.Op)(i)??b),A=(0,s.A)(),w=(0,o.f)(),v=(0,t.wt)(m)||f,{lineClassNames:O,code:I}=(0,t.Li)(n,{metastring:m,language:z,magicComments:k}),B=x??(0,t._u)(m);return(0,p.jsxs)(a.A,{as:"div",className:(0,u.A)(i,z&&!i.includes(`language-${z}`)&&`language-${z}`),children:[v&&(0,p.jsx)("div",{className:g.codeBlockTitle,children:v}),(0,p.jsxs)("div",{className:g.codeBlockContent,children:[(0,p.jsx)(h.f4,{theme:A,code:I,language:z??"text",children:e=>{let{className:n,tokens:i,getLineProps:r,getTokenProps:s}=e;return(0,p.jsx)("pre",{ref:w.codeBlockRef,tabIndex:0,className:(0,u.A)(n,g.codeBlock,"thin-scrollbar"),children:(0,p.jsx)("code",{className:(0,u.A)(g.codeBlockLines,B&&g.codeBlockLinesWithNumbering),children:i.map(((e,n)=>(0,p.jsx)(d.A,{line:e,getLineProps:r,getTokenProps:s,classNames:O[n],showLineNumbers:B},n)))})})}}),(0,p.jsxs)("div",{className:g.buttonGroup,children:[(w.isEnabled||w.isCodeScrollable)&&(0,p.jsx)(c.A,{className:g.codeButton,isEnabled:w.isEnabled,onClick:()=>{w.toggle()}}),(0,p.jsx)(l.A,{className:g.codeButton,code:I})]})]})]})}},1242:(e,n,i)=>{i.d(n,{A:()=>r});const r=i.p+"assets/images/rbac-organization-level-api-resources-9533c281f3ee1cf52aefe821717e1fef.png"}}]);