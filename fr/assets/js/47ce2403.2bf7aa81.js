"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[1633],{86092:(e,n,r)=>{r.d(n,{Ay:()=>a,RM:()=>i});var t=r(25105),s=r(79621);const i=[];function o(e){const n={a:"a",li:"li",ol:"ol",p:"p",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Sous le capot, une application tierce n'est qu'un client OAuth 2.0 / OIDC standard. Cela signifie que vous (ou le d\xe9veloppeur tiers) pouvez utiliser n'importe quelle biblioth\xe8que ou framework OAuth 2.0 / OIDC pour int\xe9grer Logto."}),"\n",(0,t.jsx)(n.p,{children:"Si vous n'\xeates pas familier avec OAuth 2.0 ou OIDC, vous pouvez commencer par suivre l'un de nos guides de d\xe9marrage rapide \u201cWeb traditionnel\u201d."}),"\n",(0,t.jsx)(n.p,{children:"Quelques points \xe0 garder \xe0 l'esprit :"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Logto exige actuellement que les applications tierces soient des applications \u201cWeb traditionnel\u201d. En d'autres termes, l'application doit disposer d'un serveur backend (ou backend-for-frontend) pour stocker en toute s\xe9curit\xe9 le secret client."}),"\n",(0,t.jsx)(n.li,{children:"La plupart de nos guides de d\xe9marrage rapide sont r\xe9dig\xe9s pour des applications propri\xe9taires, mais vous pouvez tout de m\xeame les utiliser comme r\xe9f\xe9rence pour l'int\xe9gration d'applications tierces."}),"\n",(0,t.jsx)(n.li,{children:"La principale diff\xe9rence est que les applications tierces afficheront un \xe9cran de consentement (Consent screen), demandant aux utilisateurs une permission explicite pour acc\xe9der \xe0 leurs donn\xe9es."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Vous pouvez trouver plus d'informations dans nos ",(0,t.jsx)(n.a,{href:"/quick-starts",children:"guides de d\xe9marrage rapide"}),"."]})]})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},97011:(e,n,r)=>{r.d(n,{Ay:()=>l,RM:()=>o});var t=r(25105),s=r(79621),i=r(86092);const o=[{value:"Configurer un agent IA tiers dans Logto",id:"configure-third-party-ai-agent-in-logto",level:2},{value:"Autoriser les d\xe9veloppeurs \xe0 cr\xe9er des applications tierces dans Logto",id:"allow-developers-to-create-third-party-apps-in-logto",level:3},{value:"Cr\xe9er manuellement une application tierce dans Logto",id:"manually-create-a-third-party-app-in-logto",level:3},...i.RM];function a(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",strong:"strong",...(0,s.R)(),...e.components},{CloudLink:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("CloudLink",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"configure-third-party-ai-agent-in-logto",children:"Configurer un agent IA tiers dans Logto"}),"\n",(0,t.jsxs)(n.p,{children:["Pour permettre \xe0 l\u2019agent IA tiers d\u2019acc\xe9der \xe0 ",e.serviceName??"votre service",", vous devez configurer une ",(0,t.jsx)(n.strong,{children:"application tierce"})," dans Logto. Cette application sera utilis\xe9e pour repr\xe9senter l\u2019agent IA et obtenir les identifiants n\xe9cessaires \xe0 l\u2019authentification et \xe0 l\u2019autorisation."]}),"\n",(0,t.jsx)(n.h3,{id:"allow-developers-to-create-third-party-apps-in-logto",children:"Autoriser les d\xe9veloppeurs \xe0 cr\xe9er des applications tierces dans Logto"}),"\n",(0,t.jsxs)(n.p,{children:["Si vous construisez une place de march\xe9 ou souhaitez permettre aux d\xe9veloppeurs de cr\xe9er des applications tierces dans Logto, vous pouvez utiliser la ",(0,t.jsx)(n.a,{href:"/integrate-logto/interact-with-management-api",children:"Logto Management API"})," pour cr\xe9er des applications tierces de mani\xe8re programmatique. Cela permet aux d\xe9veloppeurs d\u2019enregistrer leurs applications et d\u2019obtenir les identifiants n\xe9cessaires \xe0 l\u2019authentification."]}),"\n",(0,t.jsx)(n.p,{children:"Vous devrez h\xe9berger votre propre service pour g\xe9rer le processus d\u2019enregistrement des clients. Ce service interagira avec la Logto Management API pour cr\xe9er des applications tierces au nom des d\xe9veloppeurs."}),"\n",(0,t.jsx)(n.mermaid,{value:"sequenceDiagram\n  actor D\xe9veloppeur\n  participant Serveur as Votre service d\u2019enregistrement d\u2019application\n  participant Logto as Logto Management API\n  D\xe9veloppeur->>Serveur: Enregistrer l\u2019application\n  Serveur->>Logto: Cr\xe9er l\u2019application\n  Logto->>Serveur: ID de l\u2019application, secret, etc.\n  Serveur->>D\xe9veloppeur: ID de l\u2019application, secret, etc."}),"\n",(0,t.jsx)(n.p,{children:"Alternativement, vous pouvez cr\xe9er manuellement des applications tierces dans la Console Logto pour vous familiariser avec le processus."}),"\n",(0,t.jsx)(n.h3,{id:"manually-create-a-third-party-app-in-logto",children:"Cr\xe9er manuellement une application tierce dans Logto"}),"\n",(0,t.jsx)(n.p,{children:"Vous pouvez cr\xe9er manuellement une application tierce dans la Console Logto \xe0 des fins de test ou pour des int\xe9grations ponctuelles. Ceci est utile lorsque vous souhaitez tester rapidement l\u2019int\xe9gration sans mettre en \u0153uvre un flux complet d\u2019enregistrement de client."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Connectez-vous \xe0 votre Console Logto."}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Allez dans ",(0,t.jsx)(r,{to:"/applications",children:(0,t.jsx)(n.strong,{children:"Applications"})})," \u2192 ",(0,t.jsx)(n.strong,{children:"Cr\xe9er une application"})," \u2192 ",(0,t.jsx)(n.strong,{children:"Application tierce"})," -> ",(0,t.jsx)(n.strong,{children:"OIDC"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Renseignez le nom de l\u2019application et les autres champs requis, puis cliquez sur ",(0,t.jsx)(n.strong,{children:"Cr\xe9er une application"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Cliquez sur l\u2019onglet ",(0,t.jsx)(n.strong,{children:"Permissions"}),", dans la section ",(0,t.jsx)(n.strong,{children:"Utilisateur"}),', cliquez sur "Ajouter".']}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Dans la bo\xeete de dialogue qui s\u2019ouvre -> ",(0,t.jsx)(n.strong,{children:"Donn\xe9es utilisateur"})," -> s\xe9lectionnez les permissions ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"profile"})}),", ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"email"})}),", puis cliquez sur ",(0,t.jsx)(n.strong,{children:"Enregistrer"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Dans l\u2019application tierce, configurez les port\xe9es (scopes) pour demander les permissions (port\xe9es) ",(0,t.jsx)(n.code,{children:"openid profile email"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Remarque"})," : ",(0,t.jsx)(n.code,{children:"openid"})," est requis pour OIDC, et ",(0,t.jsx)(n.code,{children:"profile"})," et ",(0,t.jsx)(n.code,{children:"email"})," sont les permissions que vous avez ajout\xe9es \xe0 l\u2019\xe9tape pr\xe9c\xe9dente."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Configurez l\u2019",(0,t.jsx)(n.strong,{children:"URI de redirection"})," de votre application tierce en cons\xe9quence. N\u2019oubliez pas de mettre \xe0 jour l\u2019URI de redirection dans Logto \xe9galement."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)("img",{src:"/img/assets/third-party-app-permissions.png",alt:"Permissions de l\u2019application tierce",style:{maxWidth:"800px",width:"100%"}}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(i.Ay,{})]})}function l(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},10883:(e,n,r)=>{r.d(n,{Ay:()=>l,RM:()=>o});var t=r(25105),s=r(79621),i=r(27519);const o=[{value:"Pr\xe9requis",id:"prerequisites",level:2},{value:"Comprendre l\u2019architecture",id:"understanding-the-architecture",level:3}];function a(e){const n={a:"a",admonition:"admonition",h2:"h2",h3:"h3",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"prerequisites",children:"Pr\xe9requis"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Un tenant ",(0,t.jsx)(n.a,{href:"https://cloud.logto.io",children:"Logto Cloud"})," (ou auto-h\xe9berg\xe9)"]}),"\n",(0,t.jsx)(n.li,{children:"Un environnement Node.js ou Python"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"understanding-the-architecture",children:"Comprendre l\u2019architecture"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Serveur MCP"})," : Le serveur qui expose des outils et des ressources aux clients MCP."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Client MCP"})," : Un client utilis\xe9 pour initier le flux d\u2019authentification et tester l\u2019int\xe9gration. ",(0,t.jsx)("b",{children:e.isThirdParty?"L\u2019agent IA tiers sera utilis\xe9 comme client dans ce guide.":"Nous utiliserons le MCP Inspector comme client dans ce guide."})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Logto"})," : Sert de fournisseur OpenID Connect (serveur d\u2019autorisation) et g\xe8re les identit\xe9s des utilisateurs."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Un diagramme de s\xe9quence non normatif illustre le d\xe9roulement global du processus :"}),"\n",(0,t.jsx)(i.A,{value:`sequenceDiagram\n  participant Client as Client MCP<br/>${e.isThirdParty?"(agent IA tiers)":"(MCP Inspector)"}\n  participant Server as Serveur MCP\n  participant Logto\n\n  Server->>Logto: Demande la configuration OpenID Connect\n  Logto->>Server: Retourne la configuration\n  Note over Server: Met en cache la configuration\n  Client->>Server: Demande l\u2019acc\xe8s \xe0 un outil\n  Server->>Client: Non authentifi\xe9 (401 Non autoris\xe9)\n  Client->>Server: Demande les m\xe9tadonn\xe9es du serveur d\u2019autorisation OAuth 2.0\n  Note over Server: Dans ce contexte, \xab configuration OpenID Connect \xbb et<br/>\xab m\xe9tadonn\xe9es du serveur d\u2019autorisation OAuth 2.0 \xbb<br/>d\xe9signent la m\xeame chose.\n  Server->>Client: Retourne la configuration OpenID Connect r\xe9cup\xe9r\xe9e depuis Logto\n  Client->>Logto: Redirige vers Logto pour l\u2019authentification\n  Logto->>Logto: L\u2019utilisateur s\u2019authentifie\n  ${e.isThirdParty?"Logto->>Logto: L\u2019utilisateur autorise (consent) les port\xe9es<br/>\xe0 l\u2019application tierce":""}\n  Logto->>Client: Redirige vers le serveur MCP avec le code d\u2019autorisation\n  Client->>Logto: Demande un jeton d\u2019acc\xe8s en utilisant le code d\u2019autorisation\n  Logto->>Client: Retourne le jeton d\u2019acc\xe8s\n  Client->>Server: Demande l\u2019outil avec le jeton d\u2019acc\xe8s\n  Server->>Logto: Demande les informations utilisateur en utilisant le jeton d\u2019acc\xe8s\n  Logto->>Server: Retourne les informations utilisateur\n  Server->>Client: Retourne la r\xe9ponse de l\u2019outil`}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["En raison de l\u2019\xe9volution rapide de MCP, le diagramme ci-dessus peut ne pas \xeatre enti\xe8rement \xe0 jour. Veuillez consulter la documentation ",(0,t.jsx)(n.a,{href:"https://mcp-auth.dev",children:"mcp-auth"})," pour les informations les plus r\xe9centes."]})})]})}function l(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},32182:(e,n,r)=>{r.d(n,{Ay:()=>c,RM:()=>a});var t=r(25105),s=r(79621),i=r(38552),o=r(22002);const a=[];function l(e){const n={a:"a",p:"p",...(0,s.R)(),...e.components};return(0,t.jsxs)(o.A,{groupId:"sdk",children:[(0,t.jsx)(i.A,{value:"python",label:"Python",children:(0,t.jsxs)(n.p,{children:["Le code complet du serveur MCP est disponible dans le d\xe9p\xf4t ",(0,t.jsx)(n.a,{href:"https://github.com/mcp-auth/python",children:"mcp-auth/python"}),"."]})}),(0,t.jsx)(i.A,{value:"node",label:"Node.js",children:(0,t.jsxs)(n.p,{children:["Le code complet du serveur MCP est disponible dans le d\xe9p\xf4t ",(0,t.jsx)(n.a,{href:"https://github.com/mcp-auth/js",children:"mcp-auth/js"}),"."]})})]})}function c(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},15804:(e,n,r)=>{r.d(n,{Ay:()=>c,RM:()=>a});var t=r(25105),s=r(79621),i=r(38552),o=r(22002);const a=[{value:"Configurer le serveur MCP",id:"set-up-the-mcp-server",level:2},{value:"Cr\xe9er le projet et installer les d\xe9pendances",id:"create-project-and-install-dependencies",level:3},{value:"Configurer l\u2019authentification MCP avec Logto",id:"configure-mcp-auth-with-logto",level:3},{value:"Impl\xe9menter la v\xe9rification du jeton",id:"implement-token-verification",level:3},{value:"Impl\xe9menter l\u2019outil &quot;whoami&quot;",id:"implement-the-whoami-tool",level:3}];function l(e){const n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"set-up-the-mcp-server",children:"Configurer le serveur MCP"}),"\n",(0,t.jsx)(n.h3,{id:"create-project-and-install-dependencies",children:"Cr\xe9er le projet et installer les d\xe9pendances"}),"\n",(0,t.jsxs)(o.A,{groupId:"sdk",children:[(0,t.jsx)(i.A,{value:"python",label:"Python",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'mkdir mcp-server\ncd mcp-server\nuv init # Ou utilisez votre propre structure de projet\nuv add "mcp[cli]" starlette uvicorn mcpauth # Ou utilisez le gestionnaire de paquets de votre choix\n'})})}),(0,t.jsx)(i.A,{value:"node",label:"Node.js",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"mkdir mcp-server\ncd mcp-server\nnpm init -y\nnpm install @modelcontextprotocol/sdk express mcp-auth # Ou utilisez le gestionnaire de paquets de votre choix\n"})})})]}),"\n",(0,t.jsx)(n.h3,{id:"configure-mcp-auth-with-logto",children:"Configurer l\u2019authentification MCP avec Logto"}),"\n",(0,t.jsxs)(n.p,{children:["N'oubliez pas de remplacer ",(0,t.jsx)(n.code,{children:"<your-logto-issuer-endpoint>"})," par l\u2019endpoint de l\u2019\xe9metteur que vous avez copi\xe9 pr\xe9c\xe9demment."]}),"\n",(0,t.jsxs)(o.A,{groupId:"sdk",children:[(0,t.jsxs)(i.A,{value:"python",label:"Python",children:[(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.strong,{children:["Dans ",(0,t.jsx)(n.code,{children:"whoami.py"})," :"]})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"from mcpauth import MCPAuth\nfrom mcpauth.config import AuthServerType\nfrom mcpauth.utils import fetch_server_config\n\nauth_issuer = '<your-logto-issuer-endpoint>'\nauth_server_config = fetch_server_config(auth_issuer, type=AuthServerType.OIDC)\nmcp_auth = MCPAuth(server=auth_server_config)\n"})})]}),(0,t.jsxs)(i.A,{value:"node",label:"Node.js",children:[(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.strong,{children:["Dans ",(0,t.jsx)(n.code,{children:"whoami.js"})," :"]})}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"import { MCPAuth, fetchServerConfig } from 'mcp-auth';\n\nconst authIssuer = '<your-logto-issuer-endpoint>';\nconst mcpAuth = new MCPAuth({\n  server: await fetchServerConfig(authIssuer, { type: 'oidc' }),\n});\n"})})]})]}),"\n",(0,t.jsx)(n.h3,{id:"implement-token-verification",children:"Impl\xe9menter la v\xe9rification du jeton"}),"\n",(0,t.jsx)(n.p,{children:"Puisque nous allons v\xe9rifier le jeton d\u2019acc\xe8s (Access token) et r\xe9cup\xe9rer les informations utilisateur, nous devons impl\xe9menter la v\xe9rification du jeton d\u2019acc\xe8s comme suit :"}),"\n",(0,t.jsxs)(o.A,{groupId:"sdk",children:[(0,t.jsx)(i.A,{value:"python",label:"Python",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import requests\nfrom mcpauth.types import AuthInfo\n\ndef verify_access_token(token: str) -> AuthInfo:\n    endpoint = auth_server_config.metadata.userinfo_endpoint\n    response = requests.get(\n        endpoint,\n        headers={"Authorization": f"Bearer {token}"},\n    )\n    response.raise_for_status()\n    data = response.json()\n    return AuthInfo(\n        token=token,\n        subject=data.get("sub"),\n        issuer=auth_server_config.metadata.issuer,\n        claims=data,\n    )\n'})})}),(0,t.jsx)(i.A,{value:"node",label:"Node.js",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const verifyToken = async (token) => {\n  const { userinfoEndpoint, issuer } = mcpAuth.config.server.metadata;\n  const response = await fetch(userinfoEndpoint, {\n    headers: { Authorization: `Bearer ${token}` },\n  });\n  if (!response.ok) throw new Error('Token verification failed');\n  const userInfo = await response.json();\n  return {\n    token,\n    issuer,\n    subject: userInfo.sub,\n    claims: userInfo,\n  };\n};\n"})})})]}),"\n",(0,t.jsx)(n.h3,{id:"implement-the-whoami-tool",children:'Impl\xe9menter l\u2019outil "whoami"'}),"\n",(0,t.jsx)(n.p,{children:'Impl\xe9mentons maintenant l\u2019outil "whoami" qui retourne les revendications d\u2019identit\xe9 de l\u2019utilisateur courant en interrogeant l\u2019endpoint userinfo avec le jeton d\u2019acc\xe8s envoy\xe9 par le client.'}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"Nous utilisons le transport SSE pour l\u2019exemple en raison de l\u2019absence de prise en charge officielle du transport HTTP Streamable dans la version actuelle du SDK. Th\xe9oriquement, vous pouvez utiliser n\u2019importe quel transport compatible HTTP."})}),"\n",(0,t.jsxs)(o.A,{groupId:"sdk",children:[(0,t.jsxs)(i.A,{value:"python",label:"Python",children:[(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from mcp.server.fastmcp import FastMCP\nfrom starlette.applications import Starlette\nfrom starlette.routing import Mount\nfrom starlette.middleware import Middleware\n\nmcp = FastMCP("WhoAmI")\n\n@mcp.tool()\ndef whoami() -> dict:\n    """\n    Retourne les informations d\'identit\xe9 de l\'utilisateur courant.\n    """\n    return (\n        mcp_auth.auth_info.claims\n        if mcp_auth.auth_info\n        else {"error": "Not authenticated"}\n    )\n\nbearer_auth = Middleware(mcp_auth.bearer_auth_middleware(verify_access_token))\napp = Starlette(\n    routes=[\n        mcp_auth.metadata_route(),  # Sert les m\xe9tadonn\xe9es OIDC pour la d\xe9couverte\n        Mount(\'/\', app=mcp.sse_app(), middleware=[bearer_auth]),\n    ],\n)\n'})}),(0,t.jsx)(n.p,{children:"Lancez le serveur avec :"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"uvicorn whoami:app --host 0.0.0.0 --port 3001\n"})})]}),(0,t.jsxs)(i.A,{value:"node",label:"Node.js",children:[(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';\nimport express from 'express';\n\n// Cr\xe9er le serveur MCP et enregistrer l\u2019outil whoami\nconst server = new McpServer({ name: 'WhoAmI', version: '0.0.0' });\nserver.tool('whoami', ({ authInfo }) => ({\n  content: [\n    { type: 'text', text: JSON.stringify(authInfo?.claims ?? { error: 'Not authenticated' }) },\n  ],\n}));\n\n// Application Express & middleware MCP Auth\nconst app = express();\napp.use(mcpAuth.delegatedRouter());\napp.use(mcpAuth.bearerAuth(verifyToken));\n\n// Transport SSE (comme dans la documentation du SDK)\nconst transports = {};\napp.get('/sse', async (_req, res) => {\n  const transport = new SSEServerTransport('/messages', res);\n  transports[transport.sessionId] = transport;\n  res.on('close', () => delete transports[transport.sessionId]);\n  await server.connect(transport);\n});\napp.post('/messages', async (req, res) => {\n  const sessionId = String(req.query.sessionId);\n  const transport = transports[sessionId];\n  if (transport) await transport.handlePostMessage(req, res, req.body);\n  else res.status(400).send('No transport found for sessionId');\n});\n\napp.listen(3001);\n"})}),(0,t.jsx)(n.p,{children:"Lancez le serveur avec :"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"node whoami.js\n"})})]})]})]})}function c(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},26856:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>p,contentTitle:()=>d,default:()=>v,frontMatter:()=>u,metadata:()=>t,toc:()=>h});const t=JSON.parse('{"id":"use-cases/ai/mcp-server-enable-third-party-ai-agent-access","title":"Autoriser l\u2019acc\xe8s d\u2019un agent IA tiers \xe0 votre serveur MCP","description":"Ce guide vous accompagne dans l\u2019int\xe9gration de Logto avec votre serveur MCP en utilisant mcp-auth, vous permettant d\u2019authentifier les utilisateurs et de r\xe9cup\xe9rer en toute s\xe9curit\xe9 leurs informations d\u2019identit\xe9 via le flux standard OpenID Connect.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/use-cases/ai/mcp-server-enable-third-party-ai-agent-access.mdx","sourceDirName":"use-cases/ai","slug":"/use-cases/ai/mcp-server-enable-third-party-ai-agent-access","permalink":"/fr/use-cases/ai/mcp-server-enable-third-party-ai-agent-access","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/fr/docusaurus-plugin-content-docs/current/use-cases/ai/mcp-server-enable-third-party-ai-agent-access.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"sidebar_label":"Autoriser l\u2019acc\xe8s d\u2019un agent IA tiers au serveur MCP"},"sidebar":"useCasesSidebar","previous":{"title":"Activer l\u2019authentification pour les applications propuls\xe9es par MCP","permalink":"/fr/use-cases/ai/mcp-server-add-auth"},"next":{"title":"Autoriser l\u2019acc\xe8s d\u2019un agent IA tiers \xe0 l\u2019application","permalink":"/fr/use-cases/ai/enable-third-party-ai-agent-access"}}');var s=r(25105),i=r(79621),o=r(97011),a=r(10883),l=r(32182),c=r(15804);const u={sidebar_position:2,sidebar_label:"Autoriser l\u2019acc\xe8s d\u2019un agent IA tiers au serveur MCP"},d="Autoriser l\u2019acc\xe8s d\u2019un agent IA tiers \xe0 votre serveur MCP",p={},h=[{value:"Diff\xe9rence entre un agent IA tiers (client MCP tiers) et votre propre client MCP",id:"difference-between-third-party-ai-agent-mcp-client-and-your-own-mcp-client",level:2},...a.RM,...o.RM,...c.RM,{value:"Tester l\u2019int\xe9gration",id:"test-the-integration",level:2},...l.RM];function m(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"autoriser-lacc\xe8s-dun-agent-ia-tiers-\xe0-votre-serveur-mcp",children:"Autoriser l\u2019acc\xe8s d\u2019un agent IA tiers \xe0 votre serveur MCP"})}),"\n",(0,s.jsxs)(n.p,{children:["Ce guide vous accompagne dans l\u2019int\xe9gration de Logto avec votre serveur MCP en utilisant ",(0,s.jsx)(n.a,{href:"https://mcp-auth.dev",children:"mcp-auth"}),", vous permettant d\u2019authentifier les utilisateurs et de r\xe9cup\xe9rer en toute s\xe9curit\xe9 leurs informations d\u2019identit\xe9 via le flux standard OpenID Connect."]}),"\n",(0,s.jsx)(n.p,{children:"Vous apprendrez \xe0:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Configurer Logto comme serveur d\u2019autorisation pour votre serveur MCP."}),"\n",(0,s.jsx)(n.li,{children:"Mettre en place un outil \u201cwhoami\u201d dans votre serveur MCP pour retourner les revendications d\u2019identit\xe9 de l\u2019utilisateur actuel."}),"\n",(0,s.jsx)(n.li,{children:"Tester le flux avec un agent IA tiers (client MCP)."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Apr\xe8s ce tutoriel, votre serveur MCP pourra:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Authentifier les utilisateurs dans votre tenant Logto."}),"\n",(0,s.jsxs)(n.li,{children:["Retourner les revendications d\u2019identit\xe9 (",(0,s.jsx)(n.code,{children:"sub"}),", ",(0,s.jsx)(n.code,{children:"username"}),", ",(0,s.jsx)(n.code,{children:"name"}),", ",(0,s.jsx)(n.code,{children:"email"}),', etc.) lors de l\u2019appel de l\u2019outil "whoami".']}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"difference-between-third-party-ai-agent-mcp-client-and-your-own-mcp-client",children:"Diff\xe9rence entre un agent IA tiers (client MCP tiers) et votre propre client MCP"}),"\n",(0,s.jsx)(n.p,{children:"Prenons un exemple. Imaginez que vous \xeates un d\xe9veloppeur exploitant un serveur MCP pour g\xe9rer l\u2019acc\xe8s aux e-mails et l\u2019automatisation."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Application e-mail officielle (Votre propre client MCP)"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Vous fournissez une application e-mail officielle permettant aux utilisateurs de lire et g\xe9rer leurs e-mails."}),"\n",(0,s.jsx)(n.li,{children:"Fonctionnement: L\u2019application e-mail officielle se connecte \xe0 votre serveur MCP en utilisant Logto pour authentifier les utilisateurs. Lorsque Alice se connecte, elle acc\xe8de automatiquement \xe0 ses e-mails, sans \xe9cran de permission suppl\xe9mentaire, car il s\u2019agit de votre application de confiance."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Agent IA tiers (Client MCP tiers)"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Vous d\xe9veloppez un \xe9cosyst\xe8me autour de votre serveur MCP, un autre d\xe9veloppeur cr\xe9e donc \u201cSmartMail AI\u201d (un assistant IA capable de r\xe9sumer les e-mails et de planifier des r\xe9unions automatiquement) en l\u2019int\xe9grant comme client tiers."}),"\n",(0,s.jsxs)(n.li,{children:["Fonctionnement: SmartMail AI (client MCP tiers) souhaite acc\xe9der aux e-mails des utilisateurs via votre serveur MCP. Lorsque Alice se connecte \xe0 SmartMail AI avec son compte:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Un \xe9cran de consentement s\u2019affiche, demandant l\u2019autorisation \xe0 SmartMail AI de lire ses e-mails et son agenda."}),"\n",(0,s.jsx)(n.li,{children:"Alice peut autoriser ou refuser cet acc\xe8s."}),"\n",(0,s.jsx)(n.li,{children:"Seules les donn\xe9es auxquelles elle consent sont partag\xe9es avec SmartMail AI, et SmartMail AI ne peut acc\xe9der \xe0 aucune donn\xe9e suppl\xe9mentaire sans un nouveau consentement explicite."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Ce contr\xf4le d\u2019acc\xe8s (permission) garantit la s\xe9curit\xe9 des donn\xe9es utilisateur: m\xeame si votre serveur MCP g\xe8re toutes les donn\xe9es, les applications tierces comme SmartMail AI ne peuvent acc\xe9der qu\u2019aux donn\xe9es explicitement autoris\xe9es par l\u2019utilisateur. Elles ne peuvent pas contourner ce processus, car il est impos\xe9 par votre impl\xe9mentation du contr\xf4le d\u2019acc\xe8s dans le serveur MCP."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"R\xe9sum\xe9"})}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Type de client"}),(0,s.jsx)(n.th,{children:"Exemple"}),(0,s.jsx)(n.th,{children:"Consentement requis?"}),(0,s.jsx)(n.th,{children:"Qui le contr\xf4le?"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Application e-mail officielle"}),(0,s.jsx)(n.td,{children:"Votre propre application e-mail"}),(0,s.jsx)(n.td,{children:"Non"}),(0,s.jsx)(n.td,{children:"Vous (le d\xe9veloppeur)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Agent IA tiers"}),(0,s.jsx)(n.td,{children:"Assistant SmartMail AI"}),(0,s.jsx)(n.td,{children:"Oui"}),(0,s.jsx)(n.td,{children:"Un autre d\xe9veloppeur"})]})]})]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["Si vous souhaitez int\xe9grer votre serveur MCP avec votre propre agent IA ou application, veuillez consulter le guide ",(0,s.jsx)(n.a,{href:"./mcp-server-add-auth",children:"Activer l\u2019authentification pour vos applications propuls\xe9es par MCP avec Logto"}),"."]})}),"\n",(0,s.jsx)(a.Ay,{isThirdParty:!0}),"\n",(0,s.jsx)(o.Ay,{serviceName:"serveur MCP"}),"\n",(0,s.jsx)(c.Ay,{}),"\n",(0,s.jsx)(n.h2,{id:"test-the-integration",children:"Tester l\u2019int\xe9gration"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"D\xe9marrez le serveur MCP."}),"\n",(0,s.jsx)(n.li,{children:"D\xe9marrez l\u2019agent IA."}),"\n",(0,s.jsxs)(n.li,{children:["Dans le client, invoquez l\u2019outil ",(0,s.jsx)(n.code,{children:"whoami"})," pour r\xe9cup\xe9rer les revendications d\u2019identit\xe9 de l\u2019utilisateur actuel."]}),"\n",(0,s.jsx)(n.li,{children:"Le client doit g\xe9rer la r\xe9ponse 401 Non autoris\xe9 et rediriger l\u2019utilisateur vers Logto pour l\u2019authentification."}),"\n",(0,s.jsx)(n.li,{children:"Apr\xe8s une authentification r\xe9ussie, le client doit recevoir un jeton d\u2019acc\xe8s et l\u2019utiliser pour effectuer des requ\xeates vers le serveur MCP."}),"\n",(0,s.jsx)(n.li,{children:"Le client doit pouvoir r\xe9cup\xe9rer les revendications d\u2019identit\xe9 depuis le serveur MCP \xe0 l\u2019aide du jeton d\u2019acc\xe8s."}),"\n"]}),"\n",(0,s.jsx)(l.Ay,{})]})}function v(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(m,{...e})}):m(e)}},38552:(e,n,r)=>{r.d(n,{A:()=>o});r(58101);var t=r(13526);const s={tabItem:"tabItem_dgSZ"};var i=r(25105);function o(e){let{children:n,hidden:r,className:o}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,t.A)(s.tabItem,o),hidden:r,children:n})}},22002:(e,n,r)=>{r.d(n,{A:()=>A});var t=r(58101),s=r(13526),i=r(60755),o=r(55234),a=r(6635),l=r(4100),c=r(35661),u=r(42752);function d(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:r}=e;return(0,t.useMemo)((()=>{const e=n??function(e){return d(e).map((e=>{let{props:{value:n,label:r,attributes:t,default:s}}=e;return{value:n,label:r,attributes:t,default:s}}))}(r);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,r])}function h(e){let{value:n,tabValues:r}=e;return r.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:r}=e;const s=(0,o.W6)(),i=function(e){let{queryString:n=!1,groupId:r}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:n,groupId:r});return[(0,l.aZ)(i),(0,t.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(s.location.search);n.set(i,e),s.replace({...s.location,search:n.toString()})}),[i,s])]}function v(e){const{defaultValue:n,queryString:r=!1,groupId:s}=e,i=p(e),[o,l]=(0,t.useState)((()=>function(e){let{defaultValue:n,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!h({value:n,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const t=r.find((e=>e.default))??r[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:i}))),[c,d]=m({queryString:r,groupId:s}),[v,g]=function(e){let{groupId:n}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(n),[s,i]=(0,u.Dv)(r);return[s,(0,t.useCallback)((e=>{r&&i.set(e)}),[r,i])]}({groupId:s}),x=(()=>{const e=c??v;return h({value:e,tabValues:i})?e:null})();(0,a.A)((()=>{x&&l(x)}),[x]);return{selectedValue:o,selectValue:(0,t.useCallback)((e=>{if(!h({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);l(e),d(e),g(e)}),[d,g,i]),tabValues:i}}var g=r(21929);const x={tabList:"tabList_osvQ",tabItem:"tabItem_dc4O"};var j=r(25105);function f(e){let{className:n,block:r,selectedValue:t,selectValue:o,tabValues:a}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,i.a_)(),u=e=>{const n=e.currentTarget,r=l.indexOf(n),s=a[r].value;s!==t&&(c(n),o(s))},d=e=>{let n=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const r=l.indexOf(e.currentTarget)+1;n=l[r]??l[0];break}case"ArrowLeft":{const r=l.indexOf(e.currentTarget)-1;n=l[r]??l[l.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":r},n),children:a.map((e=>{let{value:n,label:r,attributes:i}=e;return(0,j.jsx)("li",{role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:e=>{l.push(e)},onKeyDown:d,onClick:u,...i,className:(0,s.A)("tabs__item",x.tabItem,i?.className,{"tabs__item--active":t===n}),children:r??n},n)}))})}function b(e){let{lazy:n,children:r,selectedValue:i}=e;const o=(Array.isArray(r)?r:[r]).filter(Boolean);if(n){const e=o.find((e=>e.props.value===i));return e?(0,t.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:o.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==i})))})}function C(e){const n=v(e);return(0,j.jsxs)("div",{className:(0,s.A)("tabs-container",x.tabList),children:[(0,j.jsx)(f,{...n,...e}),(0,j.jsx)(b,{...n,...e})]})}function A(e){const n=(0,g.A)();return(0,j.jsx)(C,{...e,children:d(e.children)},String(n))}},79621:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var t=r(58101);const s={},i=t.createContext(s);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);