"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[7243],{24312:(e,n,r)=>{r.d(n,{Ay:()=>a,RM:()=>i});var t=r(25105),s=r(79621);const i=[];function o(e){const n={admonition:"admonition",p:"p",...(0,s.R)(),...e.components};return(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:['Ce guide suppose que vous avez cr\xe9\xe9 une Application de type "',e.type,"\" dans la Console d'administration."]})})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},75254:(e,n,r)=>{r.d(n,{Ay:()=>a,RM:()=>i});var t=r(25105),s=r(79621);const i=[];function o(e){const n={p:"p",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["Passons \xe0 la page des d\xe9tails de l'application de Logto Console. Ajoutez une URI de redirection ",(0,t.jsx)("code",{children:e.redirectUri}),' et cliquez sur "Enregistrer les modifications".']}),"\n",(0,t.jsx)("img",{alt:"URI de redirection dans Logto Console",src:e.figureSrc,width:"600px"})]})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},62990:(e,n,r)=>{r.d(n,{Ay:()=>a,RM:()=>i});var t=r(25105),s=r(79621);const i=[];function o(e){const{Url:n}={...(0,s.R)(),...e.components};return n||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n,{href:"/end-user-flows",children:" Parcours utilisateur final : flux d\u2019authentification, flux de compte et flux d\u2019organisation "}),"\n",(0,t.jsx)(n,{href:"/connectors",children:" Configurer les connecteurs "}),"\n",(0,t.jsx)(n,{href:"/authorization",children:" Autorisation (Authorization) "})]})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},11233:(e,n,r)=>{r.d(n,{Ay:()=>a,RM:()=>i});var t=r(25105),s=r(79621);const i=[];function o(e){const n={admonition:"admonition",p:"p",...(0,s.R)(),...e.components};return(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsx)("p",{children:(0,t.jsx)(n.p,{children:"Vous pouvez trouver et copier le \"Secret de l'application\" depuis la page des d\xe9tails de\nl'application dans la Console d'administration :"})}),(0,t.jsx)("img",{alt:"Secret de l'application",src:"/img/assets/app-secret.png",width:"586px"})]})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},42142:(e,n,r)=>{r.d(n,{Ay:()=>a,RM:()=>i});var t=r(25105),s=r(79621);const i=[{value:"Concernant la connexion bas\xe9e sur la redirection",id:"regarding-redirect-based-sign-in",level:3}];function o(e){const n={a:"a",h3:"h3",li:"li",ol:"ol",p:"p",...(0,s.R)(),...e.components},{Details:r,MainSiteUrl:i}=n;return r||c("Details",!0),i||c("MainSiteUrl",!0),(0,t.jsxs)(r,{children:[(0,t.jsx)("summary",{children:(0,t.jsx)(n.h3,{id:"regarding-redirect-based-sign-in",children:"Concernant la connexion bas\xe9e sur la redirection"})}),(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Ce processus d'authentification (Authentication) suit le protocole ",(0,t.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html",children:"OpenID Connect (OIDC)"}),", et Logto applique des mesures de s\xe9curit\xe9 strictes pour prot\xe9ger la connexion utilisateur."]}),"\n",(0,t.jsx)(n.li,{children:"Si vous avez plusieurs applications, vous pouvez utiliser le m\xeame fournisseur d\u2019identit\xe9 (Logto). Une fois que l'utilisateur se connecte \xe0 une application, Logto compl\xe9tera automatiquement le processus de connexion lorsque l'utilisateur acc\xe8de \xe0 une autre application."}),"\n"]}),(0,t.jsxs)(n.p,{children:["Pour en savoir plus sur la logique et les avantages de la connexion bas\xe9e sur la redirection, consultez ",(0,t.jsx)(i,{href:"/concepts/sign-in-experience",children:"Exp\xe9rience de connexion Logto expliqu\xe9e"}),"."]})]})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}function c(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},37564:(e,n,r)=>{r.d(n,{Ay:()=>a,RM:()=>i});var t=r(25105),s=r(79621);const i=[];function o(e){const n={admonition:"admonition",p:"p",...(0,s.R)(),...e.components};return(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["Avant d'appeler ",(0,t.jsx)("code",{children:e.calling}),", assurez-vous d'avoir correctement configur\xe9 l'URI de redirection dans la console d'administration."]})})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},60348:(e,n,r)=>{r.d(n,{Ay:()=>c,RM:()=>o});var t=r(25105),s=r(79621),i=r(42142);const o=[...i.RM];function a(e){const n={hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Avant d\u2019entrer dans les d\xe9tails, voici un aper\xe7u rapide de l\u2019exp\xe9rience utilisateur finale. Le processus de connexion peut \xeatre simplifi\xe9 comme suit :"}),"\n",(0,t.jsx)(n.mermaid,{value:"graph LR\n    A(Votre application) --\x3e|1\\. Lancer la connexion| B(Logto)\n    B --\x3e|2\\. Connexion termin\xe9e| A"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Votre application lance la m\xe9thode de connexion."}),"\n",(0,t.jsx)(n.li,{children:"L\u2019utilisateur est redirig\xe9 vers la page de connexion Logto. Pour les applications natives, le navigateur syst\xe8me est ouvert."}),"\n",(0,t.jsx)(n.li,{children:"L\u2019utilisateur se connecte et est redirig\xe9 vers votre application (configur\xe9e comme l\u2019URI de redirection)."}),"\n"]}),"\n",(0,t.jsx)(i.Ay,{}),"\n",(0,t.jsx)(n.hr,{})]})}function c(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},89103:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>m,contentTitle:()=>x,default:()=>v,frontMatter:()=>g,metadata:()=>t,toc:()=>f});const t=JSON.parse('{"id":"quick-starts/generic/traditional/README","title":"Ajoutez l\u2019authentification \xe0 votre application web traditionnelle","description":"Votre application peut s\'ex\xe9cuter c\xf4t\xe9 serveur plut\xf4t que dans le navigateur, en utilisant des frameworks comme Django, Laravel, etc. Cela s\'appelle une application web traditionnelle. Si vous ne trouvez pas de SDK appropri\xe9 sur cette page, vous devrez probablement int\xe9grer manuellement.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/quick-starts/generic/traditional/README.mdx","sourceDirName":"quick-starts/generic/traditional","slug":"/quick-starts/traditional-web","permalink":"/fr/quick-starts/traditional-web","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/fr/docusaurus-plugin-content-docs/current/quick-starts/generic/traditional/README.mdx","tags":[],"version":"current","frontMatter":{"slug":"/quick-starts/traditional-web","sidebar_label":"Web traditionnel","sidebar_custom_props":{"description":"Int\xe9grez Logto avec des applications web traditionnelles qui s\'ex\xe9cutent sur le serveur."}},"sidebar":"quickStartSidebar","previous":{"title":"Machine \xe0 machine","permalink":"/fr/quick-starts/m2m"},"next":{"title":"Hasura","permalink":"/fr/quick-starts/hasura"}}');var s=r(25105),i=r(79621),o=r(38552),a=r(22002),c=r(24312),l=r(75254),d=r(62990),u=r(11233),p=r(37564),h=r(60348);const g={slug:"/quick-starts/traditional-web",sidebar_label:"Web traditionnel",sidebar_custom_props:{description:"Int\xe9grez Logto avec des applications web traditionnelles qui s'ex\xe9cutent sur le serveur."}},x="Ajoutez l\u2019authentification \xe0 votre application web traditionnelle",m={},f=[...c.RM,{value:"Obtenez le code source",id:"get-source-code",level:2},{value:"D\xe9marrez un projet Express",id:"start-an-express-project",level:2},{value:"Installez les d\xe9pendances",id:"install-dependencies",level:2},{value:"Utilisez la session",id:"use-session",level:2},{value:"Impl\xe9mentez des fonctions pour authentifier les utilisateurs",id:"implement-functions-to-authenticate-users",level:2},...u.RM,{value:"Connexion",id:"sign-in",level:2},...h.RM,{value:"Configurer l&#39;URI de redirection",id:"configure-redirect-uri",level:3},...l.RM,{value:"Impl\xe9mentez la route de connexion",id:"implement-sign-in-route",level:3},...p.RM,{value:"D\xe9connexion",id:"sign-out",level:2},{value:"Acc\xe9der \xe0 une ressource prot\xe9g\xe9e",id:"access-protected-resource",level:2},{value:"Lectures compl\xe9mentaires",id:"further-readings",level:2},...d.RM];function j(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components},{Url:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"ajoutez-lauthentification-\xe0-votre-application-web-traditionnelle",children:"Ajoutez l\u2019authentification \xe0 votre application web traditionnelle"})}),"\n",(0,s.jsx)(c.Ay,{type:"Traditional web"}),"\n",(0,s.jsx)(n.p,{children:"Votre application peut s'ex\xe9cuter c\xf4t\xe9 serveur plut\xf4t que dans le navigateur, en utilisant des frameworks comme Django, Laravel, etc. Cela s'appelle une application web traditionnelle. Si vous ne trouvez pas de SDK appropri\xe9 sur cette page, vous devrez probablement int\xe9grer manuellement."}),"\n",(0,s.jsx)(n.p,{children:"Cet article vous guide \xe9tape par \xe9tape pour y parvenir. Nous prenons Express dans Node.js comme exemple."}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["Cet article n'est pas seulement pour Express, et si vous utilisez d'autres frameworks ou m\xeame d'autres langages, vous pouvez remplacer ",(0,s.jsx)(n.code,{children:"@logto/js"})," par le SDK principal du langage utilis\xe9, puis ajuster certaines \xe9tapes."]})}),"\n",(0,s.jsx)(n.h2,{id:"get-source-code",children:"Obtenez le code source"}),"\n",(0,s.jsxs)(n.p,{children:["Vous pouvez aller sur ",(0,s.jsx)(n.a,{href:"https://github.com/logto-io/express-example",children:"GitHub"})," pour obtenir le code final de ce guide."]}),"\n",(0,s.jsx)(n.h2,{id:"start-an-express-project",children:"D\xe9marrez un projet Express"}),"\n",(0,s.jsxs)(n.p,{children:["Avec ",(0,s.jsx)(n.code,{children:"express-generator"}),", vous pouvez rapidement d\xe9marrer un projet Express."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"mkdir express-logto\ncd express-logto\nnpx express-generator\n"})}),"\n",(0,s.jsx)(n.h2,{id:"install-dependencies",children:"Installez les d\xe9pendances"}),"\n",(0,s.jsx)(n.p,{children:"L'application de d\xe9monstration n\xe9cessitera 4 d\xe9pendances :"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"@logto/js"})," : Le SDK principal de Logto pour JavaScript."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"node-fetch"})," : Code minimal pour une API compatible ",(0,s.jsx)(n.code,{children:"window.fetch"})," sur l'environnement Node.js."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"express-session"})," : Un middleware de session, nous utiliserons la session pour stocker les jetons utilisateur."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"js-base64"})," : Un autre transcodeur Base64."]}),"\n"]}),"\n",(0,s.jsxs)(a.A,{children:[(0,s.jsx)(o.A,{value:"npm",label:"npm",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm i @logto/js node-fetch@v2 express-session js-base64\n"})})}),(0,s.jsx)(o.A,{value:"yarn",label:"Yarn",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"yarn add @logto/js node-fetch@v2 express-session js-base64\n"})})}),(0,s.jsx)(o.A,{value:"pnpm",label:"pnpm",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pnpm add @logto/js node-fetch@v2 express-session js-base64\n"})})})]}),"\n",(0,s.jsx)(n.h2,{id:"use-session",children:"Utilisez la session"}),"\n",(0,s.jsx)(n.p,{children:"Lorsque les utilisateurs se connectent, ils obtiennent un ensemble de jetons (Jeton d\u2019acc\xe8s, Jeton d\u2019identifiant, Jeton de rafra\xeechissement) et des donn\xe9es d'interaction, et la session est un excellent endroit pour les stocker."}),"\n",(0,s.jsxs)(n.p,{children:["Nous avons install\xe9 ",(0,s.jsx)(n.a,{href:"https://github.com/expressjs/session",children:"express-session"})," \xe0 l'\xe9tape pr\xe9c\xe9dente, ajoutons donc simplement le code suivant pour le configurer :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// app.js\n\nconst session = require('express-session');\n\napp.use(\n  session({\n    secret: 'keyboard cat', // Changez pour votre propre cl\xe9 secr\xe8te\n    cookie: { maxAge: 86400 },\n  })\n);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"implement-functions-to-authenticate-users",children:"Impl\xe9mentez des fonctions pour authentifier les utilisateurs"}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["Nous supposons que l'application fonctionne sur ",(0,s.jsx)(n.code,{children:"http://localhost:3000"})," dans les extraits de code suivants."]})}),"\n",(0,s.jsx)(n.p,{children:"\xc0 cette \xe9tape, nous devons impl\xe9menter les fonctions d'authentification suivantes :"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"getSignInUrl"})," : construit et renvoie une URL compl\xe8te du serveur d'autorisation Logto vers laquelle les utilisateurs seront redirig\xe9s."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"handleSignIn"})," : analyse l'URL de rappel apr\xe8s la fin du processus d'authentification, obtient le param\xe8tre de requ\xeate code, puis r\xe9cup\xe8re les jetons (un jeton d\u2019acc\xe8s, le jeton de rafra\xeechissement et un jeton d\u2019identifiant) pour terminer le processus de connexion."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"refreshTokens"})," : \xe9change un nouveau jeton d\u2019acc\xe8s en utilisant le jeton de rafra\xeechissement."]}),"\n"]}),"\n",(0,s.jsx)(u.Ay,{}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// logto.js\n\nconst {\n  withReservedScopes,\n  fetchOidcConfig,\n  discoveryPath,\n  generateSignInUri,\n  verifyAndParseCodeFromCallbackUri,\n  fetchTokenByAuthorizationCode,\n  fetchTokenByRefreshToken,\n} = require('@logto/js');\nconst fetch = require('node-fetch');\nconst { randomFillSync, createHash } = require('crypto');\nconst { fromUint8Array } = require('js-base64');\n\nconst config = {\n  endpoint: 'https://logto.dev',\n  appId: 'foo',\n  appSecret: '<your-app-secret-copied-from-console>',\n  redirectUri: 'http://localhost:3000/callback', // Vous devrez peut-\xeatre le remplacer par l'adresse de production de votre application\n  scopes: withReservedScopes().split(' '),\n};\n\nconst requester = (input, init) => {\n  const { appId, appSecret } = config;\n\n  return fetch(input, {\n    ...init,\n    headers: {\n      ...init?.headers,\n      authorization: `Basic ${Buffer.from(`${appId}:${appSecret}`, 'utf8').toString('base64')}`,\n    },\n  });\n};\n\nconst generateRandomString = (length = 64) => {\n  return fromUint8Array(randomFillSync(new Uint8Array(length)), true);\n};\n\nconst generateCodeChallenge = async (codeVerifier) => {\n  const encodedCodeVerifier = new TextEncoder().encode(codeVerifier);\n  const hash = createHash('sha256');\n  hash.update(encodedCodeVerifier);\n  const codeChallenge = hash.digest();\n  return fromUint8Array(codeChallenge, true);\n};\n\nconst getOidcConfig = async () => {\n  return fetchOidcConfig(new URL(discoveryPath, config.endpoint).toString(), requester);\n};\n\nexports.getSignInUrl = async () => {\n  const { authorizationEndpoint } = await getOidcConfig();\n  const codeVerifier = generateRandomString();\n  const codeChallenge = await generateCodeChallenge(codeVerifier);\n  const state = generateRandomString();\n\n  const { redirectUri, scopes, appId: clientId } = config;\n\n  const signInUri = generateSignInUri({\n    authorizationEndpoint,\n    clientId,\n    redirectUri: redirectUri,\n    codeChallenge,\n    state,\n    scopes,\n  });\n\n  return { redirectUri, codeVerifier, state, signInUri };\n};\n\nexports.handleSignIn = async (signInSession, callbackUri) => {\n  const { redirectUri, state, codeVerifier } = signInSession;\n  const code = verifyAndParseCodeFromCallbackUri(callbackUri, redirectUri, state);\n\n  const { appId: clientId } = config;\n  const { tokenEndpoint } = await getOidcConfig();\n  const codeTokenResponse = await fetchTokenByAuthorizationCode(\n    {\n      clientId,\n      tokenEndpoint,\n      redirectUri,\n      codeVerifier,\n      code,\n    },\n    requester\n  );\n\n  return codeTokenResponse;\n};\n\nexports.refreshTokens = async (refreshToken) => {\n  const { appId: clientId, scopes } = config;\n  const { tokenEndpoint } = await getOidcConfig();\n  const tokenResponse = await fetchTokenByRefreshToken(\n    {\n      clientId,\n      tokenEndpoint,\n      refreshToken,\n      scopes,\n    },\n    requester\n  );\n\n  return tokenResponse;\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"sign-in",children:"Connexion"}),"\n",(0,s.jsx)(h.Ay,{}),"\n",(0,s.jsx)(n.h3,{id:"configure-redirect-uri",children:"Configurer l'URI de redirection"}),"\n",(0,s.jsx)(l.Ay,{figureSrc:"/img/assets/web-redirect-uri.png",redirectUri:"http://localhost:3000/callback"}),"\n",(0,s.jsx)(n.h3,{id:"implement-sign-in-route",children:"Impl\xe9mentez la route de connexion"}),"\n",(0,s.jsx)(p.Ay,{calling:"getSignInUrl()"}),"\n",(0,s.jsx)(n.p,{children:"Cr\xe9ez une route dans Express pour se connecter :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const { getSignInUrl } = require('./logto');\n\napp.get('/sign-in', async (req, res) => {\n  const { redirectUri, codeVerifier, state, signInUri } = await getSignInUrl();\n  req.session.signIn = { codeVerifier, state, redirectUri };\n  res.redirect(signInUri);\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"et une route pour g\xe9rer le rappel :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"app.get('/callback', async (req, res) => {\n  if (!req.session.signIn) {\n    res.send('Bad request.');\n    return;\n  }\n\n  const response = await handleSignIn(\n    req.session.signIn,\n    `${req.protocol}://${req.get('host')}${req.originalUrl}`\n  );\n  req.session.tokens = {\n    ...response,\n    expiresAt: response.expiresIn + Date.now(),\n    idToken: decodeIdToken(response.idToken),\n  };\n  req.session.signIn = null;\n\n  res.redirect('/');\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"sign-out",children:"D\xe9connexion"}),"\n",(0,s.jsx)(n.p,{children:'TODO : lien vers le chapitre "session & cookies" dans la r\xe9f\xe9rence des utilisateurs.'}),"\n",(0,s.jsx)(n.p,{children:'Vous pouvez effacer les jetons dans la session pour d\xe9connecter un utilisateur de cette application. Et consultez ce lien pour en savoir plus sur la "d\xe9connexion".'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"app.get('/sign-out', (req, res) => {\n  req.session.tokens = null;\n  res.send('Sign out successful');\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"access-protected-resource",children:"Acc\xe9der \xe0 une ressource prot\xe9g\xe9e"}),"\n",(0,s.jsxs)(n.p,{children:["Cr\xe9ez un middleware nomm\xe9 ",(0,s.jsx)(n.code,{children:"withAuth"})," pour attacher un objet ",(0,s.jsx)(n.code,{children:"auth"})," \xe0 ",(0,s.jsx)(n.code,{children:"req"}),", et v\xe9rifier si un utilisateur est connect\xe9."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// auth.js\n\nconst { decodeIdToken } = require('@logto/js');\nconst { refreshTokens } = require('./logto');\n\nconst withAuth =\n  ({ requireAuth } = { requireAuth: true }) =>\n  async (req, res, next) => {\n    if (requireAuth && !req.session.tokens) {\n      res.redirect('/sign-in');\n      return;\n    }\n\n    if (req.session.tokens) {\n      if (req.session.tokens.expiresAt >= Date.now()) {\n        // Jeton d\u2019acc\xe8s expir\xe9, rafra\xeechir pour obtenir de nouveaux jetons\n        try {\n          const response = await refreshTokens(req.session.tokens.refreshToken);\n          req.session.tokens = {\n            ...response,\n            expiresAt: response.expiresIn + Date.now(),\n            idToken: decodeIdToken(response.idToken),\n          };\n        } catch {\n          // \xc9change \xe9chou\xe9, rediriger vers la connexion\n          res.redirect('/sign-in');\n          return;\n        }\n      }\n\n      req.auth = req.session.tokens.idToken.sub;\n    }\n\n    next();\n  };\n\nmodule.exports = withAuth;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["cr\xe9ez la page ",(0,s.jsx)(n.code,{children:"index"}),", affichez un lien de connexion pour les invit\xe9s, et un lien vers le profil pour les utilisateurs d\xe9j\xe0 connect\xe9s :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"router.get('/', withAuth({ requireAuth: false }), function (req, res, next) {\n  res.render('index', { auth: Boolean(req.auth) });\n});\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jade",children:'extends layout\n\nblock content\n  h1 Hello logto\n  if auth\n    p: a(href="/user") Go to profile\n  else\n    p: a(href="/sign-in") Click here to sign in\n'})}),"\n",(0,s.jsxs)(n.p,{children:["cr\xe9ez la page ",(0,s.jsx)(n.code,{children:"user"}),", pour afficher ",(0,s.jsx)(n.code,{children:"userId"})," (",(0,s.jsx)(n.code,{children:"sujet"}),") :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"app.get('/user', withAuth(), (req, res, next) => {\n  res.render('user', { userId: req.auth });\n});\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jade",children:"extends layout\n\nblock content\n  h1 Hello logto\n  p userId: #{userId}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"further-readings",children:"Lectures compl\xe9mentaires"}),"\n",(0,s.jsx)(d.Ay,{}),"\n",(0,s.jsx)(r,{href:"https://blog.logto.io/gpt-action-oauth",children:(0,s.jsx)(n.p,{children:"Authentifiez les utilisateurs dans les actions GPT : Construisez un assistant d'agenda personnel"})})]})}function v(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(j,{...e})}):j(e)}},38552:(e,n,r)=>{r.d(n,{A:()=>o});r(58101);var t=r(13526);const s={tabItem:"tabItem_dgSZ"};var i=r(25105);function o(e){let{children:n,hidden:r,className:o}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,t.A)(s.tabItem,o),hidden:r,children:n})}},22002:(e,n,r)=>{r.d(n,{A:()=>y});var t=r(58101),s=r(13526),i=r(60755),o=r(55234),a=r(6635),c=r(4100),l=r(35661),d=r(42752);function u(e){return t.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,t.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:r}=e;return(0,t.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:r,attributes:t,default:s}}=e;return{value:n,label:r,attributes:t,default:s}}))}(r);return function(e){const n=(0,l.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,r])}function h(e){let{value:n,tabValues:r}=e;return r.some((e=>e.value===n))}function g(e){let{queryString:n=!1,groupId:r}=e;const s=(0,o.W6)(),i=function(e){let{queryString:n=!1,groupId:r}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:n,groupId:r});return[(0,c.aZ)(i),(0,t.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(s.location.search);n.set(i,e),s.replace({...s.location,search:n.toString()})}),[i,s])]}function x(e){const{defaultValue:n,queryString:r=!1,groupId:s}=e,i=p(e),[o,c]=(0,t.useState)((()=>function(e){let{defaultValue:n,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!h({value:n,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const t=r.find((e=>e.default))??r[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:i}))),[l,u]=g({queryString:r,groupId:s}),[x,m]=function(e){let{groupId:n}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(n),[s,i]=(0,d.Dv)(r);return[s,(0,t.useCallback)((e=>{r&&i.set(e)}),[r,i])]}({groupId:s}),f=(()=>{const e=l??x;return h({value:e,tabValues:i})?e:null})();(0,a.A)((()=>{f&&c(f)}),[f]);return{selectedValue:o,selectValue:(0,t.useCallback)((e=>{if(!h({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);c(e),u(e),m(e)}),[u,m,i]),tabValues:i}}var m=r(21929);const f={tabList:"tabList_osvQ",tabItem:"tabItem_dc4O"};var j=r(25105);function v(e){let{className:n,block:r,selectedValue:t,selectValue:o,tabValues:a}=e;const c=[],{blockElementScrollPositionUntilNextRender:l}=(0,i.a_)(),d=e=>{const n=e.currentTarget,r=c.indexOf(n),s=a[r].value;s!==t&&(l(n),o(s))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const r=c.indexOf(e.currentTarget)+1;n=c[r]??c[0];break}case"ArrowLeft":{const r=c.indexOf(e.currentTarget)-1;n=c[r]??c[c.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":r},n),children:a.map((e=>{let{value:n,label:r,attributes:i}=e;return(0,j.jsx)("li",{role:"tab",tabIndex:t===n?0:-1,"aria-selected":t===n,ref:e=>{c.push(e)},onKeyDown:u,onClick:d,...i,className:(0,s.A)("tabs__item",f.tabItem,i?.className,{"tabs__item--active":t===n}),children:r??n},n)}))})}function b(e){let{lazy:n,children:r,selectedValue:i}=e;const o=(Array.isArray(r)?r:[r]).filter(Boolean);if(n){const e=o.find((e=>e.props.value===i));return e?(0,t.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:o.map(((e,n)=>(0,t.cloneElement)(e,{key:n,hidden:e.props.value!==i})))})}function k(e){const n=x(e);return(0,j.jsxs)("div",{className:(0,s.A)("tabs-container",f.tabList),children:[(0,j.jsx)(v,{...n,...e}),(0,j.jsx)(b,{...n,...e})]})}function y(e){const n=(0,m.A)();return(0,j.jsx)(k,{...e,children:u(e.children)},String(n))}},79621:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var t=r(58101);const s={},i=t.createContext(s);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);