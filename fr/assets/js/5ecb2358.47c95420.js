"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[2924],{70607:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"developers/custom-token-claims/create-script","title":"Cr\xe9er un script de revendications personnalis\xe9es pour le jeton","description":"Pour ajouter des revendications personnalis\xe9es au jeton d\u2019acc\xe8s (Access token), vous devez fournir un script qui retourne un objet contenant ces revendications. Le script doit \xeatre \xe9crit comme une fonction JavaScript qui retourne un objet avec les revendications personnalis\xe9es.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/developers/custom-token-claims/create-script.mdx","sourceDirName":"developers/custom-token-claims","slug":"/developers/custom-token-claims/create-script","permalink":"/fr/developers/custom-token-claims/create-script","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/fr/docusaurus-plugin-content-docs/current/developers/custom-token-claims/create-script.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"create-script","title":"Cr\xe9er un script de revendications personnalis\xe9es pour le jeton","sidebar_label":"Cr\xe9er un script de revendications personnalis\xe9es pour le jeton","sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Cas d\u2019utilisation courants","permalink":"/fr/developers/custom-token-claims/common-use-cases"},"next":{"title":"Usurpation d\u2019identit\xe9 utilisateur","permalink":"/fr/developers/user-impersonation"}}');var t=s(25105),r=s(79621);const o={id:"create-script",title:"Cr\xe9er un script de revendications personnalis\xe9es pour le jeton",sidebar_label:"Cr\xe9er un script de revendications personnalis\xe9es pour le jeton",sidebar_position:3},d="Cr\xe9er un script de revendications personnalis\xe9es pour le jeton",c={},l=[{value:"Impl\xe9menter la fonction <code>getCustomJwtClaims()</code>",id:"implement-getcustomjwtclaims-function",level:2},{value:"\xc9tape 1 : Modifier le script",id:"step-1-edit-the-script",level:2},{value:"\xc9tape 2 : Param\xe8tres d\u2019entr\xe9e",id:"step-2-input-parameters",level:2},{value:"token",id:"token",level:3},{value:"context (Disponible uniquement pour le jeton d\u2019acc\xe8s utilisateur)",id:"context-only-available-for-user-access-token",level:3},{value:"environmentVariables",id:"environmentvariables",level:3},{value:"api",id:"api",level:3},{value:"\xc9tape 3 : R\xe9cup\xe9rer des donn\xe9es externes",id:"step-3-fetch-external-data",level:2},{value:"\xc9tape 4 : Tester le script",id:"step-4-test-the-script",level:2}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components},{CloudLink:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("CloudLink",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"cr\xe9er-un-script-de-revendications-personnalis\xe9es-pour-le-jeton",children:"Cr\xe9er un script de revendications personnalis\xe9es pour le jeton"})}),"\n",(0,t.jsxs)(n.p,{children:["Pour ",(0,t.jsx)(n.a,{href:"/developers/custom-token-claims",children:"ajouter des revendications personnalis\xe9es"})," au ",(0,t.jsx)(n.a,{href:"https://auth.wiki/access-token",children:"jeton d\u2019acc\xe8s (Access token)"}),", vous devez fournir un script qui retourne un objet contenant ces revendications. Le script doit \xeatre \xe9crit comme une fonction ",(0,t.jsx)(n.code,{children:"JavaScript"})," qui retourne un objet avec les revendications personnalis\xe9es."]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Acc\xe9dez \xe0 ",(0,t.jsx)(s,{to:"/customize-jwt",children:"Console > JWT personnalis\xe9"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Il existe deux types diff\xe9rents de jetons d\u2019acc\xe8s pour lesquels vous pouvez personnaliser les revendications du jeton d\u2019acc\xe8s :"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Jeton d\u2019acc\xe8s utilisateur"})," : Le jeton d\u2019acc\xe8s d\xe9livr\xe9 pour les utilisateurs finaux. Par exemple, pour les applications Web ou mobiles."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Jeton d\u2019acc\xe8s machine \xe0 machine"})," : Le jeton d\u2019acc\xe8s d\xe9livr\xe9 pour les services ou applications. Par exemple, pour les ",(0,t.jsx)(n.a,{href:"/quick-starts/m2m",children:"applications machine \xe0 machine"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Diff\xe9rents types de jetons d\u2019acc\xe8s peuvent avoir des contextes de charge utile diff\xe9rents. Vous pouvez personnaliser les revendications du jeton pour chaque type de jeton d\u2019acc\xe8s s\xe9par\xe9ment."}),"\n",(0,t.jsxs)(n.p,{children:["Choisissez le type de jeton d\u2019acc\xe8s que vous souhaitez personnaliser, puis cliquez sur le bouton ",(0,t.jsx)(n.strong,{children:"Ajouter des revendications personnalis\xe9es"})," pour cr\xe9er un nouveau script."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.admonition,{type:"note",children:[(0,t.jsx)(n.p,{children:"La fonctionnalit\xe9 de revendications personnalis\xe9es pour le jeton est uniquement disponible pour :"}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["les utilisateurs de ",(0,t.jsx)(n.a,{href:"/logto-oss",children:"Logto OSS"})]}),"\n",(0,t.jsxs)(n.li,{children:["les locataires ",(0,t.jsx)(n.a,{href:"/logto-cloud/tenant-settings#development",children:"Logto Cloud avec un environnement de d\xe9veloppement"})]}),"\n",(0,t.jsxs)(n.li,{children:["les locataires Logto Cloud payants avec un environnement de production (y compris les ",(0,t.jsx)(n.a,{href:"https://logto.io/pricing",children:"locataires Pro et Enterprise"}),")"]}),"\n"]})]}),"\n",(0,t.jsxs)(n.h2,{id:"implement-getcustomjwtclaims-function",children:["Impl\xe9menter la fonction ",(0,t.jsx)(n.code,{children:"getCustomJwtClaims()"})]}),"\n",(0,t.jsxs)(n.p,{children:["Dans la page de d\xe9tails ",(0,t.jsx)(n.strong,{children:"JWT personnalis\xe9"}),", vous trouverez l\u2019\xe9diteur de script pour \xe9crire votre script de revendications personnalis\xe9es pour le jeton. Le script doit \xeatre une fonction ",(0,t.jsx)(n.code,{children:"JavaScript"})," qui retourne un objet de revendications personnalis\xe9es."]}),"\n",(0,t.jsx)("img",{src:"/img/assets/custom-jwt-detail-page.png",alt:"Page de d\xe9tails des revendications personnalis\xe9es pour le jeton"}),"\n",(0,t.jsx)(n.h2,{id:"step-1-edit-the-script",children:"\xc9tape 1 : Modifier le script"}),"\n",(0,t.jsxs)(n.p,{children:["Utilisez l\u2019\xe9diteur de code \xe0 gauche pour modifier le script. Un ",(0,t.jsx)(n.code,{children:"getCustomJwtClaims"})," par d\xe9faut avec une valeur de retour d\u2019objet vide est fourni pour commencer. Vous pouvez modifier la fonction pour retourner un objet contenant vos propres revendications personnalis\xe9es."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"const getCustomJwtClaims = async ({ token, context, environmentVariables }) => {\n  return {};\n};\n"})}),"\n",(0,t.jsx)(n.p,{children:"Cet \xe9diteur utilise le serveur de langage JavaScript pour fournir la coloration syntaxique de base, la compl\xe9tion de code et la v\xe9rification des erreurs. Les param\xe8tres d\u2019entr\xe9e sont bien typ\xe9s et document\xe9s au format jsDoc. Vous pouvez utiliser l\u2019IntelliSense de l\u2019\xe9diteur pour acc\xe9der correctement aux propri\xe9t\xe9s de l\u2019objet d\u2019entr\xe9e. Vous trouverez les d\xe9finitions d\xe9taill\xe9es des param\xe8tres sur le c\xf4t\xe9 droit de la page."}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["Cette fonction sera export\xe9e en tant que module. Assurez-vous de conserver le nom de la fonction ",(0,t.jsx)(n.code,{children:"getCustomJwtClaims"})," afin que le module puisse l\u2019exporter correctement."]})}),"\n",(0,t.jsx)(n.h2,{id:"step-2-input-parameters",children:"\xc9tape 2 : Param\xe8tres d\u2019entr\xe9e"}),"\n",(0,t.jsxs)(n.p,{children:["La fonction ",(0,t.jsx)(n.code,{children:"getCustomJwtClaims"})," prend un objet comme param\xe8tre d\u2019entr\xe9e. L\u2019objet d\u2019entr\xe9e contient les propri\xe9t\xe9s suivantes :"]}),"\n",(0,t.jsx)(n.h3,{id:"token",children:"token"}),"\n",(0,t.jsx)(n.p,{children:"L\u2019objet de charge utile du jeton. Cet objet contient les revendications originales du jeton et les m\xe9tadonn\xe9es auxquelles vous pouvez acc\xe9der dans le script."}),"\n",(0,t.jsx)(n.p,{children:"Vous trouverez la d\xe9finition de type d\xe9taill\xe9e de l\u2019objet de charge utile du jeton et de l\u2019objet de donn\xe9es utilisateur sur le c\xf4t\xe9 droit de la page. L\u2019IntelliSense de l\u2019\xe9diteur vous aidera \xe9galement \xe0 acc\xe9der correctement \xe0 ces propri\xe9t\xe9s de l\u2019objet d\u2019entr\xe9e."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Objet de donn\xe9es du jeton d\u2019acc\xe8s utilisateur","\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Propri\xe9t\xe9"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Type"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"jti"})}),(0,t.jsx)(n.td,{children:"L\u2019identifiant unique du JWT"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"aud"})}),(0,t.jsx)(n.td,{children:"L\u2019audience du jeton"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"scope"})}),(0,t.jsx)(n.td,{children:"Les port\xe9es du jeton"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"clientId"})}),(0,t.jsx)(n.td,{children:"L\u2019identifiant client du jeton"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"accountId"})}),(0,t.jsx)(n.td,{children:"L\u2019identifiant utilisateur du jeton"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"expiresWithSession"})}),(0,t.jsx)(n.td,{children:"Si le jeton expirera avec la session"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"boolean"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"grantId"})}),(0,t.jsx)(n.td,{children:"L\u2019identifiant de la subvention d\u2019authentification actuelle du jeton"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"gty"})}),(0,t.jsx)(n.td,{children:"Le type de subvention du jeton"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"kind"})}),(0,t.jsx)(n.td,{children:"Le type de jeton"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"AccessToken"})})]})]})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Objet de donn\xe9es du jeton d\u2019acc\xe8s machine \xe0 machine","\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Propri\xe9t\xe9"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Type"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"jti"})}),(0,t.jsx)(n.td,{children:"L\u2019identifiant unique du JWT"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"aud"})}),(0,t.jsx)(n.td,{children:"L\u2019audience du jeton"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"scope"})}),(0,t.jsx)(n.td,{children:"Les port\xe9es du jeton"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"clientId"})}),(0,t.jsx)(n.td,{children:"L\u2019identifiant client du jeton"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"kind"})}),(0,t.jsx)(n.td,{children:"Le type de jeton"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ClientCredentials"})})]})]})]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"context-only-available-for-user-access-token",children:"context (Disponible uniquement pour le jeton d\u2019acc\xe8s utilisateur)"}),"\n",(0,t.jsx)(n.p,{children:"L\u2019objet context contient les donn\xe9es utilisateur et les donn\xe9es de subvention pertinentes pour le processus d\u2019autorisation (Authorization) en cours."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Objet de donn\xe9es utilisateur"}),"\nPour le jeton d\u2019acc\xe8s utilisateur, Logto fournit un contexte de donn\xe9es utilisateur suppl\xe9mentaire auquel vous pouvez acc\xe9der. L\u2019objet de donn\xe9es utilisateur contient toutes les donn\xe9es de profil utilisateur et les donn\xe9es d\u2019appartenance \xe0 l\u2019organisation (Organization) dont vous pourriez avoir besoin pour configurer les revendications personnalis\xe9es. Veuillez consulter ",(0,t.jsx)(n.a,{href:"/user-management/user-data",children:"Utilisateurs"})," et ",(0,t.jsx)(n.a,{href:"/organizations/organization-data",children:"Organisations"})," pour plus de d\xe9tails."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Objet de donn\xe9es de subvention"}),"\nPour le jeton d\u2019acc\xe8s utilisateur accord\xe9 par \xe9change de jeton d\u2019usurpation, Logto fournit un contexte de donn\xe9es de subvention suppl\xe9mentaire auquel vous pouvez acc\xe9der. L\u2019objet de donn\xe9es de subvention contient le contexte personnalis\xe9 du jeton sujet. Veuillez consulter ",(0,t.jsx)(n.a,{href:"/developers/user-impersonation",children:"Usurpation d\u2019identit\xe9 utilisateur"})," pour plus de d\xe9tails."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Objet de donn\xe9es d\u2019interaction utilisateur"}),"\nPour un jeton d\u2019acc\xe8s utilisateur donn\xe9, il peut y avoir des cas o\xf9 vous devez acc\xe9der aux d\xe9tails d\u2019interaction de l\u2019utilisateur pour la session d\u2019autorisation (Authorization) en cours. Par exemple, vous pourriez avoir besoin de r\xe9cup\xe9rer l\u2019identit\xe9 SSO d\u2019entreprise de l\u2019utilisateur utilis\xe9e pour la connexion. Cet objet de donn\xe9es d\u2019interaction utilisateur contient les donn\xe9es d\u2019interaction les plus r\xe9centes soumises par l\u2019utilisateur, y compris :"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Propri\xe9t\xe9"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Type"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"interactionEvent"})}),(0,t.jsx)(n.td,{children:"L\u2019\xe9v\xe9nement d\u2019interaction de l\u2019utilisateur actuel"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"SignIn"})," ou ",(0,t.jsx)(n.code,{children:"Register"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"userId"})}),(0,t.jsx)(n.td,{children:"L\u2019identifiant utilisateur de l\u2019interaction utilisateur actuelle"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"verificationRecords"})}),(0,t.jsx)(n.td,{children:"Une liste d\u2019enregistrements de v\xe9rification soumis par l\u2019utilisateur pour s\u2019identifier et se v\xe9rifier lors des interactions."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"VerificationRecord[]"})})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"Type d\u2019enregistrement de v\xe9rification :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// VerificationType.Password\n{\n  id: string;\n  type: 'Password';\n  identifier: {\n    type: 'username' | 'email' | 'phone' | 'userId';\n    value: string;\n  }\n  verified: boolean;\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// VerificationType.EmailVerificationCode\n{\n  id: string;\n  templateType: 'SignIn' | 'Register' | 'ForgotPassword' | 'Generic';\n  verified: boolean;\n  type: 'EmailVerificationCode';\n  identifier: {\n    type: 'email';\n    value: string;\n  }\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// VerificationType.PhoneVerificationCode\n{\n  id: string;\n  templateType: 'SignIn' | 'Register' | 'ForgotPassword' | 'Generic';\n  verified: boolean;\n  type: 'PhoneVerificationCode';\n  identifier: {\n    type: 'phone';\n    value: string;\n  }\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// VerificationType.Social\n{\n  id: string;\n  type: 'Social';\n  connectorId: string;\n  socialUserInfo?: {\n    id: string;\n    email?: string | undefined;\n    phone?: string | undefined;\n    name?: string | undefined;\n    avatar?: string | undefined;\n    rawData?: Record<string, unknown> | undefined;\n  } | undefined;\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// VerificationType.EnterpriseSso\n{\n  id: string;\n  type: 'EnterpriseSso';\n  connectorId: string;\n  enterpriseUserInfo?: {\n    id: string;\n    email?: string | undefined;\n    phone?: string | undefined;\n    name?: string | undefined;\n    avatar?: string | undefined;\n    [key: string]?: unknown;\n  } | undefined;\n  issuer?: string | undefined;\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// VerificationType.Totp (MFA)\n{\n  id: string;\n  type: 'Totp';\n  userId: string;\n  verified: boolean;\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// VerificationType.WebAuthn (MFA)\n{\n  id: string;\n  type: 'WebAuthn';\n  userId: string;\n  verified: boolean;\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'// VerificationType.BackupCode (MFA)\n{\n  id: string;\n  type: "BackupCode";\n  userId: string;\n  code?: string | undefined;\n}\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:'// VerificationType.OneTimeToken\n{\n  id: string;\n  type: "OneTimeToken";\n  verified: boolean;\n  identifier: {\n    type: "email";\n    value: string;\n  };\n  oneTimeTokenContext?: {\n    jitOrganizationIds?: string[] | undefined;\n  } | undefined;\n}\n'})}),"\n",(0,t.jsxs)(n.admonition,{type:"note",children:[(0,t.jsx)(n.p,{children:"Il peut y avoir plusieurs enregistrements de v\xe9rification dans l\u2019objet de donn\xe9es d\u2019interaction utilisateur, en particulier lorsque l\u2019utilisateur a effectu\xe9 plusieurs processus de connexion ou d\u2019inscription."}),(0,t.jsxs)(n.p,{children:["Par exemple, l\u2019utilisateur s\u2019est connect\xe9 en utilisant un enregistrement de v\xe9rification ",(0,t.jsx)(n.code,{children:"Social"}),", puis a li\xe9 une nouvelle adresse e-mail via un enregistrement de v\xe9rification ",(0,t.jsx)(n.code,{children:"EmailVerificationCode"}),", puis a v\xe9rifi\xe9 le statut MFA avec un enregistrement de v\xe9rification ",(0,t.jsx)(n.code,{children:"Totp"}),". Dans ce cas, vous devrez peut-\xeatre g\xe9rer tous les enregistrements de v\xe9rification en cons\xe9quence dans votre script."]}),(0,t.jsx)(n.p,{children:"Chaque type d\u2019enregistrement de v\xe9rification ne sera pr\xe9sent qu\u2019une seule fois dans l\u2019objet de donn\xe9es d\u2019interaction utilisateur."})]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"environmentvariables",children:"environmentVariables"}),"\n",(0,t.jsxs)(n.p,{children:["Utilisez la section ",(0,t.jsx)(n.strong,{children:"D\xe9finir les variables d\u2019environnement"})," \xe0 droite pour configurer les variables d\u2019environnement pour votre script. Vous pouvez utiliser ces variables pour stocker des informations sensibles ou des donn\xe9es de configuration que vous ne souhaitez pas coder en dur dans le script. Par exemple, des cl\xe9s API, des secrets ou des URLs."]}),"\n",(0,t.jsxs)(n.p,{children:["Toutes les variables d\u2019environnement que vous d\xe9finissez ici seront disponibles dans le script. Utilisez l\u2019objet ",(0,t.jsx)(n.code,{children:"environmentVariables"})," dans le param\xe8tre d\u2019entr\xe9e pour acc\xe9der \xe0 ces variables."]}),"\n",(0,t.jsx)(n.h3,{id:"api",children:"api"}),"\n",(0,t.jsxs)(n.p,{children:["L\u2019objet ",(0,t.jsx)(n.code,{children:"api"})," fournit un ensemble de fonctions utilitaires que vous pouvez utiliser dans votre script pour un contr\xf4le d\u2019acc\xe8s suppl\xe9mentaire lors du processus de d\xe9livrance du jeton. L\u2019objet ",(0,t.jsx)(n.code,{children:"api"})," contient les fonctions suivantes :"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"api.denyAccess(message?: string): void\n"})}),"\n",(0,t.jsxs)(n.p,{children:["La fonction ",(0,t.jsx)(n.code,{children:"api.denyAccess()"})," vous permet de refuser le processus de d\xe9livrance du jeton avec un message personnalis\xe9. Vous pouvez utiliser cette fonction pour appliquer une validation d\u2019acc\xe8s suppl\xe9mentaire lors du processus de d\xe9livrance du jeton."]}),"\n",(0,t.jsx)(n.h2,{id:"step-3-fetch-external-data",children:"\xc9tape 3 : R\xe9cup\xe9rer des donn\xe9es externes"}),"\n",(0,t.jsxs)(n.p,{children:["Vous pouvez utiliser la fonction int\xe9gr\xe9e ",(0,t.jsx)(n.code,{children:"fetch"})," de node pour r\xe9cup\xe9rer des donn\xe9es externes dans votre script. La fonction ",(0,t.jsx)(n.code,{children:"fetch"})," est bas\xe9e sur les promesses et vous permet d\u2019effectuer des requ\xeates HTTP vers des API externes."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"const getCustomJwtClaims = async ({ environmentVariables }) => {\n  const response = await fetch('https://api.example.com/data', {\n    headers: {\n      Authorization: `Bearer ${environmentVariables.API_KEY}`,\n    },\n  });\n\n  const data = await response.json();\n\n  return {\n    data,\n  };\n};\n"})}),"\n",(0,t.jsxs)(n.admonition,{type:"note",children:[(0,t.jsx)(n.p,{children:"Attention, toute r\xe9cup\xe9ration de donn\xe9es externes peut introduire une latence dans le processus de d\xe9livrance du jeton. Assurez-vous que l\u2019API externe est fiable et suffisamment rapide pour r\xe9pondre \xe0 vos exigences."}),(0,t.jsx)(n.p,{children:"De plus :"}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"G\xe9rez correctement les erreurs et les d\xe9lais d\u2019attente dans votre script pour \xe9viter que le processus de d\xe9livrance du jeton ne soit bloqu\xe9."}),"\n",(0,t.jsx)(n.li,{children:"Utilisez des en-t\xeates d\u2019autorisation appropri\xe9s pour prot\xe9ger votre API externe contre les acc\xe8s non autoris\xe9s."}),"\n"]})]}),"\n",(0,t.jsx)(n.h2,{id:"step-4-test-the-script",children:"\xc9tape 4 : Tester le script"}),"\n",(0,t.jsxs)(n.p,{children:["Assurez-vous de tester votre script avant de l\u2019enregistrer. Cliquez sur l\u2019onglet ",(0,t.jsx)(n.strong,{children:"Contexte de test"})," \xe0 droite de la page pour modifier la charge utile du jeton simul\xe9e et le contexte de donn\xe9es utilisateur pour les tests."]}),"\n",(0,t.jsxs)(n.p,{children:["Cliquez sur ",(0,t.jsx)(n.strong,{children:"Ex\xe9cuter le test"})," dans le coin sup\xe9rieur droit de l\u2019\xe9diteur pour ex\xe9cuter le script avec les donn\xe9es simul\xe9es. Le r\xe9sultat du script s\u2019affichera dans le tiroir ",(0,t.jsx)(n.strong,{children:"R\xe9sultat du test"}),"."]}),"\n",(0,t.jsx)("img",{src:"/img/assets/test-custom-jwt-script.png",alt:"Tester le script JWT personnalis\xe9"}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["Le r\xe9sultat du test correspond \xe0 la sortie de la fonction ",(0,t.jsx)(n.code,{children:"getCustomJwtClaims"}),' avec les donn\xe9es simul\xe9es que vous avez d\xe9finies ("revendications suppl\xe9mentaires du jeton" obtenues apr\xe8s avoir termin\xe9 l\u2019\xe9tape 3 dans ',(0,t.jsx)(n.a,{href:"/developers/custom-token-claims/#how-do-custom-token-claims-work",children:"le diagramme de s\xe9quence"}),"). La charge utile r\xe9elle du jeton et le contexte de donn\xe9es utilisateur seront diff\xe9rents lorsque le script sera ex\xe9cut\xe9 lors du processus de d\xe9livrance du jeton."]})}),"\n",(0,t.jsxs)(n.p,{children:["Cliquez sur le bouton ",(0,t.jsx)(n.strong,{children:"Cr\xe9er"})," pour enregistrer le script. Le script de revendications personnalis\xe9es pour le jeton sera enregistr\xe9 et appliqu\xe9 au processus de d\xe9livrance du jeton d\u2019acc\xe8s (Access token)."]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},79621:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>d});var i=s(58101);const t={},r=i.createContext(t);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);