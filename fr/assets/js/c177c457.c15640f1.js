"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[96352],{38291:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>a,default:()=>c,frontMatter:()=>i,metadata:()=>r,toc:()=>u});const r=JSON.parse('{"id":"authorization/api-resources/node-express","title":"Guide : Node (Express)","description":"\xc9tape 1 : Extraire le Jeton d\u2019autorisation de l\'en-t\xeate de la requ\xeate \\\\","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/authorization/api-resources/node-express.mdx","sourceDirName":"authorization/api-resources","slug":"/authorization/api-resources/node-express","permalink":"/fr/authorization/api-resources/node-express","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/fr/docusaurus-plugin-content-docs/current/authorization/api-resources/node-express.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Guide : Python","permalink":"/fr/authorization/api-resources/python"},"next":{"title":"Guide : Spring Boot","permalink":"/fr/authorization/api-resources/spring-boot"}}');var o=n(25105),s=n(79621);const i={sidebar_position:3},a="Guide : Node (Express)",d={},u=[{value:"\xc9tape 1 : Extraire le Jeton d\u2019autorisation de l&#39;en-t\xeate de la requ\xeate",id:"step-1-extract-the-bearer-token-from-request-header",level:2},{value:"\xc9tape 2 : Validation du jeton",id:"step-2-token-validation",level:2},{value:"Installer <code>jose</code> comme d\xe9pendance",id:"install-jose-as-your-dependency",level:3},{value:"R\xe9cup\xe9rer les configurations OIDC de Logto",id:"retrieve-logtos-oidc-configurations",level:3},{value:"Ajouter un middleware d&#39;authentification",id:"add-auth-middleware",level:3},{value:"Appliquer le middleware \xe0 votre API",id:"apply-middleware-to-your-api",level:2},{value:"Ressources associ\xe9es",id:"related-resources",level:2}];function l(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components},{Url:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"guide--node-express",children:"Guide : Node (Express)"})}),"\n",(0,o.jsx)(t.h2,{id:"step-1-extract-the-bearer-token-from-request-header",children:"\xc9tape 1 : Extraire le Jeton d\u2019autorisation de l'en-t\xeate de la requ\xeate"}),"\n",(0,o.jsxs)(t.p,{children:["Une requ\xeate autoris\xe9e doit contenir un en-t\xeate ",(0,o.jsx)(t.code,{children:"Authorization"})," avec ",(0,o.jsx)(t.code,{children:"Bearer <access_token>"})," comme contenu. Extrayez le Jeton d\u2019autorisation de l'en-t\xeate de la requ\xeate :"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",children:"// auth_middleware.ts\n\nimport { IncomingHttpHeaders } from 'http';\n\nconst extractBearerTokenFromHeaders = ({ authorization }: IncomingHttpHeaders) => {\n  const bearerTokenIdentifier = 'Bearer';\n\n  if (!authorization) {\n    throw new Error({ code: 'auth.authorization_header_missing', status: 401 });\n  }\n\n  if (!authorization.startsWith(bearerTokenIdentifier)) {\n    throw new Error({ code: 'auth.authorization_token_type_not_supported', status: 401 });\n  }\n\n  return authorization.slice(bearerTokenIdentifier.length + 1);\n};\n"})}),"\n",(0,o.jsx)(t.h2,{id:"step-2-token-validation",children:"\xc9tape 2 : Validation du jeton"}),"\n",(0,o.jsxs)(t.p,{children:["Pour la d\xe9monstration, nous utilisons le package ",(0,o.jsx)(t.a,{href:"https://github.com/panva/jose",children:"jose"})," pour valider la signature du jeton, son statut d'expiration et les revendications requises."]}),"\n",(0,o.jsxs)(t.h3,{id:"install-jose-as-your-dependency",children:["Installer ",(0,o.jsx)(t.code,{children:"jose"})," comme d\xe9pendance"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"npm i jose --save\n"})}),"\n",(0,o.jsx)(t.h3,{id:"retrieve-logtos-oidc-configurations",children:"R\xe9cup\xe9rer les configurations OIDC de Logto"}),"\n",(0,o.jsxs)(t.p,{children:["Vous aurez besoin d'un ensemble de cl\xe9s publiques JWK et de l'\xe9metteur du jeton pour v\xe9rifier la signature et la source du jeton JWS re\xe7u. Toutes les derni\xe8res configurations d'autorisation publiques de Logto peuvent \xeatre trouv\xe9es \xe0 ",(0,o.jsx)(t.code,{children:"https://<your-logto-domain>/oidc/.well-known/openid-configuration"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["Par exemple, appelez ",(0,o.jsx)(t.code,{children:"https://tenant-id.logto.app/oidc/.well-known/openid-configuration"}),". Et localisez les deux champs suivants dans le corps de la r\xe9ponse :"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-json",children:'{\n  "jwks_uri": "https://tenant-id.logto.app/oidc/jwks",\n  "issuer": "https://tenant-id.logto.app/oidc"\n}\n'})}),"\n",(0,o.jsx)(t.h3,{id:"add-auth-middleware",children:"Ajouter un middleware d'authentification"}),"\n",(0,o.jsxs)(t.p,{children:["La m\xe9thode ",(0,o.jsx)(t.code,{children:"jwtVerify"})," de Jose peut vous aider \xe0 v\xe9rifier le format JWS du jeton, la signature du jeton, l'\xe9metteur, l'audience et le statut d'expiration. Une exception sera lev\xe9e si la validation \xe9choue."]}),"\n",(0,o.jsx)(t.admonition,{type:"warning",children:(0,o.jsxs)(t.p,{children:["Si vous utilisez le ",(0,o.jsx)(t.a,{href:"/authorization/role-based-access-control/protect-api-resources-with-rbac",children:"contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC)"}),", la validation de la port\xe9e est \xe9galement requise."]})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",children:"// auth-middleware.ts\n\nimport { createRemoteJWKSet, jwtVerify } from 'jose';\n\n//...\n\nexport const verifyAuthFromRequest = async (req, res, next) => {\n  // Extraire le jeton\n  const token = extractBearerTokenFromHeaders(req.headers);\n\n  const { payload } = await jwtVerify(\n    token, // Le Jeton d\u2019autorisation brut extrait de l'en-t\xeate de la requ\xeate\n    createRemoteJWKSet(new URL('https://<your-logto-domain>/oidc/jwks')), // g\xe9n\xe9rer un jwks en utilisant jwks_uri demand\xe9 au serveur Logto\n    {\n      // \xe9metteur attendu du jeton, doit \xeatre \xe9mis par le serveur Logto\n      issuer: 'https://<your-logto-domain>/oidc',\n      // audience attendue du jeton, doit \xeatre l'indicateur de ressource de l'API actuelle\n      audience: '<your request listener resource indicator>',\n    }\n  );\n\n  // si vous utilisez RBAC\n  assert(payload.scope.includes('some_scope'));\n\n  // logique personnalis\xe9e du payload\n  userId = payload.sub;\n\n  return next();\n};\n"})}),"\n",(0,o.jsx)(t.h2,{id:"apply-middleware-to-your-api",children:"Appliquer le middleware \xe0 votre API"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",children:"import { verifyAuthFromRequest } from '/middleware/auth-middleware.ts';\n\napp.get('/user/:id', verifyAuthFromRequest, (req, res, next) => {\n  // Code personnalis\xe9\n});\n"})}),"\n",(0,o.jsx)(t.h2,{id:"related-resources",children:"Ressources associ\xe9es"}),"\n",(0,o.jsx)(n,{href:"https://blog.logto.io/protect-your-express-js-api",children:(0,o.jsx)(t.p,{children:"Prot\xe9gez votre API Express.js avec JWT et Logto"})})]})}function c(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},79621:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>a});var r=n(58101);const o={},s=r.createContext(o);function i(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);