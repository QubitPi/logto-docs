"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[7460],{4542:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"use-cases/authorization/rbac-in-practice","title":"rbac-in-practice","description":"Un guide pratique du contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC) : Apprenez \xe0 concevoir des permissions, g\xe9rer des r\xf4les et mettre en place une autorisation s\xe9curis\xe9e dans votre CMS.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/use-cases/authorization/rbac-in-practice.mdx","sourceDirName":"use-cases/authorization","slug":"/use-cases/authorization/rbac-in-practice","permalink":"/fr/use-cases/authorization/rbac-in-practice","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/fr/docusaurus-plugin-content-docs/current/use-cases/authorization/rbac-in-practice.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"RBAC en pratique","description":"Un guide pratique du contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC) : Apprenez \xe0 concevoir des permissions, g\xe9rer des r\xf4les et mettre en place une autorisation s\xe9curis\xe9e dans votre CMS."},"sidebar":"useCasesSidebar","previous":{"title":"Autorisation","permalink":"/fr/use-cases/authorization/"},"next":{"title":"Multi-tenancy","permalink":"/fr/use-cases/multi-tenancy/"}}');var i=n(25105),t=n(79621);const o={sidebar_position:1,sidebar_label:"RBAC en pratique",description:"Un guide pratique du contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC) : Apprenez \xe0 concevoir des permissions, g\xe9rer des r\xf4les et mettre en place une autorisation s\xe9curis\xe9e dans votre CMS."},l="RBAC en pratique : Mettre en \u0153uvre une autorisation s\xe9curis\xe9e pour votre application",c={},a=[{value:"Comprendre les fondamentaux du RBAC",id:"understanding-rbac-fundamentals",level:2},{value:"Conception de permissions fines",id:"fine-grained-permission-design",level:3},{value:"Propri\xe9t\xe9 des ressources et contr\xf4le d\u2019acc\xe8s",id:"resource-ownership-and-access-control",level:3},{value:"Concevoir des APIs s\xe9curis\xe9es",id:"designing-a-secure-apis",level:2},{value:"Mettre en \u0153uvre le contr\xf4le d\u2019acc\xe8s pour votre API",id:"implement-access-control-for-your-api",level:3},{value:"Cr\xe9er un syst\xe8me de permissions \xe9volutif",id:"creating-a-permission-system-that-scales",level:3},{value:"Construire des r\xf4les efficaces",id:"building-effective-roles",level:2},{value:"Configurer le RBAC dans Logto",id:"config-rbac-in-logto",level:2},{value:"Configurer votre application",id:"setting-up-your-application",level:3},{value:"Configurer les ressources API et les permissions",id:"configuring-api-resources-and-permissions",level:3},{value:"Cr\xe9er des r\xf4les",id:"creating-roles",level:3},{value:"Attribuer des r\xf4les aux utilisateurs",id:"assigning-roles-to-users",level:3},{value:"Int\xe9grer votre frontend avec le RBAC Logto",id:"integrate-your-frontend-with-logto-rbac",level:2},{value:"Int\xe9grer votre backend avec le RBAC Logto",id:"integrate-your-backend-with-logto-rbac",level:2},{value:"Middleware d\u2019autorisation backend",id:"backend-authorization-middleware",level:3},{value:"Prot\xe9ger les points de terminaison API",id:"protecting-api-endpoints",level:3},{value:"Tester la mise en \u0153uvre du RBAC dans le CMS",id:"test-the-cms-rbac-implementation",level:2},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components},{Head:n}=s;return n||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n,{children:(0,i.jsx)("link",{rel:"canonical",href:"https://blog.logto.io/rbac-in-practice"})}),"\n",(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"rbac-en-pratique--mettre-en-\u0153uvre-une-autorisation-s\xe9curis\xe9e-pour-votre-application",children:"RBAC en pratique : Mettre en \u0153uvre une autorisation s\xe9curis\xe9e pour votre application"})}),"\n",(0,i.jsx)(s.p,{children:"Vous avez du mal \xe0 mettre en place un syst\xe8me d'autorisation s\xe9curis\xe9 et \xe9volutif pour votre application ? Le contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC) est la norme de l'industrie pour la gestion des permissions utilisateur, mais sa mise en \u0153uvre correcte peut \xeatre complexe. Ce tutoriel va vous montrer comment construire un syst\xe8me RBAC robuste \xe0 l\u2019aide d\u2019un exemple concret de syst\xe8me de gestion de contenu (CMS)."}),"\n",(0,i.jsx)(s.p,{children:"En suivant ce guide, vous apprendrez :"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"\u2728 Comment concevoir et mettre en \u0153uvre des permissions fines pour un contr\xf4le pr\xe9cis"}),"\n",(0,i.jsx)(s.li,{children:"\ud83d\udd12 Les meilleures pratiques pour organiser les permissions en r\xf4les significatifs"}),"\n",(0,i.jsx)(s.li,{children:"\ud83d\udc64 Des techniques pour g\xe9rer efficacement la propri\xe9t\xe9 des ressources"}),"\n",(0,i.jsx)(s.li,{children:"\ud83d\ude80 Des moyens de rendre votre syst\xe8me d\u2019autorisation \xe9volutif et maintenable"}),"\n",(0,i.jsx)(s.li,{children:"\ud83d\udca1 Une mise en \u0153uvre pratique \xe0 l\u2019aide d\u2019un exemple r\xe9el de CMS"}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["Le code source complet de ce tutoriel est disponible sur ",(0,i.jsx)(s.a,{href:"https://github.com/logto-io/rbac-sample",children:"GitHub"}),"."]}),"\n",(0,i.jsx)(s.h2,{id:"understanding-rbac-fundamentals",children:"Comprendre les fondamentaux du RBAC"}),"\n",(0,i.jsx)(s.p,{children:"Le contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC) ne consiste pas seulement \xe0 attribuer des permissions aux utilisateurs. Il s\u2019agit de cr\xe9er une approche structur\xe9e de l\u2019autorisation qui \xe9quilibre s\xe9curit\xe9 et maintenabilit\xe9."}),"\n",(0,i.jsxs)(s.p,{children:["Vous pouvez en apprendre davantage sur ",(0,i.jsx)(s.a,{href:"https://auth-wiki.logto.io/rbac",children:"Qu\u2019est-ce que le RBAC"})," dans l\u2019Auth Wiki."]}),"\n",(0,i.jsx)(s.p,{children:"Voici les principes cl\xe9s que nous suivrons dans notre mise en \u0153uvre :"}),"\n",(0,i.jsx)(s.h3,{id:"fine-grained-permission-design",children:"Conception de permissions fines"}),"\n",(0,i.jsx)(s.p,{children:'Des permissions fines vous donnent un contr\xf4le pr\xe9cis sur ce que les utilisateurs peuvent faire dans votre syst\xe8me. Au lieu de niveaux d\u2019acc\xe8s larges comme "admin" ou "utilisateur", nous d\xe9finissons des actions sp\xe9cifiques que les utilisateurs peuvent effectuer sur les ressources. Par exemple :'}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"read:articles"})," - Voir n\u2019importe quel article du syst\xe8me"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"create:articles"})," - Cr\xe9er de nouveaux articles"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"update:articles"})," - Modifier des articles existants"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"publish:articles"})," - Changer le statut de publication des articles"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"resource-ownership-and-access-control",children:"Propri\xe9t\xe9 des ressources et contr\xf4le d\u2019acc\xe8s"}),"\n",(0,i.jsx)(s.p,{children:"La propri\xe9t\xe9 des ressources est un concept fondamental dans la conception de l\u2019autorisation de notre CMS. Alors que le RBAC d\xe9finit quelles actions diff\xe9rents r\xf4les peuvent effectuer, la propri\xe9t\xe9 ajoute une dimension personnelle au contr\xf4le d\u2019acc\xe8s :"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Les auteurs ont automatiquement acc\xe8s aux articles qu\u2019ils ont cr\xe9\xe9s"}),"\n",(0,i.jsx)(s.li,{children:"Ce mod\xe8le naturel de propri\xe9t\xe9 signifie que les auteurs peuvent toujours voir et \xe9diter leur propre contenu"}),"\n",(0,i.jsx)(s.li,{children:"Le syst\xe8me v\xe9rifie \xe0 la fois les permissions de r\xf4le OU la propri\xe9t\xe9 lors du traitement des op\xe9rations sur les articles"}),"\n",(0,i.jsxs)(s.li,{children:["Par exemple, m\xeame sans la permission ",(0,i.jsx)(s.code,{children:"update:articles"}),", un auteur peut toujours modifier ses propres articles"]}),"\n",(0,i.jsx)(s.li,{children:"Cette conception r\xe9duit le besoin de permissions suppl\xe9mentaires tout en maintenant la s\xe9curit\xe9"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Cette approche \xe0 double couche (r\xf4les + propri\xe9t\xe9) cr\xe9e un syst\xe8me plus intuitif et s\xe9curis\xe9. Les \xe9diteurs et les administrateurs peuvent toujours g\xe9rer tout le contenu via leurs permissions de r\xf4le, tandis que les auteurs gardent le contr\xf4le sur leur propre travail."}),"\n",(0,i.jsx)(s.h2,{id:"designing-a-secure-apis",children:"Concevoir des APIs s\xe9curis\xe9es"}),"\n",(0,i.jsx)(s.p,{children:"Commen\xe7ons par concevoir la fonctionnalit\xe9 principale de notre CMS via ses points de terminaison API :"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"GET    /api/articles         # Lister tous les articles\nGET    /api/articles/:id     # Obtenir un article sp\xe9cifique\nPOST   /api/articles         # Cr\xe9er un nouvel article\nPATCH  /api/articles/:id     # Mettre \xe0 jour un article\nDELETE /api/articles/:id     # Supprimer un article\nPATCH  /api/articles/:id/published  # Changer le statut de publication\n"})}),"\n",(0,i.jsx)(s.h3,{id:"implement-access-control-for-your-api",children:"Mettre en \u0153uvre le contr\xf4le d\u2019acc\xe8s pour votre API"}),"\n",(0,i.jsx)(s.p,{children:"Pour chaque point de terminaison, nous devons consid\xe9rer deux aspects du contr\xf4le d\u2019acc\xe8s :"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsx)(s.li,{children:"Propri\xe9t\xe9 de la ressource - L\u2019utilisateur poss\xe8de-t-il cette ressource ?"}),"\n",(0,i.jsx)(s.li,{children:"Permissions bas\xe9es sur les r\xf4les - Le r\xf4le de l\u2019utilisateur autorise-t-il cette op\xe9ration ?"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Voici comment nous allons g\xe9rer l\u2019acc\xe8s pour chaque point de terminaison :"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Endpoint"}),(0,i.jsx)(s.th,{children:"Logique de contr\xf4le d\u2019acc\xe8s"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"GET /api/articles"}),(0,i.jsxs)(s.td,{children:["- Toute personne avec la permission ",(0,i.jsx)(s.code,{children:"list:articles"}),", OU les auteurs voient leurs propres articles"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["GET /api/articles/",":id"]}),(0,i.jsxs)(s.td,{children:["- Toute personne avec la permission ",(0,i.jsx)(s.code,{children:"read:articles"}),", OU l\u2019auteur de l\u2019article"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"POST /api/articles"}),(0,i.jsxs)(s.td,{children:["- Toute personne avec la permission ",(0,i.jsx)(s.code,{children:"create:articles"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["PATCH /api/articles/",":id"]}),(0,i.jsxs)(s.td,{children:["- Toute personne avec la permission ",(0,i.jsx)(s.code,{children:"update:articles"}),", OU l\u2019auteur de l\u2019article"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["DELETE /api/articles/",":id"]}),(0,i.jsxs)(s.td,{children:["- Toute personne avec la permission ",(0,i.jsx)(s.code,{children:"delete:articles"}),", OU l\u2019auteur de l\u2019article"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["PATCH /api/articles/",":id","/published"]}),(0,i.jsxs)(s.td,{children:["- Seuls les utilisateurs avec la permission ",(0,i.jsx)(s.code,{children:"publish:articles"})]})]})]})]}),"\n",(0,i.jsx)(s.h3,{id:"creating-a-permission-system-that-scales",children:"Cr\xe9er un syst\xe8me de permissions \xe9volutif"}),"\n",(0,i.jsx)(s.p,{children:"En fonction de nos besoins d\u2019acc\xe8s \xe0 l\u2019API, nous pouvons d\xe9finir ces permissions :"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Permission"}),(0,i.jsx)(s.th,{children:"Description"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["list",":articles"]}),(0,i.jsx)(s.td,{children:"Voir la liste de tous les articles du syst\xe8me"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["read",":articles"]}),(0,i.jsx)(s.td,{children:"Lire le contenu complet de n\u2019importe quel article"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["create",":articles"]}),(0,i.jsx)(s.td,{children:"Cr\xe9er de nouveaux articles"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["update",":articles"]}),(0,i.jsx)(s.td,{children:"Modifier n\u2019importe quel article"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["delete",":articles"]}),(0,i.jsx)(s.td,{children:"Supprimer n\u2019importe quel article"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["publish",":articles"]}),(0,i.jsx)(s.td,{children:"Changer le statut de publication"})]})]})]}),"\n",(0,i.jsx)(s.p,{children:"Notez que ces permissions ne sont n\xe9cessaires que pour acc\xe9der \xe0 des ressources que vous ne poss\xe9dez pas. Les propri\xe9taires d\u2019articles peuvent automatiquement :"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Voir leurs propres articles (pas besoin de ",(0,i.jsx)(s.code,{children:"read:articles"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:["Modifier leurs propres articles (pas besoin de ",(0,i.jsx)(s.code,{children:"update:articles"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:["Supprimer leurs propres articles (pas besoin de ",(0,i.jsx)(s.code,{children:"delete:articles"}),")"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"building-effective-roles",children:"Construire des r\xf4les efficaces"}),"\n",(0,i.jsx)(s.p,{children:"Maintenant que nous avons d\xe9fini notre API et nos permissions, nous pouvons cr\xe9er des r\xf4les qui regroupent logiquement ces permissions :"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Permission/R\xf4le"}),(0,i.jsx)(s.th,{children:"\ud83d\udc51 Admin"}),(0,i.jsx)(s.th,{children:"\ud83d\udcdd Publisher"}),(0,i.jsx)(s.th,{children:"\u270d\ufe0f Author"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Description"})}),(0,i.jsx)(s.td,{children:"Acc\xe8s complet au syst\xe8me pour la gestion du contenu"}),(0,i.jsx)(s.td,{children:"Peut voir tous les articles et g\xe9rer la publication"}),(0,i.jsx)(s.td,{children:"Peut cr\xe9er de nouveaux articles dans le syst\xe8me"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["list",":articles"]}),(0,i.jsx)(s.td,{children:"\u2705"}),(0,i.jsx)(s.td,{children:"\u2705"}),(0,i.jsx)(s.td,{children:"\u274c"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["read",":articles"]}),(0,i.jsx)(s.td,{children:"\u2705"}),(0,i.jsx)(s.td,{children:"\u2705"}),(0,i.jsx)(s.td,{children:"\u274c"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["create",":articles"]}),(0,i.jsx)(s.td,{children:"\u2705"}),(0,i.jsx)(s.td,{children:"\u274c"}),(0,i.jsx)(s.td,{children:"\u2705"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["update",":articles"]}),(0,i.jsx)(s.td,{children:"\u2705"}),(0,i.jsx)(s.td,{children:"\u274c"}),(0,i.jsx)(s.td,{children:"\u274c"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["delete",":articles"]}),(0,i.jsx)(s.td,{children:"\u2705"}),(0,i.jsx)(s.td,{children:"\u274c"}),(0,i.jsx)(s.td,{children:"\u274c"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["publish",":articles"]}),(0,i.jsx)(s.td,{children:"\u2705"}),(0,i.jsx)(s.td,{children:"\u2705"}),(0,i.jsx)(s.td,{children:"\u274c"})]})]})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Remarque"})," : Les auteurs ont automatiquement les permissions de lecture / modification / suppression sur leurs propres articles, ind\xe9pendamment des permissions de r\xf4le."]}),"\n",(0,i.jsx)(s.p,{children:"Chaque r\xf4le est con\xe7u avec des responsabilit\xe9s sp\xe9cifiques en t\xeate :"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Admin"})," : A le contr\xf4le total du CMS, y compris toutes les op\xe9rations sur les articles"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Publisher"})," : Se concentre sur la relecture du contenu et la gestion de la publication"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Author"})," : Sp\xe9cialis\xe9 dans la cr\xe9ation de contenu"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Cette structure de r\xf4les cr\xe9e une s\xe9paration claire des responsabilit\xe9s :"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Les auteurs se concentrent sur la cr\xe9ation de contenu"}),"\n",(0,i.jsx)(s.li,{children:"Les \xe9diteurs g\xe8rent la qualit\xe9 et la visibilit\xe9 du contenu"}),"\n",(0,i.jsx)(s.li,{children:"Les administrateurs maintiennent le contr\xf4le global du syst\xe8me"}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"config-rbac-in-logto",children:"Configurer le RBAC dans Logto"}),"\n",(0,i.jsxs)(s.p,{children:["Avant de commencer, vous devez cr\xe9er un compte sur ",(0,i.jsx)(s.a,{href:"https://cloud.logto.io",children:"Logto Cloud"}),", ou vous pouvez \xe9galement utiliser une instance Logto auto-h\xe9berg\xe9e en utilisant la ",(0,i.jsx)(s.a,{href:"/logto-oss",children:"version Logto OSS"}),"."]}),"\n",(0,i.jsx)(s.p,{children:"Mais pour ce tutoriel, nous utiliserons Logto Cloud pour plus de simplicit\xe9."}),"\n",(0,i.jsx)(s.h3,{id:"setting-up-your-application",children:"Configurer votre application"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:['Allez dans "Applications" dans la Console Logto pour cr\xe9er une nouvelle application React',"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Nom de l\u2019application : Content Management System"}),"\n",(0,i.jsx)(s.li,{children:"Type d\u2019application : Application Web traditionnelle"}),"\n",(0,i.jsxs)(s.li,{children:["URIs de redirection : ",(0,i.jsx)(s.a,{href:"http://localhost:5173/callback",children:"http://localhost:5173/callback"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://uploads.strapi.logto.io/cms_application_3ed42f2256.png",alt:"Application CMS React"})}),"\n",(0,i.jsx)(s.h3,{id:"configuring-api-resources-and-permissions",children:"Configurer les ressources API et les permissions"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:['Allez dans "Ressources API" dans la Console Logto pour cr\xe9er une nouvelle ressource API',"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Nom de l\u2019API : CMS API"}),"\n",(0,i.jsxs)(s.li,{children:["Identifiant de l\u2019API : ",(0,i.jsx)(s.a,{href:"https://api.cms.com",children:"https://api.cms.com"})]}),"\n",(0,i.jsxs)(s.li,{children:["Ajoutez les permissions \xe0 la ressource API","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"list:articles"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"read:articles"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"create:articles"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"update:articles"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"publish:articles"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"delete:articles"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://uploads.strapi.logto.io/cms_api_resource_b15ae2b91a.png",alt:"D\xe9tails de la ressource API CMS"})}),"\n",(0,i.jsx)(s.h3,{id:"creating-roles",children:"Cr\xe9er des r\xf4les"}),"\n",(0,i.jsx)(s.p,{children:"Allez dans R\xf4les dans la Console Logto pour cr\xe9er les r\xf4les suivants pour le CMS"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Admin","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"avec toutes les permissions"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Publisher","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["avec ",(0,i.jsx)(s.code,{children:"read:articles"}),", ",(0,i.jsx)(s.code,{children:"list:articles"}),", ",(0,i.jsx)(s.code,{children:"publish:articles"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Author","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["avec ",(0,i.jsx)(s.code,{children:"create:articles"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://uploads.strapi.logto.io/admin_role_53edb35ecf.png",alt:"R\xf4le Admin"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://uploads.strapi.logto.io/publisher_role_2ac205cc32.png",alt:"R\xf4le Publisher"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://uploads.strapi.logto.io/author_role_f89cd99543.png",alt:"R\xf4le Author"})}),"\n",(0,i.jsx)(s.h3,{id:"assigning-roles-to-users",children:"Attribuer des r\xf4les aux utilisateurs"}),"\n",(0,i.jsx)(s.p,{children:'Allez dans la section "Gestion des utilisateurs" dans la Console Logto pour cr\xe9er des utilisateurs.'}),"\n",(0,i.jsx)(s.p,{children:'Dans l\u2019onglet "R\xf4les" des d\xe9tails de l\u2019utilisateur, vous pouvez attribuer des r\xf4les \xe0 l\u2019utilisateur.'}),"\n",(0,i.jsx)(s.p,{children:"Dans notre exemple, nous cr\xe9ons 3 utilisateurs avec les r\xf4les suivants :"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Alex : Admin"}),"\n",(0,i.jsx)(s.li,{children:"Bob : Publisher"}),"\n",(0,i.jsx)(s.li,{children:"Charlie : Author"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://uploads.strapi.logto.io/user_management_c0bc17119f.png",alt:"Gestion des utilisateurs"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://uploads.strapi.logto.io/user_details_alex_702f96ef9a.png",alt:"D\xe9tails utilisateur - Alex"})}),"\n",(0,i.jsx)(s.admonition,{type:"note",children:(0,i.jsxs)(s.p,{children:["\xc0 des fins de d\xe9monstration, nous cr\xe9ons ces ressources et configurations via la Console Logto. Dans des projets r\xe9els, vous pouvez cr\xe9er ces ressources et configurations de mani\xe8re programmatique en utilisant la ",(0,i.jsx)(s.a,{href:"/integrate-logto/interact-with-management-api",children:"Management API"})," fournie par Logto."]})}),"\n",(0,i.jsx)(s.h2,{id:"integrate-your-frontend-with-logto-rbac",children:"Int\xe9grer votre frontend avec le RBAC Logto"}),"\n",(0,i.jsx)(s.p,{children:"Maintenant que nous avons configur\xe9 le RBAC dans Logto, nous pouvons commencer \xe0 l\u2019int\xe9grer dans notre frontend."}),"\n",(0,i.jsxs)(s.p,{children:["Commencez par suivre les ",(0,i.jsx)(s.a,{href:"/quick-starts",children:"Logto Quick Starts"})," pour int\xe9grer Logto dans votre application."]}),"\n",(0,i.jsxs)(s.p,{children:["Dans notre exemple, nous utilisons ",(0,i.jsx)(s.a,{href:"/quick-starts/react",children:"React"})," pour la d\xe9monstration."]}),"\n",(0,i.jsx)(s.p,{children:"Apr\xe8s avoir configur\xe9 Logto dans votre application, nous devons ajouter les configurations RBAC pour que Logto fonctionne."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-tsx",children:"// frontend/src/App.tsx\n\nconst logtoConfig: LogtoConfig = {\n  appId: LOGTO_APP_ID, // L\u2019ID de l\u2019application que vous avez cr\xe9\xe9 dans la Console Logto\n  endpoint: LOGTO_ENDPOINT, // L\u2019endpoint que vous avez cr\xe9\xe9 dans la Console Logto\n  resources: [API_RESOURCE], // L\u2019identifiant de la ressource API que vous avez cr\xe9\xe9 dans la Console Logto, par exemple https://api.cms.com\n  // Toutes les port\xe9es que vous souhaitez demander \xe0 la ressource API dans le frontend\n  scopes: [\n    'list:articles',\n    'create:articles',\n    'read:articles',\n    'update:articles',\n    'delete:articles',\n    'publish:articles',\n  ],\n};\n"})}),"\n",(0,i.jsx)(s.p,{children:"N\u2019oubliez pas de vous d\xe9connecter et de vous reconnecter pour que ce changement prenne effet si vous \xeates d\xe9j\xe0 connect\xe9."}),"\n",(0,i.jsx)(s.p,{children:"Lorsque l\u2019utilisateur se connecte avec Logto et demande un jeton d\u2019acc\xe8s pour les ressources API sp\xe9cifi\xe9es ci-dessus, Logto ajoutera les port\xe9es (permissions) li\xe9es au r\xf4le de l\u2019utilisateur dans le jeton d\u2019acc\xe8s."}),"\n",(0,i.jsxs)(s.p,{children:["Vous pouvez utiliser ",(0,i.jsx)(s.code,{children:"getAccessTokenClaims"})," du hook ",(0,i.jsx)(s.code,{children:"useLogto"})," pour obtenir les port\xe9es \xe0 partir du jeton d\u2019acc\xe8s."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-tsx",children:"// frontend/src/hooks/use-user-data.ts\n\nimport { useLogto } from '@logto/react';\nimport { API_RESOURCE } from '../config';\nimport { useState, useEffect } from 'react';\n\nexport const useUserData = () => {\n  const { getAccessTokenClaims } = useLogto();\n  const [userScopes, setUserScopes] = useState<string[]>([]);\n  const [userId, setUserId] = useState<string>();\n\n  useEffect(() => {\n    const fetchScopes = async () => {\n      const token = await getAccessTokenClaims(API_RESOURCE);\n      setUserScopes(token?.scope?.split(' ') ?? []);\n      setUserId(token?.sub);\n    };\n\n    fetchScopes();\n  }, [getAccessTokenClaims]);\n\n  return { userId, userScopes };\n};\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Et vous pouvez utiliser ",(0,i.jsx)(s.code,{children:"userScopes"})," pour v\xe9rifier si l\u2019utilisateur a la permission d\u2019acc\xe9der \xe0 la ressource."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-tsx",children:"// frontend/src/pages/Dashboard.tsx\n\nconst Dashboard = () => {\n  const { userId, userScopes } = useUserData();\n  // ...\n\n  return (\n    <div>\n      {/* ... */}\n      {(userScopes.includes('delete:articles') || article.ownerId === userId) && (\n        <button\n          onClick={() => handleDelete(article.id)}\n          className=\"text-red-600 hover:text-red-900\"\n        >\n          Delete\n        </button>\n      )}\n    </div>\n  );\n};\n"})}),"\n",(0,i.jsx)(s.h2,{id:"integrate-your-backend-with-logto-rbac",children:"Int\xe9grer votre backend avec le RBAC Logto"}),"\n",(0,i.jsx)(s.p,{children:"Il est maintenant temps d\u2019int\xe9grer le RBAC Logto dans votre backend."}),"\n",(0,i.jsx)(s.h3,{id:"backend-authorization-middleware",children:"Middleware d\u2019autorisation backend"}),"\n",(0,i.jsx)(s.p,{children:"Tout d\u2019abord, nous devons ajouter un middleware dans le backend pour v\xe9rifier les permissions utilisateur, s\u2019assurer que l\u2019utilisateur est connect\xe9 et d\xe9terminer s\u2019il dispose des permissions n\xe9cessaires pour acc\xe9der \xe0 certaines APIs."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-javascript",children:"// backend/src/middleware/auth.js\n\nconst { createRemoteJWKSet, jwtVerify } = require('jose');\n\nconst getTokenFromHeader = (headers) => {\n  const { authorization } = headers;\n  const bearerTokenIdentifier = 'Bearer';\n\n  if (!authorization) {\n    throw new Error('Authorization header missing');\n  }\n\n  if (!authorization.startsWith(bearerTokenIdentifier)) {\n    throw new Error('Authorization token type not supported');\n  }\n\n  return authorization.slice(bearerTokenIdentifier.length + 1);\n};\n\nconst hasScopes = (tokenScopes, requiredScopes) => {\n  if (!requiredScopes || requiredScopes.length === 0) {\n    return true;\n  }\n  const scopeSet = new Set(tokenScopes);\n  return requiredScopes.every((scope) => scopeSet.has(scope));\n};\n\nconst verifyJwt = async (token) => {\n  const JWKS = createRemoteJWKSet(new URL(process.env.LOGTO_JWKS_URL));\n\n  const { payload } = await jwtVerify(token, JWKS, {\n    issuer: process.env.LOGTO_ISSUER,\n    audience: process.env.LOGTO_API_RESOURCE,\n  });\n\n  return payload;\n};\n\nconst requireAuth = (requiredScopes = []) => {\n  return async (req, res, next) => {\n    try {\n      // Extraire le jeton\n      const token = getTokenFromHeader(req.headers);\n\n      // V\xe9rifier le jeton\n      const payload = await verifyJwt(token);\n\n      // Ajouter les infos utilisateur \xe0 la requ\xeate\n      req.user = {\n        id: payload.sub,\n        scopes: payload.scope?.split(' ') || [],\n      };\n\n      // V\xe9rifier les port\xe9es requises\n      if (!hasScopes(req.user.scopes, requiredScopes)) {\n        throw new Error('Insufficient permissions');\n      }\n\n      next();\n    } catch (error) {\n      res.status(401).json({ error: 'Unauthorized' });\n    }\n  };\n};\n\nmodule.exports = {\n  requireAuth,\n  hasScopes,\n};\n"})}),"\n",(0,i.jsx)(s.p,{children:"Comme vous pouvez le voir, dans ce middleware, nous v\xe9rifions si la requ\xeate frontend contient un jeton d\u2019acc\xe8s valide et si l\u2019audience du jeton d\u2019acc\xe8s correspond \xe0 la ressource API que nous avons cr\xe9\xe9e dans la Console Logto."}),"\n",(0,i.jsx)(s.p,{children:"La raison de la v\xe9rification de la ressource API est que notre ressource API repr\xe9sente en r\xe9alit\xe9 les ressources de notre backend CMS, et toutes nos permissions CMS sont associ\xe9es \xe0 cette ressource API."}),"\n",(0,i.jsx)(s.p,{children:"Puisque cette ressource API repr\xe9sente les ressources CMS dans Logto, dans notre code frontend, nous incluons le jeton d\u2019acc\xe8s correspondant lors des requ\xeates API vers le backend :"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"// frontend/src/hooks/use-api.ts\nexport const useApi = () => {\n  const { getAccessToken } = useLogto();\n\n  return useMemo(\n    () =>\n      async (endpoint: string, options: RequestInit = {}) => {\n        try {\n          // Obtenir le jeton d\u2019acc\xe8s pour la ressource API\n          const token = await getAccessToken(API_RESOURCE);\n\n          if (!token) {\n            throw new ApiRequestError('Failed to get access token');\n          }\n\n          const response = await fetch(`${API_BASE_URL}${endpoint}`, {\n            ...options,\n            headers: {\n              'Content-Type': 'application/json',\n              // Ajouter le jeton d\u2019acc\xe8s dans les en-t\xeates de la requ\xeate\n              Authorization: `Bearer ${token}`,\n              ...options.headers,\n            },\n          });\n\n          // ... gestion de la r\xe9ponse\n\n          return await response.json();\n        } catch (error) {\n          // ... gestion des erreurs\n        }\n      },\n    [getAccessToken]\n  );\n};\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Nous pouvons maintenant utiliser le middleware ",(0,i.jsx)(s.code,{children:"requireAuth"})," pour prot\xe9ger nos points de terminaison API."]}),"\n",(0,i.jsx)(s.h3,{id:"protecting-api-endpoints",children:"Prot\xe9ger les points de terminaison API"}),"\n",(0,i.jsxs)(s.p,{children:["Pour les APIs qui ne doivent \xeatre accessibles qu\u2019aux utilisateurs disposant de permissions sp\xe9cifiques, nous pouvons ajouter des restrictions directement dans le middleware. Par exemple, l\u2019API de cr\xe9ation d\u2019article ne doit \xeatre accessible qu\u2019aux utilisateurs ayant la permission ",(0,i.jsx)(s.code,{children:"create:articles"})," :"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-javascript",children:"// backend/src/routes/articles.js\n\nconst { requireAuth } = require('../middleware/auth');\n\nrouter.post('/articles', requireAuth(['create:articles']), async (req, res) => {\n  // ...\n});\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Pour les APIs qui doivent v\xe9rifier \xe0 la fois les permissions et la propri\xe9t\xe9 de la ressource, nous pouvons utiliser la fonction ",(0,i.jsx)(s.code,{children:"hasScopes"}),". Par exemple, dans l\u2019API de liste des articles, les utilisateurs ayant la port\xe9e ",(0,i.jsx)(s.code,{children:"list:articles"})," peuvent acc\xe9der \xe0 tous les articles, tandis que les auteurs peuvent acc\xe9der \xe0 leurs propres articles cr\xe9\xe9s :"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-javascript",children:"// backend/src/routes/articles.js\n\nconst { requireAuth, hasScopes } = require('../middleware/auth');\n\nrouter.get('/articles', requireAuth(), async (req, res) => {\n  try {\n    // Si l\u2019utilisateur a la port\xe9e list:articles, retourner tous les articles\n    if (hasScopes(req.user.scopes, ['list:articles'])) {\n      const articles = await articleDB.list();\n      return res.json(articles);\n    }\n\n    // Sinon, retourner uniquement les articles de l\u2019utilisateur\n    const articles = await articleDB.listByOwner(req.user.id);\n    res.json(articles);\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to fetch articles' });\n  }\n});\n"})}),"\n",(0,i.jsxs)(s.p,{children:["\xc0 ce stade, nous avons termin\xe9 la mise en \u0153uvre du RBAC. Vous pouvez consulter ",(0,i.jsx)(s.a,{href:"https://github.com/logto-io/rbac-sample",children:"le code source complet"})," pour voir l\u2019impl\xe9mentation compl\xe8te."]}),"\n",(0,i.jsx)(s.h2,{id:"test-the-cms-rbac-implementation",children:"Tester la mise en \u0153uvre du RBAC dans le CMS"}),"\n",(0,i.jsx)(s.p,{children:"Testons maintenant notre mise en \u0153uvre du RBAC dans le CMS \xe0 l\u2019aide des trois utilisateurs que nous venons de cr\xe9er."}),"\n",(0,i.jsx)(s.admonition,{type:"note",children:(0,i.jsx)(s.p,{children:'Si vous constatez que vous ne pouvez pas vous connecter avec les identifiants des utilisateurs cr\xe9\xe9s dans "Gestion des utilisateurs", vous devrez d\u2019abord activer la m\xe9thode de connexion appropri\xe9e. Allez dans "Exp\xe9rience de connexion" dans la Console Logto et activez votre m\xe9thode d\u2019authentification pr\xe9f\xe9r\xe9e (par exemple Email + Mot de passe ou Nom d\u2019utilisateur + Mot de passe).'})}),"\n",(0,i.jsx)(s.p,{children:"Commen\xe7ons par nous connecter en tant qu\u2019Alex et Charles respectivement et cr\xe9ons quelques articles."}),"\n",(0,i.jsx)(s.p,{children:"Puisqu\u2019Alex a le r\xf4le Admin, il peut cr\xe9er, supprimer, mettre \xe0 jour, publier et voir tous les articles."}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://uploads.strapi.logto.io/cms_dashboard_alex_a11863a94b.png",alt:"Tableau de bord CMS - Alex"})}),"\n",(0,i.jsx)(s.p,{children:"Charles, ayant le r\xf4le Author, ne peut cr\xe9er que ses propres articles et ne peut voir, mettre \xe0 jour et supprimer que les articles qu\u2019il poss\xe8de."}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://uploads.strapi.logto.io/cms_dashboard_charles_05f610066a.png",alt:"Tableau de bord CMS - Charles - Liste des articles"})}),"\n",(0,i.jsx)(s.p,{children:"Bob, avec le r\xf4le Publisher, peut voir et publier tous les articles mais ne peut pas les cr\xe9er, les mettre \xe0 jour ou les supprimer."}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://uploads.strapi.logto.io/cms_dashboard_bob_421a429b69.png",alt:"Tableau de bord CMS - Bob"})}),"\n",(0,i.jsx)(s.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsx)(s.p,{children:"F\xe9licitations ! Vous avez appris \xe0 mettre en \u0153uvre un syst\xe8me RBAC robuste dans votre application."}),"\n",(0,i.jsxs)(s.p,{children:["Pour des sc\xe9narios plus complexes, comme la cr\xe9ation d\u2019applications multi-locataires, Logto offre un support complet des organisations. Consultez notre guide ",(0,i.jsx)(s.a,{href:"/use-cases/multi-tenancy/build-multi-tenant-saas-application",children:"Construire une application SaaS multi-locataires : Guide complet de la conception \xe0 la mise en \u0153uvre"})," pour en savoir plus sur la mise en \u0153uvre du contr\xf4le d\u2019acc\xe8s \xe0 l\u2019\xe9chelle de l\u2019organisation."]}),"\n",(0,i.jsx)(s.p,{children:"Bon code ! \ud83d\ude80"})]})}function u(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},79621:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>l});var r=n(58101);const i={},t=r.createContext(i);function o(e){const s=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);