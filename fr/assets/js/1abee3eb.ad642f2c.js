"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[7923],{6753:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"use-cases/multi-tenancy/build-multi-tenant-saas-application","title":"build-multi-tenant-saas-application","description":"D\xe9couvrez comment construire efficacement une application SaaS multi-locataire avec une authentification robuste, une gestion des organisations et un contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/use-cases/multi-tenancy/build-multi-tenant-saas-application.mdx","sourceDirName":"use-cases/multi-tenancy","slug":"/use-cases/multi-tenancy/build-multi-tenant-saas-application","permalink":"/fr/use-cases/multi-tenancy/build-multi-tenant-saas-application","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/fr/docusaurus-plugin-content-docs/current/use-cases/multi-tenancy/build-multi-tenant-saas-application.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"sidebar_label":"Construire une application SaaS multi-locataire","description":"D\xe9couvrez comment construire efficacement une application SaaS multi-locataire avec une authentification robuste, une gestion des organisations et un contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les."},"sidebar":"useCasesSidebar","previous":{"title":"Multi-tenancy","permalink":"/fr/use-cases/multi-tenancy/"},"next":{"title":"IA","permalink":"/fr/use-cases/ai/"}}');var t=i(25105),o=i(79621);const a={sidebar_position:2,sidebar_label:"Construire une application SaaS multi-locataire",description:"D\xe9couvrez comment construire efficacement une application SaaS multi-locataire avec une authentification robuste, une gestion des organisations et un contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les."},r="Construire une application SaaS multi-locataire : Guide complet de la conception \xe0 l\u2019impl\xe9mentation",l={},c=[{value:"Quelles fonctionnalit\xe9s sont n\xe9cessaires pour l\u2019authentification et l\u2019autorisation SaaS ?",id:"what-features-are-required-for-saas-authentication-and-authorization",level:2},{value:"Architecture multi-locataire",id:"multi-tenant-architecture",level:3},{value:"Adh\xe9sion (Membership)",id:"membership",level:3},{value:"Conception des r\xf4les et permissions",id:"role-and-permission-design",level:3},{value:"Flux d\u2019inscription et de connexion",id:"sign-up-and-login-flow",level:3},{value:"Cr\xe9ation de locataire et invitation",id:"tenant-creation-and-invitation",level:3},{value:"Architecture technique et conception du syst\xe8me",id:"technical-architecture-and-system-design",level:2},{value:"D\xe9finir la strat\xe9gie d\u2019authentification",id:"define-authentication-strategy",level:3},{value:"Mettre en place l\u2019architecture multi-locataire",id:"establish-multi-tenant-architecture",level:3},{value:"Activer le contr\xf4le d\u2019acc\xe8s dans une application multi-locataire",id:"enable-access-control-in-multi-tenant-app",level:3},{value:"Stack technique",id:"tech-stack",level:2},{value:"Ajouter un flux d\u2019authentification de base \xe0 votre application",id:"add-basic-authentication-flow-to-your-app",level:2},{value:"Installer Logto dans votre application",id:"install-logto-to-your-app",level:3},{value:"Personnaliser les m\xe9thodes de connexion et d\u2019inscription",id:"customize-sign-in-and-sign-up-methods",level:3},{value:"Activer l\u2019authentification multi-facteurs",id:"enable-multi-factor-authentication",level:3},{value:"Ajouter l\u2019exp\xe9rience multi-locataire d\u2019organisation",id:"adding-multi-tenant-organization-experience",level:2},{value:"Obtenir les informations d\u2019organisation d\u2019un utilisateur",id:"get-a-user-s-organization-information",level:3},{value:"Cr\xe9er une organisation dans la console Logto",id:"create-organization-in-logto-console",level:3},{value:"Impl\xe9menter l\u2019exp\xe9rience de cr\xe9ation d\u2019organisation en self-service",id:"implement-self-serve-organization-creation-experience",level:2},{value:"Comprendre le flux d\u2019interaction d\u2019authentification d\u2019organisation",id:"understand-organization-auth-interaction-flow",level:3},{value:"Prot\xe9ger votre API backend",id:"protect-your-backend-api",level:3},{value:"Appeler la Management API Logto",id:"calling-logto-management-api",level:3},{value:"Impl\xe9menter le contr\xf4le d\u2019acc\xe8s dans votre application multi-locataire",id:"implement-access-control-to-your-multi-tenant-app",level:2},{value:"Utiliser le jeton d\u2019organisation Logto",id:"using-logto-organization-token",level:3},{value:"Impl\xe9menter le contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les au niveau organisation",id:"implement-organization-level-role-based-access-control-design",level:3},{value:"Ajouter plus de fonctionnalit\xe9s multi-locataires \xe0 votre application",id:"add-more-multi-tenant-app-features",level:2},{value:"R\xe9sum\xe9",id:"summary",level:2}];function u(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components},{Head:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i,{children:(0,t.jsx)("link",{rel:"canonical",href:"https://blog.logto.io/build-multi-tenant-saas-application"})}),"\n",(0,t.jsx)("style",{children:"\n  .twoColumn {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 24px;\n  }\n  .twoColumn + .twoColumn {\n    margin-top: 24px;\n  }\n"}),"\n",(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"construire-une-application-saas-multi-locataire--guide-complet-de-la-conception-\xe0-limpl\xe9mentation",children:"Construire une application SaaS multi-locataire : Guide complet de la conception \xe0 l\u2019impl\xe9mentation"})}),"\n",(0,t.jsx)(n.p,{children:"Comment des applications comme Notion, Slack ou Figma sont-elles construites ? Ces applications SaaS multi-locataires semblent simples \xe0 utiliser, mais en construire une soi-m\xeame ? C\u2019est une autre histoire."}),"\n",(0,t.jsx)(n.p,{children:"Quand j\u2019ai d\u2019abord envisag\xe9 de construire une telle b\xeate complexe, mon esprit a explos\xe9 :"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Les utilisateurs ont besoin de plusieurs options de connexion (e-mail, Google, GitHub)"}),"\n",(0,t.jsx)(n.li,{children:"Chaque utilisateur peut cr\xe9er et appartenir \xe0 plusieurs organisations"}),"\n",(0,t.jsx)(n.li,{children:"Diff\xe9rents niveaux de permissions au sein de chaque organisation"}),"\n",(0,t.jsx)(n.li,{children:"Les organisations d\u2019entreprise n\xe9cessitent une adh\xe9sion automatique pour certains domaines e-mail"}),"\n",(0,t.jsx)(n.li,{children:"Exigences MFA pour les op\xe9rations sensibles"}),"\n",(0,t.jsx)(n.li,{children:"Et plus encore..."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\xab Boss, parlons de la conception produit dans deux semaines. Je suis embourb\xe9 pour l\u2019instant. \xbb"}),"\n",(0,t.jsxs)(n.p,{children:["Mais quand j\u2019ai r\xe9ellement commenc\xe9 \xe0 travailler dessus, ",(0,t.jsx)(n.strong,{children:"j\u2019ai constat\xe9 que ce n\u2019\xe9tait pas aussi intimidant qu\u2019il n\u2019y para\xeet."})]}),"\n",(0,t.jsxs)(n.p,{children:["J\u2019ai ",(0,t.jsx)(n.strong,{children:"construit un syst\xe8me avec toutes ces fonctionnalit\xe9s avec \xe9tonnamment peu d\u2019efforts !"})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://uploads.strapi.logto.io/documind_home_page_e72468b8c9.png",alt:"documind-home-page.png"})}),"\n",(0,t.jsxs)("div",{className:"twoColumn",children:[(0,t.jsx)("img",{alt:"Tableau de bord Documind",src:"https://uploads.strapi.logto.io/documind_dashboard_4bd2a540d2.png",width:"500"}),(0,t.jsx)("img",{alt:"Page organisation Documind",src:"https://uploads.strapi.logto.io/documind_org_page_8157e40cd8.png",width:"500"})]}),"\n",(0,t.jsx)(n.p,{children:"Je vais vous montrer exactement comment concevoir et impl\xe9menter un tel syst\xe8me de A \xe0 Z \u2013 et vous serez \xe9tonn\xe9 de voir \xe0 quel point c\u2019est simple en 2025 avec les bons outils et la bonne approche architecturale."}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.strong,{children:["Le code source complet est disponible dans ce ",(0,t.jsx)(n.a,{href:"https://github.com/logto-io/multi-tenant-saas-sample",children:"Repo Github"}),". Allons-y !"]})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Nous allons commencer avec un produit SaaS de documentation IA appel\xe9 DocuMind."}),"\n",(0,t.jsx)(n.p,{children:"DocuMind est un produit SaaS de documentation IA con\xe7u avec un mod\xe8le multi-locataire pour prendre en charge les utilisateurs individuels, les petites entreprises et les entreprises."}),"\n",(0,t.jsx)(n.p,{children:"La plateforme offre de puissantes capacit\xe9s d\u2019IA pour la gestion documentaire, notamment la g\xe9n\xe9ration automatique de r\xe9sum\xe9s, l\u2019extraction des points cl\xe9s et des recommandations intelligentes de contenu au sein des organisations."}),"\n",(0,t.jsx)(n.h2,{id:"what-features-are-required-for-saas-authentication-and-authorization",children:"Quelles fonctionnalit\xe9s sont n\xe9cessaires pour l\u2019authentification et l\u2019autorisation SaaS ?"}),"\n",(0,t.jsx)(n.p,{children:"Commen\xe7ons par revoir les exigences n\xe9cessaires. Quelles fonctionnalit\xe9s vous faut-il ?"}),"\n",(0,t.jsx)(n.h3,{id:"multi-tenant-architecture",children:"Architecture multi-locataire"}),"\n",(0,t.jsxs)(n.p,{children:["Pour permettre une architecture multi-locataire, vous aurez besoin d\u2019une couche d\u2019entit\xe9 appel\xe9e ",(0,t.jsx)(n.strong,{children:"organisation (Organization)"}),". Imaginez un seul pool d\u2019utilisateurs pouvant acc\xe9der \xe0 plusieurs espaces de travail. Chaque organisation repr\xe9sente un espace de travail, et les utilisateurs conservent une identit\xe9 unique tout en acc\xe9dant \xe0 diff\xe9rents espaces de travail (organisations) selon leurs r\xf4les attribu\xe9s."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://uploads.strapi.logto.io/multi_tenant_app_architecture_89ed9779f8.svg",alt:"multi-tenant-app-architecture.svg"})}),"\n",(0,t.jsx)(n.p,{children:"C\u2019est une fonctionnalit\xe9 largement utilis\xe9e chez les fournisseurs d\u2019authentification. Une organisation dans un syst\xe8me de gestion d\u2019identit\xe9 correspond \xe0 l\u2019espace de travail, au projet ou au locataire de votre application SaaS."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://uploads.strapi.logto.io/organization_examples_dc60ad68bb.png",alt:"organization-examples.png"})}),"\n",(0,t.jsx)(n.h3,{id:"membership",children:"Adh\xe9sion (Membership)"}),"\n",(0,t.jsx)(n.p,{children:"Un membre est un concept temporaire utilis\xe9 pour indiquer le statut d\u2019adh\xe9sion d\u2019une identit\xe9 au sein d\u2019une organisation."}),"\n",(0,t.jsxs)(n.p,{children:["Par exemple, Sarah s\u2019inscrit \xe0 votre application avec son e-mail, ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.a,{href:"mailto:sarah@gmail.com",children:"sarah@gmail.com"})}),". Elle peut appartenir \xe0 diff\xe9rents espaces de travail. Si Sarah fait partie de ",(0,t.jsx)(n.strong,{children:"Workspace A"})," mais pas de ",(0,t.jsx)(n.strong,{children:"Workspace B"}),", elle est consid\xe9r\xe9e comme membre de ",(0,t.jsx)(n.strong,{children:"Workspace A"})," mais pas de ",(0,t.jsx)(n.strong,{children:"Workspace B"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"role-and-permission-design",children:"Conception des r\xf4les et permissions"}),"\n",(0,t.jsxs)(n.p,{children:["Dans une architecture multi-locataire, les utilisateurs ont besoin de ",(0,t.jsx)(n.strong,{children:"r\xf4les (Roles)"})," avec des ",(0,t.jsx)(n.strong,{children:"permissions (Permissions)"})," sp\xe9cifiques pour acc\xe9der \xe0 leurs ressources de locataire.\nLes permissions sont des contr\xf4les d\u2019acc\xe8s d\xe9taill\xe9s qui d\xe9finissent des actions sp\xe9cifiques, telles que ",(0,t.jsx)(n.code,{children:"read: order"})," ou ",(0,t.jsx)(n.code,{children:"write: order"}),". Elles d\xe9terminent quelles actions peuvent \xeatre effectu\xe9es sur des ressources particuli\xe8res."]}),"\n",(0,t.jsx)(n.p,{children:"Les r\xf4les sont un ensemble de permissions attribu\xe9es aux membres dans un environnement multi-locataire."}),"\n",(0,t.jsx)(n.p,{children:"Vous devrez d\xe9finir ces r\xf4les et permissions, puis attribuer des r\xf4les aux utilisateurs, parfois via des processus automatis\xe9s. Par exemple :"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Les utilisateurs qui rejoignent une organisation re\xe7oivent automatiquement le r\xf4le ",(0,t.jsx)(n.strong,{children:"membre"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Le premier utilisateur \xe0 cr\xe9er un espace de travail re\xe7oit automatiquement le r\xf4le ",(0,t.jsx)(n.strong,{children:"admin"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"sign-up-and-login-flow",children:"Flux d\u2019inscription et de connexion"}),"\n",(0,t.jsx)(n.p,{children:"Assurez-vous d\u2019un processus d\u2019inscription et d\u2019authentification convivial et s\xe9curis\xe9, incluant des options de connexion et d\u2019inscription de base :"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Connexion par e-mail et mot de passe"})," : M\xe9thode traditionnelle avec e-mail et mot de passe."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Connexion sans mot de passe"})," : Utilisez des codes de v\xe9rification par e-mail pour un acc\xe8s facile et s\xe9curis\xe9."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Gestion du compte"})," : Un centre de compte o\xf9 les utilisateurs peuvent mettre \xe0 jour leur e-mail, mot de passe et autres informations."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Connexion sociale"})," : Options comme Google et GitHub pour une connexion rapide."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Authentification multi-facteurs (MFA)"})," : Renforcez la s\xe9curit\xe9 en permettant la connexion via des applications d\u2019authentification comme Duo."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"tenant-creation-and-invitation",children:"Cr\xe9ation de locataire et invitation"}),"\n",(0,t.jsx)(n.p,{children:"Dans une application SaaS multi-locataire, une diff\xe9rence cl\xe9 dans le flux utilisateur est la n\xe9cessit\xe9 de prendre en charge la cr\xe9ation de locataire et l\u2019invitation de membres. Ce processus n\xe9cessite une planification et une ex\xe9cution minutieuses car il joue un r\xf4le cl\xe9 dans l\u2019activation et la croissance du produit."}),"\n",(0,t.jsx)(n.p,{children:"Voici quelques flux d\u2019utilisation typiques \xe0 consid\xe9rer :"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Type d\u2019utilisateur"}),(0,t.jsx)(n.th,{children:"Point d\u2019entr\xe9e"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Nouveau compte"}),(0,t.jsx)(n.td,{children:"Entr\xe9e depuis la page de connexion / inscription pour cr\xe9er un nouveau locataire"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Compte existant"}),(0,t.jsx)(n.td,{children:"Cr\xe9er un autre locataire dans le produit"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Compte existant re\xe7oit une invitation de locataire"}),(0,t.jsx)(n.td,{children:"Entr\xe9e depuis la page de connexion / inscription"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Compte existant re\xe7oit une invitation de locataire"}),(0,t.jsx)(n.td,{children:"Entr\xe9e depuis l\u2019e-mail d\u2019invitation"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Nouveau compte re\xe7oit une invitation de locataire"}),(0,t.jsx)(n.td,{children:"Entr\xe9e depuis la page de connexion / inscription"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Nouveau compte re\xe7oit une invitation de locataire"}),(0,t.jsx)(n.td,{children:"Entr\xe9e depuis l\u2019e-mail d\u2019invitation"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"Voici quelques sc\xe9narios courants que l\u2019on retrouve dans presque toutes les applications SaaS. Utilisez-les comme r\xe9f\xe9rence pour inspirer votre \xe9quipe produit et design, et n\u2019h\xe9sitez pas \xe0 cr\xe9er vos propres flux selon vos besoins."}),"\n",(0,t.jsxs)("div",{className:"twoColumn",children:[(0,t.jsx)("img",{alt:"Un nouveau compte cr\xe9e un locataire",src:"https://uploads.strapi.logto.io/a_new_account_creates_a_tenant_516d2e1132.png",width:"500"}),(0,t.jsx)("img",{alt:"Un utilisateur existant cr\xe9e un autre locataire",src:"https://uploads.strapi.logto.io/an_existing_user_creates_another_tenant_7f1340cee0.png",width:"500"})]}),"\n",(0,t.jsxs)("div",{className:"twoColumn",children:[(0,t.jsx)("img",{alt:"Un utilisateur existant se connecte",src:"https://uploads.strapi.logto.io/an_existing_user_sign_in_3c5f87b929.png",width:"500"}),(0,t.jsx)("img",{alt:"Un utilisateur existant rejoint via e-mail",src:"https://uploads.strapi.logto.io/an_existing_user_join_through_email_7aa94ea6f2.png",width:"500"})]}),"\n",(0,t.jsxs)("div",{className:"twoColumn",children:[(0,t.jsx)("img",{alt:"Un nouvel utilisateur se connecte",src:"https://uploads.strapi.logto.io/a_new_user_sign_in_e91499991c.png",width:"500"}),(0,t.jsx)("img",{alt:"Un nouvel utilisateur rejoint via e-mail",src:"https://uploads.strapi.logto.io/an_new_user_join_through_email_e16ef2cf79.png",width:"500"})]}),"\n",(0,t.jsx)(n.h2,{id:"technical-architecture-and-system-design",children:"Architecture technique et conception du syst\xe8me"}),"\n",(0,t.jsx)(n.p,{children:"Une fois que nous avons compris toutes les exigences produit, passons \xe0 l\u2019impl\xe9mentation."}),"\n",(0,t.jsx)(n.h3,{id:"define-authentication-strategy",children:"D\xe9finir la strat\xe9gie d\u2019authentification"}),"\n",(0,t.jsx)(n.p,{children:"L\u2019authentification peut faire peur. Les utilisateurs ont besoin de :"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Inscription / connexion par e-mail & mot de passe"}),"\n",(0,t.jsx)(n.li,{children:"Connexion en un clic avec Google / Github"}),"\n",(0,t.jsx)(n.li,{children:"R\xe9initialisation du mot de passe en cas d\u2019oubli"}),"\n",(0,t.jsx)(n.li,{children:"Connexion \xe0 l\u2019\xe9chelle de l\u2019\xe9quipe pour les clients entreprise"}),"\n",(0,t.jsx)(n.li,{children:"..."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Impl\xe9menter seulement ces fonctionnalit\xe9s de base pourrait prendre des semaines de d\xe9veloppement."}),"\n",(0,t.jsxs)(n.p,{children:["Mais aujourd\u2019hui, ",(0,t.jsx)(n.strong,{children:"nous n\u2019avons plus besoin de construire tout cela nous-m\xeames !"})]}),"\n",(0,t.jsxs)(n.p,{children:["Les fournisseurs d\u2019authentification modernes (je vais choisir ",(0,t.jsx)(n.a,{href:"https://logto.io/",children:"Logto"})," cette fois) ont emball\xe9 toutes ces fonctionnalit\xe9s pour nous. Le flux d\u2019authentification est simple :"]}),"\n",(0,t.jsx)(n.mermaid,{value:'sequenceDiagram\n  actor u as Utilisateur\n  participant a as Application\n  participant auth as FournisseurAuth\n\n  u->>a: Clique sur "Se connecter"\n  a->>auth: Redirige vers la page d\u2019authentification\n  auth->>u: Affiche la page de connexion\n  u->>auth: Saisit ses identifiants\n  auth->>a: Redirige avec le jeton\n  a->>u: Connexion r\xe9ussie'}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"De plusieurs semaines de d\xe9veloppement \xe0 15 minutes de configuration"}),", Logto g\xe8re tous les flux complexes pour nous ! Nous verrons les \xe9tapes d\u2019int\xe9gration dans la section impl\xe9mentation plus loin. Nous pouvons maintenant nous concentrer sur la construction des fonctionnalit\xe9s principales de DocuMind !"]}),"\n",(0,t.jsx)(n.h3,{id:"establish-multi-tenant-architecture",children:"Mettre en place l\u2019architecture multi-locataire"}),"\n",(0,t.jsx)(n.p,{children:"Le syst\xe8me d\u2019organisation permet aux utilisateurs de cr\xe9er et de rejoindre plusieurs organisations. Comprenons les relations principales :"}),"\n",(0,t.jsx)(n.mermaid,{value:'erDiagram\n    Utilisateur ||--o{ MembreOrganisation : "appartient \xe0"\n    Organisation ||--o{ MembreOrganisation : "a"\n\n    Utilisateur {\n        uuid id\n        string email\n        string nom\n    }\n    Organisation {\n        uuid id\n        string nom\n        string description\n    }\n    MembreOrganisation {\n        uuid userId\n        uuid organizationId\n    }'}),"\n",(0,t.jsx)(n.p,{children:"Dans ce syst\xe8me, chaque utilisateur peut appartenir \xe0 plusieurs organisations, et chaque organisation peut avoir plusieurs membres."}),"\n",(0,t.jsx)(n.mermaid,{value:"graph TD\n    App[Application]\n    O1[Organisation 1]\n    O2[Organisation 2]\n    M1[Membre]\n    M2[Membre]\n    M3[Membre]\n\n    App --\x3e O1\n    App --\x3e O2\n    O1 --\x3e M1\n    O1 --\x3e M2\n    O2 --\x3e M2\n    O2 --\x3e M3\n\n    style O1 fill:#e6ffe6\n    style O2 fill:#e6ffe6"}),"\n",(0,t.jsx)(n.h3,{id:"enable-access-control-in-multi-tenant-app",children:"Activer le contr\xf4le d\u2019acc\xe8s dans une application multi-locataire"}),"\n",(0,t.jsx)(n.p,{children:"Le contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC) est important pour garantir la s\xe9curit\xe9 et la scalabilit\xe9 dans les applications SaaS multi-locataires."}),"\n",(0,t.jsx)(n.p,{children:"Dans une application multi-locataire, la conception des permissions et des r\xf4les est g\xe9n\xe9ralement coh\xe9rente, car elle d\xe9coule de la conception produit. Par exemple, dans plusieurs espaces de travail, il y a g\xe9n\xe9ralement un r\xf4le admin et un r\xf4le membre. Logto, en tant que fournisseur d\u2019authentification, propose la conception suivante de contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les au niveau de l\u2019organisation :"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"D\xe9finitions de permissions unifi\xe9es"})," : Les permissions sont d\xe9finies au niveau du syst\xe8me et s\u2019appliquent de mani\xe8re coh\xe9rente \xe0 toutes les organisations, assurant une gestion des permissions maintenable et coh\xe9rente."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Mod\xe8les d\u2019organisation"})," : Combinaisons pr\xe9d\xe9finies de r\xf4les et permissions via des mod\xe8les d\u2019organisation, simplifiant l\u2019initialisation des organisations."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"La relation des permissions ressemble \xe0 ceci :"}),"\n",(0,t.jsx)(n.mermaid,{value:"graph TD\n    subgraph organization_template[Mod\xe8leOrganisation]\n        subgraph role_2[R\xf4le2]\n            permission_c[Permission C]\n            permission_d[Permission D]\n        end\n\n        subgraph role_1[R\xf4le1]\n            permission_a[Permission A]\n            permission_b[Permission B]\n        end\n    end\n\n    style organization_template fill:#e6ffe6\n    style role_1 fill:#ffe6e6\n    style role_2 fill:#ffe6e6"}),"\n",(0,t.jsx)(n.p,{children:"Puisque chaque utilisateur a besoin de son propre r\xf4le(s) dans chaque organisation, la relation entre les r\xf4les et les organisations doit refl\xe9ter les r\xf4les attribu\xe9s \xe0 chaque utilisateur :"}),"\n",(0,t.jsx)(n.mermaid,{value:"erDiagram\n    MembreOrganisation {\n        uuid userId\n        uuid organizationId\n        uuid[] roleIds\n        datetime joinedAt\n    }\n"}),"\n",(0,t.jsx)(n.p,{children:"Nous avons con\xe7u le syst\xe8me d\u2019organisation et le syst\xe8me de contr\xf4le d\u2019acc\xe8s, nous pouvons maintenant commencer \xe0 construire notre produit !"}),"\n",(0,t.jsx)(n.h2,{id:"tech-stack",children:"Stack technique"}),"\n",(0,t.jsx)(n.p,{children:"J\u2019ai choisi une stack facile \xe0 prendre en main et portable :"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Frontend"})," : React (facilement transf\xe9rable vers Vue / Angular / Svelte)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Backend"})," : Express (API simple et intuitive)"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Pourquoi s\xe9parer frontend et backend ? Parce que cela offre une architecture claire, facile \xe0 apprendre et simple \xe0 changer de stack. Et pour les fournisseurs d\u2019authentification, j\u2019utilise Logto comme exemple."}),"\n",(0,t.jsxs)(n.p,{children:["Et pour les guides suivants, ",(0,t.jsx)(n.strong,{children:"ces patterns fonctionnent avec : n\u2019importe quel frontend, n\u2019importe quel backend et n\u2019importe quel syst\xe8me d\u2019authentification."})]}),"\n",(0,t.jsx)(n.h2,{id:"add-basic-authentication-flow-to-your-app",children:"Ajouter un flux d\u2019authentification de base \xe0 votre application"}),"\n",(0,t.jsx)(n.p,{children:"C\u2019est l\u2019\xe9tape la plus simple. Nous avons juste \xe0 int\xe9grer Logto dans notre projet. Ensuite, nous pouvons configurer les m\xe9thodes de connexion / inscription utilisateur dans la Console Logto selon nos besoins."}),"\n",(0,t.jsx)(n.h3,{id:"install-logto-to-your-app",children:"Installer Logto dans votre application"}),"\n",(0,t.jsxs)(n.p,{children:["Connectez-vous d\u2019abord \xe0 ",(0,t.jsx)(n.a,{href:"https://cloud.logto.io/",children:"Logto Cloud"}),". Vous pouvez cr\xe9er un compte gratuit si vous n\u2019en avez pas. Cr\xe9ez un Tenant de d\xe9veloppement pour les tests."]}),"\n",(0,t.jsx)(n.p,{children:'Dans la Console du Tenant, cliquez sur le bouton "Application" \xe0 gauche. Puis s\xe9lectionnez React pour commencer \xe0 construire notre application.'}),"\n",(0,t.jsx)(n.p,{children:"Suivez le guide sur la page. Vous pouvez compl\xe9ter l\u2019int\xe9gration Logto en environ 5 minutes !"}),"\n",(0,t.jsx)(n.p,{children:"Voici mon code d\u2019int\xe9gration :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'const config: LogtoConfig = {\n  endpoint: "<YOUR_LOGTO_ENDPOINT>",\n  appId: "<YOUR_LOGTO_APP_ID>",\n};\n\nfunction App() {\n  return (\n    <LogtoProvider config={config}>\n      <div className="min-h-screen bg-gradient-to-b from-gray-50 to-gray-100">\n        <Routes>\n          {/* Ce callback g\xe8re la redirection de connexion utilisateur depuis Logto */}\n          <Route path="/callback" element={<Callback />} />\n          <Route path="/*" element={<AppContent />} />\n        </Routes>\n      </div>\n    </LogtoProvider>\n  );\n}\n\nfunction AppContent() {\n  const { isAuthenticated } = useLogto();\n\n  if (!isAuthenticated) {\n    // Afficher la page d\u2019accueil pour les utilisateurs non authentifi\xe9s\n    return <Landing />;\n  }\n\n  // Afficher l\u2019application principale pour les utilisateurs authentifi\xe9s\n  return (\n    <Routes>\n      {/* Le tableau de bord affiche toutes les organisations disponibles */}\n      <Route path="/" element={<Dashboard />} />\n\n      {/* Page organisation apr\xe8s avoir cliqu\xe9 sur une organisation dans le Dashboard */}\n      <Route path="/:orgId" element={<Organization />} />\n    </Routes>\n  );\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://uploads.strapi.logto.io/documind_home_page_e72468b8c9.png",alt:"documind-home-page.png"})}),"\n",(0,t.jsxs)(n.p,{children:["Voici une astuce utile : notre page de connexion comporte \xe0 la fois les boutons Se connecter et S\u2019inscrire. Le bouton S\u2019inscrire m\xe8ne directement \xe0 la page d\u2019inscription Logto. Cela fonctionne gr\xe2ce \xe0 la fonctionnalit\xe9 ",(0,t.jsx)(n.a,{href:"/end-user-flows/authentication-parameters/first-screen",children:"premier \xe9cran"})," de Logto. Elle d\xe9termine quelle \xe9tape du flux d\u2019authentification les utilisateurs voient en premier."]}),"\n",(0,t.jsx)(n.p,{children:"Vous pouvez afficher par d\xe9faut la page d\u2019inscription si votre produit attend beaucoup de nouveaux utilisateurs."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'function LandingPage() {\n  const { signIn } = useLogto();\n\n  return (\n    <div className="landing-container">\n      <div className="auth-buttons">\n        <button\n          className="sign-in-button"\n          onClick={() => {\n            signIn({\n              redirectUri: \'<YOUR_APP_CALLBACK_URL>\',\n            });\n          }}\n        >\n          Se connecter\n        </button>\n\n        <button\n          className="register-button"\n          onClick={() => {\n            signIn({\n              redirectUri: \'<YOUR_APP_CALLBACK_URL>\',\n              firstScreen: \'register\',\n            });\n          }}\n        >\n          S\u2019inscrire\n        </button>\n      </div>\n    </div>\n  );\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Apr\xe8s avoir cliqu\xe9 sur connexion, vous serez redirig\xe9 vers la page de connexion Logto. Apr\xe8s une connexion (ou inscription) r\xe9ussie, f\xe9licitations ! Votre application a son premier utilisateur (vous) !"}),"\n",(0,t.jsxs)(n.p,{children:["Et appelez la fonction ",(0,t.jsx)(n.code,{children:"signOut"})," du hook ",(0,t.jsx)(n.code,{children:"useLogto"})," pour d\xe9connecter l\u2019utilisateur quand vous le souhaitez."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"function SignOutButton() {\n  const { signOut } = useLogto();\n\n  return <button onClick={() => signOut('<YOUR_POST_LOGOUT_REDIRECT_URL>')}>Se d\xe9connecter</button>;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"customize-sign-in-and-sign-up-methods",children:"Personnaliser les m\xe9thodes de connexion et d\u2019inscription"}),"\n",(0,t.jsx)(n.p,{children:'Dans la Console Logto, cliquez sur "Exp\xe9rience de connexion" dans le menu de gauche. Puis cliquez sur l\u2019onglet "Inscription et connexion".\nSur cette page, suivez les instructions pour configurer les m\xe9thodes de connexion / inscription de Logto.'}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://uploads.strapi.logto.io/sign_in_experience_settings_68690b84f4.png",alt:"sign-in-experience-settings.png"})}),"\n",(0,t.jsx)(n.p,{children:"Et le flux de connexion ressemblera \xe0 ceci :"}),"\n",(0,t.jsx)("img",{alt:"Page de connexion Logto",src:"https://uploads.strapi.logto.io/sign_in_page_88ea6b5292.png",width:"500"}),"\n",(0,t.jsx)(n.h3,{id:"enable-multi-factor-authentication",children:"Activer l\u2019authentification multi-facteurs"}),"\n",(0,t.jsx)(n.p,{children:'Avec Logto, activer la MFA est simple. Cliquez simplement sur le bouton "Authentification multi-facteurs" dans la Console Logto. Puis activez-la sur la page d\u2019authentification multi-facteurs.'}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://uploads.strapi.logto.io/mfa_settings_d74c5492d7.png",alt:"mfa-settings.png"})}),"\n",(0,t.jsx)(n.p,{children:"Et le flux MFA ressemblera \xe0 ceci :"}),"\n",(0,t.jsxs)("div",{className:"twoColumn",children:[(0,t.jsx)("img",{alt:"\xc9tape de v\xe9rification MFA",src:"https://uploads.strapi.logto.io/verification_step_852fffe7da.png",width:"500"}),(0,t.jsx)("img",{alt:"Scanner le QR code dans l\u2019application d\u2019authentification",src:"https://uploads.strapi.logto.io/scan_auth_app_qr_code_68c2e26277.png",width:"500"})]}),"\n",(0,t.jsx)(n.p,{children:"Tout est si simple ! Nous avons mis en place un syst\xe8me d\u2019authentification utilisateur complexe en quelques minutes seulement !"}),"\n",(0,t.jsx)(n.h2,{id:"adding-multi-tenant-organization-experience",children:"Ajouter l\u2019exp\xe9rience multi-locataire d\u2019organisation"}),"\n",(0,t.jsx)(n.p,{children:"Nous avons maintenant notre premier utilisateur ! Cependant, cet utilisateur n\u2019appartient \xe0 aucune organisation pour l\u2019instant, et nous n\u2019avons cr\xe9\xe9 aucune organisation."}),"\n",(0,t.jsx)(n.p,{children:"Logto offre un support int\xe9gr\xe9 pour la multi-location. Vous pouvez cr\xe9er autant d\u2019organisations que vous le souhaitez dans Logto. Chaque organisation peut avoir plusieurs membres."}),"\n",(0,t.jsx)(n.mermaid,{value:"graph TD\n    T[Locataire Logto] --\x3e OrgA[Organisation A]\n    T --\x3e OrgB[Organisation B]\n    OrgA --\x3e MA1[Membre]\n    OrgA --\x3e MA2[Membre]\n    OrgB --\x3e MB1[Membre]\n    OrgB --\x3e MB2[Membre]\n\n    style OrgA fill:#e6ffe6\n    style OrgB fill:#e6ffe6\n"}),"\n",(0,t.jsx)(n.p,{children:"Chaque utilisateur peut obtenir ses informations d\u2019organisation depuis Logto. Cela permet la prise en charge de la multi-location."}),"\n",(0,t.jsx)(n.h3,{id:"get-a-user-s-organization-information",children:"Obtenir les informations d\u2019organisation d\u2019un utilisateur"}),"\n",(0,t.jsx)(n.p,{children:"Pour obtenir les informations d\u2019organisation d\u2019un utilisateur depuis Logto, suivez ces deux \xe9tapes :"}),"\n",(0,t.jsxs)(n.p,{children:["D\xe9clarez l\u2019acc\xe8s aux informations d\u2019organisation dans la configuration Logto. Cela se fait en d\xe9finissant les ",(0,t.jsx)(n.code,{children:"scopes"})," et ",(0,t.jsx)(n.code,{children:"resources"})," appropri\xe9s."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import { UserScope, ReservedResource } from "@logto/react";\nconst config: LogtoConfig = {\n  endpoint: "<YOUR_LOGTO_ENDPOINT>",\n  appId: "<YOUR_LOGTO_APP_ID>",\n  scopes: [UserScope.Organizations], // Valeur : "urn:logto:scope:organizations"\n  resources: [ReservedResource.Organization], // Valeur : "urn:logto:resource:organizations"\n};\n\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Utilisez la m\xe9thode ",(0,t.jsx)(n.code,{children:"fetchUserInfo"})," de Logto pour obtenir les informations utilisateur, y compris les donn\xe9es d\u2019organisation."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"function Dashboard() {\n  // Obtenir les infos utilisateur\n  const { fetchUserInfo } = useLogto();\n  const [organizations, setOrganizations] = useState<OrganizationData[]>([]);\n  const [loading, setLoading] = useState(false);\n\n  useEffect(() => {\n    const loadOrganizations = async () => {\n      try {\n        setLoading(true);\n        // Obtenir les infos utilisateur\n        const userInfo = await fetchUserInfo();\n        // Obtenir les infos d\u2019organisation de l\u2019utilisateur\n        const organizationData = userInfo?.organization_data || [];\n        setOrganizations(organizationData);\n      } catch (error) {\n        console.error('Impossible de r\xe9cup\xe9rer les organisations :', error);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    loadOrganizations();\n  }, [fetchUserInfo]);\n\n  if (loading) {\n    return <div>Chargement...</div>;\n  }\n\n  if (organizations.length === 0) {\n    return <div>Vous n\u2019\xeates membre d\u2019aucune organisation pour l\u2019instant</div>;\n  }\n\n  return <div>Organisations : {organizations.map(org => org.name).join(', ')}</div>;\n}\n\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Apr\xe8s avoir compl\xe9t\xe9 ces \xe9tapes, vous devez vous d\xe9connecter puis vous reconnecter. C\u2019est n\xe9cessaire car nous avons modifi\xe9 la port\xe9e (",(0,t.jsx)(n.code,{children:"scope"}),") et la ressource demand\xe9es."]}),"\n",(0,t.jsx)(n.p,{children:'Pour l\u2019instant, vous n\u2019avez cr\xe9\xe9 aucune organisation. L\u2019utilisateur n\u2019a rejoint aucune organisation non plus. Le tableau de bord affichera "Vous n\u2019avez pas encore d\u2019organisation".'}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://uploads.strapi.logto.io/dashboard_no_orgs_94678fe16f.png",alt:"dashboard-no-orgs.png"})}),"\n",(0,t.jsx)(n.p,{children:"Ensuite, nous allons cr\xe9er une organisation pour nos utilisateurs et les y ajouter."}),"\n",(0,t.jsx)(n.p,{children:"Gr\xe2ce \xe0 Logto, nous n\u2019avons pas besoin de construire des relations d\u2019organisation complexes. Nous avons juste \xe0 cr\xe9er une organisation dans Logto et y ajouter des utilisateurs. Logto g\xe8re toute la complexit\xe9 pour nous. Il existe deux fa\xe7ons de cr\xe9er des organisations :"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Cr\xe9er manuellement des organisations via la Console Logto"}),"\n",(0,t.jsx)(n.li,{children:"Utiliser la Management API de Logto pour cr\xe9er des organisations, notamment lors de la conception d\u2019un flux SaaS permettant aux utilisateurs de cr\xe9er leurs propres organisations (espaces de travail)."}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"create-organization-in-logto-console",children:"Cr\xe9er une organisation dans la console Logto"}),"\n",(0,t.jsx)(n.p,{children:'Cliquez sur le bouton "Organisations" dans le menu de gauche de la Console Logto. Cr\xe9ez une organisation.'}),"\n",(0,t.jsx)(n.p,{children:"Vous avez maintenant votre premi\xe8re organisation."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://uploads.strapi.logto.io/console_organizations_7312c72766.png",alt:"console-organizations.png"})}),"\n",(0,t.jsx)(n.p,{children:"Ensuite, ajoutons l\u2019utilisateur \xe0 cette organisation."}),"\n",(0,t.jsx)(n.p,{children:'Allez sur la page de d\xe9tails de l\u2019organisation. Passez \xe0 l\u2019onglet Membres. Cliquez sur le bouton "+ Ajouter un membre". S\xe9lectionnez votre utilisateur connect\xe9 dans la liste de gauche. Cliquez sur le bouton "Ajouter des membres" en bas \xe0 droite. Vous avez maintenant ajout\xe9 l\u2019utilisateur \xe0 cette organisation avec succ\xe8s.'}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://uploads.strapi.logto.io/console_add_member_to_orgs_ad21beb58f.png",alt:"console-add-member-to-orgs.png"})}),"\n",(0,t.jsx)(n.p,{children:"Rafra\xeechissez la page de votre application. Vous verrez que l\u2019utilisateur appartient maintenant \xe0 une organisation !"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://uploads.strapi.logto.io/dashboard_has_orgs_568a44cc1f.png",alt:"dashboard-has-orgs.png"})}),"\n",(0,t.jsx)(n.h2,{id:"implement-self-serve-organization-creation-experience",children:"Impl\xe9menter l\u2019exp\xe9rience de cr\xe9ation d\u2019organisation en self-service"}),"\n",(0,t.jsx)(n.p,{children:"Cr\xe9er une organisation dans la console ne suffit pas. Votre application SaaS a besoin d\u2019un flux permettant aux utilisateurs finaux de cr\xe9er et g\xe9rer facilement leurs propres espaces de travail. Pour impl\xe9menter cette fonctionnalit\xe9, utilisez la Management API de Logto."}),"\n",(0,t.jsxs)(n.p,{children:["Pour obtenir des conseils, consultez la documentation ",(0,t.jsx)(n.a,{href:"/integrate-logto/interact-with-management-api",children:"Interagir avec la Management API"})," pour configurer la communication API avec Logto."]}),"\n",(0,t.jsx)(n.h3,{id:"understand-organization-auth-interaction-flow",children:"Comprendre le flux d\u2019interaction d\u2019authentification d\u2019organisation"}),"\n",(0,t.jsx)(n.p,{children:"Prenons le flux de cr\xe9ation d\u2019organisation comme exemple. Voici comment fonctionne le processus de cr\xe9ation d\u2019organisation :"}),"\n",(0,t.jsx)(n.mermaid,{value:"sequenceDiagram\n  actor A as Utilisateur\n  participant B as Frontend\n  participant C as Backend\n  participant D as Logto\n\n  A->>B: Demande de cr\xe9ation d\u2019organisation\n  B->>C: POST /organizations\n  C->>D: POST /api/organizations\n  D--\x3e>C: Organisation cr\xe9\xe9e\n  C->>D: POST /api/organizations/{id}/users\n  D--\x3e>C: Utilisateur ajout\xe9 \xe0 l\u2019organisation\n  C--\x3e>B: R\xe9ponse de succ\xe8s\n  B--\x3e>A: Afficher le message de succ\xe8s"}),"\n",(0,t.jsx)(n.p,{children:"Ce flux a deux exigences d\u2019authentification cl\xe9s :"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Prot\xe9ger l\u2019API du service backend"})," :","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"L\u2019acc\xe8s frontend \xe0 notre API de service backend n\xe9cessite une authentification"}),"\n",(0,t.jsx)(n.li,{children:"Les endpoints API sont prot\xe9g\xe9s par la validation du Jeton d\u2019acc\xe8s (Access token) Logto de l\u2019utilisateur"}),"\n",(0,t.jsx)(n.li,{children:"Cela garantit que seuls les utilisateurs authentifi\xe9s peuvent acc\xe9der \xe0 nos services"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Acc\xe8s \xe0 la Management API Logto"})," :","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Le service backend doit appeler la Management API Logto de mani\xe8re s\xe9curis\xe9e"}),"\n",(0,t.jsxs)(n.li,{children:["Suivez le guide ",(0,t.jsx)(n.a,{href:"/integrate-logto/interact-with-management-api",children:"Interagir avec la Management API"})," pour la configuration"]}),"\n",(0,t.jsx)(n.li,{children:"Utilisez l\u2019authentification machine \xe0 machine pour obtenir les identifiants d\u2019acc\xe8s"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"protect-your-backend-api",children:"Prot\xe9ger votre API backend"}),"\n",(0,t.jsx)(n.p,{children:"Cr\xe9ons d\u2019abord un endpoint API dans notre service backend pour cr\xe9er des organisations."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"app.post('/organizations', async (req, res) => {\n  // Impl\xe9mentation utilisant la Management API Logto\n  // ...\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:"Notre API de service backend n\u2019autorise que les utilisateurs authentifi\xe9s. Nous devons utiliser Logto pour prot\xe9ger notre API. Nous devons aussi conna\xeetre les informations de l\u2019utilisateur courant (comme l\u2019ID utilisateur)."}),"\n",(0,t.jsx)(n.p,{children:"Dans le concept Logto (et OAuth 2.0), notre service backend agit comme un serveur de ressources. Les utilisateurs acc\xe8dent au serveur de ressources DocuMind avec un Jeton d\u2019acc\xe8s (Access token) depuis le frontend. Le serveur de ressources v\xe9rifie ce jeton. S\u2019il est valide, il retourne les ressources demand\xe9es."}),"\n",(0,t.jsx)(n.p,{children:"Cr\xe9ons une Ressource API pour repr\xe9senter notre service backend."}),"\n",(0,t.jsx)(n.p,{children:"Allez dans la Console Logto."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:'Cliquez sur le bouton "Ressources API" \xe0 droite.'}),"\n",(0,t.jsx)(n.li,{children:'Cliquez sur "Cr\xe9er une ressource API". S\xe9lectionnez Express dans la popup.'}),"\n",(0,t.jsxs)(n.li,{children:['Saisissez "DocuMind API" comme nom d\u2019API. Utilisez "',(0,t.jsx)(n.a,{href:"https://api.documind.com/",children:"https://api.documind.com"}),'" comme identifiant d\u2019API.']}),"\n",(0,t.jsx)(n.li,{children:"Cliquez sur cr\xe9er."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Ne vous inqui\xe9tez pas pour cet identifiant d\u2019API. C\u2019est juste un identifiant unique pour votre API dans Logto. Il n\u2019est pas li\xe9 \xe0 l\u2019URL r\xe9elle de votre service backend."}),"\n",(0,t.jsx)(n.p,{children:"Vous verrez un tutoriel pour utiliser la ressource API. Vous pouvez suivre ce tutoriel ou nos \xe9tapes ci-dessous."}),"\n",(0,t.jsx)(n.p,{children:"Cr\xe9ons un middleware requireAuth pour prot\xe9ger notre endpoint POST /organizations."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"const { createRemoteJWKSet, jwtVerify } = require('jose');\n\nconst getTokenFromHeader = (headers) => {\n  const { authorization } = headers;\n  const bearerTokenIdentifier = 'Bearer';\n\n  if (!authorization) {\n    throw new Error('Authorization header missing');\n  }\n\n  if (!authorization.startsWith(bearerTokenIdentifier)) {\n    throw new Error('Authorization token type not supported');\n  }\n\n  return authorization.slice(bearerTokenIdentifier.length + 1);\n};\n\nconst requireAuth = (resource) => {\n  if (!resource) {\n    throw new Error('Resource parameter is required for authentication');\n  }\n\n  return async (req, res, next) => {\n    try {\n      // Extraire le jeton\n      const token = getTokenFromHeader(req.headers);\n\n      const { payload } = await jwtVerify(\n        token,\n        createRemoteJWKSet(new URL(process.env.LOGTO_JWKS_URL)),\n        {\n          issuer: process.env.LOGTO_ISSUER,\n          audience: resource,\n        }\n      );\n\n      // Ajouter les infos utilisateur \xe0 la requ\xeate\n      req.user = {\n        id: payload.sub,\n      };\n\n      next();\n    } catch (error) {\n      console.error('Erreur d\u2019authentification :', error);\n      res.status(401).json({ error: 'Non autoris\xe9' });\n    }\n  };\n};\n\nmodule.exports = {\n  requireAuth,\n};\n"})}),"\n",(0,t.jsx)(n.p,{children:"Pour utiliser ce middleware, nous avons besoin de ces variables d\u2019environnement :"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"LOGTO_JWKS_URL"}),"\n",(0,t.jsx)(n.li,{children:"LOGTO_ISSUER"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Obtenez ces variables depuis l\u2019endpoint OpenID Configuration de votre tenant Logto. Rendez-vous sur ",(0,t.jsx)(n.code,{children:"https://<your-tenant-id>.logto.app/oidc/.well-known/openid-configuration"}),". Vous trouverez les informations n\xe9cessaires dans le JSON retourn\xe9 :"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "jwks_uri": "<https://tenant-id.logto.app/oidc/jwks>",\n  "issuer": "<https://tenant-id.logto.app/oidc>"\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"Utilisons maintenant le middleware requireAuth dans notre endpoint POST /organizations."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"app.post('/organizations', requireAuth('<https://api.documind.com>'), async (req, res) => {\n  // G\xe9rer la logique de cr\xe9ation d\u2019organisation\n  // ...\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:"Cela prot\xe8ge notre endpoint POST /organizations. Seuls les utilisateurs avec un Jeton d\u2019acc\xe8s (Access token) Logto valide peuvent y acc\xe9der."}),"\n",(0,t.jsx)(n.p,{children:"Nous pouvons maintenant obtenir le jeton depuis Logto dans notre frontend. Les utilisateurs peuvent cr\xe9er des organisations via notre service backend avec ce jeton. Le middleware nous donne aussi l\u2019ID utilisateur. Cela aide lors de l\u2019ajout d\u2019utilisateurs aux organisations."}),"\n",(0,t.jsx)(n.p,{children:"Dans le code frontend, d\xe9clarez cette ressource API dans la config Logto. Ajoutez son identifiant au tableau resources."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'const config: LogtoConfig = {\n  endpoint: "<YOUR_LOGTO_ENDPOINT>",\n  appId: "<YOUR_LOGTO_APP_ID>",\n  scopes: [UserScope.Organizations],\n  resources: [ReservedResource.Organization, "<https://api.documind.com>"], // Identifiant de la ressource API nouvellement cr\xe9\xe9e\n};\n\n'})}),"\n",(0,t.jsx)(n.p,{children:"Comme pr\xe9c\xe9demment, les utilisateurs doivent se reconnecter apr\xe8s la mise \xe0 jour de la config Logto."}),"\n",(0,t.jsx)(n.p,{children:"Dans le Dashboard, obtenez le Jeton d\u2019acc\xe8s Logto lors de la cr\xe9ation d\u2019une organisation. Utilisez ce jeton pour acc\xe9der \xe0 notre API de service backend."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"// Obtenir le jeton d\u2019acc\xe8s pour \"DocuMind API\"\nconst token = await getAccessToken('<https://api.documind.com>');\n\n// Acc\xe9der \xe0 notre API de service backend avec le jeton\nconst response = await fetch('<http://localhost:3000/organizations>', {\n  method: 'POST',\n  headers: {\n    'Content-Type': 'application/json',\n    Authorization: `Bearer ${token}`,\n  },\n  body: JSON.stringify({\n    name: 'Organisation A',\n    description: 'Description de l\u2019Organisation A',\n  }),\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:"Nous pouvons maintenant acc\xe9der correctement \xe0 l\u2019API de service backend DocuMind."}),"\n",(0,t.jsx)(n.h3,{id:"calling-logto-management-api",children:"Appeler la Management API Logto"}),"\n",(0,t.jsx)(n.p,{children:"Impl\xe9mentons la cr\xe9ation d\u2019organisation en utilisant la Management API Logto."}),"\n",(0,t.jsx)(n.p,{children:"Comme pour les requ\xeates frontend vers le backend, les requ\xeates backend vers Logto n\xe9cessitent des Jetons d\u2019acc\xe8s (Access tokens)."}),"\n",(0,t.jsxs)(n.p,{children:["Dans Logto, nous utilisons l\u2019authentification machine \xe0 machine pour les Jetons d\u2019acc\xe8s. Voir ",(0,t.jsx)(n.a,{href:"/integrate-logto/interact-with-management-api",children:"Interagir avec la Management API"}),"."]}),"\n",(0,t.jsx)(n.p,{children:'Allez sur la page des applications dans la Console Logto. Cr\xe9ez une application machine \xe0 machine. Attribuez le r\xf4le "Acc\xe8s \xe0 la Management API Logto". Copiez l\u2019endpoint Token, l\u2019ID d\u2019application et le secret d\u2019application. Nous les utiliserons pour obtenir les Jetons d\u2019acc\xe8s.'}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://uploads.strapi.logto.io/m2m_application_d882b6386e.png",alt:"m2m-application.png"})}),"\n",(0,t.jsx)(n.p,{children:"Nous pouvons maintenant obtenir des Jetons d\u2019acc\xe8s \xe0 la Management API Logto via cette application M2M."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"async function fetchLogtoManagementApiAccessToken() {\n  const response = await fetch(process.env.LOGTO_MANAGEMENT_API_TOKEN_ENDPOINT, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded',\n      Authorization: `Basic ${Buffer.from(\n        `${process.env.LOGTO_MANAGEMENT_API_APPLICATION_ID}:${process.env.LOGTO_MANAGEMENT_API_APPLICATION_SECRET}`\n      ).toString('base64')}`,\n    },\n    body: new URLSearchParams({\n      grant_type: 'client_credentials',\n      resource: process.env.LOGTO_MANAGEMENT_API_RESOURCE,\n      scope: 'all',\n    }).toString(),\n  });\n  const data = await response.json();\n  return data.access_token;\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:"Utilisez ce Jeton d\u2019acc\xe8s pour appeler la Management API Logto."}),"\n",(0,t.jsx)(n.p,{children:"Nous utiliserons ces APIs de gestion :"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"POST /api/organizations"})," : Cr\xe9er une organisation (voir : ",(0,t.jsx)(n.a,{href:"https://openapi.logto.io/operation/operation-createorganization",children:"R\xe9f\xe9rence API cr\xe9ation d\u2019organisation"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"POST /api/organizations/{id}/users"})," : Ajouter des utilisateurs \xe0 une organisation (voir : ",(0,t.jsx)(n.a,{href:"https://openapi.logto.io/operation/operation-addusers",children:"R\xe9f\xe9rence API ajout d\u2019utilisateurs"}),")"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"app.post('/organizations', requireAuth('<https://api.documind.com>'), async (req, res) => {\n  const accessToken = await fetchLogtoManagementApiAccessToken();\n  // Cr\xe9er l\u2019organisation dans Logto, et y ajouter l\u2019utilisateur\n  const response = await fetch(`${process.env.LOGTO_ENDPOINT}/api/organizations`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      Authorization: `Bearer ${accessToken}`,\n    },\n    body: JSON.stringify({\n      name: req.body.name,\n      description: req.body.description,\n    }),\n  });\n\n  const createdOrganization = await response.json();\n\n  await fetch(`${process.env.LOGTO_ENDPOINT}/api/organizations/${createdOrganization.id}/users`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      Authorization: `Bearer ${accessToken}`,\n    },\n    body: JSON.stringify({\n      userIds: [req.user.id],\n    }),\n  });\n\n  res.json({ data: createdOrganization });\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:"Nous avons maintenant impl\xe9ment\xe9 la cr\xe9ation d\u2019organisation via la Management API Logto. Nous pouvons aussi ajouter des utilisateurs aux organisations."}),"\n",(0,t.jsx)(n.p,{children:"Testons cette fonctionnalit\xe9 dans le Dashboard."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://uploads.strapi.logto.io/dashboard_create_org_b703f1125b.png",alt:"dashboard-create-org.png"})}),"\n",(0,t.jsx)(n.p,{children:"et cliquez sur \u201cCr\xe9er une organisation\u201d"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://uploads.strapi.logto.io/dashboard_has_orgs_568a44cc1f.png",alt:"dashboard-has-orgs.png"})}),"\n",(0,t.jsx)(n.p,{children:"Cr\xe9ation r\xe9ussie !"}),"\n",(0,t.jsxs)(n.p,{children:["L\u2019\xe9tape suivante serait d\u2019inviter des utilisateurs dans une organisation. Nous n\u2019impl\xe9menterons pas cette fonctionnalit\xe9 dans notre tutoriel pour l\u2019instant. Vous savez d\xe9j\xe0 comment utiliser la Management API. Vous pouvez vous r\xe9f\xe9rer \xe0 ",(0,t.jsx)(n.a,{href:"#tenant-creation-and-invitation",children:(0,t.jsx)(n.strong,{children:"Cr\xe9ation de locataire et invitation"})})," comme r\xe9f\xe9rence de conception produit et impl\xe9menter facilement cette fonctionnalit\xe9 en suivant cet article de blog : ",(0,t.jsx)(n.a,{href:"https://blog.logto.io/implement-user-collaboration-in-your-app",children:"Comment nous avons impl\xe9ment\xe9 la collaboration utilisateur dans une application multi-locataire"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"implement-access-control-to-your-multi-tenant-app",children:"Impl\xe9menter le contr\xf4le d\u2019acc\xe8s dans votre application multi-locataire"}),"\n",(0,t.jsx)(n.p,{children:"Passons maintenant au contr\xf4le d\u2019acc\xe8s des organisations."}),"\n",(0,t.jsx)(n.p,{children:"Nous voulons obtenir :"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Les utilisateurs ne peuvent acc\xe9der qu\u2019aux ressources appartenant \xe0 leurs propres organisations : Cela peut \xeatre r\xe9alis\xe9 via le ",(0,t.jsx)(n.code,{children:"jeton d\u2019organisation (Organization token)"})," de Logto"]}),"\n",(0,t.jsx)(n.li,{children:"Les utilisateurs ont des r\xf4les sp\xe9cifiques au sein des organisations (contenant diff\xe9rentes permissions) pour effectuer des actions autoris\xe9es : Cela peut \xeatre mis en \u0153uvre via la fonctionnalit\xe9 de mod\xe8le d\u2019organisation de Logto"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Voyons comment impl\xe9menter ces fonctionnalit\xe9s."}),"\n",(0,t.jsx)(n.h3,{id:"using-logto-organization-token",children:"Utiliser le jeton d\u2019organisation Logto"}),"\n",(0,t.jsx)(n.p,{children:"Comme pour le Jeton d\u2019acc\xe8s (Access token) Logto mentionn\xe9 pr\xe9c\xe9demment, Logto \xe9met un Jeton d\u2019acc\xe8s correspondant \xe0 une ressource sp\xe9cifique, et les utilisateurs utilisent ce jeton pour acc\xe9der aux ressources prot\xe9g\xe9es dans le service backend. De m\xeame, Logto \xe9met un jeton d\u2019organisation correspondant \xe0 une organisation sp\xe9cifique, et les utilisateurs utilisent ce jeton pour acc\xe9der aux ressources d\u2019organisation prot\xe9g\xe9es dans le service backend."}),"\n",(0,t.jsxs)(n.p,{children:["Dans l\u2019application frontend, nous pouvons utiliser la m\xe9thode ",(0,t.jsx)(n.code,{children:"getOrganizationToken"})," de Logto pour obtenir un jeton d\u2019acc\xe8s \xe0 une organisation sp\xe9cifique."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"const { getOrganizationToken } = useLogto();\nconst organizationToken = await getOrganizationToken(organizationId);\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Ici, ",(0,t.jsx)(n.code,{children:"organizationId"})," est l\u2019id de l\u2019organisation \xe0 laquelle l\u2019utilisateur appartient."]}),"\n",(0,t.jsxs)(n.p,{children:["Avant d\u2019utiliser ",(0,t.jsx)(n.code,{children:"getOrganization"})," ou toute fonctionnalit\xe9 d\u2019organisation, nous devons nous assurer que le scope ",(0,t.jsx)(n.code,{children:"urn:logto:scope:organizations"})," et la ressource ",(0,t.jsx)(n.code,{children:"urn:logto:resource:organization"})," sont inclus dans la config Logto. Comme nous l\u2019avons d\xe9j\xe0 d\xe9clar\xe9 plus haut, nous ne le r\xe9p\xe9tons pas."]}),"\n",(0,t.jsx)(n.p,{children:"Dans notre page organisation, nous utilisons le jeton d\u2019organisation pour r\xe9cup\xe9rer les documents de l\u2019organisation."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"function OrganizationPage() {\n  const { organizationId } = useParams();\n  const navigate = useNavigate();\n  const { signOut, getOrganizationToken } = useLogto();\n  const [error, setError] = useState<Error | null>(null);\n  const [documents, setDocuments] = useState([]);\n\n  const fetchDocuments = useCallback(async () => {\n    if (!organizationId) return;\n\n    try {\n      const organizationToken = await getOrganizationToken(organizationId);\n      const response = await fetch(`http://localhost:3000/documents`, {\n          headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${organizationToken}`,\n        },\n      });\n      const documents = await response.json();\n      setDocuments(documents);\n    } catch (error: unknown) {\n      if (error instanceof Error) {\n        setError(error);\n      } else {\n        setError(new Error(String(error)));\n      }\n    }\n  },[getOrganizationToken, organizationId]);\n\n  useEffect(() => {\n    void fetchDocuments();\n  }, [fetchDocuments]);\n\n  if (error) {\n    return <div>Erreur : {error.message}</div>;\n  }\n\n  return <div>\n    <h1>Documents de l\u2019organisation</h1>\n    <ul>\n      {documents.map((document) => (\n        <li key={document.id}>{document.name}</li>\n      ))}\n    </ul>\n  </div>\n}\n\n"})}),"\n",(0,t.jsx)(n.p,{children:"Deux points importants \xe0 noter dans cette impl\xe9mentation :"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Si le ",(0,t.jsx)(n.code,{children:"organizationId"})," pass\xe9 \xe0 ",(0,t.jsx)(n.code,{children:"getOrganizationToken"})," n\u2019est pas un id d\u2019organisation auquel appartient l\u2019utilisateur courant, cette m\xe9thode ne pourra pas obtenir de jeton, garantissant ainsi que les utilisateurs ne peuvent acc\xe9der qu\u2019\xe0 leurs propres organisations."]}),"\n",(0,t.jsxs)(n.li,{children:["Lors de la requ\xeate de ressources d\u2019organisation, nous utilisons le jeton d\u2019organisation au lieu du Jeton d\u2019acc\xe8s (Access token) car pour les ressources appartenant \xe0 une organisation, nous voulons utiliser le contr\xf4le de permission d\u2019organisation plut\xf4t que le contr\xf4le de permission utilisateur (vous comprendrez mieux cela lors de l\u2019impl\xe9mentation de l\u2019API ",(0,t.jsx)(n.code,{children:"GET /documents"})," plus loin)."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Ensuite, cr\xe9ons une API ",(0,t.jsx)(n.code,{children:"GET /documents"})," dans notre service backend. Comme pour la protection de l\u2019API ",(0,t.jsx)(n.code,{children:"POST /organizations"})," par la ressource API, nous utilisons des indicateurs de ressource sp\xe9cifiques \xe0 l\u2019organisation pour prot\xe9ger l\u2019API ",(0,t.jsx)(n.code,{children:"GET /documents"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Cr\xe9ons d\u2019abord un middleware ",(0,t.jsx)(n.code,{children:"requireOrganizationAccess"})," pour prot\xe9ger les ressources d\u2019organisation."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"const getTokenFromHeader = (headers) => {\n  const { authorization } = headers;\n  const bearerTokenIdentifier = 'Bearer';\n\n  if (!authorization) {\n    throw new Error('Authorization header missing');\n  }\n\n  if (!authorization.startsWith(bearerTokenIdentifier)) {\n    throw new Error('Authorization token type not supported');\n  }\n\n  return authorization.slice(bearerTokenIdentifier.length + 1);\n};\n\nconst extractOrganizationId = (aud) => {\n  if (!aud || typeof aud !== 'string' || !aud.startsWith('urn:logto:organization:')) {\n    throw new Error('Invalid organization token');\n  }\n  return aud.replace('urn:logto:organization:', '');\n};\n\nconst decodeJwtPayload = (token) => {\n  try {\n    const [, payloadBase64] = token.split('.');\n    if (!payloadBase64) {\n      throw new Error('Invalid token format');\n    }\n    const payloadJson = Buffer.from(payloadBase64, 'base64').toString('utf-8');\n    return JSON.parse(payloadJson);\n  } catch (error) {\n    throw new Error('Failed to decode token payload');\n  }\n};\n\nconst requireOrganizationAccess = () => {\n  return async (req, res, next) => {\n    try {\n      // Extraire le jeton\n      const token = getTokenFromHeader(req.headers);\n\n      // R\xe9cup\xe9rer dynamiquement l\u2019audience depuis le jeton\n      const { aud } = decodeJwtPayload(token);\n      if (!aud) {\n        throw new Error('Missing audience in token');\n      }\n\n      // V\xe9rifier le jeton avec l\u2019audience\n      const { payload } = await jwtVerify(\n        token,\n        createRemoteJWKSet(new URL(process.env.LOGTO_JWKS_URL)),\n        {\n          issuer: process.env.LOGTO_ISSUER,\n          audience: aud,\n        }\n      );\n\n      // Extraire l\u2019ID d\u2019organisation depuis la claim audience\n      const organizationId = extractOrganizationId(payload.aud);\n\n      // Ajouter les infos d\u2019organisation \xe0 la requ\xeate\n      req.user = {\n        id: payload.sub,\n        organizationId,\n      };\n\n      next();\n    } catch (error) {\n      console.error('Erreur d\u2019authentification organisation :', error);\n      res.status(401).json({ error: 'Non autoris\xe9 - Acc\xe8s organisation invalide' });\n    }\n  };\n};\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Utilisons ensuite le middleware ",(0,t.jsx)(n.code,{children:"requireOrganizationAccess"})," pour prot\xe9ger l\u2019API ",(0,t.jsx)(n.code,{children:"GET /documents"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"app.get('/documents', requireOrganizationAccess(), async (req, res) => {\n  // Vous pouvez obtenir l\u2019id utilisateur courant et l\u2019organisation via req.user\n  console.log('userId', req.user.id);\n  console.log('organizationId', req.user.organizationId);\n\n  // R\xe9cup\xe9rer les documents de la base de donn\xe9es par organizationId\n  // ....\n  const documents = await getDocumentsByOrganizationId(req.user.organizationId);\n\n  res.json(documents);\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:"Ainsi, nous avons impl\xe9ment\xe9 l\u2019utilisation des jetons d\u2019organisation pour acc\xe9der aux ressources d\u2019organisation. Dans le service backend, vous pouvez r\xe9cup\xe9rer les ressources correspondantes depuis la base de donn\xe9es selon l\u2019id d\u2019organisation."}),"\n",(0,t.jsxs)(n.p,{children:["Certains logiciels n\xe9cessitent une isolation des donn\xe9es entre organisations. Pour aller plus loin, vous pouvez consulter l\u2019article de blog : ",(0,t.jsx)(n.a,{href:"https://blog.logto.io/implement-multi-tenancy",children:"Impl\xe9mentation de la multi-location avec PostgreSQL : Apprenez avec un exemple concret"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"implement-organization-level-role-based-access-control-design",children:"Impl\xe9menter le contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les au niveau organisation"}),"\n",(0,t.jsx)(n.p,{children:"Nous avons impl\xe9ment\xe9 l\u2019utilisation des jetons d\u2019organisation pour acc\xe9der aux ressources d\u2019organisation. Passons maintenant au contr\xf4le des permissions utilisateur au sein des organisations via le RBAC."}),"\n",(0,t.jsx)(n.p,{children:"Supposons que DocuMind ait deux r\xf4les : Admin et Collaborateur."}),"\n",(0,t.jsx)(n.p,{children:"Les Admins peuvent cr\xe9er et acc\xe9der aux documents, tandis que les Collaborateurs ne peuvent qu\u2019acc\xe9der aux documents."}),"\n",(0,t.jsx)(n.p,{children:"Notre Organisation doit donc avoir ces deux r\xf4les : Admin et Collaborateur."}),"\n",(0,t.jsxs)(n.p,{children:["Admin a les permissions ",(0,t.jsx)(n.code,{children:"read:documents"})," et ",(0,t.jsx)(n.code,{children:"create:documents"}),", tandis que Collaborateur n\u2019a que la permission ",(0,t.jsx)(n.code,{children:"read:documents"}),"."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Admin","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"read:documents"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"create:documents"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Collaborateur","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"read:documents"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"C\u2019est l\xe0 qu\u2019intervient la fonctionnalit\xe9 de mod\xe8le d\u2019organisation de Logto."}),"\n",(0,t.jsx)(n.p,{children:"Un mod\xe8le d\u2019organisation est un plan du mod\xe8le de contr\xf4le d\u2019acc\xe8s pour chaque organisation : il d\xe9finit les r\xf4les et permissions applicables \xe0 toutes les organisations."}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"Pourquoi un mod\xe8le d\u2019organisation ?"}),"\n",(0,t.jsx)(n.p,{children:"Parce que la scalabilit\xe9 est l\u2019une des exigences les plus importantes pour les produits SaaS. En d\u2019autres termes, ce qui fonctionne pour un client doit fonctionner pour tous les clients."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Allons dans Logto Console > Mod\xe8les d\u2019organisation > Permissions d\u2019organisation et cr\xe9ons deux permissions : ",(0,t.jsx)(n.code,{children:"read:documents"})," et ",(0,t.jsx)(n.code,{children:"create:documents"}),"."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://uploads.strapi.logto.io/org_template_permission_f0ad59f5b5.png",alt:"org-template-permission.png"})}),"\n",(0,t.jsx)(n.p,{children:"Puis allez dans l\u2019onglet r\xf4les d\u2019organisation pour cr\xe9er deux r\xf4les utilisateur : Admin et Collaborateur, et attribuez les permissions correspondantes \xe0 ces r\xf4les."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://uploads.strapi.logto.io/organization_details_9293d7965d.png",alt:"organization-details.png"})}),"\n",(0,t.jsx)(n.p,{children:"Ainsi, nous avons cr\xe9\xe9 un mod\xe8le de permission RBAC pour chaque organisation."}),"\n",(0,t.jsx)(n.p,{children:"Ensuite, allons sur la page de d\xe9tails de notre organisation pour attribuer les r\xf4les appropri\xe9s \xe0 nos membres."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://uploads.strapi.logto.io/org_template_role_0137f5a8ca.png",alt:"org-template-role.png"})}),"\n",(0,t.jsx)(n.p,{children:"Nos utilisateurs d\u2019organisation ont maintenant des r\xf4les !\nVous pouvez r\xe9aliser ces \xe9tapes via la Management API Logto :"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"// Attribuer le r\xf4le 'Admin' au cr\xe9ateur de l\u2019organisation\napp.post('/organizations', requireAuth('https://api.documind.com'), async (req, res) => {\n  const accessToken = await fetchLogtoManagementApiAccessToken();\n  // Cr\xe9er l\u2019organisation dans Logto\n  // codes existants...\n\n  // Ajouter l\u2019utilisateur \xe0 l\u2019organisation dans Logto\n  await fetch(`${process.env.LOGTO_ENDPOINT}/api/organizations/${createdOrganization.id}/users`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      Authorization: `Bearer ${accessToken}`,\n    },\n    body: JSON.stringify({\n      userIds: [req.user.id],\n    }),\n  });\n\n  // Attribuer le r\xf4le `Admin` au premier utilisateur.\n  const rolesResponse = await fetch(`${process.env.LOGTO_ENDPOINT}/api/organization-roles`, {\n    method: 'GET',\n    headers: {\n      'Content-Type': 'application/json',\n      Authorization: `Bearer ${accessToken}`,\n    },\n  });\n\n  const roles = await rolesResponse.json();\n\n  // Trouver le r\xf4le `Admin`\n  const adminRole = roles.find((role) => role.name === 'Admin');\n\n  // Attribuer le r\xf4le `Admin` au premier utilisateur.\n  await fetch(\n    `${process.env.LOGTO_ENDPOINT}/api/organizations/${createdOrganization.id}/users/${req.user.id}/roles`,\n    {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${accessToken}`,\n      },\n      body: JSON.stringify({\n        organizationRoleIds: [adminRole.id],\n      }),\n    }\n  );\n\n  // codes existants...\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:"Nous pouvons maintenant impl\xe9menter le contr\xf4le des permissions utilisateur en v\xe9rifiant leurs permissions."}),"\n",(0,t.jsx)(n.p,{children:"Dans notre code, nous devons faire en sorte que le jeton d\u2019organisation de l\u2019utilisateur transporte les informations de permission, puis v\xe9rifier ces permissions dans le backend."}),"\n",(0,t.jsxs)(n.p,{children:["Dans la config Logto du code frontend, nous devons d\xe9clarer les permissions que les utilisateurs doivent demander au sein de l\u2019organisation. Ajoutons les permissions ",(0,t.jsx)(n.code,{children:"read:documents"})," et ",(0,t.jsx)(n.code,{children:"create:documents"})," au tableau ",(0,t.jsx)(n.code,{children:"scopes"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'const config: LogtoConfig = {\n  endpoint: "<YOUR_LOGTO_ENDPOINT>",\n  appId: "<YOUR_LOGTO_APP_ID>",\n  scopes: [UserScope.Organizations, "read:documents", "create:documents"],\n  resources: [ReservedResource.Organization, "<https://api.documind.com>"], // Identifiant de la ressource API nouvellement cr\xe9\xe9e\n};\n\n'})}),"\n",(0,t.jsx)(n.p,{children:"Comme d\u2019habitude, reconnectez-vous avec votre utilisateur pour que ces configurations prennent effet."}),"\n",(0,t.jsxs)(n.p,{children:["Puis dans le middleware ",(0,t.jsx)(n.code,{children:"requireOrganizationAccess"})," du backend, ajoutons la v\xe9rification des permissions utilisateur."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"const hasRequiredScopes = (tokenScopes, requiredScopes) => {\n  if (!requiredScopes || requiredScopes.length === 0) {\n    return true;\n  }\n  const scopeSet = new Set(tokenScopes);\n  return requiredScopes.every((scope) => scopeSet.has(scope));\n};\n\nconst requireOrganizationAccess = ({ requiredScopes = [] } = {}) => {\n  return async (req, res, next) => {\n    try {\n      //...\n\n      // V\xe9rifier le jeton avec l\u2019audience\n      const { payload } = await jwtVerify(\n        token,\n        createRemoteJWKSet(new URL(process.env.LOGTO_JWKS_URL)),\n        {\n          issuer: process.env.LOGTO_ISSUER,\n          audience: aud,\n        }\n      );\n\n      //...\n\n      // Obtenir les scopes du jeton\n      const scopes = payload.scope?.split(' ') || [];\n\n      // V\xe9rifier les scopes requis\n      if (!hasRequiredScopes(scopes, requiredScopes)) {\n        throw new Error('Permissions insuffisantes');\n      }\n\n      //...\n\n      next();\n    } catch (error) {\n      //...\n    }\n  };\n};\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Cr\xe9ons ensuite une API POST /documents, et utilisons le middleware ",(0,t.jsx)(n.code,{children:"requireOrganizationAccess"})," avec la configuration requiredScopes pour prot\xe9ger cette API et l\u2019API ",(0,t.jsx)(n.code,{children:"GET /documents"})," pr\xe9c\xe9dente."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"// API pour cr\xe9er des documents\napp.post(\n  '/documents',\n  requireOrganizationAccess({ requiredScopes: ['create:documents'] }),\n  async (req, res) => {\n    //...\n  }\n);\n\n// API pour obtenir les documents\napp.get(\n  '/documents',\n  requireOrganizationAccess({ requiredScopes: ['read:documents'] }),\n  async (req, res) => {\n    //...\n  }\n);\n"})}),"\n",(0,t.jsx)(n.p,{children:"Ainsi, nous avons impl\xe9ment\xe9 le contr\xf4le des permissions utilisateur en v\xe9rifiant les permissions utilisateur."}),"\n",(0,t.jsxs)(n.p,{children:["Dans le frontend, vous pouvez obtenir les informations de permission utilisateur en d\xe9codant le jeton d\u2019organisation ou en appelant la m\xe9thode ",(0,t.jsx)(n.code,{children:"getOrganizationTokenClaims"})," de Logto."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"const [scopes, setScopes] = useState([]);\nconst { getOrganizationTokenClaims } = useLogto();\n\nconst loadScopes = async () => {\n  const claims = await getOrganizationTokenClaims(organizationId);\n  setScopes(claims.scope.split(' '));\n};\n\n// ...\n"})}),"\n",(0,t.jsx)(n.p,{children:"Contr\xf4lez les \xe9l\xe9ments de la page selon les permissions utilisateur en v\xe9rifiant les scopes dans les claims."}),"\n",(0,t.jsx)(n.h2,{id:"add-more-multi-tenant-app-features",children:"Ajouter plus de fonctionnalit\xe9s multi-locataires \xe0 votre application"}),"\n",(0,t.jsx)(n.p,{children:"Jusqu\u2019ici, nous avons impl\xe9ment\xe9 les fonctionnalit\xe9s de base utilisateur et organisation dans un syst\xe8me SaaS multi-locataire ! Cependant, il reste encore des fonctionnalit\xe9s que nous n\u2019avons pas abord\xe9es, comme la personnalisation de la marque de la page de connexion pour chaque Organisation, l\u2019ajout automatique d\u2019utilisateurs avec des e-mails de domaine sp\xe9cifique \xe0 certaines organisations, et l\u2019int\xe9gration de la fonctionnalit\xe9 SSO d\u2019entreprise."}),"\n",(0,t.jsx)(n.p,{children:"Ce sont toutes des fonctionnalit\xe9s pr\xeates \xe0 l\u2019emploi, et vous pouvez trouver plus d\u2019informations \xe0 leur sujet dans la documentation Logto :"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/end-user-flows/enterprise-sso",children:"Int\xe9gration SSO d\u2019entreprise"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/organizations/just-in-time-provisioning",children:"Provisionnement Just-in-Time (JIT)"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/customization/match-your-brand#organization-specific-branding",children:"Personnalisation au niveau de l\u2019organisation"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/organizations/organization-management#require-mfa-for-organization-members",children:"Authentification multi-facteurs au niveau de l\u2019organisation (MFA)"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/end-user-flows/organization-experience/organization-management",children:"Gestion au niveau de l\u2019organisation"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"summary",children:"R\xe9sum\xe9"}),"\n",(0,t.jsx)(n.p,{children:"Vous vous souvenez \xe0 quel point cela semblait insurmontable au d\xe9but ? Utilisateurs, organisations, permissions, fonctionnalit\xe9s entreprise... cela ressemblait \xe0 une montagne sans fin \xe0 gravir."}),"\n",(0,t.jsx)(n.p,{children:"Mais regardez ce que nous avons accompli :"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Un syst\xe8me d\u2019authentification complet avec plusieurs options de connexion et prise en charge MFA"}),"\n",(0,t.jsx)(n.li,{children:"Un syst\xe8me d\u2019organisation flexible prenant en charge plusieurs adh\xe9sions"}),"\n",(0,t.jsx)(n.li,{children:"Contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les au sein des organisations"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Et le meilleur ? Nous n\u2019avons pas eu \xe0 r\xe9inventer la roue. En tirant parti d\u2019outils modernes comme Logto, nous avons transform\xe9 ce qui aurait pu \xeatre des mois de d\xe9veloppement en quelques minutes."}),"\n",(0,t.jsxs)(n.p,{children:["Le code source complet de ce tutoriel est disponible ici : ",(0,t.jsx)(n.a,{href:"https://github.com/logto-io/multi-tenant-saas-sample",children:"Exemple SaaS multi-locataire"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"C\u2019est la puissance du d\xe9veloppement moderne en 2025 \u2013 nous pouvons nous concentrer sur la cr\xe9ation de fonctionnalit\xe9s produit uniques au lieu de lutter avec l\u2019infrastructure. \xc0 vous de jouer pour construire quelque chose d\u2019incroyable !"}),"\n",(0,t.jsxs)(n.p,{children:["D\xe9couvrez toutes les fonctionnalit\xe9s de Logto, de Logto Cloud \xe0 Logto OSS, sur le ",(0,t.jsx)(n.a,{href:"https://logto.io/",children:"site Logto"})," ou inscrivez-vous sur ",(0,t.jsx)(n.a,{href:"https://cloud.logto.io/?sign_up",children:"Logto cloud"})," d\xe8s aujourd\u2019hui."]})]})}function d(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},79621:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>r});var s=i(58101);const t={},o=s.createContext(t);function a(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);