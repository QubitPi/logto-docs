"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[8171],{84149:(e,n,r)=>{r.d(n,{Ay:()=>S,RM:()=>y});var i=r(25105),s=r(79621),t=r(41466),o=r(28503),a=r(53830),l=r(12128);const c=r.p+"assets/images/guide-focus-8b3e94dddfb8a3c19b5bdd8a343fc29f.png";var d=r(33435);function u(e){const n={a:"a",h2:"h2",h3:"h3",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"before-you-start",children:"Avant de commencer"}),"\n",(0,i.jsxs)(n.p,{children:["Vos applications clientes doivent obtenir des jetons d\u2019acc\xe8s (Access tokens) aupr\xe8s de Logto. Si vous n'avez pas encore configur\xe9 l'int\xe9gration c\xf4t\xe9 client, consultez nos ",(0,i.jsx)(n.a,{href:"/quick-starts",children:"D\xe9marrages rapides"})," pour React, Vue, Angular ou d'autres frameworks clients, ou consultez notre ",(0,i.jsx)(n.a,{href:"/quick-starts/m2m",children:"Guide machine \xe0 machine"})," pour l'acc\xe8s serveur \xe0 serveur."]}),"\n",(0,i.jsxs)(n.p,{children:["Ce guide se concentre sur la ",(0,i.jsx)(n.strong,{children:"validation c\xf4t\xe9 serveur"})," de ces jetons dans votre application ",(0,d.My)(e.framework),"."]}),"\n",(0,i.jsx)("img",{src:c,alt:"Une illustration montrant le focus de ce guide",style:{width:"100%",maxWidth:"480px",margin:"20px auto"}}),"\n",(0,i.jsx)(n.h3,{id:"what-you-will-learn",children:"Ce que vous allez apprendre"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Validation JWT :"})," Apprenez \xe0 valider les jetons d\u2019acc\xe8s (Access tokens) et \xe0 extraire les informations d\u2019authentification (Authentication)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Impl\xe9mentation de middleware :"})," Cr\xe9ez un middleware r\xe9utilisable pour la protection de votre API"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Mod\xe8les de permissions :"})," Comprenez et impl\xe9mentez diff\xe9rents sch\xe9mas d\u2019autorisation (Authorization) :","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Ressources API globales pour les points de terminaison \xe0 l\u2019\xe9chelle de l\u2019application"}),"\n",(0,i.jsx)(n.li,{children:"Permissions d\u2019organisation pour le contr\xf4le des fonctionnalit\xe9s sp\xe9cifiques \xe0 un locataire"}),"\n",(0,i.jsx)(n.li,{children:"Ressources API au niveau de l\u2019organisation pour l\u2019acc\xe8s aux donn\xe9es multi-locataires"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Int\xe9gration RBAC :"})," Appliquez des permissions et des port\xe9es (Scopes) bas\xe9es sur les r\xf4les (Roles) dans vos points de terminaison API"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"prerequisites",children:"Pr\xe9requis"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Derni\xe8re version stable de ",(0,d.Id)(e.framework)," install\xe9e"]}),"\n",(0,i.jsxs)(n.li,{children:["Compr\xe9hension de base de ",(0,d.My)(e.framework)," et du d\xe9veloppement d\u2019API web"]}),"\n",(0,i.jsxs)(n.li,{children:["Une application Logto configur\xe9e (voir ",(0,i.jsx)(n.a,{href:"/quick-starts",children:"D\xe9marrages rapides"})," si besoin)"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}function g(e){const n={h2:"h2",p:"p",...(0,s.R)(),...e.components},{Url:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"further-reading",children:"Pour aller plus loin"}),"\n",(0,i.jsx)(r,{href:"/use-cases/authorization/rbac-in-practice",children:(0,i.jsx)(n.p,{children:"RBAC en pratique : Mettre en \u0153uvre une autorisation s\xe9curis\xe9e pour votre application"})}),"\n",(0,i.jsx)(r,{href:"/use-cases/multi-tenancy/build-multi-tenant-saas-application",children:(0,i.jsx)(n.p,{children:"Construire une application SaaS multi-locataires : Guide complet de la conception \xe0 la mise en\n\u0153uvre"})})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(g,{...e})}):g(e)}var m=r(46643),j=r(1242),x=r(93855),v=r(38552),f=r(22002);function b(e){const n={a:"a",h2:"h2",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"permission-models-overview",children:"Aper\xe7u des mod\xe8les de permission"}),"\n",(0,i.jsxs)(n.p,{children:["Avant de mettre en place une protection, choisissez le mod\xe8le de permission qui correspond \xe0 l\u2019architecture de votre application. Cela s\u2019aligne avec les trois principaux ",(0,i.jsx)(n.a,{href:"/authorization#authorization-scenarios",children:"sc\xe9narios d\u2019autorisation"})," de Logto :"]}),"\n",(0,i.jsxs)(f.A,{groupId:"permission-models",children:[(0,i.jsxs)(v.A,{value:"global-api-resources",label:"Ressources API globales",children:[(0,i.jsx)("img",{src:m.A,alt:"RBAC des ressources API globales",style:{maxWidth:"100%"}}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cas d\u2019utilisation :"})," Prot\xe9ger les ressources API partag\xe9es \xe0 travers toute votre application (non sp\xe9cifiques \xe0 une organisation)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type de jeton :"})," Jeton d\u2019acc\xe8s (Access token) avec audience globale"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Exemples :"})," APIs publiques, services principaux du produit, points de terminaison d\u2019administration"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Id\xe9al pour :"})," Produits SaaS avec des APIs utilis\xe9es par tous les clients, microservices sans isolation de locataire"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"En savoir plus :"})," ",(0,i.jsx)(n.a,{href:"/authorization/global-api-resources",children:"Prot\xe9ger les ressources API globales"})]}),"\n"]})]}),(0,i.jsxs)(v.A,{value:"organization-permissions",label:"Permissions d\u2019organisation (hors API)",children:[(0,i.jsx)("img",{src:x.A,alt:"RBAC des permissions d\u2019organisation",style:{maxWidth:"800px",width:"100%"}}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cas d\u2019utilisation :"})," Contr\xf4ler les actions sp\xe9cifiques \xe0 l\u2019organisation, les fonctionnalit\xe9s de l\u2019interface ou la logique m\xe9tier (hors APIs)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type de jeton :"})," Jeton d\u2019organisation (Organization token) avec audience sp\xe9cifique \xe0 l\u2019organisation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Exemples :"})," Limitation de fonctionnalit\xe9s, permissions du tableau de bord, contr\xf4le d\u2019invitation des membres"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Id\xe9al pour :"})," SaaS multi-locataires avec des fonctionnalit\xe9s et des flux de travail propres \xe0 chaque organisation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"En savoir plus :"})," ",(0,i.jsx)(n.a,{href:"/authorization/organization-permissions",children:"Prot\xe9ger les permissions d\u2019organisation (hors API)"})]}),"\n"]})]}),(0,i.jsxs)(v.A,{value:"organization-level-api-resources",label:"Ressources API au niveau de l\u2019organisation",children:[(0,i.jsx)("img",{src:j.A,alt:"RBAC des ressources API au niveau de l\u2019organisation",style:{width:"100%"}}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cas d\u2019utilisation :"})," Prot\xe9ger les ressources API accessibles dans le contexte d\u2019une organisation sp\xe9cifique"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Type de jeton :"})," Jeton d\u2019organisation (Organization token) avec audience de ressource API + contexte d\u2019organisation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Exemples :"})," APIs multi-locataires, points de terminaison de donn\xe9es \xe0 port\xe9e d\u2019organisation, microservices sp\xe9cifiques au locataire"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Id\xe9al pour :"})," SaaS multi-locataires o\xf9 les donn\xe9es API sont limit\xe9es \xe0 l\u2019organisation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"En savoir plus :"})," ",(0,i.jsx)(n.a,{href:"/authorization/organization-level-api-resources",children:"Prot\xe9ger les ressources API au niveau de l\u2019organisation"})]}),"\n"]})]})]}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\ud83d\udca1 Choisissez votre mod\xe8le avant de continuer"})," \u2013 la mise en \u0153uvre fera r\xe9f\xe9rence \xe0 l\u2019approche choisie tout au long de ce guide."]})]})}function A(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(b,{...e})}):b(e)}function I(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"quick-preparation-steps",children:"\xc9tapes de pr\xe9paration rapide"}),"\n",(0,i.jsx)(n.h3,{id:"configure-logto-resources-permissions",children:"Configurer les ressources & permissions Logto"}),"\n",(0,i.jsxs)(f.A,{groupId:"permission-models",children:[(0,i.jsx)(v.A,{value:"global-api-resources",label:"Ressources API globales",children:(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cr\xe9er une ressource API :"})," Rendez-vous sur ",(0,i.jsx)(n.a,{href:"https://cloud.logto.io/api-resources",children:"Console \u2192 Ressources API"})," et enregistrez votre API (par exemple, ",(0,i.jsx)(n.code,{children:"https://api.votreapp.com"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"D\xe9finir les permissions :"})," Ajoutez des port\xe9es comme ",(0,i.jsx)(n.code,{children:"read:products"}),", ",(0,i.jsx)(n.code,{children:"write:orders"})," \u2013 voir ",(0,i.jsx)(n.a,{href:"/authorization/role-based-access-control#define-api-resources-with-permissions",children:"D\xe9finir des ressources API avec des permissions"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cr\xe9er des r\xf4les globaux :"})," Rendez-vous sur ",(0,i.jsx)(n.a,{href:"https://cloud.logto.io/roles",children:"Console \u2192 R\xf4les"})," et cr\xe9ez des r\xf4les qui incluent vos permissions API \u2013 voir ",(0,i.jsx)(n.a,{href:"/authorization/role-based-access-control#configure-global-roles",children:"Configurer des r\xf4les globaux"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Attribuer des r\xf4les :"})," Attribuez des r\xf4les aux utilisateurs ou applications M2M qui ont besoin d'acc\xe9der \xe0 l'API"]}),"\n"]})}),(0,i.jsx)(v.A,{value:"organization-permissions",label:"Permissions d'organisation (hors API)",children:(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"D\xe9finir les permissions d'organisation :"})," Cr\xe9ez des permissions d'organisation hors API comme ",(0,i.jsx)(n.code,{children:"invite:member"}),", ",(0,i.jsx)(n.code,{children:"manage:billing"})," dans le mod\xe8le d'organisation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Configurer les r\xf4les d'organisation :"})," Configurez le mod\xe8le d'organisation avec des r\xf4les sp\xe9cifiques \xe0 l'organisation et attribuez-leur des permissions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Attribuer des r\xf4les d'organisation :"})," Attribuez des utilisateurs aux r\xf4les d'organisation dans chaque contexte d'organisation"]}),"\n"]})}),(0,i.jsx)(v.A,{value:"organization-level-api-resources",label:"Ressources API au niveau de l'organisation",children:(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cr\xe9er une ressource API :"})," Enregistrez votre ressource API comme ci-dessus, mais elle sera utilis\xe9e dans le contexte d'organisation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"D\xe9finir les permissions :"})," Ajoutez des port\xe9es comme ",(0,i.jsx)(n.code,{children:"read:data"}),", ",(0,i.jsx)(n.code,{children:"write:settings"})," qui sont limit\xe9es au contexte d'organisation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Configurer le mod\xe8le d'organisation :"})," Configurez des r\xf4les d'organisation qui incluent les permissions de votre ressource API"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Attribuer des r\xf4les d'organisation :"})," Attribuez des utilisateurs ou applications M2M \xe0 des r\xf4les d'organisation qui incluent des permissions API"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Configuration multi-locataire :"})," Assurez-vous que votre API peut g\xe9rer les donn\xe9es et la validation \xe0 l'\xe9chelle de l'organisation"]}),"\n"]})})]}),"\n",(0,i.jsx)(n.admonition,{title:"Nouveau sur le RBAC ?",type:"tip",children:(0,i.jsxs)(n.p,{children:["Commencez avec notre ",(0,i.jsx)(n.a,{href:"/authorization/role-based-access-control",children:"guide du contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC)"})," pour des instructions d'installation \xe9tape par \xe9tape."]})}),"\n",(0,i.jsx)(n.h3,{id:"update-your-client-application",children:"Mettez \xe0 jour votre application cliente"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Demandez les port\xe9es appropri\xe9es dans votre client :"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Authentification utilisateur : ",(0,i.jsx)(n.a,{href:"/quick-starts",children:"Mettez \xe0 jour votre application \u2192"})," pour demander les port\xe9es de votre API et/ou le contexte d'organisation"]}),"\n",(0,i.jsxs)(n.li,{children:["Machine \xe0 machine : ",(0,i.jsx)(n.a,{href:"/quick-starts/m2m",children:"Configurer les port\xe9es M2M \u2192"})," pour l'acc\xe8s serveur \xe0 serveur"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Le processus consiste g\xe9n\xe9ralement \xe0 mettre \xe0 jour la configuration de votre client pour inclure un ou plusieurs des \xe9l\xe9ments suivants :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Param\xe8tre ",(0,i.jsx)(n.code,{children:"scope"})," dans les flux OAuth"]}),"\n",(0,i.jsxs)(n.li,{children:["Param\xe8tre ",(0,i.jsx)(n.code,{children:"resource"})," pour l'acc\xe8s \xe0 la ressource API"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"organization_id"})," pour le contexte d'organisation"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{title:"Avant de coder",type:"tip",children:(0,i.jsx)(n.p,{children:"Assurez-vous que l'utilisateur ou l'application M2M que vous testez s'est vu attribuer les r\xf4les ou r\xf4les d'organisation appropri\xe9s incluant les permissions n\xe9cessaires pour votre API."})})]})}function w(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(I,{...e})}):I(e)}const y=[{value:"Avant de commencer",id:"before-you-start",level:2},{value:"Ce que vous allez apprendre",id:"what-you-will-learn",level:3},{value:"Pr\xe9requis",id:"prerequisites",level:3},{value:"Aper\xe7u des mod\xe8les de permission",id:"permission-models-overview",level:2},{value:"\xc9tapes de pr\xe9paration rapide",id:"quick-preparation-steps",level:2},{value:"Configurer les ressources &amp; permissions Logto",id:"configure-logto-resources-permissions",level:3},{value:"Mettez \xe0 jour votre application cliente",id:"update-your-client-application",level:3},{value:"Initialiser votre projet API",id:"initialize-your-api-project",level:2},{value:"Initialiser les constantes et utilitaires",id:"initialize-constants-and-utilities",level:2},...t.RM,{value:"R\xe9cup\xe9rer les informations sur votre tenant Logto",id:"retrieve-info-about-your-logto-tenant",level:2},...o.RM,{value:"Valider le jeton et les permissions",id:"validate-the-token-and-permissions",level:2},...l.RM,{value:"Ajouter la logique de validation",id:"add-the-validation-logic",level:3},{value:"Appliquer le middleware \xe0 votre API",id:"apply-the-middleware-to-your-api",level:2},{value:"Tester votre API prot\xe9g\xe9e",id:"test-your-protected-api",level:2},...a.RM,{value:"Pour aller plus loin",id:"further-reading",level:2}];function z(e){const n={h2:"h2",h3:"h3",p:"p",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(p,{framework:e.framework}),"\n",(0,i.jsx)(A,{}),"\n",(0,i.jsx)(w,{}),"\n",(0,i.jsx)(n.h2,{id:"initialize-your-api-project",children:"Initialiser votre projet API"}),"\n","\n",e.initializeProject,"\n",(0,i.jsx)(n.h2,{id:"initialize-constants-and-utilities",children:"Initialiser les constantes et utilitaires"}),"\n",(0,i.jsx)(t.Ay,{}),"\n","\n",e.languageInit,"\n",(0,i.jsx)(n.h2,{id:"retrieve-info-about-your-logto-tenant",children:"R\xe9cup\xe9rer les informations sur votre tenant Logto"}),"\n",(0,i.jsx)(o.Ay,{}),"\n",(0,i.jsx)(n.h2,{id:"validate-the-token-and-permissions",children:"Valider le jeton et les permissions"}),"\n",(0,i.jsx)(l.Ay,{}),"\n",(0,i.jsx)(n.h3,{id:"add-the-validation-logic",children:"Ajouter la logique de validation"}),"\n","\n",e.addValidationLogic,"\n",(0,i.jsx)(n.h2,{id:"apply-the-middleware-to-your-api",children:"Appliquer le middleware \xe0 votre API"}),"\n",(0,i.jsx)(n.p,{children:"Appliquez maintenant le middleware \xe0 vos routes API prot\xe9g\xe9es."}),"\n","\n",e.applyMiddleware,"\n",(0,i.jsx)(n.h2,{id:"test-your-protected-api",children:"Tester votre API prot\xe9g\xe9e"}),"\n",(0,i.jsx)(a.Ay,{}),"\n",(0,i.jsx)(h,{})]})}function S(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(z,{...e})}):z(e)}},59115:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>h,contentTitle:()=>g,default:()=>x,frontMatter:()=>p,metadata:()=>i,toc:()=>m});const i=JSON.parse('{"id":"api-protection/java/spring-boot/README","title":"Prot\xe9gez votre API Spring Boot avec le contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC) et la validation JWT","description":"Ce guide vous aidera \xe0 impl\xe9menter l\'autorisation pour s\xe9curiser vos APIs Spring Boot en utilisant le contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC) et les JSON Web Tokens (JWTs) \xe9mis par Logto.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/api-protection/java/spring-boot/README.mdx","sourceDirName":"api-protection/java/spring-boot","slug":"/api-protection/java/spring-boot/","permalink":"/fr/api-protection/java/spring-boot/","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/fr/docusaurus-plugin-content-docs/current/api-protection/java/spring-boot/README.mdx","tags":[],"version":"current","frontMatter":{"sidebar_label":"Spring Boot"},"sidebar":"apiProtectionSidebar","previous":{"title":"Quarkus","permalink":"/fr/api-protection/java/quarkus/"},"next":{"title":"Vert.x Web","permalink":"/fr/api-protection/java/vertx-web/"}}');var s=r(25105),t=r(79621),o=r(57476),a=r(20242),l=r(51198),c=r(84149);function d(e){const n={a:"a",admonition:"admonition",code:"code",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Pour initialiser un nouveau projet Spring Boot, vous pouvez utiliser Spring Initializr ou suivre ces \xe9tapes :"}),"\n",(0,s.jsxs)(n.p,{children:["Visitez ",(0,s.jsx)(n.a,{href:"https://start.spring.io/",children:"Spring Initializr"})," et s\xe9lectionnez :"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Projet : Maven"}),"\n",(0,s.jsx)(n.li,{children:"Langage : Java"}),"\n",(0,s.jsx)(n.li,{children:"Spring Boot : derni\xe8re version stable"}),"\n",(0,s.jsx)(n.li,{children:"D\xe9pendances : Spring Web, Spring Security"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Ou cr\xe9ez-le manuellement :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",metastring:'title="pom.xml"',children:'<?xml version="1.0" encoding="UTF-8"?>\n<project xmlns="http://maven.apache.org/POM/4.0.0">\n    <modelVersion>4.0.0</modelVersion>\n    <parent>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-parent</artifactId>\n        <version>3.2.0</version>\n        <relativePath/>\n    </parent>\n\n    <groupId>com.example</groupId>\n    <artifactId>your-api-name</artifactId>\n    <version>0.0.1-SNAPSHOT</version>\n    <name>your-api-name</name>\n\n    <properties>\n        <java.version>17</java.version>\n    </properties>\n\n    <dependencies>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-web</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-security</artifactId>\n        </dependency>\n    </dependencies>\n</project>\n'})}),"\n",(0,s.jsx)(n.p,{children:"Cr\xe9ez une application Spring Boot de base :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",metastring:'title="src/main/java/com/example/Application.java"',children:"package com.example;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\n\n@SpringBootApplication\npublic class Application {\n    public static void main(String[] args) {\n        SpringApplication.run(Application.class, args);\n    }\n}\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsx)(n.p,{children:"Consultez la documentation de Spring Boot pour plus de d\xe9tails sur la configuration des contr\xf4leurs, des services et d'autres fonctionnalit\xe9s."})})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}const p={sidebar_label:"Spring Boot"},g="Prot\xe9gez votre API Spring Boot avec le contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC) et la validation JWT",h={},m=[...c.RM];function j(e){const n={a:"a",h1:"h1",header:"header",p:"p",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"prot\xe9gez-votre-api-spring-boot-avec-le-contr\xf4le-dacc\xe8s-bas\xe9-sur-les-r\xf4les-rbac-et-la-validation-jwt",children:"Prot\xe9gez votre API Spring Boot avec le contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC) et la validation JWT"})}),"\n",(0,s.jsxs)(n.p,{children:["Ce guide vous aidera \xe0 impl\xe9menter l'autorisation pour s\xe9curiser vos APIs Spring Boot en utilisant le ",(0,s.jsx)(n.a,{href:"/authorization/role-based-access-control",children:"contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC)"})," et les ",(0,s.jsx)(n.a,{href:"https://auth.wiki/jwt",children:"JSON Web Tokens (JWTs)"})," \xe9mis par Logto."]}),"\n","\n",(0,s.jsx)(c.Ay,{framework:"spring-boot",initializeProject:(0,s.jsx)(u,{}),languageInit:(0,s.jsx)(a.Ay,{}),applyMiddleware:(0,s.jsx)(l.Ay,{}),addValidationLogic:(0,s.jsx)(o.Ay,{framework:"spring-boot"})})]})}function x(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(j,{...e})}):j(e)}},41466:(e,n,r)=>{r.d(n,{Ay:()=>a,RM:()=>t});var i=r(25105),s=r(79621);const t=[];function o(e){const n={code:"code",p:"p",...(0,s.R)(),...e.components};return(0,i.jsxs)(n.p,{children:["D\xe9finissez les constantes et utilitaires n\xe9cessaires dans votre code pour g\xe9rer l\u2019extraction et la validation du jeton. Une requ\xeate valide doit inclure un en-t\xeate ",(0,i.jsx)(n.code,{children:"Authorization"})," sous la forme ",(0,i.jsx)(n.code,{children:"Bearer <jeton d\u2019acc\xe8s (access token)>"}),"."]})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},28503:(e,n,r)=>{r.d(n,{Ay:()=>a,RM:()=>t});var i=r(25105),s=r(79621);const t=[{value:"R\xe9cup\xe9rer depuis l\u2019endpoint de d\xe9couverte OpenID Connect",id:"fetch-from-openid-connect-discovery-endpoint",level:3},{value:"Codage en dur dans votre code (non recommand\xe9)",id:"hardcode-in-your-code-not-recommended",level:3}];function o(e){const n={code:"code",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Vous aurez besoin des valeurs suivantes pour valider les jetons \xe9mis par Logto :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"URI JSON Web Key Set (JWKS) : L\u2019URL vers les cl\xe9s publiques de Logto, utilis\xe9e pour v\xe9rifier les signatures JWT."}),"\n",(0,i.jsx)(n.li,{children:"\xc9metteur (Issuer) : La valeur attendue de l\u2019\xe9metteur (l\u2019URL OIDC de Logto)."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Commencez par trouver l\u2019endpoint de votre tenant Logto. Vous pouvez le trouver \xe0 diff\xe9rents endroits :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Dans la Console Logto, sous ",(0,i.jsx)(n.strong,{children:"Param\xe8tres"})," \u2192 ",(0,i.jsx)(n.strong,{children:"Domaines"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Dans les param\xe8tres de toute application que vous avez configur\xe9e dans Logto, ",(0,i.jsx)(n.strong,{children:"Param\xe8tres"})," \u2192 ",(0,i.jsx)(n.strong,{children:"Endpoints & Credentials"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"fetch-from-openid-connect-discovery-endpoint",children:"R\xe9cup\xe9rer depuis l\u2019endpoint de d\xe9couverte OpenID Connect"}),"\n",(0,i.jsx)(n.p,{children:"Ces valeurs peuvent \xeatre r\xe9cup\xe9r\xe9es depuis l\u2019endpoint de d\xe9couverte OpenID Connect de Logto :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"https://<your-logto-endpoint>/oidc/.well-known/openid-configuration\n"})}),"\n",(0,i.jsx)(n.p,{children:"Voici un exemple de r\xe9ponse (autres champs omis pour plus de clart\xe9) :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "jwks_uri": "https://your-tenant.logto.app/oidc/jwks",\n  "issuer": "https://your-tenant.logto.app/oidc"\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"hardcode-in-your-code-not-recommended",children:"Codage en dur dans votre code (non recommand\xe9)"}),"\n",(0,i.jsx)(n.p,{children:"Puisque Logto ne permet pas de personnaliser l\u2019URI JWKS ou l\u2019\xe9metteur (Issuer), vous pouvez coder ces valeurs en dur dans votre code. Cependant, cela n\u2019est pas recommand\xe9 pour les applications en production, car cela peut augmenter la charge de maintenance si une configuration change \xe0 l\u2019avenir."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["URI JWKS : ",(0,i.jsx)(n.code,{children:"https://<your-logto-endpoint>/oidc/jwks"})]}),"\n",(0,i.jsxs)(n.li,{children:["\xc9metteur (Issuer) : ",(0,i.jsx)(n.code,{children:"https://<your-logto-endpoint>/oidc"})]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},53830:(e,n,r)=>{r.d(n,{Ay:()=>c,RM:()=>a});var i=r(25105),s=r(79621),t=r(38552),o=r(22002);const a=[{value:"Obtenir des jetons d\u2019acc\xe8s (Access tokens)",id:"get-access-tokens",level:3},{value:"Tester les points de terminaison prot\xe9g\xe9s",id:"test-protected-endpoints",level:3},{value:"Tests sp\xe9cifiques au mod\xe8le de permission",id:"permission-model-specific-testing",level:3}];function l(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components},{Details:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h3,{id:"get-access-tokens",children:"Obtenir des jetons d\u2019acc\xe8s (Access tokens)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Depuis votre application cliente :"}),(0,i.jsx)(n.br,{}),"\n","Si vous avez configur\xe9 une int\xe9gration client, votre application peut obtenir automatiquement les jetons. Extrayez le jeton d\u2019acc\xe8s (access token) et utilisez-le dans les requ\xeates API."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Pour tester avec curl / Postman :"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Jetons utilisateur :"})," Utilisez les outils d\xe9veloppeur de votre application cliente pour copier le jeton d\u2019acc\xe8s depuis le localStorage ou l\u2019onglet r\xe9seau."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Jetons machine \xe0 machine :"})," Utilisez le flux d\u2019identifiants client (client credentials flow). Voici un exemple non normatif utilisant curl :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST https://your-tenant.logto.app/oidc/token \\\n  -H "Content-Type: application/x-www-form-urlencoded" \\\n  -d "grant_type=client_credentials" \\\n  -d "client_id=your-m2m-client-id" \\\n  -d "client_secret=your-m2m-client-secret" \\\n  -d "resource=https://your-api-resource-indicator" \\\n  -d "scope=api:read api:write"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Vous devrez peut-\xeatre ajuster les param\xe8tres ",(0,i.jsx)(n.code,{children:"resource"})," et ",(0,i.jsx)(n.code,{children:"scope"})," selon votre ressource API (API resource) et vos permissions ; un param\xe8tre ",(0,i.jsx)(n.code,{children:"organization_id"})," peut \xe9galement \xeatre requis si votre API est li\xe9e \xe0 une organisation."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["Besoin d\u2019inspecter le contenu du jeton ? Utilisez notre ",(0,i.jsx)(n.a,{href:"https://logto.io/jwt-decoder",children:"d\xe9codificateur JWT"})," pour d\xe9coder et v\xe9rifier vos JWT."]})}),"\n",(0,i.jsx)(n.h3,{id:"test-protected-endpoints",children:"Tester les points de terminaison prot\xe9g\xe9s"}),"\n",(0,i.jsxs)(r,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)(n.strong,{children:"Requ\xeate avec jeton valide"})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -H "Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..." \\\n  http://localhost:3000/api/protected\n'})}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"R\xe9ponse attendue :"})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "auth": {\n    "sub": "user123",\n    "clientId": "app456",\n    "organizationId": "org789",\n    "scopes": ["api:read", "api:write"],\n    "audience": ["https://your-api-resource-indicator"]\n  }\n}\n'})})]}),"\n",(0,i.jsxs)(r,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)(n.strong,{children:"Jeton manquant"})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:3000/api/protected\n"})}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"R\xe9ponse attendue (401) :"})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "error": "Authorization header is missing"\n}\n'})})]}),"\n",(0,i.jsxs)(r,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)(n.strong,{children:"Jeton invalide"})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -H "Authorization: Bearer invalid-token" \\\n  http://localhost:3000/api/protected\n'})}),(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"R\xe9ponse attendue (401) :"})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "error": "Invalid token"\n}\n'})})]}),"\n",(0,i.jsx)(n.h3,{id:"permission-model-specific-testing",children:"Tests sp\xe9cifiques au mod\xe8le de permission"}),"\n",(0,i.jsxs)(o.A,{groupId:"permission-models",children:[(0,i.jsxs)(t.A,{value:"global-api-resources",label:"Ressources API globales",children:[(0,i.jsx)(n.p,{children:"Sc\xe9narios de test pour les API prot\xe9g\xe9es par des port\xe9es globales :"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Port\xe9es valides :"})," Testez avec des jetons qui incluent les port\xe9es API requises (par exemple, ",(0,i.jsx)(n.code,{children:"api:read"}),", ",(0,i.jsx)(n.code,{children:"api:write"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Port\xe9es manquantes :"})," Attendez-vous \xe0 une r\xe9ponse ",(0,i.jsx)(n.strong,{children:"403 Interdit"})," si le jeton ne contient pas les port\xe9es requises"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Audience incorrecte :"})," Attendez-vous \xe0 une r\xe9ponse ",(0,i.jsx)(n.strong,{children:"403 Interdit"})," si l\u2019audience ne correspond pas \xe0 la ressource API"]}),"\n"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Jeton sans les port\xe9es requises - attendre 403\ncurl -H "Authorization: Bearer token-without-required-scopes" \\\n  http://localhost:3000/api/protected\n'})})]}),(0,i.jsxs)(t.A,{value:"organization-permissions",label:"Permissions d\u2019organisation (hors API)",children:[(0,i.jsx)(n.p,{children:"Sc\xe9narios de test pour le contr\xf4le d\u2019acc\xe8s sp\xe9cifique \xe0 une organisation :"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Jeton d\u2019organisation valide :"})," Testez avec des jetons qui incluent le bon contexte d\u2019organisation (ID d\u2019organisation et port\xe9es)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Port\xe9es manquantes :"})," Attendez-vous \xe0 une r\xe9ponse ",(0,i.jsx)(n.strong,{children:"403 Interdit"})," si l\u2019utilisateur n\u2019a pas les permissions pour l\u2019action demand\xe9e"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Mauvaise organisation :"})," Attendez-vous \xe0 une r\xe9ponse ",(0,i.jsx)(n.strong,{children:"403 Interdit"})," si l\u2019audience ne correspond pas au contexte d\u2019organisation (",(0,i.jsx)(n.code,{children:"urn:logto:organization:<organization_id>"}),")"]}),"\n"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Jeton pour une mauvaise organisation - attendre 403\ncurl -H "Authorization: Bearer token-for-different-organization" \\\n  http://localhost:3000/api/protected\n'})})]}),(0,i.jsxs)(t.A,{value:"organization-level-api-resources",label:"Ressources API au niveau organisation",children:[(0,i.jsx)(n.p,{children:"Sc\xe9narios de test combinant la validation de ressource API avec le contexte d\u2019organisation :"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Organisation valide + port\xe9es API :"})," Testez avec des jetons ayant \xe0 la fois le contexte d\u2019organisation et les port\xe9es API requises"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Port\xe9es API manquantes :"})," Attendez-vous \xe0 une r\xe9ponse ",(0,i.jsx)(n.strong,{children:"403 Interdit"})," si le jeton d\u2019organisation ne poss\xe8de pas les permissions API requises"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Mauvaise organisation :"})," Attendez-vous \xe0 une r\xe9ponse ",(0,i.jsx)(n.strong,{children:"403 Interdit"})," lors de l\u2019acc\xe8s \xe0 l\u2019API avec un jeton d\u2019une autre organisation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Audience incorrecte :"})," Attendez-vous \xe0 une r\xe9ponse ",(0,i.jsx)(n.strong,{children:"403 Interdit"})," si l\u2019audience ne correspond pas \xe0 la ressource API au niveau organisation"]}),"\n"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Jeton d\u2019organisation sans port\xe9es API - attendre 403\ncurl -H "Authorization: Bearer organization-token-without-api-scopes" \\\n  http://localhost:3000/api/protected\n'})})]})]})]})}function c(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},12128:(e,n,r)=>{r.d(n,{Ay:()=>c,RM:()=>a});var i=r(25105),s=r(79621),t=r(38552),o=r(22002);const a=[{value:"\xc0 v\xe9rifier selon chaque mod\xe8le de permission",id:"what-to-check-for-each-permission-model",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h3:"h3",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Apr\xe8s avoir extrait le jeton et r\xe9cup\xe9r\xe9 la configuration OIDC, validez les \xe9l\xe9ments suivants :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Signature :"})," Le JWT doit \xeatre valide et sign\xe9 par Logto (via JWKS)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\xc9metteur (Issuer) :"})," Doit correspondre \xe0 l\u2019\xe9metteur de votre tenant Logto."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Audience (Audience) :"})," Doit correspondre \xe0 l\u2019indicateur de ressource de l\u2019API enregistr\xe9 dans Logto, ou au contexte d\u2019organisation si applicable."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Expiration :"})," Le jeton ne doit pas \xeatre expir\xe9."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Permissions (Port\xe9es / scopes) :"})," Le jeton doit inclure les port\xe9es requises pour votre API / action. Les port\xe9es sont des cha\xeenes s\xe9par\xe9es par des espaces dans la revendication ",(0,i.jsx)(n.code,{children:"scope"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Contexte d\u2019organisation :"})," Si vous prot\xe9gez des ressources API au niveau organisation, validez la revendication ",(0,i.jsx)(n.code,{children:"organization_id"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Consultez ",(0,i.jsx)(n.a,{href:"https://auth.wiki/jwt",children:"JSON Web Token"})," pour en savoir plus sur la structure et les revendications des JWT."]}),"\n",(0,i.jsx)(n.h3,{id:"what-to-check-for-each-permission-model",children:"\xc0 v\xe9rifier selon chaque mod\xe8le de permission"}),"\n",(0,i.jsxs)(o.A,{groupId:"permission-models",children:[(0,i.jsx)(t.A,{value:"global-api-resources",label:"Ressources API globales",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Revendication Audience (",(0,i.jsx)(n.code,{children:"aud"}),") :"]})," Indicateur de ressource API"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Revendication Organisation (",(0,i.jsx)(n.code,{children:"organization_id"}),") :"]})," ",(0,i.jsx)(n.em,{children:"Non pr\xe9sent"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Port\xe9es (permissions) \xe0 v\xe9rifier (",(0,i.jsx)(n.code,{children:"scope"}),") :"]})," Permissions de ressource API"]}),"\n"]})}),(0,i.jsx)(t.A,{value:"organization-permissions",label:"Permissions d'organisation (hors API)",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Revendication Audience (",(0,i.jsx)(n.code,{children:"aud"}),") :"]})," ",(0,i.jsx)(n.code,{children:"urn:logto:organization:<id>"})," (le contexte d'organisation est dans ",(0,i.jsx)(n.code,{children:"aud"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Revendication Organisation (",(0,i.jsx)(n.code,{children:"organization_id"}),") :"]})," ",(0,i.jsx)(n.em,{children:"Non pr\xe9sent"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Port\xe9es (permissions) \xe0 v\xe9rifier (",(0,i.jsx)(n.code,{children:"scope"}),") :"]})," Permissions d'organisation"]}),"\n"]})}),(0,i.jsx)(t.A,{value:"organization-level-api-resources",label:"Ressources API au niveau organisation",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Revendication Audience (",(0,i.jsx)(n.code,{children:"aud"}),") :"]})," Indicateur de ressource API"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Revendication Organisation (",(0,i.jsx)(n.code,{children:"organization_id"}),") :"]})," ID de l'organisation (doit correspondre \xe0 la requ\xeate)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["Port\xe9es (permissions) \xe0 v\xe9rifier (",(0,i.jsx)(n.code,{children:"scope"}),") :"]})," Permissions de ressource API"]}),"\n"]})})]}),"\n",(0,i.jsx)("small",{children:(0,i.jsxs)(n.p,{children:["Pour les permissions d\u2019organisation hors API, le contexte d\u2019organisation est repr\xe9sent\xe9 par la\nrevendication ",(0,i.jsx)(n.code,{children:"aud"})," (par exemple, ",(0,i.jsx)(n.code,{children:"urn:logto:organization:abc123"}),"). La revendication\n",(0,i.jsx)(n.code,{children:"organization_id"})," n\u2019est pr\xe9sente que pour les jetons de ressource API au niveau organisation."]})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsx)(n.p,{children:"Validez toujours \xe0 la fois les permissions (port\xe9es / scopes) et le contexte (audience, organisation) pour s\xe9curiser les API multi-tenant."})})]})}function c(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},57476:(e,n,r)=>{r.d(n,{Ay:()=>m,RM:()=>g});var i=r(25105),s=r(79621),t=r(33435),o=r(38552),a=r(22002);function l(e){const n={code:"code",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["Ajoutez \xe0 votre ",(0,i.jsx)(n.code,{children:"pom.xml"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>io.micronaut.security</groupId>\n    <artifactId>micronaut-security-jwt</artifactId>\n</dependency>\n<dependency>\n    <groupId>io.micronaut</groupId>\n    <artifactId>micronaut-http-server-netty</artifactId>\n</dependency>\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="application.yml"',children:"micronaut:\n  security:\n    authentication: bearer\n    token:\n      jwt:\n        signatures:\n          jwks:\n            logto:\n              url: ${JWKS_URI:https://your-tenant.logto.app/oidc/jwks}\n        claims-validators:\n          issuer: ${JWT_ISSUER:https://your-tenant.logto.app/oidc}\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:'title="JwtClaimsValidator.java"',children:'import io.micronaut.security.token.Claims;\nimport io.micronaut.security.token.validator.TokenValidator;\nimport jakarta.inject.Singleton;\nimport org.reactivestreams.Publisher;\nimport reactor.core.publisher.Mono;\nimport java.util.Arrays;\nimport java.util.List;\n\n@Singleton\npublic class JwtClaimsValidator implements TokenValidator {\n\n    @Override\n    public Publisher<Boolean> validateToken(String token, Claims claims) {\n        try {\n            verifyPayload(claims);\n            return Mono.just(true);\n        } catch (AuthorizationException e) {\n            // Micronaut g\xe9rera le code de statut de mani\xe8re appropri\xe9e\n            return Mono.just(false);\n        }\n    }\n\n    private void verifyPayload(Claims claims) {\n        // La validation de l\u2019\xe9metteur (Issuer) est g\xe9r\xe9e automatiquement par la configuration JWT de Micronaut\n        // Impl\xe9mentez ici votre logique de v\xe9rification suppl\xe9mentaire bas\xe9e sur le mod\xe8le de permission (Permission)\n        // Utilisez les m\xe9thodes utilitaires ci-dessous pour l\u2019extraction des revendications (Claims)\n\n        // Exemple : throw new AuthorizationException("Permissions insuffisantes");\n    }\n\n    // M\xe9thodes utilitaires pour Micronaut JWT\n    @SuppressWarnings("unchecked")\n    private List<String> extractAudiences(Claims claims) {\n        Object aud = claims.get("aud");\n        if (aud instanceof List) {\n            return (List<String>) aud;\n        } else if (aud instanceof String) {\n            return Arrays.asList((String) aud);\n        }\n        return List.of();\n    }\n\n    private String extractScopes(Claims claims) {\n        return (String) claims.get("scope");\n    }\n\n    private String extractOrganizationId(Claims claims) {\n        return (String) claims.get("organization_id");\n    }\n}\n'})})]})}function c(e){const n={code:"code",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["Ajoutez \xe0 votre ",(0,i.jsx)(n.code,{children:"pom.xml"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>io.quarkus</groupId>\n    <artifactId>quarkus-smallrye-jwt</artifactId>\n</dependency>\n<dependency>\n    <groupId>io.quarkus</groupId>\n    <artifactId>quarkus-resteasy-reactive</artifactId>\n</dependency>\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-properties",metastring:'title="application.properties"',children:"# Configuration JWT (Jeton d\u2019identifiant)\nmp.jwt.verify.publickey.location=${JWKS_URI:https://your-tenant.logto.app/oidc/jwks}\nmp.jwt.verify.issuer=${JWT_ISSUER:https://your-tenant.logto.app/oidc}\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:'title="JwtVerificationFilter.java"',children:'import org.eclipse.microprofile.jwt.JsonWebToken;\nimport jakarta.enterprise.context.ApplicationScoped;\nimport jakarta.inject.Inject;\nimport jakarta.ws.rs.container.ContainerRequestContext;\nimport jakarta.ws.rs.container.ContainerRequestFilter;\nimport jakarta.ws.rs.core.Response;\nimport jakarta.ws.rs.ext.Provider;\nimport java.util.ArrayList;\nimport java.util.List;\n\n@Provider\n@ApplicationScoped\npublic class JwtVerificationFilter implements ContainerRequestFilter {\n\n    @Inject\n    JsonWebToken jwt;\n\n    @Override\n    public void filter(ContainerRequestContext requestContext) {\n        if (requestContext.getUriInfo().getPath().startsWith("/api/protected")) {\n            try {\n                verifyPayload(jwt);\n                requestContext.setProperty("auth", jwt);\n            } catch (AuthorizationException e) {\n                requestContext.abortWith(\n                    Response.status(e.getStatusCode())\n                        .entity("{\\"error\\": \\"" + e.getMessage() + "\\"}")\n                        .build()\n                );\n            } catch (Exception e) {\n                requestContext.abortWith(\n                    Response.status(401)\n                        .entity("{\\"error\\": \\"Invalid token\\"}")\n                        .build()\n                );\n            }\n        }\n    }\n\n    private void verifyPayload(JsonWebToken jwt) {\n        // La validation de l\u2019\xe9metteur (Issuer) est g\xe9r\xe9e automatiquement par l\u2019extension Quarkus JWT\n        // Impl\xe9mentez ici votre logique de v\xe9rification suppl\xe9mentaire selon votre mod\xe8le de permission (Permission)\n        // Utilisez les m\xe9thodes utilitaires ci-dessous pour extraire les revendications (Claims)\n    }\n\n    // M\xe9thodes utilitaires pour Quarkus JWT\n    private List<String> extractAudiences(JsonWebToken jwt) {\n        return new ArrayList<>(jwt.getAudience());\n    }\n\n    private String extractScopes(JsonWebToken jwt) {\n        return jwt.getClaim("scope");\n    }\n\n    private String extractOrganizationId(JsonWebToken jwt) {\n        return jwt.getClaim("organization_id");\n    }\n}\n'})})]})}function d(e){const n={code:"code",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["Ajoutez \xe0 votre ",(0,i.jsx)(n.code,{children:"pom.xml"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-security</artifactId>\n</dependency>\n<dependency>\n    <groupId>org.springframework.security</groupId>\n    <artifactId>spring-security-oauth2-resource-server</artifactId>\n</dependency>\n<dependency>\n    <groupId>org.springframework.security</groupId>\n    <artifactId>spring-security-oauth2-jose</artifactId>\n</dependency>\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:'title="JwtSecurityConfig.java"',children:'import org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.oauth2.jwt.JwtDecoder;\nimport org.springframework.security.oauth2.jwt.NimbusJwtDecoder;\nimport org.springframework.security.web.SecurityFilterChain;\n\n@Configuration\n@EnableWebSecurity\npublic class JwtSecurityConfig {\n\n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        http\n            .authorizeHttpRequests(authz -> authz\n                .requestMatchers("/api/protected/**").authenticated()\n                .anyRequest().permitAll()\n            )\n            .oauth2ResourceServer(oauth2 -> oauth2\n                .jwt(jwt -> jwt.decoder(jwtDecoder()))\n            );\n        return http.build();\n    }\n\n    @Bean\n    public JwtDecoder jwtDecoder() {\n        // N\'oubliez pas de d\xe9finir ces variables d\'environnement dans votre d\xe9ploiement\n        String jwksUri = System.getenv("JWKS_URI");\n        String issuer = System.getenv("JWT_ISSUER");\n\n        return NimbusJwtDecoder.withJwkSetUri(jwksUri)\n            .issuer(issuer)\n            .build();\n    }\n}\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:'title="JwtValidator.java"',children:'import org.springframework.security.oauth2.jwt.Jwt;\nimport org.springframework.stereotype.Component;\nimport java.util.List;\n\n@Component\npublic class JwtValidator {\n\n    public void verifyPayload(Jwt jwt) {\n        // La validation de l\u2019\xe9metteur (Issuer) est g\xe9r\xe9e automatiquement par le d\xe9codeur JWT de Spring Security\n        // Impl\xe9mentez ici votre logique de v\xe9rification suppl\xe9mentaire bas\xe9e sur le mod\xe8le de permission (Permission)\n        // Utilisez les m\xe9thodes utilitaires ci-dessous pour extraire les revendications (Claims)\n\n        // Exemple : throw new AuthorizationException("Insufficient permissions");\n        // Le code de statut sera g\xe9r\xe9 par la gestion des exceptions de Spring Security\n    }\n\n    // M\xe9thodes utilitaires pour JWT avec Spring Boot\n    private List<String> extractAudiences(Jwt jwt) {\n        return jwt.getAudience();\n    }\n\n    private String extractScopes(Jwt jwt) {\n        return jwt.getClaimAsString("scope");\n    }\n\n    private String extractOrganizationId(Jwt jwt) {\n        return jwt.getClaimAsString("organization_id");\n    }\n}\n'})})]})}function u(e){const n={code:"code",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["Ajoutez \xe0 votre ",(0,i.jsx)(n.code,{children:"pom.xml"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>io.vertx</groupId>\n    <artifactId>vertx-web</artifactId>\n</dependency>\n<dependency>\n    <groupId>io.vertx</groupId>\n    <artifactId>vertx-auth-jwt</artifactId>\n</dependency>\n<dependency>\n    <groupId>io.vertx</groupId>\n    <artifactId>vertx-web-client</artifactId>\n</dependency>\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:'title="JwtAuthHandler.java"',children:'import io.vertx.core.Future;\nimport io.vertx.core.Handler;\nimport io.vertx.core.Vertx;\nimport io.vertx.core.json.JsonArray;\nimport io.vertx.core.json.JsonObject;\nimport io.vertx.ext.auth.jwt.JWTAuth;\nimport io.vertx.ext.auth.jwt.JWTAuthOptions;\nimport io.vertx.ext.web.RoutingContext;\nimport io.vertx.ext.web.client.WebClient;\nimport java.util.List;\nimport java.util.ArrayList;\n\npublic class JwtAuthHandler implements Handler<RoutingContext> {\n\n    private final JWTAuth jwtAuth;\n    private final WebClient webClient;\n    private final String expectedIssuer;\n    private final String jwksUri;\n\n    public JwtAuthHandler(Vertx vertx) {\n        this.webClient = WebClient.create(vertx);\n        this.jwtAuth = JWTAuth.create(vertx, new JWTAuthOptions());\n\n        // N\'oubliez pas de d\xe9finir ces variables d\'environnement dans votre d\xe9ploiement\n        this.expectedIssuer = System.getenv("JWT_ISSUER");\n        this.jwksUri = System.getenv("JWKS_URI");\n\n        // R\xe9cup\xe9rer le JWKS et configurer l\'authentification JWT\n        fetchJWKS().onSuccess(jwks -> {\n            // Configurer le JWKS (simplifi\xe9 - vous pourriez avoir besoin d\'un parseur JWKS appropri\xe9)\n        });\n    }\n\n    @Override\n    public void handle(RoutingContext context) {\n        String authHeader = context.request().getHeader("Authorization");\n        if (authHeader == null || !authHeader.startsWith("Bearer ")) {\n            context.response()\n                .setStatusCode(401)\n                .putHeader("Content-Type", "application/json")\n                .end("{\\"error\\": \\"Authorization header missing or invalid\\"}");\n            return;\n        }\n\n        String token = authHeader.substring(7);\n        jwtAuth.authenticate(new JsonObject().put("jwt", token))\n            .onSuccess(user -> {\n                try {\n                    JsonObject principal = user.principal();\n                    verifyPayload(principal);\n                    context.put("auth", principal);\n                    context.next();\n                } catch (AuthorizationException e) {\n                    context.response()\n                        .setStatusCode(e.getStatusCode())  // Utiliser le code d\'\xe9tat de l\'exception\n                        .putHeader("Content-Type", "application/json")\n                        .end("{\\"error\\": \\"" + e.getMessage() + "\\"}");\n                } catch (Exception e) {\n                    context.response()\n                        .setStatusCode(401)\n                        .putHeader("Content-Type", "application/json")\n                        .end("{\\"error\\": \\"Invalid token\\"}");\n                }\n            })\n            .onFailure(err -> {\n                context.response()\n                    .setStatusCode(401)\n                    .putHeader("Content-Type", "application/json")\n                    .end("{\\"error\\": \\"Invalid token: " + err.getMessage() + "\\"}");\n            });\n    }\n\n    private Future<JsonObject> fetchJWKS() {\n        return webClient.getAbs(this.jwksUri)\n            .send()\n            .map(response -> response.bodyAsJsonObject());\n    }\n\n    private void verifyPayload(JsonObject principal) {\n        // V\xe9rifier l\'\xe9metteur manuellement pour Vert.x\n        String issuer = principal.getString("iss");\n        if (issuer == null || !expectedIssuer.equals(issuer)) {\n            throw new AuthorizationException("Invalid issuer: " + issuer);\n        }\n\n        // Impl\xe9mentez ici votre logique de v\xe9rification suppl\xe9mentaire bas\xe9e sur le mod\xe8le de permission\n        // Utilisez les m\xe9thodes utilitaires ci-dessous pour l\'extraction des revendications\n    }\n\n    // M\xe9thodes utilitaires pour Vert.x JWT\n    private List<String> extractAudiences(JsonObject principal) {\n        JsonArray audiences = principal.getJsonArray("aud");\n        if (audiences != null) {\n            List<String> result = new ArrayList<>();\n            for (Object aud : audiences) {\n                result.add(aud.toString());\n            }\n            return result;\n        }\n        return List.of();\n    }\n\n    private String extractScopes(JsonObject principal) {\n        return principal.getString("scope");\n    }\n\n    private String extractOrganizationId(JsonObject principal) {\n        return principal.getString("organization_id");\n    }\n}\n'})})]})}const p=Object.freeze({"spring-boot":(0,i.jsx)((function(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}),{}),quarkus:(0,i.jsx)((function(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}),{}),micronaut:(0,i.jsx)((function(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}),{}),"vertx-web":(0,i.jsx)((function(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}),{})}),g=[];function h(e){const n={code:"code",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Nous utilisons diff\xe9rentes biblioth\xe8ques JWT selon le framework. Installez les d\xe9pendances requises :"}),"\n",e.framework?p[e.framework]:(0,i.jsx)(a.A,{groupId:"api-framework",children:Object.entries(p).map((([e,n])=>(0,i.jsx)(o.A,{value:e,label:(0,t.My)(e),children:n},e)))}),"\n",(0,i.jsx)(n.p,{children:"Selon votre mod\xe8le de permission (Permission), impl\xe9mentez la logique de v\xe9rification appropri\xe9e :"}),"\n",(0,i.jsxs)(a.A,{groupId:"permission-models",children:[(0,i.jsx)(o.A,{value:"global-api-resources",label:"Ressources API globales",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// V\xe9rifiez que la revendication d\'audience (Audience) correspond \xe0 votre indicateur de ressource API\nList<String> audiences = extractAudiences(token); // Extraction sp\xe9cifique au framework\nif (!audiences.contains("https://your-api-resource-indicator")) {\n    throw new AuthorizationException("Audience invalide");\n}\n\n// V\xe9rifiez les port\xe9es (Scopes) requises pour les ressources API globales\nList<String> requiredScopes = Arrays.asList("api:read", "api:write"); // Remplacez par vos port\xe9es requises r\xe9elles\nString scopes = extractScopes(token); // Extraction sp\xe9cifique au framework\nList<String> tokenScopes = scopes != null ? Arrays.asList(scopes.split(" ")) : List.of();\n\nif (!tokenScopes.containsAll(requiredScopes)) {\n    throw new AuthorizationException("Port\xe9e insuffisante");\n}\n'})})}),(0,i.jsx)(o.A,{value:"organization-permissions",label:"Permissions d'organisation (hors API)",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// V\xe9rifiez que la revendication d\'audience (Audience) correspond au format d\'organisation\nList<String> audiences = extractAudiences(token); // Extraction sp\xe9cifique au framework\nboolean hasOrgAudience = audiences.stream()\n    .anyMatch(aud -> aud.startsWith("urn:logto:organization:"));\n\nif (!hasOrgAudience) {\n    throw new AuthorizationException("Audience invalide pour les permissions d\'organisation");\n}\n\n// V\xe9rifiez que l\'ID d\'organisation correspond au contexte (vous devrez peut-\xeatre l\'extraire du contexte de la requ\xeate)\nString expectedOrgId = "your-organization-id"; // \xc0 extraire du contexte de la requ\xeate\nString expectedAud = "urn:logto:organization:" + expectedOrgId;\nif (!audiences.contains(expectedAud)) {\n    throw new AuthorizationException("ID d\'organisation non correspondant");\n}\n\n// V\xe9rifiez les port\xe9es (Scopes) d\'organisation requises\nList<String> requiredScopes = Arrays.asList("invite:users", "manage:settings"); // Remplacez par vos port\xe9es requises r\xe9elles\nString scopes = extractScopes(token); // Extraction sp\xe9cifique au framework\nList<String> tokenScopes = scopes != null ? Arrays.asList(scopes.split(" ")) : List.of();\n\nif (!tokenScopes.containsAll(requiredScopes)) {\n    throw new AuthorizationException("Port\xe9e d\'organisation insuffisante");\n}\n'})})}),(0,i.jsx)(o.A,{value:"organization-level-api-resources",label:"Ressources API au niveau de l'organisation",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// V\xe9rifiez que la revendication d\'audience (Audience) correspond \xe0 votre indicateur de ressource API\nList<String> audiences = extractAudiences(token); // Extraction sp\xe9cifique au framework\nif (!audiences.contains("https://your-api-resource-indicator")) {\n    throw new AuthorizationException("Audience invalide pour les ressources API au niveau de l\'organisation");\n}\n\n// V\xe9rifiez que l\'ID d\'organisation correspond au contexte (vous devrez peut-\xeatre l\'extraire du contexte de la requ\xeate)\nString expectedOrgId = "your-organization-id"; // \xc0 extraire du contexte de la requ\xeate\nString orgId = extractOrganizationId(token); // Extraction sp\xe9cifique au framework\nif (!expectedOrgId.equals(orgId)) {\n    throw new AuthorizationException("ID d\'organisation non correspondant");\n}\n\n// V\xe9rifiez les port\xe9es (Scopes) requises pour les ressources API au niveau de l\'organisation\nList<String> requiredScopes = Arrays.asList("api:read", "api:write"); // Remplacez par vos port\xe9es requises r\xe9elles\nString scopes = extractScopes(token); // Extraction sp\xe9cifique au framework\nList<String> tokenScopes = scopes != null ? Arrays.asList(scopes.split(" ")) : List.of();\n\nif (!tokenScopes.containsAll(requiredScopes)) {\n    throw new AuthorizationException("Port\xe9es API au niveau de l\'organisation insuffisantes");\n}\n'})})})]}),"\n",(0,i.jsx)(n.p,{children:"Les m\xe9thodes utilitaires pour extraire les revendications (Claims) sont sp\xe9cifiques au framework. Consultez les d\xe9tails d'impl\xe9mentation dans les fichiers de validation sp\xe9cifiques au framework ci-dessus."})]})}function m(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},20242:(e,n,r)=>{r.d(n,{Ay:()=>a,RM:()=>t});var i=r(25105),s=r(79621);const t=[];function o(e){const n={code:"code",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:'title="AuthorizationException.java"',children:"public class AuthorizationException extends RuntimeException {\n    private final int statusCode;\n\n    public AuthorizationException(String message) {\n        this(message, 403); // Par d\xe9faut \xe0 403 Interdit\n    }\n\n    public AuthorizationException(String message, int statusCode) {\n        super(message);\n        this.statusCode = statusCode;\n    }\n\n    public int getStatusCode() {\n        return statusCode;\n    }\n}\n"})})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},51198:(e,n,r)=>{r.d(n,{Ay:()=>a,RM:()=>t});var i=r(25105),s=r(79621);const t=[];function o(e){const n={code:"code",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:'title="ProtectedController.java"',children:'import org.springframework.security.core.annotation.AuthenticationPrincipal;\nimport org.springframework.security.oauth2.jwt.Jwt;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RestController;\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.Map;\n\n@RestController\npublic class ProtectedController {\n\n    @GetMapping("/api/protected")\n    public Map<String, Object> protectedEndpoint(@AuthenticationPrincipal Jwt jwt) {\n        // Informations du jeton d\u2019acc\xe8s (Access token) directement depuis le JWT\n        String scopes = jwt.getClaimAsString("scope");\n        List<String> scopeList = scopes != null ? Arrays.asList(scopes.split(" ")) : List.of();\n\n        return Map.of(\n            "sub", jwt.getSubject(),\n            "client_id", jwt.getClaimAsString("client_id"),\n            "organization_id", jwt.getClaimAsString("organization_id"),\n            "scopes", scopeList,\n            "audience", jwt.getAudience()\n        );\n    }\n}\n'})})}function a(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},38552:(e,n,r)=>{r.d(n,{A:()=>o});r(58101);var i=r(13526);const s={tabItem:"tabItem_dgSZ"};var t=r(25105);function o(e){let{children:n,hidden:r,className:o}=e;return(0,t.jsx)("div",{role:"tabpanel",className:(0,i.A)(s.tabItem,o),hidden:r,children:n})}},22002:(e,n,r)=>{r.d(n,{A:()=>I});var i=r(58101),s=r(13526),t=r(60755),o=r(55234),a=r(6635),l=r(4100),c=r(35661),d=r(42752);function u(e){return i.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:r}=e;return(0,i.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:r,attributes:i,default:s}}=e;return{value:n,label:r,attributes:i,default:s}}))}(r);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,r])}function g(e){let{value:n,tabValues:r}=e;return r.some((e=>e.value===n))}function h(e){let{queryString:n=!1,groupId:r}=e;const s=(0,o.W6)(),t=function(e){let{queryString:n=!1,groupId:r}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:n,groupId:r});return[(0,l.aZ)(t),(0,i.useCallback)((e=>{if(!t)return;const n=new URLSearchParams(s.location.search);n.set(t,e),s.replace({...s.location,search:n.toString()})}),[t,s])]}function m(e){const{defaultValue:n,queryString:r=!1,groupId:s}=e,t=p(e),[o,l]=(0,i.useState)((()=>function(e){let{defaultValue:n,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!g({value:n,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const i=r.find((e=>e.default))??r[0];if(!i)throw new Error("Unexpected error: 0 tabValues");return i.value}({defaultValue:n,tabValues:t}))),[c,u]=h({queryString:r,groupId:s}),[m,j]=function(e){let{groupId:n}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(n),[s,t]=(0,d.Dv)(r);return[s,(0,i.useCallback)((e=>{r&&t.set(e)}),[r,t])]}({groupId:s}),x=(()=>{const e=c??m;return g({value:e,tabValues:t})?e:null})();(0,a.A)((()=>{x&&l(x)}),[x]);return{selectedValue:o,selectValue:(0,i.useCallback)((e=>{if(!g({value:e,tabValues:t}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),j(e)}),[u,j,t]),tabValues:t}}var j=r(21929);const x={tabList:"tabList_osvQ",tabItem:"tabItem_dc4O"};var v=r(25105);function f(e){let{className:n,block:r,selectedValue:i,selectValue:o,tabValues:a}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,t.a_)(),d=e=>{const n=e.currentTarget,r=l.indexOf(n),s=a[r].value;s!==i&&(c(n),o(s))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const r=l.indexOf(e.currentTarget)+1;n=l[r]??l[0];break}case"ArrowLeft":{const r=l.indexOf(e.currentTarget)-1;n=l[r]??l[l.length-1];break}}n?.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":r},n),children:a.map((e=>{let{value:n,label:r,attributes:t}=e;return(0,v.jsx)("li",{role:"tab",tabIndex:i===n?0:-1,"aria-selected":i===n,ref:e=>{l.push(e)},onKeyDown:u,onClick:d,...t,className:(0,s.A)("tabs__item",x.tabItem,t?.className,{"tabs__item--active":i===n}),children:r??n},n)}))})}function b(e){let{lazy:n,children:r,selectedValue:t}=e;const o=(Array.isArray(r)?r:[r]).filter(Boolean);if(n){const e=o.find((e=>e.props.value===t));return e?(0,i.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:o.map(((e,n)=>(0,i.cloneElement)(e,{key:n,hidden:e.props.value!==t})))})}function A(e){const n=m(e);return(0,v.jsxs)("div",{className:(0,s.A)("tabs-container",x.tabList),children:[(0,v.jsx)(f,{...n,...e}),(0,v.jsx)(b,{...n,...e})]})}function I(e){const n=(0,j.A)();return(0,v.jsx)(A,{...e,children:u(e.children)},String(n))}},33435:(e,n,r)=>{r.d(n,{Id:()=>o,My:()=>t});const i=Object.freeze({dotnet:{name:".NET"},go:{name:"Go"},java:{name:"Java"},nodejs:{name:"Node.js"},php:{name:"PHP"},python:{name:"Python"},ruby:{name:"Ruby"},rust:{name:"Rust"}}),s=Object.freeze({express:{name:"Express.js",language:"nodejs"},koa:{name:"Koa.js",language:"nodejs"},fastify:{name:"Fastify",language:"nodejs"},hapi:{name:"Hapi.js",language:"nodejs"},nestjs:{name:"NestJS",language:"nodejs"},gin:{name:"Gin",language:"go"},fiber:{name:"Fiber",language:"go"},echo:{name:"Echo",language:"go"},chi:{name:"Chi",language:"go"},"spring-boot":{name:"Spring Boot",language:"java"},quarkus:{name:"Quarkus",language:"java"},micronaut:{name:"Micronaut",language:"java"},"vertx-web":{name:"Vert.x Web",language:"java"},laravel:{name:"Laravel",language:"php"},symfony:{name:"Symfony",language:"php"},slim:{name:"Slim",language:"php"},rails:{name:"Ruby on Rails",language:"ruby"},sinatra:{name:"Sinatra",language:"ruby"},grape:{name:"Grape",language:"ruby"},fastapi:{name:"FastAPI",language:"python"},flask:{name:"Flask",language:"python"},django:{name:"Django",language:"python"},"django-rest":{name:"Django REST Framework",language:"python"},axum:{name:"Axum",language:"rust"},"actix-web":{name:"Actix Web",language:"rust"},rocket:{name:"Rocket",language:"rust"},"aspnet-core":{name:"ASP.NET Core",language:"dotnet"}}),t=e=>s[e].name,o=e=>i[s[e].language].name},46643:(e,n,r)=>{r.d(n,{A:()=>i});const i=r.p+"assets/images/rbac-global-api-resources-33fafc263308d3f769c62cbcdb8d7829.png"},1242:(e,n,r)=>{r.d(n,{A:()=>i});const i=r.p+"assets/images/rbac-organization-level-api-resources-9533c281f3ee1cf52aefe821717e1fef.png"},93855:(e,n,r)=>{r.d(n,{A:()=>i});const i=r.p+"assets/images/rbac-organization-permissions-3302be06221b4399f73ddceac8ca17e3.png"},79621:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var i=r(58101);const s={},t=i.createContext(s);function o(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);