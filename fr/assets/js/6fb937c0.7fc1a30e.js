"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[53855],{98281:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"authorization/role-based-access-control/protect-api-resources-with-rbac","title":"Prot\xe9ger les ressources API avec RBAC","description":"En plus de Prot\xe9ger votre API qui s\xe9curise les ressources en s\'assurant qu\'un JWT valide est pr\xe9sent, le contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC) peut \xe9galement \xeatre appliqu\xe9.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/authorization/role-based-access-control/protect-api-resources-with-rbac.mdx","sourceDirName":"authorization/role-based-access-control","slug":"/authorization/role-based-access-control/protect-api-resources-with-rbac","permalink":"/fr/authorization/role-based-access-control/protect-api-resources-with-rbac","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/fr/docusaurus-plugin-content-docs/current/authorization/role-based-access-control/protect-api-resources-with-rbac.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Configurer les r\xf4les","permalink":"/fr/authorization/role-based-access-control/configure-roles"},"next":{"title":"Mod\xe8le d\'organisation","permalink":"/fr/authorization/organization-template/"}}');var r=n(25105),o=n(79621);const i={sidebar_position:3},a="Prot\xe9ger les ressources API avec RBAC",l={},c=[{value:"Diagramme de flux d&#39;autorisation",id:"authorization-flow-diagram",level:2},{value:"Optionnel : G\xe9rer le changement de permissions utilisateur",id:"optional-handle-user-permission-change",level:2},{value:"Aucune nouvelle permission introduite dans le syst\xe8me",id:"no-new-permissions-introduced-into-the-system",level:3},{value:"Nouvelle permission introduite dans le syst\xe8me et attribu\xe9e \xe0 un utilisateur",id:"new-permission-is-introduced-into-the-system-and-assigned-to-a-user",level:3},{value:"Ressources connexes",id:"related-resources",level:2}];function u(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components},{Url:n}=s;return n||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"prot\xe9ger-les-ressources-api-avec-rbac",children:"Prot\xe9ger les ressources API avec RBAC"})}),"\n",(0,r.jsxs)(s.p,{children:["En plus de ",(0,r.jsx)(s.a,{href:"/authorization/api-resources/protect-your-api",children:"Prot\xe9ger votre API"})," qui s\xe9curise les ressources en s'assurant qu'un JWT valide est pr\xe9sent, le contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC) peut \xe9galement \xeatre appliqu\xe9."]}),"\n",(0,r.jsx)(s.p,{children:"Dans cet article, nous nous concentrerons sur la mani\xe8re dont le RBAC affecte la d\xe9l\xe9gation et la validation des port\xe9es dans votre flux d'authentification."}),"\n",(0,r.jsx)(s.h2,{id:"authorization-flow-diagram",children:"Diagramme de flux d'autorisation"}),"\n",(0,r.jsx)(s.mermaid,{value:"sequenceDiagram\n    participant Client\n    participant Logto\n    participant API\n\n    Note over Client,API: Authentification & Requ\xeate de jeton\n    Client->>Logto: GET /oidc/auth & POST /oidc/token\n    Note right of Client: avec ressource et port\xe9es demand\xe9es\n\n    Note over Logto: Filtrer les port\xe9es demand\xe9es en fonction<br/>de la politique RBAC de l'utilisateur\n    Logto--\x3e>Client: Retourne le jeton d\u2019acc\xe8s JWT\n    Note left of Logto: Le jeton contient :<br/>- Revendications JWT standard<br/>- Port\xe9es accord\xe9es (filtr\xe9es par RBAC)\n\n    Note over Client,API: Requ\xeate API\n    Client->>API: Requ\xeate avec jeton Bearer\n\n    Note over API: Valider le jeton JWT :<br/>- Validation JWT standard<br/>- V\xe9rifier les port\xe9es accord\xe9es\n\n    alt Jeton invalide\n        API--\x3e>Client: 401 Non autoris\xe9\n    else Jeton valide\n        alt Port\xe9es requises non dans les port\xe9es accord\xe9es\n            API--\x3e>Client: 403 Interdit\n        else A les port\xe9es requises\n            API--\x3e>Client: Ressource prot\xe9g\xe9e\n        end\n    end"}),"\n",(0,r.jsx)(s.p,{children:"Comme vous pouvez le voir sur le diagramme, la principale diff\xe9rence par rapport \xe0 la protection API de base est la gestion des port\xe9es. Au lieu d'accorder directement toutes les port\xe9es demand\xe9es, Logto les filtre d\xe9sormais en fonction de la politique RBAC de l'utilisateur. Le jeton JWT ne contiendra que les port\xe9es que l'utilisateur a obtenues gr\xe2ce \xe0 ses r\xf4les. C\xf4t\xe9 API, apr\xe8s avoir valid\xe9 l'authenticit\xe9 du jeton, il y a une v\xe9rification suppl\xe9mentaire pour s'assurer que le jeton contient les port\xe9es requises pour la ressource demand\xe9e."}),"\n",(0,r.jsx)(s.h2,{id:"optional-handle-user-permission-change",children:"Optionnel : G\xe9rer le changement de permissions utilisateur"}),"\n",(0,r.jsx)(s.p,{children:"Les permissions utilisateur peuvent \xeatre modifi\xe9es pendant une session - par exemple, de nouveaux r\xf4les peuvent leur \xeatre attribu\xe9s ou les permissions de r\xf4le existantes peuvent \xeatre modifi\xe9es. Dans ces sc\xe9narios, il peut \xeatre n\xe9cessaire de d\xe9tecter ces changements et de mettre \xe0 jour l'interface utilisateur de l'application."}),"\n",(0,r.jsx)(s.p,{children:"Que se passe-t-il lorsque les permissions d'un utilisateur changent ? Il y a deux cas."}),"\n",(0,r.jsx)(s.h3,{id:"no-new-permissions-introduced-into-the-system",children:"Aucune nouvelle permission introduite dans le syst\xe8me"}),"\n",(0,r.jsx)(s.p,{children:"Les jetons d\u2019acc\xe8s actuels resteront valides jusqu'\xe0 leur expiration, m\xeame apr\xe8s que les permissions d'un utilisateur aient \xe9t\xe9 modifi\xe9es. Cependant, les nouvelles permissions seront refl\xe9t\xe9es dans les jetons d\u2019acc\xe8s suivants, et toutes les permissions r\xe9voqu\xe9es seront omises."}),"\n",(0,r.jsxs)(s.p,{children:["Voici quelques ",(0,r.jsx)(s.strong,{children:"actions recommand\xe9es"})," :"]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Option 1 : Utiliser des temps d'expiration de jeton d\u2019acc\xe8s courts"})}),"\n",(0,r.jsxs)(s.p,{children:["Les jetons d\u2019acc\xe8s de courte dur\xe9e garantissent des mises \xe0 jour plus fr\xe9quentes des permissions utilisateur. Configurez les param\xe8tres d'expiration des jetons dans les param\xe8tres de ",(0,r.jsx)(s.a,{href:"/authorization/api-resources/#logto-api-resource-schema",children:"Ressource API"})," de la Console. L'inconv\xe9nient est que cela augmentera votre utilisation de jetons."]}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.strong,{children:"Option 2 : V\xe9rifier dynamiquement les permissions"})}),"\n",(0,r.jsxs)(s.p,{children:["Appelez p\xe9riodiquement les points de terminaison de ",(0,r.jsx)(s.a,{href:"/integrate-logto/interact-with-management-api",children:"Logto Management API"})," (par exemple, SWR) ou utilisez des techniques telles que WebSocket pour impl\xe9menter des connexions de longue dur\xe9e afin de r\xe9cup\xe9rer dynamiquement les permissions utilisateur. Lors de la d\xe9tection de changements, effacez le jeton d\u2019acc\xe8s existant et les nouveaux jetons \xe9mis refl\xe9teront automatiquement les changements de permissions. - API : User-role - API : Role-permission"]}),"\n",(0,r.jsxs)(s.p,{children:["Lorsqu'un changement de permission est d\xe9tect\xe9, effacez d'abord le jeton d\u2019acc\xe8s du stockage, puis appelez la m\xe9thode SDK ",(0,r.jsx)(s.code,{children:"getAccessToken()"})," pour en acqu\xe9rir un nouveau. Le nouveau jeton d\u2019acc\xe8s \xe9mis devrait refl\xe9ter les changements de permissions."]}),"\n",(0,r.jsx)(s.h3,{id:"new-permission-is-introduced-into-the-system-and-assigned-to-a-user",children:"Nouvelle permission introduite dans le syst\xe8me et attribu\xe9e \xe0 un utilisateur"}),"\n",(0,r.jsx)(s.p,{children:"Cela se produit lorsque de nouvelles permissions sont introduites dans votre syst\xe8me. Dans ce cas, vous devrez d'abord inclure les nouvelles port\xe9es de permission introduites lors de l'initialisation du client Logto. Par exemple :"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-tsx",children:"new LogtoClient({\n  appId: 'your-app-id',\n  redirectUrl: 'your-redirect-url',\n  resources: ['your-api-resource'],\n  scopes: [\n    // ... vos port\xe9es de permission existantes,\n    'new-scope',\n  ],\n});\n"})}),"\n",(0,r.jsx)(s.p,{children:"Deuxi\xe8mement, chacune de vos applications clientes doit re-consentir ou reconnecter les utilisateurs afin de recevoir le changement de permission. Ensuite, la nouvelle port\xe9e de permission sera refl\xe9t\xe9e dans les nouveaux jetons d\u2019acc\xe8s."}),"\n",(0,r.jsx)(s.p,{children:"Exemple de code pour re-consentir :"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-tsx",children:"signIn({ redirectUrl: 'your-redirect-url', prompt: 'consent' });\n"})}),"\n",(0,r.jsx)(s.h2,{id:"related-resources",children:"Ressources connexes"}),"\n",(0,r.jsx)(n,{href:"https://blog.logto.io/logto-x-cloudflare-workers",children:(0,r.jsx)(s.p,{children:"Logto x Cloudflare Workers : Comment s\xe9curiser vos workers contre l'acc\xe8s public ?"})}),"\n",(0,r.jsx)(n,{href:"https://blog.logto.io/secure-api-for-machine-to-machine",children:(0,r.jsx)(s.p,{children:"S\xe9curisez vos ressources API pour la communication machine \xe0 machine"})})]})}function d(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},79621:(e,s,n)=>{n.d(s,{R:()=>i,x:()=>a});var t=n(58101);const r={},o=t.createContext(r);function i(e){const s=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(o.Provider,{value:s},e.children)}}}]);