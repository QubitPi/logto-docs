"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[17902],{66233:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>d,contentTitle:()=>a,default:()=>l,frontMatter:()=>s,metadata:()=>n,toc:()=>u});const n=JSON.parse('{"id":"authorization/api-resources/python","title":"Guide : Python","description":"\xc9tape 1 : Extraire le Jeton d\u2019autorisation du header de la requ\xeate \\\\","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/authorization/api-resources/python.mdx","sourceDirName":"authorization/api-resources","slug":"/authorization/api-resources/python","permalink":"/fr/authorization/api-resources/python","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/fr/docusaurus-plugin-content-docs/current/authorization/api-resources/python.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Prot\xe9gez votre API","permalink":"/fr/authorization/api-resources/protect-your-api"},"next":{"title":"Guide : Node (Express)","permalink":"/fr/authorization/api-resources/node-express"}}');var r=o(25105),i=o(79621);const s={sidebar_position:2},a="Guide : Python",d={},u=[{value:"\xc9tape 1 : Extraire le Jeton d\u2019autorisation du header de la requ\xeate",id:"step-1-extract-the-bearer-token-from-request-header",level:2},{value:"\xc9tape 2 : Validation du jeton",id:"step-2-token-validation",level:2},{value:"Installer <code>python-jose</code> comme d\xe9pendance",id:"install-python-jose-as-your-dependency",level:3},{value:"R\xe9cup\xe9rer les configurations OIDC de Logto",id:"retrieve-logtos-oidc-configurations",level:3},{value:"Cr\xe9er le d\xe9corateur de validation d&#39;autorisation",id:"create-the-authorization-validation-decorator",level:3},{value:"Appliquer le d\xe9corateur \xe0 votre API",id:"apply-decorator-to-your-api",level:2}];function c(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"guide--python",children:"Guide : Python"})}),"\n",(0,r.jsx)(t.h2,{id:"step-1-extract-the-bearer-token-from-request-header",children:"\xc9tape 1 : Extraire le Jeton d\u2019autorisation du header de la requ\xeate"}),"\n",(0,r.jsxs)(t.p,{children:["Une requ\xeate autoris\xe9e doit contenir un header ",(0,r.jsx)(t.code,{children:"Authorization"})," avec ",(0,r.jsx)(t.code,{children:"Bearer <access_token>"})," comme contenu. Extraire le Jeton d\u2019autorisation du header de la requ\xeate :"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:"\"\"\"requires-auth.py\n\"\"\"\ndef get_auth_token():\n  auth = request.headers.get(\"Authorization\", None)\n\n  if not auth:\n    raise Error({ code: 'auth.authorization_header_missing', status: 401 })\n\n  contents = auth.split()\n\n  if len(contents) < 2\n    raise Error({code: 'auth.authorization_token_invalid_format', status: 401})\n\n  elif contents[0] != 'Bearer'\n    raise Error({code: 'auth.authorization_token_type_not_supported', status: 401})\n\n  return contents[1]\n"})}),"\n",(0,r.jsx)(t.h2,{id:"step-2-token-validation",children:"\xc9tape 2 : Validation du jeton"}),"\n",(0,r.jsxs)(t.p,{children:["Pour la d\xe9monstration, nous utilisons l'application Flask et le package ",(0,r.jsx)(t.a,{href:"https://github.com/mpdavis/python-jose",children:"jose"})," pour cr\xe9er le d\xe9corateur require_auth afin de valider la signature du jeton, son statut d'expiration et les revendications requises."]}),"\n",(0,r.jsxs)(t.h3,{id:"install-python-jose-as-your-dependency",children:["Installer ",(0,r.jsx)(t.code,{children:"python-jose"})," comme d\xe9pendance"]}),"\n",(0,r.jsxs)(t.p,{children:["Choisissez la cryptographie que vous utilisez dans Logto. (",(0,r.jsx)(t.code,{children:"ecdsa"})," par d\xe9faut)"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"pip install python-jose[ecdsa]\n\n"})}),"\n",(0,r.jsx)(t.h3,{id:"retrieve-logtos-oidc-configurations",children:"R\xe9cup\xe9rer les configurations OIDC de Logto"}),"\n",(0,r.jsxs)(t.p,{children:["Vous aurez besoin d'un ensemble de cl\xe9s publiques JWK et de l'\xe9metteur du jeton pour v\xe9rifier la signature et la source du jeton JWS re\xe7u. Toutes les derni\xe8res configurations d'Autorisation Logto peuvent \xeatre trouv\xe9es \xe0 ",(0,r.jsx)(t.code,{children:"https://<your-logto-domain>/oidc/.well-known/openid-configuration"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["par exemple, appelez ",(0,r.jsx)(t.code,{children:"https://tenant-id.logto.app/oidc/.well-known/openid-configuration"}),". Et localisez les deux champs suivants dans le corps de la r\xe9ponse :"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",children:'{\n  "jwks_uri": "https://tenant-id.logto.app/oidc/jwks",\n  "issuer": "https://tenant-id.logto.app/oidc"\n}\n'})}),"\n",(0,r.jsx)(t.h3,{id:"create-the-authorization-validation-decorator",children:"Cr\xe9er le d\xe9corateur de validation d'autorisation"}),"\n",(0,r.jsx)(t.admonition,{type:"warning",children:(0,r.jsxs)(t.p,{children:["Si vous utilisez le ",(0,r.jsx)(t.a,{href:"/authorization/role-based-access-control/protect-api-resources-with-rbac",children:"contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les"}),", la validation de la port\xe9e est \xe9galement requise."]})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:"\"\"\"requires-auth.py\n\"\"\"\n\nimport json\nfrom flask import request,  _request_ctx_stack\nfrom six.moves.urllib.request import urlopen\nfrom functools import wraps\nfrom jose import jwt\n\ndef requires_auth(f):\n  @wraps(f)\n  def decorated(*args, **kwargs):\n    token = get_token_auth_header()\n\n# jwks_uri endpoint retrieved from Logto\n    jwks_uri = urlopen('https://<your-logto-domain>/oidc/jwks')\n\n# issuer retrieved from Logto\n    issuer = 'https://<your-logto-domain>/oidc'\n\n    jwks = json.loads(jwks_uri.read())\n\n    try:\n      payload = jwt.decode(\n        token,\n        jwks,\n# The jwt encode algorithm retrieved along with jwks. ES384 by default\n        algorithms=jwt.get_unverified_header(token).get('alg'),\n# The API's registered resource indicator in Logto\n        audience='<your request listener resource indicator>',\n        issuer=issuer,\n        options={\n          'verify_at_hash': False\n        }\n      )\n    except Exception:\n# exception handler\n      raise Error({code: 'invalid_token', status: 401})\n\n# Custom code to process payload\n    _request_ctx_stack.top.user_id = payload.get('sub')\n\n    return f(*args, **kwargs)\n  return decorated\n"})}),"\n",(0,r.jsx)(t.h2,{id:"apply-decorator-to-your-api",children:"Appliquer le d\xe9corateur \xe0 votre API"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:'from flask import Flask\nfrom flask_cors import cross_origin\n\nAPP = Flask(__name__)\n\n@APP.route("/user/info")\n@cross_origin(headers=["Content-Type", "Authorization"])\n@requires_auth\ndef api:\n# Your API Logic\n'})})]})}function l(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},79621:(e,t,o)=>{o.d(t,{R:()=>s,x:()=>a});var n=o(58101);const r={},i=n.createContext(r);function s(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);