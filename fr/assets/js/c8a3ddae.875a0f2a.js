"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[21012],{56037:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"integrate-logto/protected-app","title":"Application prot\xe9g\xe9e","description":"L\'Application prot\xe9g\xe9e est con\xe7ue pour \xe9liminer la complexit\xe9 des int\xe9grations SDK en s\xe9parant la couche d\'authentification de votre application. Nous g\xe9rons l\'authentification, vous permettant de vous concentrer sur votre fonctionnalit\xe9 principale. Une fois qu\'un utilisateur est authentifi\xe9, l\'Application prot\xe9g\xe9e sert le contenu de votre serveur.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/integrate-logto/protected-app.mdx","sourceDirName":"integrate-logto","slug":"/integrate-logto/protected-app","permalink":"/fr/integrate-logto/protected-app","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/fr/docusaurus-plugin-content-docs/current/integrate-logto/protected-app.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Comprendre le flux d\'authentification","permalink":"/fr/integrate-logto/integrate-logto-into-your-application/understand-authentication-flow"},"next":{"title":"Applications tierces","permalink":"/fr/integrate-logto/third-party-applications/"}}');var o=n(25105),r=n(79621);const s={sidebar_position:2},a="Application prot\xe9g\xe9e",l={},c=[{value:"Comment fonctionne l&#39;Application prot\xe9g\xe9e",id:"how-protected-app-works",level:2},{value:"Prot\xe9ger votre serveur d&#39;origine",id:"protect-your-origin-server",level:2},{value:"Validation des en-t\xeates HTTP",id:"http-header-validation",level:3},{value:"Validation des JSON Web Tokens (JWT)",id:"json-web-tokens-jwt-validation",level:3},{value:"Obtenir l&#39;\xe9tat d&#39;authentification et les informations de l&#39;utilisateur",id:"get-authentication-state-and-user-information",level:2},{value:"Obtenir l&#39;h\xf4te d&#39;origine",id:"get-the-original-host",level:2},{value:"Personnaliser les r\xe8gles d&#39;authentification",id:"customize-authentication-rules",level:2},{value:"D\xe9veloppement local",id:"local-development",level:2},{value:"Transition vers l&#39;int\xe9gration SDK",id:"transition-to-sdk-integration",level:2},{value:"Ressources connexes",id:"related-resources",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components},{Url:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"application-prot\xe9g\xe9e",children:"Application prot\xe9g\xe9e"})}),"\n",(0,o.jsxs)(t.p,{children:["L'Application prot\xe9g\xe9e est con\xe7ue pour \xe9liminer la complexit\xe9 des ",(0,o.jsx)(t.a,{href:"/quick-starts",children:"int\xe9grations SDK"})," en s\xe9parant la couche ",(0,o.jsx)(t.a,{href:"https://auth.wiki/authentication",children:"d'authentification"})," de votre application. Nous g\xe9rons l'authentification, vous permettant de vous concentrer sur votre fonctionnalit\xe9 principale. Une fois qu'un utilisateur est authentifi\xe9, l'Application prot\xe9g\xe9e sert le contenu de votre serveur."]}),"\n",(0,o.jsx)(t.h2,{id:"how-protected-app-works",children:"Comment fonctionne l'Application prot\xe9g\xe9e"}),"\n",(0,o.jsx)(t.p,{children:"L'Application prot\xe9g\xe9e, propuls\xe9e par Cloudflare, fonctionne globalement sur des r\xe9seaux de p\xe9riph\xe9rie, garantissant une faible latence et une haute disponibilit\xe9 pour votre application."}),"\n",(0,o.jsx)(t.p,{children:"L'Application prot\xe9g\xe9e maintient l'\xe9tat de la session et les informations de l'utilisateur. Si un utilisateur n'est pas authentifi\xe9, l'Application prot\xe9g\xe9e le redirige vers la page de connexion. Une fois authentifi\xe9, l'Application prot\xe9g\xe9e enveloppe la requ\xeate de l'utilisateur avec l'authentification et les informations de l'utilisateur, puis la transmet au serveur d'origine."}),"\n",(0,o.jsx)(t.p,{children:"Ce processus est visualis\xe9 dans le diagramme de flux suivant :"}),"\n",(0,o.jsx)(t.mermaid,{value:'graph LR\n  A("Client<br/>(Navigateur)") --\x3e|Requ\xeate| B(Logto<br/>Application prot\xe9g\xe9e)\n  B --\x3e Condition{{Route<br/>correspondante ?}}\n  Condition --\x3e|Oui| Matched{{Est authentifi\xe9 ?}}\n  Matched --\x3e|Oui| C(Serveur d\'origine)\n  Matched --\x3e|Non| D(Connexion Logto)\n  Condition --\x3e|Non| C'}),"\n",(0,o.jsx)(t.h2,{id:"protect-your-origin-server",children:"Prot\xe9ger votre serveur d'origine"}),"\n",(0,o.jsx)(t.p,{children:"Le serveur d'origine, qui peut \xeatre un dispositif physique ou virtuel non poss\xe9d\xe9 par l'Application prot\xe9g\xe9e de Logto, est l'endroit o\xf9 r\xe9side le contenu de votre application. Semblable \xe0 un serveur de r\xe9seau de diffusion de contenu (CDN), l'Application prot\xe9g\xe9e g\xe8re les processus d'authentification et r\xe9cup\xe8re le contenu de votre serveur d'origine. Par cons\xe9quent, si les utilisateurs acc\xe8dent directement \xe0 votre serveur d'origine, ils peuvent contourner l'authentification et votre application n'est plus prot\xe9g\xe9e."}),"\n",(0,o.jsx)(t.p,{children:"Il est donc important de s\xe9curiser les connexions d'origine, cela emp\xeache les attaquants de d\xe9couvrir et d'acc\xe9der \xe0 votre serveur d'origine sans authentification. Il existe plusieurs fa\xe7ons de le faire :"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:"Validation des en-t\xeates HTTP"}),"\n",(0,o.jsx)(t.li,{children:"Validation des JSON Web Tokens (JWT)"}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"http-header-validation",children:"Validation des en-t\xeates HTTP"}),"\n",(0,o.jsxs)(t.p,{children:["S\xe9curiser votre serveur d'origine peut \xeatre r\xe9alis\xe9 en utilisant ",(0,o.jsx)(t.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Authentication#basic_authentication_scheme",children:"l'authentification de base HTTP"})," pour s\xe9curiser votre serveur d'origine."]}),"\n",(0,o.jsx)(t.p,{children:"Chaque requ\xeate de l'Application prot\xe9g\xe9e inclut l'en-t\xeate suivant :"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"Authorization: Basic base64(appId:appSecret)\n"})}),"\n",(0,o.jsx)(t.p,{children:"En validant cet en-t\xeate, vous pouvez confirmer que la requ\xeate provient de l'Application prot\xe9g\xe9e et refuser toute requ\xeate qui n'inclut pas cet en-t\xeate."}),"\n",(0,o.jsx)(t.p,{children:"Si vous utilisez Nginx ou Apache, vous pouvez vous r\xe9f\xe9rer aux guides suivants pour impl\xe9menter l'authentification de base HTTP sur votre serveur d'origine :"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["Nginx : ",(0,o.jsx)(t.a,{href:"https://docs.nginx.com/nginx/admin-guide/security-controls/configuring-http-basic-authentication/",children:"Configurer l'authentification de base HTTP"})]}),"\n",(0,o.jsxs)(t.li,{children:["Apache : ",(0,o.jsx)(t.a,{href:"https://httpd.apache.org/docs/2.4/howto/auth.html",children:"Authentification et autorisation"})]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["Pour v\xe9rifier les en-t\xeates dans votre application, consultez l'",(0,o.jsx)(t.a,{href:"https://developers.cloudflare.com/workers/examples/basic-auth/",children:"exemple d'authentification de base HTTP"})," fourni par Cloudflare pour apprendre \xe0 restreindre l'acc\xe8s en utilisant le sch\xe9ma d'authentification de base HTTP."]}),"\n",(0,o.jsx)(t.h3,{id:"json-web-tokens-jwt-validation",children:"Validation des JSON Web Tokens (JWT)"}),"\n",(0,o.jsx)(t.p,{children:"Une autre fa\xe7on de s\xe9curiser votre serveur d'origine est d'utiliser les JSON Web Tokens (JWT)."}),"\n",(0,o.jsx)(t.p,{children:"Chaque requ\xeate authentifi\xe9e de l'Application prot\xe9g\xe9e inclut l'en-t\xeate suivant :"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"Logto-ID-Token: <JWT>\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Le JWT est appel\xe9 ",(0,o.jsx)(t.a,{href:"https://auth.wiki/id-token",children:"Jeton d\u2019identifiant (ID Token)"})," qui est sign\xe9 par Logto et contient des informations sur l'utilisateur. En validant ce JWT, vous pouvez confirmer que la requ\xeate provient de l'Application prot\xe9g\xe9e et refuser toute requ\xeate qui n'inclut pas cet en-t\xeate."]}),"\n",(0,o.jsxs)(t.p,{children:["Le jeton est crypt\xe9 et sign\xe9 en tant que jeton ",(0,o.jsx)(t.a,{href:"https://auth.wiki/jws",children:"JWS"}),"."]}),"\n",(0,o.jsx)(t.p,{children:"Les \xe9tapes de validation :"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"https://datatracker.ietf.org/doc/html/rfc7519#section-7.2",children:"Validation d'un JWT"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"https://datatracker.ietf.org/doc/html/rfc7515#section-5.2",children:"Validation de la signature JWS"})}),"\n",(0,o.jsxs)(t.li,{children:["L'\xe9metteur du jeton est ",(0,o.jsx)(t.code,{children:"https://<your-logto-domain>/oidc"})," (\xe9mis par votre serveur d'authentification Logto)"]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-js",children:"const express = require('express');\nconst jwksClient = require('jwks-rsa');\nconst jwt = require('jsonwebtoken');\n\nconst ISSUER = 'https://<your-logto-domain>/oidc';\nconst CERTS_URL = 'https://<your-logto-domain>/oidc/jwks';\n\nconst client = jwksClient({\n  jwksUri: CERTS_URL,\n});\n\nconst getKey = (header, callback) => {\n  client.getSigningKey(header.kid, function (err, key) {\n    callback(err, key?.getPublicKey());\n  });\n};\n\nconst verifyToken = (req, res, next) => {\n  const token = req.headers['Logto-ID-Token'];\n\n  // Assurez-vous que la requ\xeate entrante a notre en-t\xeate de jeton\n  if (!token) {\n    return res\n      .status(403)\n      .send({ status: false, message: 'en-t\xeate Logto-ID-Token requis manquant' });\n  }\n\n  jwt.verify(token, getKey, { issuer: ISSUER }, (err, decoded) => {\n    if (err) {\n      return res.status(403).send({ status: false, message: 'jeton d\u2019identifiant invalide' });\n    }\n\n    req.user = decoded;\n    next();\n  });\n};\n\nconst app = express();\n\napp.use(verifyToken);\n\napp.get('/', (req, res) => {\n  res.send('Bonjour le monde !');\n});\n\napp.listen(3000);\n"})}),"\n",(0,o.jsx)(t.h2,{id:"get-authentication-state-and-user-information",children:"Obtenir l'\xe9tat d'authentification et les informations de l'utilisateur"}),"\n",(0,o.jsxs)(t.p,{children:["Si vous avez besoin d'obtenir l'authentification et les informations de l'utilisateur pour votre application, vous pouvez \xe9galement utiliser l'en-t\xeate ",(0,o.jsx)(t.code,{children:"Logto-ID-Token"}),"."]}),"\n",(0,o.jsx)(t.p,{children:"Si vous souhaitez uniquement d\xe9coder le jeton, vous pouvez utiliser le code suivant :"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-js",children:"const express = require('express');\n\nconst decodeIdToken = (req, res, next) => {\n  const token = req.headers['Logto-ID-Token'];\n\n  if (!token) {\n    return res.status(403).send({\n      status: false,\n      message: 'en-t\xeate Logto-ID-Token requis manquant',\n    });\n  }\n\n  const parts = token.split('.');\n  if (parts.length !== 3) {\n    throw new Error('Jeton d\u2019identifiant invalide');\n  }\n\n  const payload = parts[1];\n  const decodedPayload = atob(payload.replace(/-/g, '+').replace(/_/g, '/'));\n  const claims = JSON.parse(decodedPayload);\n\n  req.user = claims;\n  next();\n};\n\nconst app = express();\n\napp.use(decodeIdToken);\n\napp.get('/', (req, res) => {\n  res.json(req.user);\n});\n\napp.listen(3000);\n"})}),"\n",(0,o.jsx)(t.h2,{id:"get-the-original-host",children:"Obtenir l'h\xf4te d'origine"}),"\n",(0,o.jsxs)(t.p,{children:["Si vous avez besoin d'obtenir l'h\xf4te d'origine demand\xe9 par le client, vous pouvez utiliser l'en-t\xeate ",(0,o.jsx)(t.code,{children:"Logto-Host"})," ou ",(0,o.jsx)(t.code,{children:"x-forwarded-host"}),"."]}),"\n",(0,o.jsx)(t.h2,{id:"customize-authentication-rules",children:"Personnaliser les r\xe8gles d'authentification"}),"\n",(0,o.jsx)(t.p,{children:"Par d\xe9faut, l'Application prot\xe9g\xe9e prot\xe9gera toutes les routes. Si vous avez besoin de personnaliser les r\xe8gles d'authentification, vous pouvez d\xe9finir le champ \"R\xe8gles d'authentification personnalis\xe9es\" dans la Console."}),"\n",(0,o.jsx)(t.p,{children:"Il prend en charge les expressions r\xe9guli\xe8res, voici deux sc\xe9narios de cas :"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["Pour ne prot\xe9ger que les routes ",(0,o.jsx)(t.code,{children:"/admin"})," et ",(0,o.jsx)(t.code,{children:"/privacy"})," avec authentification : ",(0,o.jsx)(t.code,{children:"^/(admin|privacy)/.*"})]}),"\n",(0,o.jsxs)(t.li,{children:["Pour exclure les images JPG de l'authentification : ",(0,o.jsx)(t.code,{children:"^(?!.*\\.jpg$).*$"})]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"local-development",children:"D\xe9veloppement local"}),"\n",(0,o.jsxs)(t.p,{children:["L'Application prot\xe9g\xe9e est con\xe7ue pour fonctionner avec votre serveur d'origine. Cependant, si votre serveur d'origine n'est pas accessible publiquement, vous pouvez utiliser un outil comme ",(0,o.jsx)(t.a,{href:"https://ngrok.com/",children:"ngrok"})," ou ",(0,o.jsx)(t.a,{href:"https://developers.cloudflare.com/pages/how-to/preview-with-cloudflare-tunnel/",children:"Cloudflare Tunnels"})," pour exposer votre serveur local \xe0 Internet."]}),"\n",(0,o.jsx)(t.h2,{id:"transition-to-sdk-integration",children:"Transition vers l'int\xe9gration SDK"}),"\n",(0,o.jsxs)(t.p,{children:["L'Application prot\xe9g\xe9e est con\xe7ue pour simplifier le processus d'authentification. Cependant, si vous d\xe9cidez de passer \xe0 l'int\xe9gration SDK pour un meilleur contr\xf4le et une personnalisation, vous pouvez ",(0,o.jsx)(t.a,{href:"/integrate-logto/integrate-logto-into-your-application",children:"cr\xe9er une nouvelle application"})," dans Logto et configurer l'",(0,o.jsx)(t.a,{href:"/quick-starts",children:"int\xe9gration SDK"}),". Et pour une transition en douceur, vous pouvez r\xe9utiliser les configurations d'application de l'Application prot\xe9g\xe9e. L'Application prot\xe9g\xe9e est en fait une \"Application Web traditionnelle\" dans Logto, vous pouvez trouver l'",(0,o.jsx)(t.a,{href:"/integrate-logto/application-data-structure#application-id",children:'"AppId'}),"\" et l'",(0,o.jsx)(t.a,{href:"/integrate-logto/application-data-structure#application-secret",children:'"AppSecret'}),"\" dans les param\xe8tres de l'application. Une fois la transition termin\xe9e, vous pouvez supprimer l'Application prot\xe9g\xe9e de votre application."]}),"\n",(0,o.jsx)(t.h2,{id:"related-resources",children:"Ressources connexes"}),"\n",(0,o.jsx)(n,{href:"https://www.youtube.com/watch?v=ZBrXW3iZyKY",children:(0,o.jsx)(t.p,{children:"Application prot\xe9g\xe9e : Construisez l'authentification de votre application en quelques clics.\nAucun code requis."})}),"\n",(0,o.jsx)(n,{href:"https://blog.logto.io/protected-app",children:"La motivation derri\xe8re l'Application prot\xe9g\xe9e"}),"\n",(0,o.jsx)(n,{href:"https://blog.logto.io/fastest-way-to-build-auth-system",children:(0,o.jsx)(t.p,{children:"La fa\xe7on la plus rapide de construire un syst\xe8me d'authentification"})})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},79621:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>a});var i=n(58101);const o={},r=i.createContext(o);function s(e){const t=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(r.Provider,{value:t},e.children)}}}]);