"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[3329],{25429:(e,n,i)=>{i.d(n,{Ay:()=>a,RM:()=>r});var s=i(25105),o=i(79621);const r=[];function t(e){const n={admonition:"admonition",code:"code",p:"p",...(0,o.R)(),...e.components};return(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["Inspectez la revendication ",(0,s.jsx)(n.code,{children:"organizations"})," dans le jeton d\u2019identifiant (ID token) pour obtenir une liste des identifiants d\u2019organisation auxquels l\u2019utilisateur appartient. Cette revendication r\xe9pertorie toutes les organisations dont l\u2019utilisateur est membre, ce qui facilite l\u2019\xe9num\xe9ration ou le changement d\u2019organisation dans votre application."]})})}function a(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},32930:(e,n,i)=>{i.d(n,{Ay:()=>a,RM:()=>r});var s=i(25105),o=i(79621);const r=[];function t(e){const n={admonition:"admonition",p:"p",...(0,o.R)(),...e.components};return(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsx)(n.p,{children:"Pour le moment, Logto ne prend pas en charge la r\xe9cup\xe9ration directe des jetons d\u2019organisation (Organization tokens) \xe0 partir du flux de code d\u2019autorisation. Vous devrez utiliser le flux de jeton de rafra\xeechissement (Refresh token) pour obtenir un jeton d\u2019organisation (Organization token)."})})}function a(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},88220:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>x,contentTitle:()=>m,default:()=>b,frontMatter:()=>g,metadata:()=>s,resource:()=>j,toc:()=>v});const s=JSON.parse('{"id":"authorization/organization-level-api-resources","title":"Prot\xe9ger les ressources API au niveau de l\u2019organisation","description":"Combinez les ressources API avec le mod\xe8le d\u2019organisation pour restreindre l\u2019acc\xe8s aux API et aux donn\xe9es au sein de chaque organisation, garantissant ainsi une isolation au niveau du locataire dans votre SaaS.","source":"@site/i18n/fr/docusaurus-plugin-content-docs/current/authorization/organization-level-api-resources.mdx","sourceDirName":"authorization","slug":"/authorization/organization-level-api-resources","permalink":"/fr/authorization/organization-level-api-resources","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/fr/docusaurus-plugin-content-docs/current/authorization/organization-level-api-resources.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"docsSidebar","previous":{"title":"Prot\xe9ger les permissions d\u2019organisation (hors API)","permalink":"/fr/authorization/organization-permissions"},"next":{"title":"Valider les jetons d\u2019acc\xe8s dans l\u2019API","permalink":"/fr/authorization/validate-access-tokens/"}}');var o=i(25105),r=i(79621),t=i(1242),a=i(39088),l=i(78506),c=i(42372),d=i(38552),u=i(22002),p=i(25429),h=i(32930);const g={sidebar_position:5},m="Prot\xe9ger les ressources API au niveau de l\u2019organisation",x={},j="https://api.your-app.com/organizations",v=[{value:"Que sont les ressources API au niveau de l\u2019organisation ?",id:"what-are-organization-level-api-resources",level:2},{value:"Fonctionnement dans Logto",id:"how-it-works-in-logto",level:2},{value:"Vue d\u2019ensemble de la mise en \u0153uvre",id:"implementation-overview",level:3},{value:"Comment Logto applique le RBAC d\u2019organisation",id:"how-logto-applies-organization-rbac",level:3},{value:"Flux d\u2019autorisation : authentifier et s\xe9curiser les API avec le contexte organisationnel",id:"authorization-flow-authenticating-and-securing-apis-with-organization-context",level:3},{value:"\xc9tapes de mise en \u0153uvre",id:"implementation-steps",level:2},{value:"Enregistrez votre ressource API",id:"register-your-api-resource",level:3},{value:"Configurez les r\xf4les d\u2019organisation",id:"set-up-organization-roles",level:3},{value:"Obtenez des jetons d\u2019organisation pour les ressources API",id:"obtain-organization-tokens-for-api-resources",level:3},{value:"Flux de jeton de rafra\xeechissement",id:"refresh-token-flow",level:4},...p.RM,...h.RM,...p.RM,{value:"Flux client credentials",id:"client-credentials-flow",level:4},{value:"Validez les jetons d\u2019organisation",id:"validate-organization-tokens",level:3},{value:"Bonnes pratiques et conseils de s\xe9curit\xe9",id:"best-practices-and-security-tips",level:2},{value:"FAQ",id:"faqs",level:2},{value:"Que se passe-t-il si je n\u2019inclus pas <code>organization_id</code> dans ma requ\xeate de jeton ?",id:"what-if-i-don-t-include-organization-id-in-my-token-request",level:3},{value:"Puis-je m\xe9langer des permissions d\u2019organisation et non-organisation dans un m\xeame r\xf4le ?",id:"can-i-mix-organization-and-non-organization-permissions-in-a-single-role",level:3},{value:"Pour aller plus loin",id:"further-reading",level:2}];function f(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{CloudLink:i,Details:s,Url:g}=n;return i||z("CloudLink",!0),s||z("Details",!0),g||z("Url",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"prot\xe9ger-les-ressources-api-au-niveau-de-lorganisation",children:"Prot\xe9ger les ressources API au niveau de l\u2019organisation"})}),"\n","\n",(0,o.jsx)(n.p,{children:"Combinez les ressources API avec le mod\xe8le d\u2019organisation pour restreindre l\u2019acc\xe8s aux API et aux donn\xe9es au sein de chaque organisation, garantissant ainsi une isolation au niveau du locataire dans votre SaaS."}),"\n",(0,o.jsx)(n.h2,{id:"what-are-organization-level-api-resources",children:"Que sont les ressources API au niveau de l\u2019organisation ?"}),"\n",(0,o.jsxs)(n.p,{children:["Les ressources API au niveau de l\u2019organisation sont des points de terminaison ou des services dans votre application qui sont ",(0,o.jsx)(n.strong,{children:"limit\xe9s \xe0 une organisation sp\xe9cifique"}),". Ces API appliquent l\u2019autorisation et l\u2019acc\xe8s en fonction du contexte organisationnel, garantissant que les utilisateurs ou clients n\u2019acc\xe8dent qu\u2019aux donn\xe9es et actions pertinentes pour leur organisation."]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Exemples d\u2019utilisation"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["API pour g\xe9rer les membres, r\xf4les ou param\xe8tres d\u2019une organisation (par exemple, ",(0,o.jsx)(n.code,{children:"/organizations/{organizationId}/members"}),")"]}),"\n",(0,o.jsx)(n.li,{children:"Tableaux de bord, analyses ou rapports limit\xe9s \xe0 l\u2019organisation"}),"\n",(0,o.jsx)(n.li,{children:"Points de terminaison de facturation, d\u2019abonnement ou d\u2019audit li\xe9s \xe0 une organisation"}),"\n",(0,o.jsx)(n.li,{children:"Toute API o\xf9 les actions et les donn\xe9es sont isol\xe9es par locataire"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Logto vous permet de s\xe9curiser ces API d\u2019organisation en utilisant OAuth 2.1 et le contr\xf4le d\u2019acc\xe8s bas\xe9 sur les r\xf4les (RBAC), tout en prenant en charge les architectures SaaS multi-locataires."}),"\n",(0,o.jsxs)(n.p,{children:["Ces permissions sont g\xe9r\xe9es via les ",(0,o.jsx)(n.strong,{children:"r\xf4les d\u2019organisation"})," d\xe9finis dans le ",(0,o.jsx)(n.a,{href:"/authorization/organization-template",children:"mod\xe8le d\u2019organisation"}),". Chaque organisation utilise le m\xeame mod\xe8le, garantissant un mod\xe8le de permission coh\xe9rent pour toutes les organisations."]}),"\n",(0,o.jsx)(n.h2,{id:"how-it-works-in-logto",children:"Fonctionnement dans Logto"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Les ressources API et les permissions sont enregistr\xe9es globalement :"})," Chaque ressource API est d\xe9finie avec un indicateur de ressource unique (URI) et un ensemble de permissions (port\xe9es) dans Logto."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"R\xf4les au niveau de l\u2019organisation :"})," Les r\xf4les d\u2019organisation sont d\xe9finis dans le mod\xe8le d\u2019organisation. Les permissions (port\xe9es) des ressources API sont attribu\xe9es aux r\xf4les d\u2019organisation, qui sont ensuite attribu\xe9s aux utilisateurs ou clients ",(0,o.jsx)(n.strong,{children:"au sein de chaque organisation"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Autorisation contextuelle :"})," Lorsqu\u2019un client demande un jeton d\u2019acc\xe8s avec \xe0 la fois une ressource API et un ",(0,o.jsx)(n.code,{children:"organization_id"}),", Logto \xe9met un jeton qui inclut \xe0 la fois le contexte organisationnel et l\u2019audience API. Les permissions (port\xe9es) du jeton sont d\xe9termin\xe9es par les r\xf4les d\u2019organisation de l\u2019utilisateur pour l\u2019organisation sp\xe9cifi\xe9e."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"S\xe9paration des ressources globales :"})," Les ressources API peuvent \xeatre accessibles avec ou sans contexte organisationnel. Le RBAC d\u2019organisation n\u2019est appliqu\xe9 que si un ",(0,o.jsx)(n.code,{children:"organization_id"})," est inclus dans la requ\xeate. Pour les API partag\xe9es entre tous les utilisateurs, voir ",(0,o.jsx)(n.a,{href:"/authorization/global-api-resources",children:"Prot\xe9ger les ressources API globales"}),"."]}),"\n"]}),"\n",(0,o.jsx)("img",{src:t.A,alt:"Ressources API au niveau de l\u2019organisation RBAC",style:{maxWidth:"100%"}}),"\n",(0,o.jsx)(n.h3,{id:"implementation-overview",children:"Vue d\u2019ensemble de la mise en \u0153uvre"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Enregistrez votre ressource API"})," et d\xe9finissez ses permissions (port\xe9es) dans Logto."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"D\xe9finissez les r\xf4les d\u2019organisation"})," dans le mod\xe8le d\u2019organisation et attribuez les permissions API pertinentes."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Attribuez des r\xf4les"})," aux utilisateurs ou clients au sein de chaque organisation."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Demandez un jeton d\u2019acc\xe8s"})," pour l\u2019API avec un ",(0,o.jsx)(n.code,{children:"organization_id"})," pour inclure le contexte organisationnel."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Validez les jetons d\u2019acc\xe8s"})," dans votre API, en appliquant \xe0 la fois le contexte organisationnel et les permissions."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"how-logto-applies-organization-rbac",children:"Comment Logto applique le RBAC d\u2019organisation"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Si vous demandez un jeton d\u2019acc\xe8s ",(0,o.jsx)(n.strong,{children:"sans"})," ",(0,o.jsx)(n.code,{children:"organization_id"}),", seuls les r\xf4les / permissions globaux sont pris en compte."]}),"\n",(0,o.jsxs)(n.li,{children:["Si vous demandez un jeton d\u2019acc\xe8s ",(0,o.jsx)(n.strong,{children:"avec"})," un ",(0,o.jsx)(n.code,{children:"organization_id"}),", Logto \xe9value les r\xf4les d\u2019organisation de l\u2019utilisateur et leurs permissions associ\xe9es pour cette organisation."]}),"\n",(0,o.jsxs)(n.li,{children:["Le JWT r\xe9sultant contiendra \xe0 la fois l\u2019audience API (",(0,o.jsx)(n.code,{children:"aud"})," revendication) et le contexte organisationnel (",(0,o.jsx)(n.code,{children:"organization_id"})," revendication), avec des port\xe9es filtr\xe9es selon celles accord\xe9es par les r\xf4les d\u2019organisation de l\u2019utilisateur."]}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"authorization-flow-authenticating-and-securing-apis-with-organization-context",children:"Flux d\u2019autorisation : authentifier et s\xe9curiser les API avec le contexte organisationnel"}),"\n",(0,o.jsx)(n.p,{children:"Le flux suivant montre comment un client (web, mobile ou backend) obtient et utilise des jetons d\u2019organisation pour acc\xe9der aux ressources API au niveau de l\u2019organisation."}),"\n",(0,o.jsx)(n.p,{children:"Veuillez noter que ce flux ne d\xe9taille pas tous les param\xe8tres ou en-t\xeates requis, mais se concentre sur les \xe9tapes cl\xe9s. Continuez \xe0 lire pour voir comment le flux fonctionne en pratique."}),"\n",(0,o.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Client\n    participant Logto\n    participant API as Ressource API\n\n    alt Authentification utilisateur\n        Client->>Logto: GET /oidc/auth\n        Logto->>Logto: Redirige l\u2019utilisateur vers la page de connexion\n        Logto->>Client: Redirige avec `authorization_code`\n        Client->>Logto: POST /oidc/token avec `grant_type=authorization_code`\n        Logto->>Client: Retourne le jeton de rafra\xeechissement\n        Client->>Logto: POST /oidc/token avec `grant_type=refresh_token`<br/>+ resource + organization_id\n    else Authentification client machine \xe0 machine (M2M)\n        Client->>Logto: POST /oidc/token avec `grant_type=client_credentials`<br/>+ resource + organization_id\n    end\n\n    Logto->>Client: Retourne le jeton d\u2019acc\xe8s (JWT)\n    Client->>API: Requ\xeate avec jeton Bearer\n    API->>API: Valide le jeton, v\xe9rifie le contexte organisationnel et les permissions\n\n    alt Jeton valide\n      API->>Client: Retourne les donn\xe9es de l\u2019organisation\n    else Jeton invalide\n      API->>Client: 401 Non autoris\xe9\n    end"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"Authentification utilisateur = navigateur / application. M2M = service backend ou script utilisant les identifiants client + contexte organisationnel."})}),"\n",(0,o.jsx)(n.h2,{id:"implementation-steps",children:"\xc9tapes de mise en \u0153uvre"}),"\n",(0,o.jsx)(n.h3,{id:"register-your-api-resource",children:"Enregistrez votre ressource API"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Allez dans ",(0,o.jsx)(i,{to:"/api-resources",children:"Console \u2192 Ressources API"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Cr\xe9ez une nouvelle ressource API (par exemple, ",(0,o.jsx)(n.code,{children:"https://api.yourapp.com/org"}),") et d\xe9finissez ses permissions (port\xe9es)."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Pour les \xe9tapes compl\xe8tes de configuration, voir ",(0,o.jsx)(n.a,{href:"/authorization/role-based-access-control#define-api-resources-with-permissions",children:"D\xe9finir des ressources API avec des permissions"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"set-up-organization-roles",children:"Configurez les r\xf4les d\u2019organisation"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Allez dans ",(0,o.jsx)(i,{to:"/organization-template/organization-roles",children:"Console \u2192 Mod\xe8le d\u2019organisation \u2192 R\xf4les d\u2019organisation"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:["Cr\xe9ez des r\xf4les d\u2019organisation (par exemple, ",(0,o.jsx)(n.code,{children:"admin"}),", ",(0,o.jsx)(n.code,{children:"member"}),") et attribuez des permissions API \xe0 chaque r\xf4le."]}),"\n",(0,o.jsx)(n.li,{children:"Attribuez des r\xf4les aux utilisateurs ou clients au sein de chaque organisation. S\u2019ils ne sont pas encore membres, invitez-les ou ajoutez-les d\u2019abord."}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Pour les \xe9tapes compl\xe8tes de configuration, voir ",(0,o.jsx)(n.a,{href:"/authorization/role-based-access-control#configure-organization-roles",children:"Utiliser les r\xf4les d\u2019organisation"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"obtain-organization-tokens-for-api-resources",children:"Obtenez des jetons d\u2019organisation pour les ressources API"}),"\n",(0,o.jsxs)(n.p,{children:["Votre client / application doit demander un jeton avec \xe0 la fois ",(0,o.jsx)(n.code,{children:"resource"})," et ",(0,o.jsx)(n.code,{children:"organization_id"})," pour acc\xe9der aux API au niveau de l\u2019organisation. Logto \xe9met des jetons d\u2019organisation sous forme de ",(0,o.jsx)(n.a,{href:"https://auth.wiki/jwt",children:"JSON Web Tokens (JWTs)"}),". Vous pouvez les obtenir en utilisant soit le ",(0,o.jsx)(n.a,{href:"https://auth.wiki/refresh-token",children:"flux de jeton de rafra\xeechissement"}),", soit le ",(0,o.jsx)(n.a,{href:"https://auth.wiki/client-credentials-flow",children:"flux client credentials"}),"."]}),"\n",(0,o.jsx)(n.h4,{id:"refresh-token-flow",children:"Flux de jeton de rafra\xeechissement"}),"\n",(0,o.jsx)(n.p,{children:"Presque tous les SDK officiels Logto prennent en charge l\u2019obtention de jetons d\u2019organisation via le flux de jeton de rafra\xeechissement par d\xe9faut. Une biblioth\xe8que cliente OAuth 2.0 / OIDC standard peut \xe9galement \xeatre utilis\xe9e pour impl\xe9menter ce flux."}),"\n",(0,o.jsxs)(u.A,{groupId:"user-client",children:[(0,o.jsxs)(d.A,{value:"logto-sdk",label:"Logto SDK",children:[(0,o.jsxs)(n.p,{children:["Lors de l\u2019initialisation du SDK Logto, ajoutez ",(0,o.jsx)(n.code,{children:"urn:logto:scope:organizations"})," et les permissions d\u2019organisation souhait\xe9es (port\xe9es) au param\xe8tre ",(0,o.jsx)(n.code,{children:"scopes"}),"."]}),(0,o.jsxs)(n.p,{children:["Certains SDK Logto disposent d\u2019une port\xe9e pr\xe9d\xe9finie pour les organisations, telle que ",(0,o.jsx)(n.code,{children:"UserScope.Organizations"})," dans les SDK JavaScript."]}),(0,o.jsx)(p.Ay,{}),(0,o.jsxs)(n.p,{children:["Lors de l\u2019appel de ",(0,o.jsx)(n.code,{children:"getAccessToken()"}),", sp\xe9cifiez \xe0 la fois la ressource API (",(0,o.jsx)(n.code,{children:"resource"}),") et l\u2019ID de l\u2019organisation (",(0,o.jsx)(n.code,{children:"organizationId"}),") pour obtenir un jeton d\u2019organisation."]}),(0,o.jsxs)(n.p,{children:["Pour plus de d\xe9tails sur chaque SDK, voir ",(0,o.jsx)(n.a,{href:"/quick-starts",children:"D\xe9marrages rapides"}),"."]})]}),(0,o.jsxs)(d.A,{value:"oauth-client",label:"Biblioth\xe8que cliente OAuth 2.0 / OIDC",children:[(0,o.jsx)(n.p,{children:"Lors de la configuration de votre client OAuth 2.0 ou de l\u2019initialisation du flux d\u2019autorisation par code, assurez-vous d\u2019inclure les param\xe8tres suivants :"}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"resource"})," : D\xe9fini sur l\u2019identifiant de la ressource API enregistr\xe9e dans Logto (par exemple, ",(0,o.jsx)(n.code,{children:"https://api.your-app.com/organizations"}),")."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"scope"})," : Incluez la port\xe9e pr\xe9d\xe9finie d\u2019organisation (",(0,o.jsx)(n.code,{children:"urn:logto:scope:organizations"}),"), ",(0,o.jsx)(n.code,{children:"offline_access"})," (pour obtenir des jetons de rafra\xeechissement), et toutes les permissions API sp\xe9cifiques dont vous avez besoin (par exemple, ",(0,o.jsx)(n.code,{children:"manage:members view:analytics"}),")."]}),"\n"]}),(0,o.jsxs)(n.p,{children:["Certaines biblioth\xe8ques peuvent ne pas prendre en charge nativement le param\xe8tre ",(0,o.jsx)(n.code,{children:"resource"}),", mais permettent g\xe9n\xe9ralement de passer des param\xe8tres suppl\xe9mentaires dans la requ\xeate d\u2019autorisation. Consultez la documentation de votre biblioth\xe8que pour plus de d\xe9tails."]}),(0,o.jsx)(n.p,{children:"Voici un exemple non normatif de requ\xeate d\u2019autorisation :"}),(0,o.jsx)(a.A,{resource:j,scope:"urn:logto:scope:organizations invite:member manage:billing"}),(0,o.jsxs)(n.p,{children:["Une fois l\u2019utilisateur authentifi\xe9, vous recevrez un code d\u2019autorisation. Utilisez ce code en effectuant une requ\xeate POST vers le point de terminaison ",(0,o.jsx)(n.code,{children:"/oidc/token"})," de Logto."]}),(0,o.jsx)(n.p,{children:"Voici un exemple non normatif de requ\xeate de jeton :"}),(0,o.jsx)(c.A,{grantType:"authorization_code"}),(0,o.jsx)(h.Ay,{}),(0,o.jsx)(n.p,{children:"Vous recevrez un jeton de rafra\xeechissement qui pourra \xeatre utilis\xe9 pour obtenir des jetons d\u2019organisation."}),(0,o.jsx)(p.Ay,{}),(0,o.jsxs)(n.p,{children:["Enfin, utilisez le jeton de rafra\xeechissement pour obtenir un jeton d\u2019organisation en effectuant une requ\xeate POST vers le point de terminaison ",(0,o.jsx)(n.code,{children:"/oidc/token"})," de Logto. N\u2019oubliez pas d\u2019inclure :"]}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Le param\xe8tre ",(0,o.jsx)(n.code,{children:"resource"})," d\xe9fini sur l\u2019identifiant de la ressource API (par exemple, ",(0,o.jsx)(n.code,{children:"https://api.yourapp.com/org"}),")."]}),"\n",(0,o.jsxs)(n.li,{children:["Le param\xe8tre ",(0,o.jsx)(n.code,{children:"organization_id"})," d\xe9fini sur l\u2019ID de l\u2019organisation souhait\xe9e."]}),"\n",(0,o.jsxs)(n.li,{children:["(Optionnel) Le param\xe8tre ",(0,o.jsx)(n.code,{children:"scope"})," pour restreindre davantage les permissions dont vous avez besoin (par exemple, ",(0,o.jsx)(n.code,{children:"manage:members view:reports"}),")."]}),"\n"]}),(0,o.jsx)(n.p,{children:"Voici un exemple non normatif de requ\xeate de jeton :"}),(0,o.jsx)(c.A,{grantType:"refresh_token",resource:j,organizationId:"your-organization-id"})]})]}),"\n",(0,o.jsx)(n.h4,{id:"client-credentials-flow",children:"Flux client credentials"}),"\n",(0,o.jsxs)(n.p,{children:["Pour les sc\xe9narios machine \xe0 machine (M2M), vous pouvez utiliser le flux client credentials pour obtenir un jeton d\u2019acc\xe8s avec des permissions de ressource API au niveau de l\u2019organisation. En effectuant une requ\xeate POST vers le point de terminaison ",(0,o.jsx)(n.code,{children:"/oidc/token"})," de Logto avec les param\xe8tres d\u2019organisation, vous pouvez demander un jeton d\u2019organisation en utilisant votre client ID et secret."]}),"\n",(0,o.jsx)(n.p,{children:"Voici les param\xe8tres cl\xe9s \xe0 inclure dans la requ\xeate :"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"resource"})," : L\u2019identifiant de la ressource API (par exemple, ",(0,o.jsx)(n.code,{children:"https://api.yourapp.com/org"}),")."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"organization_id"})," : L\u2019ID de l\u2019organisation pour laquelle vous souhaitez le jeton."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"scope"})," : Les permissions de ressource API au niveau de l\u2019organisation que vous souhaitez demander (par exemple, ",(0,o.jsx)(n.code,{children:"invite:member"}),", ",(0,o.jsx)(n.code,{children:"manage:billing"}),")."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Voici un exemple non normatif de requ\xeate de jeton utilisant le type de flux client credentials :"}),"\n",(0,o.jsx)(l.A,{resource:"https://api.yourapp.com/org",organizationId:"your-organization-id",scope:"invite:member manage:billing"}),"\n",(0,o.jsx)(n.h3,{id:"validate-organization-tokens",children:"Validez les jetons d\u2019organisation"}),"\n",(0,o.jsx)(n.p,{children:"Les jetons d\u2019organisation \xe9mis par Logto (JWTs) contiennent des revendications que votre API peut utiliser pour appliquer le contr\xf4le d\u2019acc\xe8s au niveau de l\u2019organisation."}),"\n",(0,o.jsx)(n.p,{children:"Lorsque votre application re\xe7oit un jeton d\u2019organisation, vous devez :"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"V\xe9rifier la signature du jeton (en utilisant les JWKs de Logto)."}),"\n",(0,o.jsxs)(n.li,{children:["Confirmer que le jeton n\u2019est pas expir\xe9 (",(0,o.jsx)(n.code,{children:"exp"})," revendication)."]}),"\n",(0,o.jsxs)(n.li,{children:["V\xe9rifier que le ",(0,o.jsx)(n.code,{children:"iss"})," (\xe9metteur) correspond \xe0 votre point de terminaison Logto."]}),"\n",(0,o.jsxs)(n.li,{children:["S\u2019assurer que le ",(0,o.jsx)(n.code,{children:"aud"})," (audience) correspond \xe0 l\u2019identifiant de la ressource API que vous avez enregistr\xe9e (par exemple, ",(0,o.jsx)(n.code,{children:"https://api.yourapp.com/org"}),")."]}),"\n",(0,o.jsxs)(n.li,{children:["Valider la revendication ",(0,o.jsx)(n.code,{children:"organization_id"})," pour s\u2019assurer que le jeton est limit\xe9 \xe0 la bonne organisation."]}),"\n",(0,o.jsxs)(n.li,{children:["S\xe9parer la revendication ",(0,o.jsx)(n.code,{children:"scope"})," (s\xe9par\xe9e par des espaces) et v\xe9rifier les permissions requises."]}),"\n",(0,o.jsxs)(n.li,{children:["Si le chemin de votre API inclut l\u2019ID de l\u2019organisation (par exemple, ",(0,o.jsx)(n.code,{children:"/organizations/{organizationId}/members"}),"), assurez-vous que la revendication ",(0,o.jsx)(n.code,{children:"organization_id"})," correspond au param\xe8tre du chemin."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Pour des guides \xe9tape par \xe9tape et sp\xe9cifiques \xe0 chaque langage, voir ",(0,o.jsx)(n.a,{href:"/authorization/validate-access-tokens",children:"Comment valider les jetons d\u2019acc\xe8s"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"best-practices-and-security-tips",children:"Bonnes pratiques et conseils de s\xe9curit\xe9"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Validez toujours le contexte organisationnel :"})," Ne vous fiez pas uniquement au jeton ; v\xe9rifiez la revendication ",(0,o.jsx)(n.code,{children:"organization_id"})," pour chaque appel d\u2019API limit\xe9 \xe0 l\u2019organisation."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Utilisez les restrictions d\u2019audience :"})," V\xe9rifiez toujours la revendication ",(0,o.jsx)(n.code,{children:"aud"})," pour vous assurer que le jeton est destin\xe9 \xe0 la bonne organisation."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Gardez les permissions orient\xe9es m\xe9tier :"})," Utilisez des noms clairs correspondant \xe0 de vraies actions ; n\u2019accordez que ce qui est n\xe9cessaire pour chaque r\xf4le d\u2019organisation."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"S\xe9parez les permissions API et non-API"})," lorsque c\u2019est possible (mais les deux peuvent \xeatre dans un m\xeame r\xf4le)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Gardez la dur\xe9e de vie des jetons courte :"})," R\xe9duit le risque en cas de fuite d\u2019un jeton."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"R\xe9visez r\xe9guli\xe8rement votre mod\xe8le d\u2019organisation :"})," Mettez \xe0 jour les r\xf4les et permissions au fur et \xe0 mesure de l\u2019\xe9volution de votre produit."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"faqs",children:"FAQ"}),"\n",(0,o.jsxs)(s,{children:[(0,o.jsx)("summary",{children:(0,o.jsxs)(n.h3,{id:"what-if-i-don-t-include-organization-id-in-my-token-request",children:["Que se passe-t-il si je n\u2019inclus pas ",(0,o.jsx)(n.code,{children:"organization_id"})," dans ma requ\xeate de jeton ?"]})}),(0,o.jsx)(n.p,{children:"Seuls les r\xf4les / permissions globaux seront \xe9valu\xe9s. Le RBAC d\u2019organisation ne sera pas appliqu\xe9."})]}),"\n",(0,o.jsxs)(s,{children:[(0,o.jsx)("summary",{children:(0,o.jsx)(n.h3,{id:"can-i-mix-organization-and-non-organization-permissions-in-a-single-role",children:"Puis-je m\xe9langer des permissions d\u2019organisation et non-organisation dans un m\xeame r\xf4le ?"})}),(0,o.jsx)(n.p,{children:"Non, les permissions d\u2019organisation (y compris les permissions API au niveau de l\u2019organisation) sont d\xe9finies par le mod\xe8le d\u2019organisation et ne peuvent pas \xeatre m\xe9lang\xe9es avec des permissions API globales. Cependant, vous pouvez cr\xe9er des r\xf4les qui incluent \xe0 la fois des permissions d\u2019organisation et des permissions API au niveau de l\u2019organisation."})]}),"\n",(0,o.jsx)(n.h2,{id:"further-reading",children:"Pour aller plus loin"}),"\n",(0,o.jsx)(g,{href:"/authorization/validate-access-tokens",children:"Comment valider les jetons d\u2019acc\xe8s"}),"\n",(0,o.jsx)(g,{href:"/developers/custom-token-claims",children:"Personnalisation des revendications de jeton"}),"\n",(0,o.jsx)(g,{href:"/use-cases/multi-tenancy/build-multi-tenant-saas-application",children:(0,o.jsx)(n.p,{children:"Cas d\u2019usage : Construire une application SaaS multi-locataire"})}),"\n",(0,o.jsx)(g,{href:"https://www.rfc-editor.org/rfc/rfc8707.html",children:"RFC 8707 : Indicateurs de ressource"})]})}function b(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(f,{...e})}):f(e)}function z(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},39088:(e,n,i)=>{i.d(n,{A:()=>r});var s=i(80173),o=i(25105);const r=e=>{let{resource:n,scope:i}=e;return(0,o.jsx)(s.A,{language:"http",children:`GET /oidc/auth?response_type=code\n&client_id=your-client-id\n&redirect_uri=https://your-app.com/callback\n&scope=openid profile offline_access ${i}\n&resource=${n}\n&code_challenge=abc123\n&code_challenge_method=S256\n&state=xyz\nHTTP/1.1\nHost: your.logto.endpoint\n`})}},78506:(e,n,i)=>{i.d(n,{A:()=>r});var s=i(80173),o=i(25105);const r=e=>{let{resource:n,organizationId:i,scope:r}=e;return(0,o.jsxs)(s.A,{language:"http",children:["POST /oidc/token HTTP/1.1\nHost: your.logto.endpoint\nContent-Type: application/x-www-form-urlencoded\nAuthorization: Basic base64(client_id:client_secret)\n\ngrant_type=client_credentials\n",n&&`&resource=${n}\n`,i&&`&organization_id=${i}\n`,`&scope=${r}\n`]})}},42372:(e,n,i)=>{i.d(n,{A:()=>r});var s=i(80173),o=i(25105);const r=e=>{let{grantType:n,resource:i,organizationId:r}=e;const t=[`grant_type=${n}`,"authorization_code"===n&&"code=authorization-code-received","authorization_code"===n&&"redirect_uri=https://your-app.com/callback","refresh_token"===n&&"refresh_token=your-refresh-token",i&&`resource=${i}`,r&&`organization_id=${r}`].filter(Boolean);return(0,o.jsx)(s.A,{language:"http",children:`POST /oidc/token HTTP/1.1\nHost: your.logto.endpoint\nContent-Type: application/x-www-form-urlencoded\nAuthorization: Basic base64(client_id:client_secret)\n\n${t.join("\n&")}`})}},38552:(e,n,i)=>{i.d(n,{A:()=>t});i(58101);var s=i(13526);const o={tabItem:"tabItem_dgSZ"};var r=i(25105);function t(e){let{children:n,hidden:i,className:t}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,s.A)(o.tabItem,t),hidden:i,children:n})}},22002:(e,n,i)=>{i.d(n,{A:()=>A});var s=i(58101),o=i(13526),r=i(60755),t=i(55234),a=i(6635),l=i(4100),c=i(35661),d=i(42752);function u(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:i}=e;return(0,s.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:i,attributes:s,default:o}}=e;return{value:n,label:i,attributes:s,default:o}}))}(i);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,i])}function h(e){let{value:n,tabValues:i}=e;return i.some((e=>e.value===n))}function g(e){let{queryString:n=!1,groupId:i}=e;const o=(0,t.W6)(),r=function(e){let{queryString:n=!1,groupId:i}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!i)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return i??null}({queryString:n,groupId:i});return[(0,l.aZ)(r),(0,s.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(o.location.search);n.set(r,e),o.replace({...o.location,search:n.toString()})}),[r,o])]}function m(e){const{defaultValue:n,queryString:i=!1,groupId:o}=e,r=p(e),[t,l]=(0,s.useState)((()=>function(e){let{defaultValue:n,tabValues:i}=e;if(0===i.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!h({value:n,tabValues:i}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${i.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const s=i.find((e=>e.default))??i[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:n,tabValues:r}))),[c,u]=g({queryString:i,groupId:o}),[m,x]=function(e){let{groupId:n}=e;const i=function(e){return e?`docusaurus.tab.${e}`:null}(n),[o,r]=(0,d.Dv)(i);return[o,(0,s.useCallback)((e=>{i&&r.set(e)}),[i,r])]}({groupId:o}),j=(()=>{const e=c??m;return h({value:e,tabValues:r})?e:null})();(0,a.A)((()=>{j&&l(j)}),[j]);return{selectedValue:t,selectValue:(0,s.useCallback)((e=>{if(!h({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),x(e)}),[u,x,r]),tabValues:r}}var x=i(21929);const j={tabList:"tabList_osvQ",tabItem:"tabItem_dc4O"};var v=i(25105);function f(e){let{className:n,block:i,selectedValue:s,selectValue:t,tabValues:a}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,r.a_)(),d=e=>{const n=e.currentTarget,i=l.indexOf(n),o=a[i].value;o!==s&&(c(n),t(o))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const i=l.indexOf(e.currentTarget)+1;n=l[i]??l[0];break}case"ArrowLeft":{const i=l.indexOf(e.currentTarget)-1;n=l[i]??l[l.length-1];break}}n?.focus()};return(0,v.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":i},n),children:a.map((e=>{let{value:n,label:i,attributes:r}=e;return(0,v.jsx)("li",{role:"tab",tabIndex:s===n?0:-1,"aria-selected":s===n,ref:e=>{l.push(e)},onKeyDown:u,onClick:d,...r,className:(0,o.A)("tabs__item",j.tabItem,r?.className,{"tabs__item--active":s===n}),children:i??n},n)}))})}function b(e){let{lazy:n,children:i,selectedValue:r}=e;const t=(Array.isArray(i)?i:[i]).filter(Boolean);if(n){const e=t.find((e=>e.props.value===r));return e?(0,s.cloneElement)(e,{className:(0,o.A)("margin-top--md",e.props.className)}):null}return(0,v.jsx)("div",{className:"margin-top--md",children:t.map(((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==r})))})}function z(e){const n=m(e);return(0,v.jsxs)("div",{className:(0,o.A)("tabs-container",j.tabList),children:[(0,v.jsx)(f,{...n,...e}),(0,v.jsx)(b,{...n,...e})]})}function A(e){const n=(0,x.A)();return(0,v.jsx)(z,{...e,children:u(e.children)},String(n))}},55138:(e,n,i)=>{i.d(n,{A:()=>m});var s=i(28259),o=i(6097),r=i(58574),t=i(9484),a=i(76566),l=i(26346),c=i(17867),d=i(17510),u=i(13526),p=i(72355);const h={codeBlockContent:"codeBlockContent_m3Ux",codeBlockTitle:"codeBlockTitle_P25_",codeBlock:"codeBlock_qGQc",codeBlockStandalone:"codeBlockStandalone_zC50",codeBlockLines:"codeBlockLines_p187",codeBlockLinesWithNumbering:"codeBlockLinesWithNumbering_OFgW",buttonGroup:"buttonGroup_6DOT"};var g=i(25105);function m(e){let{children:n,className:i="",metastring:m,title:x,showLineNumbers:j,language:v}=e;const{prism:{defaultLanguage:f,magicComments:b}}=(0,s.p)(),z=function(e){return e?.toLowerCase()}(v??(0,r.Op)(i)??f),A=(0,o.A)(),I=(0,t.f)(),P=(0,r.wt)(m)||x,{lineClassNames:q,code:k}=(0,r.Li)(n,{metastring:m,language:z,magicComments:b}),y=j??(0,r._u)(m);return(0,g.jsxs)(a.A,{as:"div",className:(0,u.A)(i,z&&!i.includes(`language-${z}`)&&`language-${z}`),children:[P&&(0,g.jsx)("div",{className:h.codeBlockTitle,children:P}),(0,g.jsxs)("div",{className:h.codeBlockContent,children:[(0,g.jsx)(p.f4,{theme:A,code:k,language:z??"text",children:e=>{let{className:n,tokens:i,getLineProps:s,getTokenProps:o}=e;return(0,g.jsx)("pre",{ref:I.codeBlockRef,tabIndex:0,className:(0,u.A)(n,h.codeBlock,"thin-scrollbar"),children:(0,g.jsx)("code",{className:(0,u.A)(h.codeBlockLines,y&&h.codeBlockLinesWithNumbering),children:i.map(((e,n)=>(0,g.jsx)(c.A,{line:e,getLineProps:s,getTokenProps:o,classNames:q[n],showLineNumbers:y},n)))})})}}),(0,g.jsxs)("div",{className:h.buttonGroup,children:[(I.isEnabled||I.isCodeScrollable)&&(0,g.jsx)(d.A,{className:h.codeButton,isEnabled:I.isEnabled,onClick:()=>{I.toggle()}}),(0,g.jsx)(l.A,{className:h.codeButton,code:k})]})]})]})}},1242:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/rbac-organization-level-api-resources-9533c281f3ee1cf52aefe821717e1fef.png"}}]);