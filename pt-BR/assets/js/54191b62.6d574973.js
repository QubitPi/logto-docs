"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[5767],{45796:(e,s,o)=>{o.r(s),o.d(s,{assets:()=>t,contentTitle:()=>a,default:()=>p,frontMatter:()=>d,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"developers/custom-token-claims/create-script","title":"Criar um script de reivindica\xe7\xf5es personalizadas de token","description":"Para adicionar reivindica\xe7\xf5es personalizadas ao token de acesso (Access token), voc\xea precisa fornecer um script que retorne um objeto contendo essas reivindica\xe7\xf5es. O script deve ser escrito como uma fun\xe7\xe3o JavaScript que retorna um objeto com as reivindica\xe7\xf5es personalizadas.","source":"@site/i18n/pt-BR/docusaurus-plugin-content-docs/current/developers/custom-token-claims/create-script.mdx","sourceDirName":"developers/custom-token-claims","slug":"/developers/custom-token-claims/create-script","permalink":"/pt-BR/developers/custom-token-claims/create-script","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/pt-BR/docusaurus-plugin-content-docs/current/developers/custom-token-claims/create-script.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"create-script","title":"Criar um script de reivindica\xe7\xf5es personalizadas de token","sidebar_label":"Criar um script de reivindica\xe7\xf5es personalizadas de token","sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Casos de uso comuns","permalink":"/pt-BR/developers/custom-token-claims/common-use-cases"},"next":{"title":"Imita\xe7\xe3o de usu\xe1rio","permalink":"/pt-BR/developers/user-impersonation"}}');var i=o(25105),r=o(79621);const d={id:"create-script",title:"Criar um script de reivindica\xe7\xf5es personalizadas de token",sidebar_label:"Criar um script de reivindica\xe7\xf5es personalizadas de token",sidebar_position:3},a="Criar um script de reivindica\xe7\xf5es personalizadas de token",t={},c=[{value:"Implementar a fun\xe7\xe3o <code>getCustomJwtClaims()</code>",id:"implement-getcustomjwtclaims-function",level:2},{value:"Passo 1: Edite o script",id:"step-1-edit-the-script",level:2},{value:"Passo 2: Par\xe2metros de entrada",id:"step-2-input-parameters",level:2},{value:"token",id:"token",level:3},{value:"context (Dispon\xedvel apenas para token de acesso do usu\xe1rio)",id:"context-only-available-for-user-access-token",level:3},{value:"environmentVariables",id:"environmentvariables",level:3},{value:"api",id:"api",level:3},{value:"Passo 3: Buscar dados externos",id:"step-3-fetch-external-data",level:2},{value:"Passo 4: Teste o script",id:"step-4-test-the-script",level:2}];function l(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components},{CloudLink:o}=s;return o||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("CloudLink",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"criar-um-script-de-reivindica\xe7\xf5es-personalizadas-de-token",children:"Criar um script de reivindica\xe7\xf5es personalizadas de token"})}),"\n",(0,i.jsxs)(s.p,{children:["Para ",(0,i.jsx)(s.a,{href:"/developers/custom-token-claims",children:"adicionar reivindica\xe7\xf5es personalizadas"})," ao ",(0,i.jsx)(s.a,{href:"https://auth.wiki/access-token",children:"token de acesso (Access token)"}),", voc\xea precisa fornecer um script que retorne um objeto contendo essas reivindica\xe7\xf5es. O script deve ser escrito como uma fun\xe7\xe3o ",(0,i.jsx)(s.code,{children:"JavaScript"})," que retorna um objeto com as reivindica\xe7\xf5es personalizadas."]}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Navegue at\xe9 ",(0,i.jsx)(o,{to:"/customize-jwt",children:"Console > JWT personalizado"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Existem dois tipos diferentes de tokens de acesso para os quais voc\xea pode personalizar as reivindica\xe7\xf5es do token de acesso:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Token de acesso do usu\xe1rio"}),": O token de acesso emitido para usu\xe1rios finais. Ex.: para aplicativos Web ou aplicativos m\xf3veis."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Token de acesso m\xe1quina para m\xe1quina"}),": O token de acesso emitido para servi\xe7os ou aplicativos. Ex.: para ",(0,i.jsx)(s.a,{href:"/quick-starts/m2m",children:"aplicativos m\xe1quina para m\xe1quina"}),"."]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Diferentes tipos de tokens de acesso podem ter diferentes contextos de payload do token. Voc\xea pode personalizar as reivindica\xe7\xf5es do token para cada tipo de token de acesso separadamente."}),"\n",(0,i.jsxs)(s.p,{children:["Escolha qualquer tipo de token de acesso que deseja personalizar as reivindica\xe7\xf5es do token e clique no bot\xe3o ",(0,i.jsx)(s.strong,{children:"Adicionar reivindica\xe7\xf5es personalizadas"})," para criar um novo script."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.admonition,{type:"note",children:[(0,i.jsx)(s.p,{children:"O recurso de reivindica\xe7\xf5es personalizadas de token est\xe1 dispon\xedvel apenas para:"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Usu\xe1rios do ",(0,i.jsx)(s.a,{href:"/logto-oss",children:"Logto OSS"})]}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"/logto-cloud/tenant-settings#development",children:"Locat\xe1rios do Logto Cloud com ambiente de desenvolvimento"})}),"\n",(0,i.jsxs)(s.li,{children:["Locat\xe1rios pagos do Logto Cloud com ambiente de produ\xe7\xe3o (incluindo ",(0,i.jsx)(s.a,{href:"https://logto.io/pricing",children:"locat\xe1rios Pro e locat\xe1rios Enterprise"}),")"]}),"\n"]})]}),"\n",(0,i.jsxs)(s.h2,{id:"implement-getcustomjwtclaims-function",children:["Implementar a fun\xe7\xe3o ",(0,i.jsx)(s.code,{children:"getCustomJwtClaims()"})]}),"\n",(0,i.jsxs)(s.p,{children:["Na p\xe1gina de detalhes do ",(0,i.jsx)(s.strong,{children:"JWT personalizado"}),", voc\xea encontrar\xe1 o editor de script para escrever seu script de reivindica\xe7\xf5es personalizadas de token. O script deve ser uma fun\xe7\xe3o ",(0,i.jsx)(s.code,{children:"JavaScript"})," que retorna um objeto de reivindica\xe7\xf5es personalizadas."]}),"\n",(0,i.jsx)("img",{src:"/img/assets/custom-jwt-detail-page.png",alt:"P\xe1gina de detalhes de reivindica\xe7\xf5es personalizadas de token"}),"\n",(0,i.jsx)(s.h2,{id:"step-1-edit-the-script",children:"Passo 1: Edite o script"}),"\n",(0,i.jsxs)(s.p,{children:["Use o editor de c\xf3digo no lado esquerdo para modificar o script. Um ",(0,i.jsx)(s.code,{children:"getCustomJwtClaims"})," padr\xe3o com um valor de retorno de objeto vazio \xe9 fornecido para voc\xea come\xe7ar. Voc\xea pode modificar a fun\xe7\xe3o para retornar um objeto com suas pr\xf3prias reivindica\xe7\xf5es personalizadas."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-jsx",children:"const getCustomJwtClaims = async ({ token, context, environmentVariables }) => {\n  return {};\n};\n"})}),"\n",(0,i.jsx)(s.p,{children:"Este editor utiliza o servidor de linguagem JavaScript para fornecer realce de sintaxe b\xe1sico, autocompletar c\xf3digo e verifica\xe7\xe3o de erros. O par\xe2metro de entrada \xe9 bem tipado e documentado no estilo jsDoc. Voc\xea pode usar o IntelliSense do editor para acessar corretamente as propriedades do objeto de entrada. Voc\xea encontrar\xe1 as defini\xe7\xf5es detalhadas dos par\xe2metros no lado direito da p\xe1gina."}),"\n",(0,i.jsx)(s.admonition,{type:"note",children:(0,i.jsxs)(s.p,{children:["Esta fun\xe7\xe3o ser\xe1 exportada como um m\xf3dulo. Certifique-se de manter o nome da fun\xe7\xe3o como ",(0,i.jsx)(s.code,{children:"getCustomJwtClaims"})," para que o m\xf3dulo possa exportar a fun\xe7\xe3o corretamente."]})}),"\n",(0,i.jsx)(s.h2,{id:"step-2-input-parameters",children:"Passo 2: Par\xe2metros de entrada"}),"\n",(0,i.jsxs)(s.p,{children:["A fun\xe7\xe3o ",(0,i.jsx)(s.code,{children:"getCustomJwtClaims"})," recebe um objeto como par\xe2metro de entrada. O objeto de entrada cont\xe9m as seguintes propriedades:"]}),"\n",(0,i.jsx)(s.h3,{id:"token",children:"token"}),"\n",(0,i.jsx)(s.p,{children:"O objeto payload do token. Este objeto cont\xe9m as reivindica\xe7\xf5es originais do token e metadados que voc\xea pode precisar acessar no script."}),"\n",(0,i.jsx)(s.p,{children:"Voc\xea pode encontrar a defini\xe7\xe3o de tipo detalhada do objeto payload do token e do objeto de dados do usu\xe1rio no lado direito da p\xe1gina. O IntelliSense do editor tamb\xe9m ajudar\xe1 voc\xea a acessar corretamente essas propriedades do objeto de entrada."}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Objeto de dados do token de acesso do usu\xe1rio","\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Propriedade"}),(0,i.jsx)(s.th,{children:"Descri\xe7\xe3o"}),(0,i.jsx)(s.th,{children:"Tipo"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"jti"})}),(0,i.jsx)(s.td,{children:"O id \xfanico do JWT"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"string"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"aud"})}),(0,i.jsx)(s.td,{children:"O p\xfablico do token"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"string"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"scope"})}),(0,i.jsx)(s.td,{children:"Os escopos do token"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"string"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"clientId"})}),(0,i.jsx)(s.td,{children:"O id do cliente do token"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"string"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"accountId"})}),(0,i.jsx)(s.td,{children:"O id do usu\xe1rio do token"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"string"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"expiresWithSession"})}),(0,i.jsx)(s.td,{children:"Se o token ir\xe1 expirar com a sess\xe3o"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"boolean"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"grantId"})}),(0,i.jsx)(s.td,{children:"O id da concess\xe3o de autentica\xe7\xe3o atual do token"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"string"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"gty"})}),(0,i.jsx)(s.td,{children:"O tipo de concess\xe3o do token"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"string"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"kind"})}),(0,i.jsx)(s.td,{children:"O tipo do token"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"AccessToken"})})]})]})]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Objeto de dados do token de acesso m\xe1quina para m\xe1quina","\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Propriedade"}),(0,i.jsx)(s.th,{children:"Descri\xe7\xe3o"}),(0,i.jsx)(s.th,{children:"Tipo"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"jti"})}),(0,i.jsx)(s.td,{children:"O id \xfanico do JWT"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"string"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"aud"})}),(0,i.jsx)(s.td,{children:"O p\xfablico do token"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"string"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"scope"})}),(0,i.jsx)(s.td,{children:"Os escopos do token"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"string"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"clientId"})}),(0,i.jsx)(s.td,{children:"O id do cliente do token"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"string"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"kind"})}),(0,i.jsx)(s.td,{children:"O tipo do token"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ClientCredentials"})})]})]})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"context-only-available-for-user-access-token",children:"context (Dispon\xedvel apenas para token de acesso do usu\xe1rio)"}),"\n",(0,i.jsx)(s.p,{children:"O objeto context cont\xe9m os dados do usu\xe1rio e dados da concess\xe3o relevantes para o processo atual de autoriza\xe7\xe3o (Authorization)."}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Objeto de dados do usu\xe1rio"}),"\nPara token de acesso do usu\xe1rio, o Logto fornece contexto adicional de dados do usu\xe1rio para voc\xea acessar. O objeto de dados do usu\xe1rio cont\xe9m todos os dados de perfil do usu\xe1rio e dados de associa\xe7\xe3o \xe0 organiza\xe7\xe3o que voc\xea pode precisar para configurar as reivindica\xe7\xf5es personalizadas. Consulte ",(0,i.jsx)(s.a,{href:"/user-management/user-data",children:"Usu\xe1rios"})," e ",(0,i.jsx)(s.a,{href:"/organizations/organization-data",children:"Organiza\xe7\xf5es"})," para mais detalhes."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Objeto de dados da concess\xe3o"}),"\nPara token de acesso do usu\xe1rio concedido por troca de token de imita\xe7\xe3o, o Logto fornece contexto adicional de dados da concess\xe3o para voc\xea acessar. O objeto de dados da concess\xe3o cont\xe9m o contexto personalizado do token de sujeito. Consulte ",(0,i.jsx)(s.a,{href:"/developers/user-impersonation",children:"Imita\xe7\xe3o de usu\xe1rio (User impersonation)"})," para mais detalhes."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Objeto de dados de intera\xe7\xe3o do usu\xe1rio"}),"\nPara um determinado token de acesso do usu\xe1rio, pode haver situa\xe7\xf5es em que voc\xea precise acessar os detalhes de intera\xe7\xe3o do usu\xe1rio para a sess\xe3o de autoriza\xe7\xe3o atual. Por exemplo, voc\xea pode precisar recuperar a identidade SSO corporativa do usu\xe1rio usada para login. Este objeto de dados de intera\xe7\xe3o do usu\xe1rio cont\xe9m os dados de intera\xe7\xe3o mais recentes enviados pelo usu\xe1rio, incluindo:"]}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Propriedade"}),(0,i.jsx)(s.th,{children:"Descri\xe7\xe3o"}),(0,i.jsx)(s.th,{children:"Tipo"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"interactionEvent"})}),(0,i.jsx)(s.td,{children:"O evento de intera\xe7\xe3o da intera\xe7\xe3o atual do usu\xe1rio"}),(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"SignIn"})," ou ",(0,i.jsx)(s.code,{children:"Register"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"userId"})}),(0,i.jsx)(s.td,{children:"O id do usu\xe1rio da intera\xe7\xe3o atual"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"string"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"verificationRecords"})}),(0,i.jsx)(s.td,{children:"Uma lista de registros de verifica\xe7\xe3o enviados pelo usu\xe1rio para identificar e verificar sua identidade durante as intera\xe7\xf5es."}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"VerificationRecord[]"})})]})]})]}),"\n",(0,i.jsx)(s.p,{children:"Tipo de registro de verifica\xe7\xe3o:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"// VerificationType.Password\n{\n  id: string;\n  type: 'Password';\n  identifier: {\n    type: 'username' | 'email' | 'phone' | 'userId';\n    value: string;\n  }\n  verified: boolean;\n}\n"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"// VerificationType.EmailVerificationCode\n{\n  id: string;\n  templateType: 'SignIn' | 'Register' | 'ForgotPassword' | 'Generic';\n  verified: boolean;\n  type: 'EmailVerificationCode';\n  identifier: {\n    type: 'email';\n    value: string;\n  }\n}\n"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"// VerificationType.PhoneVerificationCode\n{\n  id: string;\n  templateType: 'SignIn' | 'Register' | 'ForgotPassword' | 'Generic';\n  verified: boolean;\n  type: 'PhoneVerificationCode';\n  identifier: {\n    type: 'phone';\n    value: string;\n  }\n}\n"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"// VerificationType.Social\n{\n  id: string;\n  type: 'Social';\n  connectorId: string;\n  socialUserInfo?: {\n    id: string;\n    email?: string | undefined;\n    phone?: string | undefined;\n    name?: string | undefined;\n    avatar?: string | undefined;\n    rawData?: Record<string, unknown> | undefined;\n  } | undefined;\n}\n"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"// VerificationType.EnterpriseSso\n{\n  id: string;\n  type: 'EnterpriseSso';\n  connectorId: string;\n  enterpriseUserInfo?: {\n    id: string;\n    email?: string | undefined;\n    phone?: string | undefined;\n    name?: string | undefined;\n    avatar?: string | undefined;\n    [key: string]?: unknown;\n  } | undefined;\n  issuer?: string | undefined;\n}\n"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"// VerificationType.Totp (MFA)\n{\n  id: string;\n  type: 'Totp';\n  userId: string;\n  verified: boolean;\n}\n"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:"// VerificationType.WebAuthn (MFA)\n{\n  id: string;\n  type: 'WebAuthn';\n  userId: string;\n  verified: boolean;\n}\n"})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:'// VerificationType.BackupCode (MFA)\n{\n  id: string;\n  type: "BackupCode";\n  userId: string;\n  code?: string | undefined;\n}\n'})}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-ts",children:'// VerificationType.OneTimeToken\n{\n  id: string;\n  type: "OneTimeToken";\n  verified: boolean;\n  identifier: {\n    type: "email";\n    value: string;\n  };\n  oneTimeTokenContext?: {\n    jitOrganizationIds?: string[] | undefined;\n  } | undefined;\n}\n'})}),"\n",(0,i.jsxs)(s.admonition,{type:"note",children:[(0,i.jsx)(s.p,{children:"Pode haver v\xe1rios registros de verifica\xe7\xe3o no objeto de dados de intera\xe7\xe3o do usu\xe1rio, especialmente quando o usu\xe1rio passou por v\xe1rios processos de login ou registro."}),(0,i.jsxs)(s.p,{children:["Ex.: o usu\xe1rio fez login usando um registro de verifica\xe7\xe3o ",(0,i.jsx)(s.code,{children:"Social"}),", depois vinculou um novo endere\xe7o de e-mail atrav\xe9s de um registro de verifica\xe7\xe3o ",(0,i.jsx)(s.code,{children:"EmailVerificationCode"})," e, em seguida, verificou o status MFA com um registro de verifica\xe7\xe3o ",(0,i.jsx)(s.code,{children:"Totp"}),". Nesse caso, voc\xea pode precisar tratar todos os registros de verifica\xe7\xe3o adequadamente em seu script."]}),(0,i.jsx)(s.p,{children:"Cada tipo de registro de verifica\xe7\xe3o estar\xe1 presente apenas uma vez no objeto de dados de intera\xe7\xe3o do usu\xe1rio."})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"environmentvariables",children:"environmentVariables"}),"\n",(0,i.jsxs)(s.p,{children:["Use a se\xe7\xe3o ",(0,i.jsx)(s.strong,{children:"Definir vari\xe1veis de ambiente"})," \xe0 direita para configurar as vari\xe1veis de ambiente para seu script. Voc\xea pode usar essas vari\xe1veis para armazenar informa\xe7\xf5es sens\xedveis ou dados de configura\xe7\xe3o que n\xe3o deseja codificar diretamente no script. Ex.: chaves de API, segredos ou URLs."]}),"\n",(0,i.jsxs)(s.p,{children:["Todas as vari\xe1veis de ambiente que voc\xea definir aqui estar\xe3o dispon\xedveis no script. Use o objeto ",(0,i.jsx)(s.code,{children:"environmentVariables"})," no par\xe2metro de entrada para acessar essas vari\xe1veis."]}),"\n",(0,i.jsx)(s.h3,{id:"api",children:"api"}),"\n",(0,i.jsxs)(s.p,{children:["O objeto ",(0,i.jsx)(s.code,{children:"api"})," fornece um conjunto de fun\xe7\xf5es utilit\xe1rias que voc\xea pode usar em seu script para controle de acesso adicional sobre o processo de emiss\xe3o do token. O objeto ",(0,i.jsx)(s.code,{children:"api"})," cont\xe9m as seguintes fun\xe7\xf5es:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-jsx",children:"api.denyAccess(message?: string): void\n"})}),"\n",(0,i.jsxs)(s.p,{children:["A fun\xe7\xe3o ",(0,i.jsx)(s.code,{children:"api.denyAccess()"})," permite negar o processo de emiss\xe3o do token com uma mensagem personalizada. Voc\xea pode usar essa fun\xe7\xe3o para impor valida\xe7\xf5es adicionais de acesso sobre o processo de emiss\xe3o do token."]}),"\n",(0,i.jsx)(s.h2,{id:"step-3-fetch-external-data",children:"Passo 3: Buscar dados externos"}),"\n",(0,i.jsxs)(s.p,{children:["Voc\xea pode usar a fun\xe7\xe3o nativa do node ",(0,i.jsx)(s.code,{children:"fetch"})," para buscar dados externos em seu script. A fun\xe7\xe3o ",(0,i.jsx)(s.code,{children:"fetch"})," \xe9 baseada em promessas e permite fazer requisi\xe7\xf5es HTTP para APIs externas."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-jsx",children:"const getCustomJwtClaims = async ({ environmentVariables }) => {\n  const response = await fetch('https://api.example.com/data', {\n    headers: {\n      Authorization: `Bearer ${environmentVariables.API_KEY}`,\n    },\n  });\n\n  const data = await response.json();\n\n  return {\n    data,\n  };\n};\n"})}),"\n",(0,i.jsxs)(s.admonition,{type:"note",children:[(0,i.jsx)(s.p,{children:"Aten\xe7\xe3o: qualquer busca de dados externos pode introduzir lat\xeancia no processo de emiss\xe3o do token. Certifique-se de que a API externa seja confi\xe1vel e r\xe1pida o suficiente para atender aos seus requisitos."}),(0,i.jsx)(s.p,{children:"Al\xe9m disso:"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Trate erros e timeout adequadamente em seu script para evitar que o processo de emiss\xe3o do token seja bloqueado."}),"\n",(0,i.jsx)(s.li,{children:"Use cabe\xe7alhos de autoriza\xe7\xe3o apropriados para proteger sua API externa contra acessos n\xe3o autorizados."}),"\n"]})]}),"\n",(0,i.jsx)(s.h2,{id:"step-4-test-the-script",children:"Passo 4: Teste o script"}),"\n",(0,i.jsxs)(s.p,{children:["Certifique-se de testar seu script antes de salv\xe1-lo. Clique na aba ",(0,i.jsx)(s.strong,{children:"Contexto de teste"})," no lado direito da p\xe1gina para modificar o payload de token simulado e o contexto de dados do usu\xe1rio para teste."]}),"\n",(0,i.jsxs)(s.p,{children:["Clique em ",(0,i.jsx)(s.strong,{children:"Executar teste"})," no canto superior direito do editor para rodar o script com os dados simulados. A sa\xedda do script ser\xe1 exibida na gaveta ",(0,i.jsx)(s.strong,{children:"Resultado do teste"}),"."]}),"\n",(0,i.jsx)("img",{src:"/img/assets/test-custom-jwt-script.png",alt:"Testar script JWT personalizado"}),"\n",(0,i.jsx)(s.admonition,{type:"note",children:(0,i.jsxs)(s.p,{children:["O resultado do teste \xe9 a sa\xedda da fun\xe7\xe3o ",(0,i.jsx)(s.code,{children:"getCustomJwtClaims"}),' com os dados simulados que voc\xea definiu ("reivindica\xe7\xf5es extras do token" obtidas ap\xf3s concluir o passo 3 no ',(0,i.jsx)(s.a,{href:"/developers/custom-token-claims/#how-do-custom-token-claims-work",children:"diagrama de sequ\xeancia"}),"). O payload real do token e o contexto de dados do usu\xe1rio ser\xe3o diferentes quando o script for executado no processo de emiss\xe3o do token."]})}),"\n",(0,i.jsxs)(s.p,{children:["Clique no bot\xe3o ",(0,i.jsx)(s.strong,{children:"Criar"})," para salvar o script. O script de reivindica\xe7\xf5es personalizadas de token ser\xe1 salvo e aplicado ao processo de emiss\xe3o do token de acesso."]})]})}function p(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},79621:(e,s,o)=>{o.d(s,{R:()=>d,x:()=>a});var n=o(58101);const i={},r=n.createContext(i);function d(e){const s=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),n.createElement(r.Provider,{value:s},e.children)}}}]);