"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[7363],{12888:(e,s,r)=>{r.r(s),r.d(s,{assets:()=>c,contentTitle:()=>t,default:()=>p,frontMatter:()=>a,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"use-cases/authorization/rbac-in-practice","title":"rbac-in-practice","description":"Um guia pr\xe1tico para controle de acesso baseado em papel (RBAC): Aprenda como desenhar permiss\xf5es, gerenciar pap\xe9is e configurar autoriza\xe7\xe3o segura em seu CMS.","source":"@site/i18n/pt-BR/docusaurus-plugin-content-docs/current/use-cases/authorization/rbac-in-practice.mdx","sourceDirName":"use-cases/authorization","slug":"/use-cases/authorization/rbac-in-practice","permalink":"/pt-BR/use-cases/authorization/rbac-in-practice","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/pt-BR/docusaurus-plugin-content-docs/current/use-cases/authorization/rbac-in-practice.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"RBAC na pr\xe1tica","description":"Um guia pr\xe1tico para controle de acesso baseado em papel (RBAC): Aprenda como desenhar permiss\xf5es, gerenciar pap\xe9is e configurar autoriza\xe7\xe3o segura em seu CMS."},"sidebar":"useCasesSidebar","previous":{"title":"Autoriza\xe7\xe3o","permalink":"/pt-BR/use-cases/authorization/"},"next":{"title":"Multi-tenancy","permalink":"/pt-BR/use-cases/multi-tenancy/"}}');var i=r(25105),n=r(79621);const a={sidebar_position:1,sidebar_label:"RBAC na pr\xe1tica",description:"Um guia pr\xe1tico para controle de acesso baseado em papel (RBAC): Aprenda como desenhar permiss\xf5es, gerenciar pap\xe9is e configurar autoriza\xe7\xe3o segura em seu CMS."},t="RBAC na pr\xe1tica: Implementando autoriza\xe7\xe3o segura para seu aplicativo",c={},d=[{value:"Entendendo os fundamentos do RBAC",id:"understanding-rbac-fundamentals",level:2},{value:"Design de permiss\xf5es granulares",id:"fine-grained-permission-design",level:3},{value:"Propriedade de recursos e controle de acesso",id:"resource-ownership-and-access-control",level:3},{value:"Desenhando APIs seguras",id:"designing-a-secure-apis",level:2},{value:"Implemente controle de acesso para sua API",id:"implement-access-control-for-your-api",level:3},{value:"Criando um sistema de permiss\xf5es escal\xe1vel",id:"creating-a-permission-system-that-scales",level:3},{value:"Construindo pap\xe9is eficazes",id:"building-effective-roles",level:2},{value:"Configurando RBAC no Logto",id:"config-rbac-in-logto",level:2},{value:"Configurando seu aplicativo",id:"setting-up-your-application",level:3},{value:"Configurando recursos de API e permiss\xf5es",id:"configuring-api-resources-and-permissions",level:3},{value:"Criando pap\xe9is",id:"creating-roles",level:3},{value:"Atribuindo pap\xe9is aos usu\xe1rios",id:"assigning-roles-to-users",level:3},{value:"Integre seu frontend com o RBAC do Logto",id:"integrate-your-frontend-with-logto-rbac",level:2},{value:"Integre seu backend com o RBAC do Logto",id:"integrate-your-backend-with-logto-rbac",level:2},{value:"Middleware de autoriza\xe7\xe3o no backend",id:"backend-authorization-middleware",level:3},{value:"Protegendo endpoints de API",id:"protecting-api-endpoints",level:3},{value:"Testando a implementa\xe7\xe3o do RBAC no CMS",id:"test-the-cms-rbac-implementation",level:2},{value:"Conclus\xe3o",id:"conclusion",level:2}];function l(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.R)(),...e.components},{Head:r}=s;return r||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r,{children:(0,i.jsx)("link",{rel:"canonical",href:"https://blog.logto.io/rbac-in-practice"})}),"\n",(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"rbac-na-pr\xe1tica-implementando-autoriza\xe7\xe3o-segura-para-seu-aplicativo",children:"RBAC na pr\xe1tica: Implementando autoriza\xe7\xe3o segura para seu aplicativo"})}),"\n",(0,i.jsx)(s.p,{children:"Voc\xea est\xe1 tendo dificuldades para implementar um sistema de autoriza\xe7\xe3o seguro e escal\xe1vel para seu aplicativo? O Controle de Acesso Baseado em Papel (RBAC) \xe9 o padr\xe3o da ind\xfastria para gerenciar permiss\xf5es de usu\xe1rios, mas implement\xe1-lo corretamente pode ser desafiador. Este tutorial mostrar\xe1 como construir um sistema RBAC robusto usando um exemplo real de Sistema de Gerenciamento de Conte\xfado (CMS)."}),"\n",(0,i.jsx)(s.p,{children:"Ao seguir este guia, voc\xea aprender\xe1:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"\u2728 Como desenhar e implementar permiss\xf5es granulares que oferecem controle preciso"}),"\n",(0,i.jsx)(s.li,{children:"\ud83d\udd12 Melhores pr\xe1ticas para organizar permiss\xf5es em pap\xe9is significativos"}),"\n",(0,i.jsx)(s.li,{children:"\ud83d\udc64 T\xe9cnicas para lidar com propriedade de recursos de forma eficaz"}),"\n",(0,i.jsx)(s.li,{children:"\ud83d\ude80 Maneiras de tornar seu sistema de autoriza\xe7\xe3o escal\xe1vel e f\xe1cil de manter"}),"\n",(0,i.jsx)(s.li,{children:"\ud83d\udca1 Implementa\xe7\xe3o pr\xe1tica usando um exemplo real de CMS"}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["O c\xf3digo-fonte completo deste tutorial est\xe1 dispon\xedvel no ",(0,i.jsx)(s.a,{href:"https://github.com/logto-io/rbac-sample",children:"GitHub"}),"."]}),"\n",(0,i.jsx)(s.h2,{id:"understanding-rbac-fundamentals",children:"Entendendo os fundamentos do RBAC"}),"\n",(0,i.jsx)(s.p,{children:"O Controle de Acesso Baseado em Papel vai al\xe9m de apenas atribuir permiss\xf5es aos usu\xe1rios. Trata-se de criar uma abordagem estruturada para autoriza\xe7\xe3o que equilibra seguran\xe7a com facilidade de manuten\xe7\xe3o."}),"\n",(0,i.jsxs)(s.p,{children:["Voc\xea pode saber mais sobre ",(0,i.jsx)(s.a,{href:"https://auth-wiki.logto.io/rbac",children:"O que \xe9 RBAC"})," na Auth Wiki."]}),"\n",(0,i.jsx)(s.p,{children:"Aqui est\xe3o os princ\xedpios-chave que seguiremos em nossa implementa\xe7\xe3o:"}),"\n",(0,i.jsx)(s.h3,{id:"fine-grained-permission-design",children:"Design de permiss\xf5es granulares"}),"\n",(0,i.jsx)(s.p,{children:'Permiss\xf5es granulares oferecem controle preciso sobre o que os usu\xe1rios podem fazer em seu sistema. Em vez de n\xedveis amplos de acesso como "admin" ou "usu\xe1rio", definimos a\xe7\xf5es espec\xedficas que os usu\xe1rios podem executar em recursos. Por exemplo:'}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"read:articles"})," - Visualizar qualquer artigo no sistema"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"create:articles"})," - Criar novos artigos"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"update:articles"})," - Modificar artigos existentes"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"publish:articles"})," - Alterar o status de publica\xe7\xe3o dos artigos"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"resource-ownership-and-access-control",children:"Propriedade de recursos e controle de acesso"}),"\n",(0,i.jsx)(s.p,{children:"A propriedade de recursos \xe9 um conceito fundamental no design de autoriza\xe7\xe3o do nosso CMS. Enquanto o RBAC define quais a\xe7\xf5es diferentes pap\xe9is podem executar, a propriedade adiciona uma dimens\xe3o pessoal ao controle de acesso:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Autores t\xeam acesso automaticamente aos artigos que criaram"}),"\n",(0,i.jsx)(s.li,{children:"Esse modelo natural de propriedade significa que autores sempre podem visualizar e editar seu pr\xf3prio conte\xfado"}),"\n",(0,i.jsx)(s.li,{children:"O sistema verifica tanto as permiss\xf5es do papel OU a propriedade ao lidar com opera\xe7\xf5es em artigos"}),"\n",(0,i.jsxs)(s.li,{children:["Por exemplo, mesmo sem a permiss\xe3o ",(0,i.jsx)(s.code,{children:"update:articles"}),", um autor ainda pode editar seus pr\xf3prios artigos"]}),"\n",(0,i.jsx)(s.li,{children:"Esse design reduz a necessidade de permiss\xf5es extras de papel, mantendo a seguran\xe7a"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Essa abordagem de duas camadas (pap\xe9is + propriedade) cria um sistema mais intuitivo e seguro. Editores e administradores ainda podem gerenciar todo o conte\xfado por meio das permiss\xf5es de seus pap\xe9is, enquanto autores mant\xeam o controle sobre seu pr\xf3prio trabalho."}),"\n",(0,i.jsx)(s.h2,{id:"designing-a-secure-apis",children:"Desenhando APIs seguras"}),"\n",(0,i.jsx)(s.p,{children:"Vamos come\xe7ar desenhando a funcionalidade principal do nosso CMS atrav\xe9s de seus endpoints de API:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"GET    /api/articles         # Listar todos os artigos\nGET    /api/articles/:id     # Obter um artigo espec\xedfico\nPOST   /api/articles         # Criar um novo artigo\nPATCH  /api/articles/:id     # Atualizar um artigo\nDELETE /api/articles/:id     # Excluir um artigo\nPATCH  /api/articles/:id/published  # Alterar status de publica\xe7\xe3o\n"})}),"\n",(0,i.jsx)(s.h3,{id:"implement-access-control-for-your-api",children:"Implemente controle de acesso para sua API"}),"\n",(0,i.jsx)(s.p,{children:"Para cada endpoint, precisamos considerar dois aspectos do controle de acesso:"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsx)(s.li,{children:"Propriedade do recurso - O usu\xe1rio \xe9 dono deste recurso?"}),"\n",(0,i.jsx)(s.li,{children:"Permiss\xf5es baseadas em papel - O papel do usu\xe1rio permite esta opera\xe7\xe3o?"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Veja como lidaremos com o acesso para cada endpoint:"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Endpoint"}),(0,i.jsx)(s.th,{children:"L\xf3gica de controle de acesso"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"GET /api/articles"}),(0,i.jsxs)(s.td,{children:["- Qualquer um com permiss\xe3o ",(0,i.jsx)(s.code,{children:"list:articles"}),", OU autores podem ver seus pr\xf3prios artigos"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["GET /api/articles/",":id"]}),(0,i.jsxs)(s.td,{children:["- Qualquer um com permiss\xe3o ",(0,i.jsx)(s.code,{children:"read:articles"}),", OU autor do artigo"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"POST /api/articles"}),(0,i.jsxs)(s.td,{children:["- Qualquer um com permiss\xe3o ",(0,i.jsx)(s.code,{children:"create:articles"})]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["PATCH /api/articles/",":id"]}),(0,i.jsxs)(s.td,{children:["- Qualquer um com permiss\xe3o ",(0,i.jsx)(s.code,{children:"update:articles"}),", OU autor do artigo"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["DELETE /api/articles/",":id"]}),(0,i.jsxs)(s.td,{children:["- Qualquer um com permiss\xe3o ",(0,i.jsx)(s.code,{children:"delete:articles"}),", OU autor do artigo"]})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["PATCH /api/articles/",":id","/published"]}),(0,i.jsxs)(s.td,{children:["- Apenas usu\xe1rios com permiss\xe3o ",(0,i.jsx)(s.code,{children:"publish:articles"})]})]})]})]}),"\n",(0,i.jsx)(s.h3,{id:"creating-a-permission-system-that-scales",children:"Criando um sistema de permiss\xf5es escal\xe1vel"}),"\n",(0,i.jsx)(s.p,{children:"Com base nos requisitos de acesso \xe0 API, podemos definir estas permiss\xf5es:"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Permiss\xe3o"}),(0,i.jsx)(s.th,{children:"Descri\xe7\xe3o"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["list",":articles"]}),(0,i.jsx)(s.td,{children:"Visualizar a lista de todos os artigos no sistema"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["read",":articles"]}),(0,i.jsx)(s.td,{children:"Ler o conte\xfado completo de qualquer artigo"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["create",":articles"]}),(0,i.jsx)(s.td,{children:"Criar novos artigos"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["update",":articles"]}),(0,i.jsx)(s.td,{children:"Modificar qualquer artigo"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["delete",":articles"]}),(0,i.jsx)(s.td,{children:"Excluir qualquer artigo"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["publish",":articles"]}),(0,i.jsx)(s.td,{children:"Alterar status de publica\xe7\xe3o"})]})]})]}),"\n",(0,i.jsx)(s.p,{children:"Observe que essas permiss\xf5es s\xf3 s\xe3o necess\xe1rias ao acessar recursos que voc\xea n\xe3o possui. Os propriet\xe1rios dos artigos podem automaticamente:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Visualizar seus pr\xf3prios artigos (n\xe3o precisa de ",(0,i.jsx)(s.code,{children:"read:articles"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:["Editar seus pr\xf3prios artigos (n\xe3o precisa de ",(0,i.jsx)(s.code,{children:"update:articles"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:["Excluir seus pr\xf3prios artigos (n\xe3o precisa de ",(0,i.jsx)(s.code,{children:"delete:articles"}),")"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"building-effective-roles",children:"Construindo pap\xe9is eficazes"}),"\n",(0,i.jsx)(s.p,{children:"Agora que temos nossa API e permiss\xf5es definidas, podemos criar pap\xe9is que agrupam essas permiss\xf5es logicamente:"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Permiss\xe3o/Papel"}),(0,i.jsx)(s.th,{children:"\ud83d\udc51 Admin"}),(0,i.jsx)(s.th,{children:"\ud83d\udcdd Editor"}),(0,i.jsx)(s.th,{children:"\u270d\ufe0f Autor"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.strong,{children:"Descri\xe7\xe3o"})}),(0,i.jsx)(s.td,{children:"Acesso total ao sistema para gerenciamento completo"}),(0,i.jsx)(s.td,{children:"Pode ver todos os artigos e controlar publica\xe7\xe3o"}),(0,i.jsx)(s.td,{children:"Pode criar novos artigos no sistema"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["list",":articles"]}),(0,i.jsx)(s.td,{children:"\u2705"}),(0,i.jsx)(s.td,{children:"\u2705"}),(0,i.jsx)(s.td,{children:"\u274c"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["read",":articles"]}),(0,i.jsx)(s.td,{children:"\u2705"}),(0,i.jsx)(s.td,{children:"\u2705"}),(0,i.jsx)(s.td,{children:"\u274c"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["create",":articles"]}),(0,i.jsx)(s.td,{children:"\u2705"}),(0,i.jsx)(s.td,{children:"\u274c"}),(0,i.jsx)(s.td,{children:"\u2705"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["update",":articles"]}),(0,i.jsx)(s.td,{children:"\u2705"}),(0,i.jsx)(s.td,{children:"\u274c"}),(0,i.jsx)(s.td,{children:"\u274c"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["delete",":articles"]}),(0,i.jsx)(s.td,{children:"\u2705"}),(0,i.jsx)(s.td,{children:"\u274c"}),(0,i.jsx)(s.td,{children:"\u274c"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:["publish",":articles"]}),(0,i.jsx)(s.td,{children:"\u2705"}),(0,i.jsx)(s.td,{children:"\u2705"}),(0,i.jsx)(s.td,{children:"\u274c"})]})]})]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Nota"}),": Autores t\xeam automaticamente permiss\xf5es de leitura/atualiza\xe7\xe3o/exclus\xe3o para seus pr\xf3prios artigos, independentemente das permiss\xf5es do papel."]}),"\n",(0,i.jsx)(s.p,{children:"Cada papel \xe9 desenhado com responsabilidades espec\xedficas em mente:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Admin"}),": Tem controle total sobre o CMS, incluindo todas as opera\xe7\xf5es em artigos"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Editor"}),": Foca na revis\xe3o de conte\xfado e gerenciamento de publica\xe7\xe3o"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Autor"}),": Especialista em cria\xe7\xe3o de conte\xfado"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Essa estrutura de pap\xe9is cria uma separa\xe7\xe3o clara de responsabilidades:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Autores focam na cria\xe7\xe3o de conte\xfado"}),"\n",(0,i.jsx)(s.li,{children:"Editores gerenciam a qualidade e visibilidade do conte\xfado"}),"\n",(0,i.jsx)(s.li,{children:"Admins mant\xeam o controle geral do sistema"}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"config-rbac-in-logto",children:"Configurando RBAC no Logto"}),"\n",(0,i.jsxs)(s.p,{children:["Antes de come\xe7ar, voc\xea precisa criar uma conta no ",(0,i.jsx)(s.a,{href:"https://cloud.logto.io",children:"Logto Cloud"}),", ou tamb\xe9m pode usar uma inst\xe2ncia Logto auto-hospedada utilizando a ",(0,i.jsx)(s.a,{href:"/logto-oss",children:"vers\xe3o Logto OSS"}),"."]}),"\n",(0,i.jsx)(s.p,{children:"Mas para este tutorial, usaremos o Logto Cloud pela simplicidade."}),"\n",(0,i.jsx)(s.h3,{id:"setting-up-your-application",children:"Configurando seu aplicativo"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:['V\xe1 em "Applications" no Logto Console para criar um novo aplicativo react',"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Nome do aplicativo: Sistema de Gerenciamento de Conte\xfado"}),"\n",(0,i.jsx)(s.li,{children:"Tipo de aplicativo: Aplicativo Web Tradicional"}),"\n",(0,i.jsxs)(s.li,{children:["Redirect URIs: ",(0,i.jsx)(s.a,{href:"http://localhost:5173/callback",children:"http://localhost:5173/callback"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://uploads.strapi.logto.io/cms_application_3ed42f2256.png",alt:"Aplicativo React CMS"})}),"\n",(0,i.jsx)(s.h3,{id:"configuring-api-resources-and-permissions",children:"Configurando recursos de API e permiss\xf5es"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsxs)(s.li,{children:['V\xe1 em "API Resources" no Logto Console para criar um novo recurso de API',"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Nome da API: CMS API"}),"\n",(0,i.jsxs)(s.li,{children:["Identificador da API: ",(0,i.jsx)(s.a,{href:"https://api.cms.com",children:"https://api.cms.com"})]}),"\n",(0,i.jsxs)(s.li,{children:["Adicione permiss\xf5es ao recurso de API","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"list:articles"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"read:articles"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"create:articles"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"update:articles"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"publish:articles"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"delete:articles"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://uploads.strapi.logto.io/cms_api_resource_b15ae2b91a.png",alt:"Detalhes do recurso de API CMS"})}),"\n",(0,i.jsx)(s.h3,{id:"creating-roles",children:"Criando pap\xe9is"}),"\n",(0,i.jsx)(s.p,{children:"V\xe1 em Roles no Logto Console para criar os seguintes pap\xe9is para o CMS"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Admin","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"com todas as permiss\xf5es"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Editor","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["com ",(0,i.jsx)(s.code,{children:"read:articles"}),", ",(0,i.jsx)(s.code,{children:"list:articles"}),", ",(0,i.jsx)(s.code,{children:"publish:articles"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Autor","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["com ",(0,i.jsx)(s.code,{children:"create:articles"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://uploads.strapi.logto.io/admin_role_53edb35ecf.png",alt:"Papel Admin"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://uploads.strapi.logto.io/publisher_role_2ac205cc32.png",alt:"Papel Editor"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://uploads.strapi.logto.io/author_role_f89cd99543.png",alt:"Papel Autor"})}),"\n",(0,i.jsx)(s.h3,{id:"assigning-roles-to-users",children:"Atribuindo pap\xe9is aos usu\xe1rios"}),"\n",(0,i.jsx)(s.p,{children:'V\xe1 at\xe9 a se\xe7\xe3o "User management" no Logto Console para criar usu\xe1rios.'}),"\n",(0,i.jsx)(s.p,{children:'Na aba "Roles" dos detalhes do usu\xe1rio, voc\xea pode atribuir pap\xe9is ao usu\xe1rio.'}),"\n",(0,i.jsx)(s.p,{children:"No nosso exemplo, criamos 3 usu\xe1rios com os seguintes pap\xe9is:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Alex: Admin"}),"\n",(0,i.jsx)(s.li,{children:"Bob: Editor"}),"\n",(0,i.jsx)(s.li,{children:"Charlie: Autor"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://uploads.strapi.logto.io/user_management_c0bc17119f.png",alt:"Gerenciamento de usu\xe1rios"})}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://uploads.strapi.logto.io/user_details_alex_702f96ef9a.png",alt:"Detalhes do usu\xe1rio - Alex"})}),"\n",(0,i.jsx)(s.admonition,{type:"note",children:(0,i.jsxs)(s.p,{children:["Para fins de demonstra\xe7\xe3o, criamos esses recursos e configura\xe7\xf5es pelo Logto Console. Em projetos reais, voc\xea pode criar esses recursos e configura\xe7\xf5es programaticamente usando a ",(0,i.jsx)(s.a,{href:"/integrate-logto/interact-with-management-api",children:"Management API"})," fornecida pelo Logto."]})}),"\n",(0,i.jsx)(s.h2,{id:"integrate-your-frontend-with-logto-rbac",children:"Integre seu frontend com o RBAC do Logto"}),"\n",(0,i.jsx)(s.p,{children:"Agora que configuramos o RBAC no Logto, podemos come\xe7ar a integr\xe1-lo ao nosso frontend."}),"\n",(0,i.jsxs)(s.p,{children:["Primeiro, siga os ",(0,i.jsx)(s.a,{href:"/quick-starts",children:"Logto Quick Starts"})," para integrar o Logto ao seu aplicativo."]}),"\n",(0,i.jsxs)(s.p,{children:["No nosso exemplo, usamos ",(0,i.jsx)(s.a,{href:"/quick-starts/react",children:"React"})," para demonstra\xe7\xe3o."]}),"\n",(0,i.jsx)(s.p,{children:"Depois de configurar o Logto em seu aplicativo, precisamos adicionar as configura\xe7\xf5es de RBAC para o Logto funcionar."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-tsx",children:"// frontend/src/App.tsx\n\nconst logtoConfig: LogtoConfig = {\n  appId: LOGTO_APP_ID, // O app ID que voc\xea criou no Logto Console\n  endpoint: LOGTO_ENDPOINT, // O endpoint que voc\xea criou no Logto Console\n  resources: [API_RESOURCE], // O identificador do recurso de API criado no Logto Console, ex: https://api.cms.com\n  // Todos os escopos que voc\xea pode querer requisitar do recurso de API no frontend\n  scopes: [\n    'list:articles',\n    'create:articles',\n    'read:articles',\n    'update:articles',\n    'delete:articles',\n    'publish:articles',\n  ],\n};\n"})}),"\n",(0,i.jsx)(s.p,{children:"Lembre-se de sair e entrar novamente para que essa altera\xe7\xe3o tenha efeito se voc\xea j\xe1 estiver autenticado."}),"\n",(0,i.jsx)(s.p,{children:"Quando o usu\xe1rio faz login com o Logto e solicita um token de acesso para os recursos de API especificados acima, o Logto adicionar\xe1 os escopos (permiss\xf5es) relacionados ao papel do usu\xe1rio ao token de acesso."}),"\n",(0,i.jsxs)(s.p,{children:["Voc\xea pode usar ",(0,i.jsx)(s.code,{children:"getAccessTokenClaims"})," do hook ",(0,i.jsx)(s.code,{children:"useLogto"})," para obter os escopos do token de acesso."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-tsx",children:"// frontend/src/hooks/use-user-data.ts\n\nimport { useLogto } from '@logto/react';\nimport { API_RESOURCE } from '../config';\nimport { useState, useEffect } from 'react';\n\nexport const useUserData = () => {\n  const { getAccessTokenClaims } = useLogto();\n  const [userScopes, setUserScopes] = useState<string[]>([]);\n  const [userId, setUserId] = useState<string>();\n\n  useEffect(() => {\n    const fetchScopes = async () => {\n      const token = await getAccessTokenClaims(API_RESOURCE);\n      setUserScopes(token?.scope?.split(' ') ?? []);\n      setUserId(token?.sub);\n    };\n\n    fetchScopes();\n  }, [getAccessTokenClaims]);\n\n  return { userId, userScopes };\n};\n"})}),"\n",(0,i.jsxs)(s.p,{children:["E voc\xea pode usar o ",(0,i.jsx)(s.code,{children:"userScopes"})," para verificar se o usu\xe1rio tem permiss\xe3o para acessar o recurso."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-tsx",children:"// frontend/src/pages/Dashboard.tsx\n\nconst Dashboard = () => {\n  const { userId, userScopes } = useUserData();\n  // ...\n\n  return (\n    <div>\n      {/* ... */}\n      {(userScopes.includes('delete:articles') || article.ownerId === userId) && (\n        <button\n          onClick={() => handleDelete(article.id)}\n          className=\"text-red-600 hover:text-red-900\"\n        >\n          Excluir\n        </button>\n      )}\n    </div>\n  );\n};\n"})}),"\n",(0,i.jsx)(s.h2,{id:"integrate-your-backend-with-logto-rbac",children:"Integre seu backend com o RBAC do Logto"}),"\n",(0,i.jsx)(s.p,{children:"Agora, \xe9 hora de integrar o RBAC do Logto ao seu backend."}),"\n",(0,i.jsx)(s.h3,{id:"backend-authorization-middleware",children:"Middleware de autoriza\xe7\xe3o no backend"}),"\n",(0,i.jsx)(s.p,{children:"Primeiro, precisamos adicionar um middleware no backend para verificar as permiss\xf5es do usu\xe1rio, conferir se o usu\xe1rio est\xe1 autenticado e determinar se ele tem as permiss\xf5es necess\xe1rias para acessar certas APIs."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-javascript",children:"// backend/src/middleware/auth.js\n\nconst { createRemoteJWKSet, jwtVerify } = require('jose');\n\nconst getTokenFromHeader = (headers) => {\n  const { authorization } = headers;\n  const bearerTokenIdentifier = 'Bearer';\n\n  if (!authorization) {\n    throw new Error('Authorization header missing');\n  }\n\n  if (!authorization.startsWith(bearerTokenIdentifier)) {\n    throw new Error('Authorization token type not supported');\n  }\n\n  return authorization.slice(bearerTokenIdentifier.length + 1);\n};\n\nconst hasScopes = (tokenScopes, requiredScopes) => {\n  if (!requiredScopes || requiredScopes.length === 0) {\n    return true;\n  }\n  const scopeSet = new Set(tokenScopes);\n  return requiredScopes.every((scope) => scopeSet.has(scope));\n};\n\nconst verifyJwt = async (token) => {\n  const JWKS = createRemoteJWKSet(new URL(process.env.LOGTO_JWKS_URL));\n\n  const { payload } = await jwtVerify(token, JWKS, {\n    issuer: process.env.LOGTO_ISSUER,\n    audience: process.env.LOGTO_API_RESOURCE,\n  });\n\n  return payload;\n};\n\nconst requireAuth = (requiredScopes = []) => {\n  return async (req, res, next) => {\n    try {\n      // Extrai o token\n      const token = getTokenFromHeader(req.headers);\n\n      // Verifica o token\n      const payload = await verifyJwt(token);\n\n      // Adiciona informa\xe7\xf5es do usu\xe1rio \xe0 requisi\xe7\xe3o\n      req.user = {\n        id: payload.sub,\n        scopes: payload.scope?.split(' ') || [],\n      };\n\n      // Verifica os escopos necess\xe1rios\n      if (!hasScopes(req.user.scopes, requiredScopes)) {\n        throw new Error('Insufficient permissions');\n      }\n\n      next();\n    } catch (error) {\n      res.status(401).json({ error: 'Unauthorized' });\n    }\n  };\n};\n\nmodule.exports = {\n  requireAuth,\n  hasScopes,\n};\n"})}),"\n",(0,i.jsx)(s.p,{children:"Como voc\xea pode ver, neste middleware, verificamos se a requisi\xe7\xe3o do frontend cont\xe9m um token de acesso v\xe1lido e conferimos se o p\xfablico do token de acesso corresponde ao recurso de API que criamos no Logto Console."}),"\n",(0,i.jsx)(s.p,{children:"O motivo de verificar o recurso de API \xe9 que nosso recurso de API representa, de fato, os recursos do backend do nosso CMS, e todas as permiss\xf5es do CMS est\xe3o associadas a esse recurso de API."}),"\n",(0,i.jsx)(s.p,{children:"Como esse recurso de API representa os recursos do CMS no Logto, em nosso c\xf3digo frontend, inclu\xedmos o respectivo token de acesso ao fazer requisi\xe7\xf5es de API para o backend:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-typescript",children:"// frontend/src/hooks/use-api.ts\nexport const useApi = () => {\n  const { getAccessToken } = useLogto();\n\n  return useMemo(\n    () =>\n      async (endpoint: string, options: RequestInit = {}) => {\n        try {\n          // Obt\xe9m o token de acesso para o recurso de API\n          const token = await getAccessToken(API_RESOURCE);\n\n          if (!token) {\n            throw new ApiRequestError('Failed to get access token');\n          }\n\n          const response = await fetch(`${API_BASE_URL}${endpoint}`, {\n            ...options,\n            headers: {\n              'Content-Type': 'application/json',\n              // Adiciona o token de acesso ao cabe\xe7alho da requisi\xe7\xe3o\n              Authorization: `Bearer ${token}`,\n              ...options.headers,\n            },\n          });\n\n          // ... trata resposta\n\n          return await response.json();\n        } catch (error) {\n          // ... tratamento de erro\n        }\n      },\n    [getAccessToken]\n  );\n};\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Agora podemos usar o middleware ",(0,i.jsx)(s.code,{children:"requireAuth"})," para proteger nossos endpoints de API."]}),"\n",(0,i.jsx)(s.h3,{id:"protecting-api-endpoints",children:"Protegendo endpoints de API"}),"\n",(0,i.jsxs)(s.p,{children:["Para APIs que devem ser acess\xedveis apenas a usu\xe1rios com permiss\xf5es espec\xedficas, podemos adicionar restri\xe7\xf5es diretamente no middleware. Por exemplo, a API de cria\xe7\xe3o de artigos deve ser acess\xedvel apenas a usu\xe1rios com a permiss\xe3o ",(0,i.jsx)(s.code,{children:"create:articles"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-javascript",children:"// backend/src/routes/articles.js\n\nconst { requireAuth } = require('../middleware/auth');\n\nrouter.post('/articles', requireAuth(['create:articles']), async (req, res) => {\n  // ...\n});\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Para APIs que precisam verificar tanto permiss\xf5es quanto propriedade do recurso, podemos usar a fun\xe7\xe3o ",(0,i.jsx)(s.code,{children:"hasScopes"}),". Por exemplo, na API de listagem de artigos, usu\xe1rios com o escopo ",(0,i.jsx)(s.code,{children:"list:articles"})," podem acessar todos os artigos, enquanto autores podem acessar apenas os artigos que criaram:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-javascript",children:"// backend/src/routes/articles.js\n\nconst { requireAuth, hasScopes } = require('../middleware/auth');\n\nrouter.get('/articles', requireAuth(), async (req, res) => {\n  try {\n    // Se o usu\xe1rio tem o escopo list:articles, retorna todos os artigos\n    if (hasScopes(req.user.scopes, ['list:articles'])) {\n      const articles = await articleDB.list();\n      return res.json(articles);\n    }\n\n    // Caso contr\xe1rio, retorna apenas os artigos do usu\xe1rio\n    const articles = await articleDB.listByOwner(req.user.id);\n    res.json(articles);\n  } catch (error) {\n    res.status(500).json({ error: 'Failed to fetch articles' });\n  }\n});\n"})}),"\n",(0,i.jsxs)(s.p,{children:["Neste ponto, conclu\xedmos a implementa\xe7\xe3o do RBAC. Voc\xea pode conferir ",(0,i.jsx)(s.a,{href:"https://github.com/logto-io/rbac-sample",children:"o c\xf3digo-fonte completo"})," para ver a implementa\xe7\xe3o completa."]}),"\n",(0,i.jsx)(s.h2,{id:"test-the-cms-rbac-implementation",children:"Testando a implementa\xe7\xe3o do RBAC no CMS"}),"\n",(0,i.jsx)(s.p,{children:"Agora, vamos testar nossa implementa\xe7\xe3o do RBAC no CMS usando os tr\xeas usu\xe1rios que acabamos de criar."}),"\n",(0,i.jsx)(s.admonition,{type:"note",children:(0,i.jsx)(s.p,{children:'Se voc\xea perceber que n\xe3o consegue fazer login com as credenciais dos usu\xe1rios criados em "User Management", ser\xe1 necess\xe1rio habilitar o m\xe9todo de login apropriado primeiro. V\xe1 em "Sign-in Experience" no Logto Console e habilite seu m\xe9todo de autentica\xe7\xe3o preferido (como Email + Senha ou Nome de usu\xe1rio + Senha).'})}),"\n",(0,i.jsx)(s.p,{children:"Primeiro, vamos fazer login como Alex e Charles, respectivamente, e criar alguns artigos."}),"\n",(0,i.jsx)(s.p,{children:"Como Alex tem o papel de Admin, ele pode criar, excluir, atualizar, publicar e visualizar todos os artigos."}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://uploads.strapi.logto.io/cms_dashboard_alex_a11863a94b.png",alt:"Painel CMS - Alex"})}),"\n",(0,i.jsx)(s.p,{children:"Charles, com o papel de Autor, s\xf3 pode criar seus pr\xf3prios artigos e pode apenas visualizar, atualizar e excluir artigos que ele mesmo criou."}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://uploads.strapi.logto.io/cms_dashboard_charles_05f610066a.png",alt:"Painel CMS - Charles - Lista de artigos"})}),"\n",(0,i.jsx)(s.p,{children:"Bob, com o papel de Editor, pode visualizar e publicar todos os artigos, mas n\xe3o pode criar, atualizar ou excluir."}),"\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.img,{src:"https://uploads.strapi.logto.io/cms_dashboard_bob_421a429b69.png",alt:"Painel CMS - Bob"})}),"\n",(0,i.jsx)(s.h2,{id:"conclusion",children:"Conclus\xe3o"}),"\n",(0,i.jsx)(s.p,{children:"Parab\xe9ns! Voc\xea aprendeu como implementar um sistema RBAC robusto em seu aplicativo."}),"\n",(0,i.jsxs)(s.p,{children:["Para cen\xe1rios mais complexos, como construir aplicativos multi-inquilino, o Logto oferece suporte abrangente a organiza\xe7\xf5es. Confira nosso guia ",(0,i.jsx)(s.a,{href:"/use-cases/multi-tenancy/build-multi-tenant-saas-application",children:"Construa um aplicativo SaaS multi-inquilino: Um guia completo do design \xe0 implementa\xe7\xe3o"})," para saber mais sobre como implementar controle de acesso em toda a organiza\xe7\xe3o."]}),"\n",(0,i.jsx)(s.p,{children:"Boas codifica\xe7\xf5es! \ud83d\ude80"})]})}function p(e={}){const{wrapper:s}={...(0,n.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},79621:(e,s,r)=>{r.d(s,{R:()=>a,x:()=>t});var o=r(58101);const i={},n=o.createContext(i);function a(e){const s=o.useContext(n);return o.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),o.createElement(n.Provider,{value:s},e.children)}}}]);