"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[7920],{71197:(e,n,r)=>{r.d(n,{Ay:()=>t,RM:()=>a});var o=r(25105),s=r(79621);const a=[];function i(e){const n={admonition:"admonition",p:"p",...(0,s.R)(),...e.components};return(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:['Este guia assume que voc\xea criou um Aplicativo do tipo "',e.type,'" no Console de Administra\xe7\xe3o.']})})}function t(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(i,{...e})}):i(e)}},46443:(e,n,r)=>{r.d(n,{Ay:()=>t,RM:()=>a});var o=r(25105),s=r(79621);const a=[];function i(e){const n={p:"p",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["Vamos mudar para a p\xe1gina de detalhes do Aplicativo no Logto Console. Adicione um URI de redirecionamento ",(0,o.jsx)("code",{children:e.redirectUri}),' e clique em "Salvar altera\xe7\xf5es".']}),"\n",(0,o.jsx)("img",{alt:"URI de redirecionamento no Logto Console",src:e.figureSrc,width:"600px"})]})}function t(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(i,{...e})}):i(e)}},20045:(e,n,r)=>{r.d(n,{Ay:()=>t,RM:()=>a});var o=r(25105),s=r(79621);const a=[];function i(e){const{Url:n}={...(0,s.R)(),...e.components};return n||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n,{href:"/end-user-flows",children:" Fluxos do usu\xe1rio final: fluxos de autentica\xe7\xe3o, fluxos de conta e fluxos de organiza\xe7\xe3o "}),"\n",(0,o.jsx)(n,{href:"/connectors",children:" Configurar conectores "}),"\n",(0,o.jsx)(n,{href:"/authorization",children:" Autoriza\xe7\xe3o (Authorization) "})]})}function t(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(i,{...e})}):i(e)}},47540:(e,n,r)=>{r.d(n,{Ay:()=>t,RM:()=>a});var o=r(25105),s=r(79621);const a=[];function i(e){const n={admonition:"admonition",p:"p",...(0,s.R)(),...e.components};return(0,o.jsxs)(n.admonition,{type:"tip",children:[(0,o.jsx)("p",{children:(0,o.jsx)(n.p,{children:'Voc\xea pode encontrar e copiar o "App Secret" na p\xe1gina de detalhes do aplicativo no Admin Console:'})}),(0,o.jsx)("img",{alt:"App Secret",src:"/img/assets/app-secret.png",width:"586px"})]})}function t(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(i,{...e})}):i(e)}},81427:(e,n,r)=>{r.d(n,{Ay:()=>t,RM:()=>a});var o=r(25105),s=r(79621);const a=[{value:"Sobre o login baseado em redirecionamento",id:"regarding-redirect-based-sign-in",level:3}];function i(e){const n={a:"a",h3:"h3",li:"li",ol:"ol",p:"p",...(0,s.R)(),...e.components},{Details:r,MainSiteUrl:a}=n;return r||c("Details",!0),a||c("MainSiteUrl",!0),(0,o.jsxs)(r,{children:[(0,o.jsx)("summary",{children:(0,o.jsx)(n.h3,{id:"regarding-redirect-based-sign-in",children:"Sobre o login baseado em redirecionamento"})}),(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Este processo de autentica\xe7\xe3o segue o protocolo ",(0,o.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html",children:"OpenID Connect (OIDC)"}),", e o Logto aplica medidas de seguran\xe7a rigorosas para proteger o login do usu\xe1rio."]}),"\n",(0,o.jsx)(n.li,{children:"Se voc\xea tiver v\xe1rios aplicativos, pode usar o mesmo provedor de identidade (Logto). Uma vez que o usu\xe1rio faz login em um aplicativo, o Logto completar\xe1 automaticamente o processo de login quando o usu\xe1rio acessar outro aplicativo."}),"\n"]}),(0,o.jsxs)(n.p,{children:["Para saber mais sobre a l\xf3gica e os benef\xedcios do login baseado em redirecionamento, veja ",(0,o.jsx)(a,{href:"/concepts/sign-in-experience",children:"Experi\xeancia de login do Logto explicada"}),"."]})]})}function t(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(i,{...e})}):i(e)}function c(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},61997:(e,n,r)=>{r.d(n,{Ay:()=>t,RM:()=>a});var o=r(25105),s=r(79621);const a=[];function i(e){const n={admonition:"admonition",p:"p",...(0,s.R)(),...e.components};return(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["Antes de chamar ",(0,o.jsx)("code",{children:e.calling}),", certifique-se de que voc\xea configurou corretamente o URI de redirecionamento no Admin Console."]})})}function t(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(i,{...e})}):i(e)}},84057:(e,n,r)=>{r.d(n,{Ay:()=>c,RM:()=>i});var o=r(25105),s=r(79621),a=r(81427);const i=[...a.RM];function t(e){const n={hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"Antes de entrarmos nos detalhes, aqui est\xe1 uma vis\xe3o geral r\xe1pida da experi\xeancia do usu\xe1rio final. O processo de login pode ser simplificado da seguinte forma:"}),"\n",(0,o.jsx)(n.mermaid,{value:"graph LR\n    A(Seu app) --\x3e|1\\. Iniciar login| B(Logto)\n    B --\x3e|2\\. Finalizar login| A"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Seu app invoca o m\xe9todo de login."}),"\n",(0,o.jsx)(n.li,{children:"O usu\xe1rio \xe9 redirecionado para a p\xe1gina de login do Logto. Para aplicativos nativos, o navegador do sistema \xe9 aberto."}),"\n",(0,o.jsx)(n.li,{children:"O usu\xe1rio faz login e \xe9 redirecionado de volta para seu app (configurado como o URI de redirecionamento)."}),"\n"]}),"\n",(0,o.jsx)(a.Ay,{}),"\n",(0,o.jsx)(n.hr,{})]})}function c(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(t,{...e})}):t(e)}},19320:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>x,contentTitle:()=>m,default:()=>v,frontMatter:()=>g,metadata:()=>o,toc:()=>f});const o=JSON.parse('{"id":"quick-starts/generic/traditional/README","title":"Adicionar autentica\xe7\xe3o ao seu aplicativo web tradicional","description":"Seu aplicativo pode rodar no lado do servidor em vez do navegador, usando frameworks como Django, Laravel, etc. Isso \xe9 chamado de aplicativo web tradicional. Se voc\xea n\xe3o encontrar um SDK adequado nesta p\xe1gina, provavelmente precisar\xe1 integrar manualmente.","source":"@site/i18n/pt-BR/docusaurus-plugin-content-docs/current/quick-starts/generic/traditional/README.mdx","sourceDirName":"quick-starts/generic/traditional","slug":"/quick-starts/traditional-web","permalink":"/pt-BR/quick-starts/traditional-web","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/pt-BR/docusaurus-plugin-content-docs/current/quick-starts/generic/traditional/README.mdx","tags":[],"version":"current","frontMatter":{"slug":"/quick-starts/traditional-web","sidebar_label":"Web tradicional","sidebar_custom_props":{"description":"Integre o Logto com aplicativos web tradicionais que rodam no servidor."}},"sidebar":"quickStartSidebar","previous":{"title":"M\xe1quina para m\xe1quina","permalink":"/pt-BR/quick-starts/m2m"},"next":{"title":"Hasura","permalink":"/pt-BR/quick-starts/hasura"}}');var s=r(25105),a=r(79621),i=r(38552),t=r(22002),c=r(71197),l=r(46443),d=r(20045),u=r(47540),p=r(61997),h=r(84057);const g={slug:"/quick-starts/traditional-web",sidebar_label:"Web tradicional",sidebar_custom_props:{description:"Integre o Logto com aplicativos web tradicionais que rodam no servidor."}},m="Adicionar autentica\xe7\xe3o ao seu aplicativo web tradicional",x={},f=[...c.RM,{value:"Obter c\xf3digo-fonte",id:"get-source-code",level:2},{value:"Iniciar um projeto Express",id:"start-an-express-project",level:2},{value:"Instalar depend\xeancias",id:"install-dependencies",level:2},{value:"Usar sess\xe3o",id:"use-session",level:2},{value:"Implementar fun\xe7\xf5es para autenticar usu\xe1rios",id:"implement-functions-to-authenticate-users",level:2},...u.RM,{value:"Fazer login",id:"sign-in",level:2},...h.RM,{value:"Configurar Redirect URI",id:"configure-redirect-uri",level:3},...l.RM,{value:"Implementar rota de login",id:"implement-sign-in-route",level:3},...p.RM,{value:"Fazer logout",id:"sign-out",level:2},{value:"Acessar recurso protegido",id:"access-protected-resource",level:2},{value:"Leituras adicionais",id:"further-readings",level:2},...d.RM];function j(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components},{Url:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"adicionar-autentica\xe7\xe3o-ao-seu-aplicativo-web-tradicional",children:"Adicionar autentica\xe7\xe3o ao seu aplicativo web tradicional"})}),"\n",(0,s.jsx)(c.Ay,{type:"Traditional web"}),"\n",(0,s.jsx)(n.p,{children:"Seu aplicativo pode rodar no lado do servidor em vez do navegador, usando frameworks como Django, Laravel, etc. Isso \xe9 chamado de aplicativo web tradicional. Se voc\xea n\xe3o encontrar um SDK adequado nesta p\xe1gina, provavelmente precisar\xe1 integrar manualmente."}),"\n",(0,s.jsx)(n.p,{children:"Este artigo orienta voc\xea sobre como concluir isso passo a passo. E tomamos o Express no Node.js como exemplo."}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["Este artigo n\xe3o \xe9 apenas para Express, e se voc\xea estiver usando outros frameworks ou at\xe9 mesmo outras linguagens, pode substituir ",(0,s.jsx)(n.code,{children:"@logto/js"})," pelo SDK principal da outra linguagem e, em seguida, ajustar algumas das etapas."]})}),"\n",(0,s.jsx)(n.h2,{id:"get-source-code",children:"Obter c\xf3digo-fonte"}),"\n",(0,s.jsxs)(n.p,{children:["Voc\xea pode ir ao ",(0,s.jsx)(n.a,{href:"https://github.com/logto-io/express-example",children:"GitHub"})," para obter o c\xf3digo final deste guia."]}),"\n",(0,s.jsx)(n.h2,{id:"start-an-express-project",children:"Iniciar um projeto Express"}),"\n",(0,s.jsxs)(n.p,{children:["Com ",(0,s.jsx)(n.code,{children:"express-generator"}),", voc\xea pode iniciar rapidamente um projeto Express."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"mkdir express-logto\ncd express-logto\nnpx express-generator\n"})}),"\n",(0,s.jsx)(n.h2,{id:"install-dependencies",children:"Instalar depend\xeancias"}),"\n",(0,s.jsx)(n.p,{children:"O aplicativo de demonstra\xe7\xe3o precisar\xe1 de 4 depend\xeancias:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"@logto/js"}),": SDK principal do Logto para JavaScript."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"node-fetch"}),": C\xf3digo m\xednimo para uma API compat\xedvel com ",(0,s.jsx)(n.code,{children:"window.fetch"})," no runtime Node.js."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"express-session"}),": Um middleware de sess\xe3o, usaremos a sess\xe3o para armazenar tokens de usu\xe1rio."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"js-base64"}),": Mais um transcodificador Base64."]}),"\n"]}),"\n",(0,s.jsxs)(t.A,{children:[(0,s.jsx)(i.A,{value:"npm",label:"npm",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"npm i @logto/js node-fetch@v2 express-session js-base64\n"})})}),(0,s.jsx)(i.A,{value:"yarn",label:"Yarn",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"yarn add @logto/js node-fetch@v2 express-session js-base64\n"})})}),(0,s.jsx)(i.A,{value:"pnpm",label:"pnpm",children:(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pnpm add @logto/js node-fetch@v2 express-session js-base64\n"})})})]}),"\n",(0,s.jsx)(n.h2,{id:"use-session",children:"Usar sess\xe3o"}),"\n",(0,s.jsx)(n.p,{children:"Quando os usu\xe1rios fazem login, eles receber\xe3o um conjunto de tokens (Tokens de acesso, Tokens de ID, Tokens de atualiza\xe7\xe3o) e dados de intera\xe7\xe3o, e a sess\xe3o \xe9 um excelente lugar para armazen\xe1-los."}),"\n",(0,s.jsxs)(n.p,{children:["Instalamos ",(0,s.jsx)(n.a,{href:"https://github.com/expressjs/session",children:"express-session"})," na etapa anterior, ent\xe3o agora vamos simplesmente adicionar o seguinte c\xf3digo para configur\xe1-lo:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// app.js\n\nconst session = require('express-session');\n\napp.use(\n  session({\n    secret: 'keyboard cat', // Altere para sua pr\xf3pria chave secreta\n    cookie: { maxAge: 86400 },\n  })\n);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"implement-functions-to-authenticate-users",children:"Implementar fun\xe7\xf5es para autenticar usu\xe1rios"}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["Assumimos que o aplicativo est\xe1 rodando em ",(0,s.jsx)(n.code,{children:"http://localhost:3000"})," nos trechos de c\xf3digo a seguir."]})}),"\n",(0,s.jsx)(n.p,{children:"Nesta etapa, precisamos implementar as seguintes fun\xe7\xf5es de autentica\xe7\xe3o:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"getSignInUrl"}),": constr\xf3i e retorna uma URL completa do Servidor de Autoriza\xe7\xe3o Logto para a qual os usu\xe1rios ser\xe3o redirecionados."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"handleSignIn"}),": analisa a URL de callback ap\xf3s o processo de autentica\xe7\xe3o ser conclu\xeddo, obt\xe9m o par\xe2metro de consulta de c\xf3digo e, em seguida, busca tokens (um token de acesso, o token de atualiza\xe7\xe3o e um token de ID) para concluir o processo de login."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"refreshTokens"}),": troca um novo token de acesso usando o token de atualiza\xe7\xe3o."]}),"\n"]}),"\n",(0,s.jsx)(u.Ay,{}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// logto.js\n\nconst {\n  withReservedScopes,\n  fetchOidcConfig,\n  discoveryPath,\n  generateSignInUri,\n  verifyAndParseCodeFromCallbackUri,\n  fetchTokenByAuthorizationCode,\n  fetchTokenByRefreshToken,\n} = require('@logto/js');\nconst fetch = require('node-fetch');\nconst { randomFillSync, createHash } = require('crypto');\nconst { fromUint8Array } = require('js-base64');\n\nconst config = {\n  endpoint: 'https://logto.dev',\n  appId: 'foo',\n  appSecret: '<your-app-secret-copied-from-console>',\n  redirectUri: 'http://localhost:3000/callback', // Voc\xea pode precisar substitu\xed-lo pelo endere\xe7o de produ\xe7\xe3o do seu aplicativo\n  scopes: withReservedScopes().split(' '),\n};\n\nconst requester = (input, init) => {\n  const { appId, appSecret } = config;\n\n  return fetch(input, {\n    ...init,\n    headers: {\n      ...init?.headers,\n      authorization: `Basic ${Buffer.from(`${appId}:${appSecret}`, 'utf8').toString('base64')}`,\n    },\n  });\n};\n\nconst generateRandomString = (length = 64) => {\n  return fromUint8Array(randomFillSync(new Uint8Array(length)), true);\n};\n\nconst generateCodeChallenge = async (codeVerifier) => {\n  const encodedCodeVerifier = new TextEncoder().encode(codeVerifier);\n  const hash = createHash('sha256');\n  hash.update(encodedCodeVerifier);\n  const codeChallenge = hash.digest();\n  return fromUint8Array(codeChallenge, true);\n};\n\nconst getOidcConfig = async () => {\n  return fetchOidcConfig(new URL(discoveryPath, config.endpoint).toString(), requester);\n};\n\nexports.getSignInUrl = async () => {\n  const { authorizationEndpoint } = await getOidcConfig();\n  const codeVerifier = generateRandomString();\n  const codeChallenge = await generateCodeChallenge(codeVerifier);\n  const state = generateRandomString();\n\n  const { redirectUri, scopes, appId: clientId } = config;\n\n  const signInUri = generateSignInUri({\n    authorizationEndpoint,\n    clientId,\n    redirectUri: redirectUri,\n    codeChallenge,\n    state,\n    scopes,\n  });\n\n  return { redirectUri, codeVerifier, state, signInUri };\n};\n\nexports.handleSignIn = async (signInSession, callbackUri) => {\n  const { redirectUri, state, codeVerifier } = signInSession;\n  const code = verifyAndParseCodeFromCallbackUri(callbackUri, redirectUri, state);\n\n  const { appId: clientId } = config;\n  const { tokenEndpoint } = await getOidcConfig();\n  const codeTokenResponse = await fetchTokenByAuthorizationCode(\n    {\n      clientId,\n      tokenEndpoint,\n      redirectUri,\n      codeVerifier,\n      code,\n    },\n    requester\n  );\n\n  return codeTokenResponse;\n};\n\nexports.refreshTokens = async (refreshToken) => {\n  const { appId: clientId, scopes } = config;\n  const { tokenEndpoint } = await getOidcConfig();\n  const tokenResponse = await fetchTokenByRefreshToken(\n    {\n      clientId,\n      tokenEndpoint,\n      refreshToken,\n      scopes,\n    },\n    requester\n  );\n\n  return tokenResponse;\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"sign-in",children:"Fazer login"}),"\n",(0,s.jsx)(h.Ay,{}),"\n",(0,s.jsx)(n.h3,{id:"configure-redirect-uri",children:"Configurar Redirect URI"}),"\n",(0,s.jsx)(l.Ay,{figureSrc:"/img/assets/web-redirect-uri.png",redirectUri:"http://localhost:3000/callback"}),"\n",(0,s.jsx)(n.h3,{id:"implement-sign-in-route",children:"Implementar rota de login"}),"\n",(0,s.jsx)(p.Ay,{calling:"getSignInUrl()"}),"\n",(0,s.jsx)(n.p,{children:"Crie uma rota no Express para fazer login:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const { getSignInUrl } = require('./logto');\n\napp.get('/sign-in', async (req, res) => {\n  const { redirectUri, codeVerifier, state, signInUri } = await getSignInUrl();\n  req.session.signIn = { codeVerifier, state, redirectUri };\n  res.redirect(signInUri);\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"e uma rota para lidar com o callback:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"app.get('/callback', async (req, res) => {\n  if (!req.session.signIn) {\n    res.send('Bad request.');\n    return;\n  }\n\n  const response = await handleSignIn(\n    req.session.signIn,\n    `${req.protocol}://${req.get('host')}${req.originalUrl}`\n  );\n  req.session.tokens = {\n    ...response,\n    expiresAt: response.expiresIn + Date.now(),\n    idToken: decodeIdToken(response.idToken),\n  };\n  req.session.signIn = null;\n\n  res.redirect('/');\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"sign-out",children:"Fazer logout"}),"\n",(0,s.jsx)(n.p,{children:'TODO: link para o cap\xedtulo "sess\xe3o & cookies" na refer\xeancia de usu\xe1rios.'}),"\n",(0,s.jsx)(n.p,{children:'Voc\xea pode limpar tokens na sess\xe3o para fazer logout de um usu\xe1rio deste aplicativo. E confira este link para ler mais sobre "fazer logout".'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"app.get('/sign-out', (req, res) => {\n  req.session.tokens = null;\n  res.send('Sign out successful');\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"access-protected-resource",children:"Acessar recurso protegido"}),"\n",(0,s.jsxs)(n.p,{children:["Crie um middleware chamado ",(0,s.jsx)(n.code,{children:"withAuth"})," para anexar um objeto ",(0,s.jsx)(n.code,{children:"auth"})," ao ",(0,s.jsx)(n.code,{children:"req"})," e verificar se um usu\xe1rio est\xe1 logado."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"// auth.js\n\nconst { decodeIdToken } = require('@logto/js');\nconst { refreshTokens } = require('./logto');\n\nconst withAuth =\n  ({ requireAuth } = { requireAuth: true }) =>\n  async (req, res, next) => {\n    if (requireAuth && !req.session.tokens) {\n      res.redirect('/sign-in');\n      return;\n    }\n\n    if (req.session.tokens) {\n      if (req.session.tokens.expiresAt >= Date.now()) {\n        // Token de acesso expirado, atualizar para novos tokens\n        try {\n          const response = await refreshTokens(req.session.tokens.refreshToken);\n          req.session.tokens = {\n            ...response,\n            expiresAt: response.expiresIn + Date.now(),\n            idToken: decodeIdToken(response.idToken),\n          };\n        } catch {\n          // Falha na troca, redirecionar para login\n          res.redirect('/sign-in');\n          return;\n        }\n      }\n\n      req.auth = req.session.tokens.idToken.sub;\n    }\n\n    next();\n  };\n\nmodule.exports = withAuth;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["crie a p\xe1gina ",(0,s.jsx)(n.code,{children:"index"}),", mostre um link de login para convidados e um link para o perfil para usu\xe1rios que j\xe1 fizeram login:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"router.get('/', withAuth({ requireAuth: false }), function (req, res, next) {\n  res.render('index', { auth: Boolean(req.auth) });\n});\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jade",children:'extends layout\n\nblock content\n  h1 Hello logto\n  if auth\n    p: a(href="/user") Go to profile\n  else\n    p: a(href="/sign-in") Click here to sign in\n'})}),"\n",(0,s.jsxs)(n.p,{children:["crie a p\xe1gina ",(0,s.jsx)(n.code,{children:"user"}),", para exibir ",(0,s.jsx)(n.code,{children:"userId"})," (",(0,s.jsx)(n.code,{children:"sujeito"}),"):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"app.get('/user', withAuth(), (req, res, next) => {\n  res.render('user', { userId: req.auth });\n});\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-jade",children:"extends layout\n\nblock content\n  h1 Hello logto\n  p userId: #{userId}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"further-readings",children:"Leituras adicionais"}),"\n",(0,s.jsx)(d.Ay,{}),"\n",(0,s.jsx)(r,{href:"https://blog.logto.io/gpt-action-oauth",children:(0,s.jsx)(n.p,{children:"Autenticar usu\xe1rios em a\xe7\xf5es GPT: Construa um assistente de agenda pessoal"})})]})}function v(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(j,{...e})}):j(e)}},38552:(e,n,r)=>{r.d(n,{A:()=>i});r(58101);var o=r(13526);const s={tabItem:"tabItem_dgSZ"};var a=r(25105);function i(e){let{children:n,hidden:r,className:i}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,o.A)(s.tabItem,i),hidden:r,children:n})}},22002:(e,n,r)=>{r.d(n,{A:()=>I});var o=r(58101),s=r(13526),a=r(60755),i=r(55234),t=r(6635),c=r(4100),l=r(35661),d=r(42752);function u(e){return o.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:r}=e;return(0,o.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:r,attributes:o,default:s}}=e;return{value:n,label:r,attributes:o,default:s}}))}(r);return function(e){const n=(0,l.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,r])}function h(e){let{value:n,tabValues:r}=e;return r.some((e=>e.value===n))}function g(e){let{queryString:n=!1,groupId:r}=e;const s=(0,i.W6)(),a=function(e){let{queryString:n=!1,groupId:r}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:n,groupId:r});return[(0,c.aZ)(a),(0,o.useCallback)((e=>{if(!a)return;const n=new URLSearchParams(s.location.search);n.set(a,e),s.replace({...s.location,search:n.toString()})}),[a,s])]}function m(e){const{defaultValue:n,queryString:r=!1,groupId:s}=e,a=p(e),[i,c]=(0,o.useState)((()=>function(e){let{defaultValue:n,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!h({value:n,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const o=r.find((e=>e.default))??r[0];if(!o)throw new Error("Unexpected error: 0 tabValues");return o.value}({defaultValue:n,tabValues:a}))),[l,u]=g({queryString:r,groupId:s}),[m,x]=function(e){let{groupId:n}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(n),[s,a]=(0,d.Dv)(r);return[s,(0,o.useCallback)((e=>{r&&a.set(e)}),[r,a])]}({groupId:s}),f=(()=>{const e=l??m;return h({value:e,tabValues:a})?e:null})();(0,t.A)((()=>{f&&c(f)}),[f]);return{selectedValue:i,selectValue:(0,o.useCallback)((e=>{if(!h({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);c(e),u(e),x(e)}),[u,x,a]),tabValues:a}}var x=r(21929);const f={tabList:"tabList_osvQ",tabItem:"tabItem_dc4O"};var j=r(25105);function v(e){let{className:n,block:r,selectedValue:o,selectValue:i,tabValues:t}=e;const c=[],{blockElementScrollPositionUntilNextRender:l}=(0,a.a_)(),d=e=>{const n=e.currentTarget,r=c.indexOf(n),s=t[r].value;s!==o&&(l(n),i(s))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const r=c.indexOf(e.currentTarget)+1;n=c[r]??c[0];break}case"ArrowLeft":{const r=c.indexOf(e.currentTarget)-1;n=c[r]??c[c.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":r},n),children:t.map((e=>{let{value:n,label:r,attributes:a}=e;return(0,j.jsx)("li",{role:"tab",tabIndex:o===n?0:-1,"aria-selected":o===n,ref:e=>{c.push(e)},onKeyDown:u,onClick:d,...a,className:(0,s.A)("tabs__item",f.tabItem,a?.className,{"tabs__item--active":o===n}),children:r??n},n)}))})}function b(e){let{lazy:n,children:r,selectedValue:a}=e;const i=(Array.isArray(r)?r:[r]).filter(Boolean);if(n){const e=i.find((e=>e.props.value===a));return e?(0,o.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:i.map(((e,n)=>(0,o.cloneElement)(e,{key:n,hidden:e.props.value!==a})))})}function k(e){const n=m(e);return(0,j.jsxs)("div",{className:(0,s.A)("tabs-container",f.tabList),children:[(0,j.jsx)(v,{...n,...e}),(0,j.jsx)(b,{...n,...e})]})}function I(e){const n=(0,x.A)();return(0,j.jsx)(k,{...e,children:u(e.children)},String(n))}},79621:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>t});var o=r(58101);const s={},a=o.createContext(s);function i(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);