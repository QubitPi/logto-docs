"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[9509],{60744:(e,o,a)=>{a.d(o,{Ay:()=>t,RM:()=>r});var n=a(25105),i=a(79621);const r=[];function s(e){const o={admonition:"admonition",code:"code",p:"p",...(0,i.R)(),...e.components};return(0,n.jsx)(o.admonition,{type:"note",children:(0,n.jsxs)(o.p,{children:["Inspecione a reivindica\xe7\xe3o ",(0,n.jsx)(o.code,{children:"organizations"})," no Token de ID (ID token) para obter uma lista de IDs das organiza\xe7\xf5es \xe0s quais o usu\xe1rio pertence. Essa reivindica\xe7\xe3o lista todas as organiza\xe7\xf5es das quais o usu\xe1rio \xe9 membro, facilitando a enumera\xe7\xe3o ou troca de organiza\xe7\xf5es em seu aplicativo."]})})}function t(e={}){const{wrapper:o}={...(0,i.R)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(s,{...e})}):s(e)}},94803:(e,o,a)=>{a.d(o,{Ay:()=>t,RM:()=>r});var n=a(25105),i=a(79621);const r=[];function s(e){const o={admonition:"admonition",p:"p",...(0,i.R)(),...e.components};return(0,n.jsx)(o.admonition,{type:"warning",children:(0,n.jsx)(o.p,{children:"No momento, o Logto n\xe3o suporta a obten\xe7\xe3o de tokens de organiza\xe7\xe3o (organization tokens) diretamente pelo fluxo de c\xf3digo de autoriza\xe7\xe3o. Voc\xea precisar\xe1 usar o fluxo de token de atualiza\xe7\xe3o (refresh token) para obter um token de organiza\xe7\xe3o (organization token)."})})}function t(e={}){const{wrapper:o}={...(0,i.R)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(s,{...e})}):s(e)}},42671:(e,o,a)=>{a.r(o),a.d(o,{assets:()=>x,contentTitle:()=>g,default:()=>f,frontMatter:()=>h,metadata:()=>n,resource:()=>j,toc:()=>z});const n=JSON.parse('{"id":"authorization/organization-level-api-resources","title":"Proteger recursos de API em n\xedvel de organiza\xe7\xe3o","description":"Combine recursos de API com o template de organiza\xe7\xe3o para restringir o acesso a APIs e dados dentro de cada organiza\xe7\xe3o, garantindo isolamento em n\xedvel de locat\xe1rio em seu SaaS.","source":"@site/i18n/pt-BR/docusaurus-plugin-content-docs/current/authorization/organization-level-api-resources.mdx","sourceDirName":"authorization","slug":"/authorization/organization-level-api-resources","permalink":"/pt-BR/authorization/organization-level-api-resources","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/pt-BR/docusaurus-plugin-content-docs/current/authorization/organization-level-api-resources.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"docsSidebar","previous":{"title":"Proteger permiss\xf5es de organiza\xe7\xe3o (n\xe3o-API)","permalink":"/pt-BR/authorization/organization-permissions"},"next":{"title":"Validar tokens de acesso na API","permalink":"/pt-BR/authorization/validate-access-tokens/"}}');var i=a(25105),r=a(79621),s=a(1242),t=a(39088),d=a(78506),c=a(42372),l=a(38552),u=a(22002),p=a(60744),m=a(94803);const h={sidebar_position:5},g="Proteger recursos de API em n\xedvel de organiza\xe7\xe3o",x={},j="https://api.your-app.com/organizations",z=[{value:"O que s\xe3o recursos de API em n\xedvel de organiza\xe7\xe3o?",id:"what-are-organization-level-api-resources",level:2},{value:"Como funciona no Logto",id:"how-it-works-in-logto",level:2},{value:"Vis\xe3o geral da implementa\xe7\xe3o",id:"implementation-overview",level:3},{value:"Como o Logto aplica o RBAC de organiza\xe7\xe3o",id:"how-logto-applies-organization-rbac",level:3},{value:"Fluxo de autoriza\xe7\xe3o: autenticando e protegendo APIs com contexto de organiza\xe7\xe3o",id:"authorization-flow-authenticating-and-securing-apis-with-organization-context",level:3},{value:"Etapas de implementa\xe7\xe3o",id:"implementation-steps",level:2},{value:"Registre seu recurso de API",id:"register-your-api-resource",level:3},{value:"Configure pap\xe9is de organiza\xe7\xe3o",id:"set-up-organization-roles",level:3},{value:"Obtenha tokens de organiza\xe7\xe3o para recursos de API",id:"obtain-organization-tokens-for-api-resources",level:3},{value:"Fluxo de token de atualiza\xe7\xe3o",id:"refresh-token-flow",level:4},...p.RM,...m.RM,...p.RM,{value:"Fluxo de credenciais de cliente",id:"client-credentials-flow",level:4},{value:"Validar tokens de organiza\xe7\xe3o",id:"validate-organization-tokens",level:3},{value:"Boas pr\xe1ticas e dicas de seguran\xe7a",id:"best-practices-and-security-tips",level:2},{value:"Perguntas frequentes",id:"faqs",level:2},{value:"O que acontece se eu n\xe3o incluir <code>organization_id</code> na minha solicita\xe7\xe3o de token?",id:"what-if-i-don-t-include-organization-id-in-my-token-request",level:3},{value:"Posso misturar permiss\xf5es de organiza\xe7\xe3o e n\xe3o-organiza\xe7\xe3o em um \xfanico papel?",id:"can-i-mix-organization-and-non-organization-permissions-in-a-single-role",level:3},{value:"Leitura adicional",id:"further-reading",level:2}];function v(e){const o={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{CloudLink:a,Details:n,Url:h}=o;return a||b("CloudLink",!0),n||b("Details",!0),h||b("Url",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.header,{children:(0,i.jsx)(o.h1,{id:"proteger-recursos-de-api-em-n\xedvel-de-organiza\xe7\xe3o",children:"Proteger recursos de API em n\xedvel de organiza\xe7\xe3o"})}),"\n","\n",(0,i.jsx)(o.p,{children:"Combine recursos de API com o template de organiza\xe7\xe3o para restringir o acesso a APIs e dados dentro de cada organiza\xe7\xe3o, garantindo isolamento em n\xedvel de locat\xe1rio em seu SaaS."}),"\n",(0,i.jsx)(o.h2,{id:"what-are-organization-level-api-resources",children:"O que s\xe3o recursos de API em n\xedvel de organiza\xe7\xe3o?"}),"\n",(0,i.jsxs)(o.p,{children:["Recursos de API em n\xedvel de organiza\xe7\xe3o s\xe3o endpoints ou servi\xe7os em seu aplicativo que s\xe3o ",(0,i.jsx)(o.strong,{children:"restritos a uma organiza\xe7\xe3o espec\xedfica"}),". Essas APIs aplicam autoriza\xe7\xe3o e acesso com base no contexto da organiza\xe7\xe3o \u2014 garantindo que usu\xe1rios ou clientes acessem apenas dados e a\xe7\xf5es relevantes para sua organiza\xe7\xe3o."]}),"\n",(0,i.jsx)(o.p,{children:(0,i.jsx)(o.strong,{children:"Casos de uso incluem"})}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["APIs para gerenciar membros, pap\xe9is ou configura\xe7\xf5es da organiza\xe7\xe3o (por exemplo, ",(0,i.jsx)(o.code,{children:"/organizations/{organizationId}/members"}),")"]}),"\n",(0,i.jsx)(o.li,{children:"Dashboards, an\xe1lises ou relat\xf3rios restritos \xe0 organiza\xe7\xe3o"}),"\n",(0,i.jsx)(o.li,{children:"Endpoints de cobran\xe7a, assinatura ou auditoria vinculados a uma organiza\xe7\xe3o"}),"\n",(0,i.jsx)(o.li,{children:"Qualquer API onde a\xe7\xf5es e dados s\xe3o isolados por locat\xe1rio"}),"\n"]}),"\n",(0,i.jsx)(o.p,{children:"O Logto permite proteger essas APIs de organiza\xe7\xe3o usando OAuth 2.1 e RBAC, enquanto oferece suporte a arquiteturas SaaS multi-locat\xe1rio."}),"\n",(0,i.jsxs)(o.p,{children:["Essas permiss\xf5es s\xe3o gerenciadas por meio de ",(0,i.jsx)(o.strong,{children:"pap\xe9is da organiza\xe7\xe3o"})," definidos no ",(0,i.jsx)(o.a,{href:"/authorization/organization-template",children:"template de organiza\xe7\xe3o"}),". Cada organiza\xe7\xe3o usa o mesmo template, garantindo um modelo de permiss\xf5es consistente em todas as organiza\xe7\xf5es."]}),"\n",(0,i.jsx)(o.h2,{id:"how-it-works-in-logto",children:"Como funciona no Logto"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Recursos de API e permiss\xf5es s\xe3o registrados globalmente:"})," Cada recurso de API \xe9 definido com um indicador de recurso (URI) exclusivo e um conjunto de permiss\xf5es (escopos) no Logto."]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Pap\xe9is em n\xedvel de organiza\xe7\xe3o:"})," Pap\xe9is de organiza\xe7\xe3o s\xe3o definidos no template de organiza\xe7\xe3o. Permiss\xf5es de recursos de API (escopos) s\xe3o atribu\xeddas a pap\xe9is da organiza\xe7\xe3o, que ent\xe3o s\xe3o atribu\xeddos a usu\xe1rios ou clientes ",(0,i.jsx)(o.strong,{children:"dentro de cada organiza\xe7\xe3o"}),"."]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Autoriza\xe7\xe3o sens\xedvel ao contexto:"})," Quando um cliente solicita um token de acesso com um recurso de API e um ",(0,i.jsx)(o.code,{children:"organization_id"}),", o Logto emite um token que inclui tanto o contexto da organiza\xe7\xe3o quanto o p\xfablico da API. As permiss\xf5es (escopos) do token s\xe3o determinadas pelos pap\xe9is da organiza\xe7\xe3o do usu\xe1rio para a organiza\xe7\xe3o especificada."]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Separa\xe7\xe3o de recursos globais:"})," Recursos de API podem ser acessados com ou sem contexto de organiza\xe7\xe3o. O RBAC da organiza\xe7\xe3o s\xf3 \xe9 aplicado se um ",(0,i.jsx)(o.code,{children:"organization_id"})," for inclu\xeddo na solicita\xe7\xe3o. Para APIs compartilhadas entre todos os usu\xe1rios, veja ",(0,i.jsx)(o.a,{href:"/authorization/global-api-resources",children:"Proteger recursos de API globais"}),"."]}),"\n"]}),"\n",(0,i.jsx)("img",{src:s.A,alt:"Recursos de API em n\xedvel de organiza\xe7\xe3o RBAC",style:{maxWidth:"100%"}}),"\n",(0,i.jsx)(o.h3,{id:"implementation-overview",children:"Vis\xe3o geral da implementa\xe7\xe3o"}),"\n",(0,i.jsxs)(o.ol,{children:["\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Registre seu recurso de API"})," e defina suas permiss\xf5es (escopos) no Logto."]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Defina pap\xe9is de organiza\xe7\xe3o"})," no template de organiza\xe7\xe3o e atribua as permiss\xf5es de API relevantes."]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Atribua pap\xe9is"})," a usu\xe1rios ou clientes dentro de cada organiza\xe7\xe3o."]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Solicite um token de acesso"})," para a API com um ",(0,i.jsx)(o.code,{children:"organization_id"})," para incluir o contexto da organiza\xe7\xe3o."]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Valide tokens de acesso"})," em sua API, aplicando tanto o contexto da organiza\xe7\xe3o quanto as permiss\xf5es."]}),"\n"]}),"\n",(0,i.jsx)(o.h3,{id:"how-logto-applies-organization-rbac",children:"Como o Logto aplica o RBAC de organiza\xe7\xe3o"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["Se voc\xea solicitar um token de acesso ",(0,i.jsx)(o.strong,{children:"sem"})," um ",(0,i.jsx)(o.code,{children:"organization_id"}),", apenas pap\xe9is/permiss\xf5es globais ser\xe3o considerados."]}),"\n",(0,i.jsxs)(o.li,{children:["Se voc\xea solicitar um token de acesso ",(0,i.jsx)(o.strong,{children:"com"})," um ",(0,i.jsx)(o.code,{children:"organization_id"}),", o Logto avalia os pap\xe9is da organiza\xe7\xe3o do usu\xe1rio e suas permiss\xf5es associadas para aquela organiza\xe7\xe3o."]}),"\n",(0,i.jsxs)(o.li,{children:["O JWT resultante conter\xe1 tanto o p\xfablico da API (",(0,i.jsx)(o.code,{children:"aud"})," claim) quanto o contexto da organiza\xe7\xe3o (",(0,i.jsx)(o.code,{children:"organization_id"})," claim), com escopos filtrados para aqueles concedidos pelos pap\xe9is da organiza\xe7\xe3o do usu\xe1rio."]}),"\n"]}),"\n",(0,i.jsx)(o.h3,{id:"authorization-flow-authenticating-and-securing-apis-with-organization-context",children:"Fluxo de autoriza\xe7\xe3o: autenticando e protegendo APIs com contexto de organiza\xe7\xe3o"}),"\n",(0,i.jsx)(o.p,{children:"O fluxo a seguir mostra como um cliente (web, mobile ou backend) obt\xe9m e usa tokens de organiza\xe7\xe3o para acessar recursos de API em n\xedvel de organiza\xe7\xe3o."}),"\n",(0,i.jsx)(o.p,{children:"Observe que o fluxo n\xe3o inclui detalhes exaustivos sobre os par\xe2metros ou cabe\xe7alhos necess\xe1rios, mas foca nos principais passos envolvidos. Continue lendo para ver como o fluxo funciona na pr\xe1tica."}),"\n",(0,i.jsx)(o.mermaid,{value:"sequenceDiagram\n    participant Cliente\n    participant Logto\n    participant API as Recurso de API\n\n    alt Autentica\xe7\xe3o do usu\xe1rio\n        Cliente->>Logto: GET /oidc/auth\n        Logto->>Logto: Redireciona usu\xe1rio para p\xe1gina de login\n        Logto->>Cliente: Redireciona de volta com `authorization_code`\n        Cliente->>Logto: POST /oidc/token com `grant_type=authorization_code`\n        Logto->>Cliente: Retorna token de atualiza\xe7\xe3o\n        Cliente->>Logto: POST /oidc/token com `grant_type=refresh_token`<br/>+ resource + organization_id\n    else Autentica\xe7\xe3o de cliente m\xe1quina para m\xe1quina (M2M)\n        Cliente->>Logto: POST /oidc/token com `grant_type=client_credentials`<br/>+ resource + organization_id\n    end\n\n    Logto->>Cliente: Retorna token de acesso (JWT)\n    Cliente->>API: Solicita\xe7\xe3o com token Bearer\n    API->>API: Valida token, verifica contexto da organiza\xe7\xe3o e permiss\xf5es\n\n    alt Token \xe9 v\xe1lido\n      API->>Cliente: Retorna dados da organiza\xe7\xe3o\n    else Token \xe9 inv\xe1lido\n      API->>Cliente: 401 N\xe3o autorizado\n    end"}),"\n",(0,i.jsx)(o.p,{children:(0,i.jsx)(o.em,{children:"Autentica\xe7\xe3o do usu\xe1rio = navegador/app. M2M = servi\xe7o backend ou script usando credenciais de cliente + contexto de organiza\xe7\xe3o."})}),"\n",(0,i.jsx)(o.h2,{id:"implementation-steps",children:"Etapas de implementa\xe7\xe3o"}),"\n",(0,i.jsx)(o.h3,{id:"register-your-api-resource",children:"Registre seu recurso de API"}),"\n",(0,i.jsxs)(o.ol,{children:["\n",(0,i.jsxs)(o.li,{children:["V\xe1 para ",(0,i.jsx)(a,{to:"/api-resources",children:"Console \u2192 Recursos de API"}),"."]}),"\n",(0,i.jsxs)(o.li,{children:["Crie um novo recurso de API (por exemplo, ",(0,i.jsx)(o.code,{children:"https://api.yourapp.com/org"}),") e defina suas permiss\xf5es (escopos)."]}),"\n"]}),"\n",(0,i.jsxs)(o.p,{children:["Para etapas completas de configura\xe7\xe3o, veja ",(0,i.jsx)(o.a,{href:"/authorization/role-based-access-control#define-api-resources-with-permissions",children:"Definir recursos de API com permiss\xf5es"}),"."]}),"\n",(0,i.jsx)(o.h3,{id:"set-up-organization-roles",children:"Configure pap\xe9is de organiza\xe7\xe3o"}),"\n",(0,i.jsxs)(o.ol,{children:["\n",(0,i.jsxs)(o.li,{children:["V\xe1 para ",(0,i.jsx)(a,{to:"/organization-template/organization-roles",children:"Console \u2192 Template de organiza\xe7\xe3o \u2192 Pap\xe9is da organiza\xe7\xe3o"}),"."]}),"\n",(0,i.jsxs)(o.li,{children:["Crie pap\xe9is de organiza\xe7\xe3o (por exemplo, ",(0,i.jsx)(o.code,{children:"admin"}),", ",(0,i.jsx)(o.code,{children:"member"}),") e atribua permiss\xf5es de API a cada papel."]}),"\n",(0,i.jsx)(o.li,{children:"Atribua pap\xe9is a usu\xe1rios ou clientes dentro de cada organiza\xe7\xe3o. Se ainda n\xe3o forem membros, convide-os ou adicione-os primeiro."}),"\n"]}),"\n",(0,i.jsxs)(o.p,{children:["Para etapas completas de configura\xe7\xe3o, veja ",(0,i.jsx)(o.a,{href:"/authorization/role-based-access-control#configure-organization-roles",children:"Usar pap\xe9is de organiza\xe7\xe3o"}),"."]}),"\n",(0,i.jsx)(o.h3,{id:"obtain-organization-tokens-for-api-resources",children:"Obtenha tokens de organiza\xe7\xe3o para recursos de API"}),"\n",(0,i.jsxs)(o.p,{children:["Seu cliente/app deve solicitar um token com ",(0,i.jsx)(o.code,{children:"resource"})," e ",(0,i.jsx)(o.code,{children:"organization_id"})," para acessar APIs em n\xedvel de organiza\xe7\xe3o. O Logto emite tokens de organiza\xe7\xe3o como ",(0,i.jsx)(o.a,{href:"https://auth.wiki/jwt",children:"JSON Web Tokens (JWTs)"}),". Voc\xea pode obt\xea-los usando o ",(0,i.jsx)(o.a,{href:"https://auth.wiki/refresh-token",children:"fluxo de token de atualiza\xe7\xe3o"})," ou o ",(0,i.jsx)(o.a,{href:"https://auth.wiki/client-credentials-flow",children:"fluxo de credenciais de cliente"}),"."]}),"\n",(0,i.jsx)(o.h4,{id:"refresh-token-flow",children:"Fluxo de token de atualiza\xe7\xe3o"}),"\n",(0,i.jsx)(o.p,{children:"Quase todos os SDKs oficiais do Logto suportam a obten\xe7\xe3o de tokens de organiza\xe7\xe3o usando o fluxo de token de atualiza\xe7\xe3o nativamente. Uma biblioteca padr\xe3o de cliente OAuth 2.0 / OIDC tamb\xe9m pode ser usada para implementar esse fluxo."}),"\n",(0,i.jsxs)(u.A,{groupId:"user-client",children:[(0,i.jsxs)(l.A,{value:"logto-sdk",label:"Logto SDK",children:[(0,i.jsxs)(o.p,{children:["Ao inicializar o Logto SDK, adicione o ",(0,i.jsx)(o.code,{children:"urn:logto:scope:organizations"})," e as permiss\xf5es de organiza\xe7\xe3o desejadas (escopos) ao par\xe2metro ",(0,i.jsx)(o.code,{children:"scopes"}),"."]}),(0,i.jsxs)(o.p,{children:["Alguns SDKs do Logto possuem um escopo predefinido para organiza\xe7\xf5es, como ",(0,i.jsx)(o.code,{children:"UserScope.Organizations"})," em SDKs JavaScript."]}),(0,i.jsx)(p.Ay,{}),(0,i.jsxs)(o.p,{children:["Ao chamar ",(0,i.jsx)(o.code,{children:"getAccessToken()"}),", especifique tanto o recurso de API (",(0,i.jsx)(o.code,{children:"resource"}),") quanto o ID da organiza\xe7\xe3o (",(0,i.jsx)(o.code,{children:"organizationId"}),") para obter um token de organiza\xe7\xe3o."]}),(0,i.jsxs)(o.p,{children:["Para detalhes sobre cada SDK, veja ",(0,i.jsx)(o.a,{href:"/quick-starts",children:"In\xedcios r\xe1pidos"}),"."]})]}),(0,i.jsxs)(l.A,{value:"oauth-client",label:"Biblioteca cliente OAuth 2.0 / OIDC",children:[(0,i.jsx)(o.p,{children:"Ao configurar seu cliente OAuth 2.0 ou inicializar o fluxo de c\xf3digo de autoriza\xe7\xe3o, certifique-se de incluir os seguintes par\xe2metros:"}),(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.code,{children:"resource"}),": Defina como o identificador do recurso de API registrado no Logto (por exemplo, ",(0,i.jsx)(o.code,{children:"https://api.your-app.com/organizations"}),")."]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.code,{children:"scope"}),": Inclua o escopo predefinido de organiza\xe7\xe3o (",(0,i.jsx)(o.code,{children:"urn:logto:scope:organizations"}),"), ",(0,i.jsx)(o.code,{children:"offline_access"})," (para obter tokens de atualiza\xe7\xe3o) e quaisquer permiss\xf5es de API espec\xedficas que voc\xea precisar (por exemplo, ",(0,i.jsx)(o.code,{children:"manage:members view:analytics"}),")."]}),"\n"]}),(0,i.jsxs)(o.p,{children:["Algumas bibliotecas podem n\xe3o suportar o par\xe2metro ",(0,i.jsx)(o.code,{children:"resource"})," nativamente, mas geralmente permitem passar par\xe2metros adicionais na solicita\xe7\xe3o de autoriza\xe7\xe3o. Verifique a documenta\xe7\xe3o da sua biblioteca para detalhes."]}),(0,i.jsx)(o.p,{children:"Aqui est\xe1 um exemplo n\xe3o normativo de como a solicita\xe7\xe3o de autoriza\xe7\xe3o pode ser:"}),(0,i.jsx)(t.A,{resource:j,scope:"urn:logto:scope:organizations invite:member manage:billing"}),(0,i.jsxs)(o.p,{children:["Depois que o usu\xe1rio for autenticado, voc\xea receber\xe1 um c\xf3digo de autoriza\xe7\xe3o. Use esse c\xf3digo fazendo uma solicita\xe7\xe3o POST para o endpoint ",(0,i.jsx)(o.code,{children:"/oidc/token"})," do Logto."]}),(0,i.jsx)(o.p,{children:"Aqui est\xe1 um exemplo n\xe3o normativo da solicita\xe7\xe3o de token:"}),(0,i.jsx)(c.A,{grantType:"authorization_code"}),(0,i.jsx)(m.Ay,{}),(0,i.jsx)(o.p,{children:"Voc\xea receber\xe1 um token de atualiza\xe7\xe3o que pode ser usado para obter tokens de organiza\xe7\xe3o."}),(0,i.jsx)(p.Ay,{}),(0,i.jsxs)(o.p,{children:["Por fim, use o token de atualiza\xe7\xe3o para obter um token de organiza\xe7\xe3o fazendo uma solicita\xe7\xe3o POST para o endpoint ",(0,i.jsx)(o.code,{children:"/oidc/token"})," do Logto. Lembre-se de incluir:"]}),(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["O par\xe2metro ",(0,i.jsx)(o.code,{children:"resource"})," definido como o identificador do recurso de API (por exemplo, ",(0,i.jsx)(o.code,{children:"https://api.yourapp.com/org"}),")."]}),"\n",(0,i.jsxs)(o.li,{children:["O par\xe2metro ",(0,i.jsx)(o.code,{children:"organization_id"})," definido como o ID da organiza\xe7\xe3o desejada."]}),"\n",(0,i.jsxs)(o.li,{children:["(Opcional) O par\xe2metro ",(0,i.jsx)(o.code,{children:"scope"})," para restringir ainda mais as permiss\xf5es necess\xe1rias (por exemplo, ",(0,i.jsx)(o.code,{children:"manage:members view:reports"}),")."]}),"\n"]}),(0,i.jsx)(o.p,{children:"Aqui est\xe1 um exemplo n\xe3o normativo de como a solicita\xe7\xe3o de token pode ser:"}),(0,i.jsx)(c.A,{grantType:"refresh_token",resource:j,organizationId:"your-organization-id"})]})]}),"\n",(0,i.jsx)(o.h4,{id:"client-credentials-flow",children:"Fluxo de credenciais de cliente"}),"\n",(0,i.jsxs)(o.p,{children:["Para cen\xe1rios m\xe1quina para m\xe1quina (M2M), voc\xea pode usar o fluxo de credenciais de cliente para obter um token de acesso para permiss\xf5es de recursos de API em n\xedvel de organiza\xe7\xe3o. Fazendo uma solicita\xe7\xe3o POST para o endpoint ",(0,i.jsx)(o.code,{children:"/oidc/token"})," do Logto com par\xe2metros de organiza\xe7\xe3o, voc\xea pode solicitar um token de organiza\xe7\xe3o usando seu client ID e secret."]}),"\n",(0,i.jsx)(o.p,{children:"Aqui est\xe3o os principais par\xe2metros a serem inclu\xeddos na solicita\xe7\xe3o:"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.code,{children:"resource"}),": O identificador do recurso de API (por exemplo, ",(0,i.jsx)(o.code,{children:"https://api.yourapp.com/org"}),")."]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.code,{children:"organization_id"}),": O ID da organiza\xe7\xe3o para a qual voc\xea deseja o token."]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.code,{children:"scope"}),": As permiss\xf5es de recursos de API em n\xedvel de organiza\xe7\xe3o que voc\xea deseja solicitar (por exemplo, ",(0,i.jsx)(o.code,{children:"invite:member"}),", ",(0,i.jsx)(o.code,{children:"manage:billing"}),")."]}),"\n"]}),"\n",(0,i.jsx)(o.p,{children:"Aqui est\xe1 um exemplo n\xe3o normativo da solicita\xe7\xe3o de token usando o tipo de concess\xe3o de credenciais de cliente:"}),"\n",(0,i.jsx)(d.A,{resource:"https://api.yourapp.com/org",organizationId:"your-organization-id",scope:"invite:member manage:billing"}),"\n",(0,i.jsx)(o.h3,{id:"validate-organization-tokens",children:"Validar tokens de organiza\xe7\xe3o"}),"\n",(0,i.jsx)(o.p,{children:"Tokens de organiza\xe7\xe3o emitidos pelo Logto (JWTs) cont\xeam reivindica\xe7\xf5es que sua API pode usar para aplicar controle de acesso em n\xedvel de organiza\xe7\xe3o."}),"\n",(0,i.jsx)(o.p,{children:"Quando seu app receber um token de organiza\xe7\xe3o, voc\xea deve:"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsx)(o.li,{children:"Verificar a assinatura do token (usando os JWKs do Logto)."}),"\n",(0,i.jsxs)(o.li,{children:["Confirmar que o token n\xe3o est\xe1 expirado (",(0,i.jsx)(o.code,{children:"exp"})," claim)."]}),"\n",(0,i.jsxs)(o.li,{children:["Verificar se o ",(0,i.jsx)(o.code,{children:"iss"})," (emissor) corresponde ao seu endpoint Logto."]}),"\n",(0,i.jsxs)(o.li,{children:["Garantir que o ",(0,i.jsx)(o.code,{children:"aud"})," (p\xfablico) corresponda ao identificador do recurso de API que voc\xea registrou (por exemplo, ",(0,i.jsx)(o.code,{children:"https://api.yourapp.com/org"}),")."]}),"\n",(0,i.jsxs)(o.li,{children:["Validar a reivindica\xe7\xe3o ",(0,i.jsx)(o.code,{children:"organization_id"})," para garantir que o token est\xe1 restrito \xe0 organiza\xe7\xe3o correta."]}),"\n",(0,i.jsxs)(o.li,{children:["Dividir a reivindica\xe7\xe3o ",(0,i.jsx)(o.code,{children:"scope"})," (separada por espa\xe7o) e verificar as permiss\xf5es necess\xe1rias."]}),"\n",(0,i.jsxs)(o.li,{children:["Se o caminho da sua API incluir o ID da organiza\xe7\xe3o (por exemplo, ",(0,i.jsx)(o.code,{children:"/organizations/{organizationId}/members"}),"), garantir que a reivindica\xe7\xe3o ",(0,i.jsx)(o.code,{children:"organization_id"})," corresponda ao par\xe2metro do caminho."]}),"\n"]}),"\n",(0,i.jsxs)(o.p,{children:["Para guias passo a passo e espec\xedficos de linguagem, veja ",(0,i.jsx)(o.a,{href:"/authorization/validate-access-tokens",children:"Como validar tokens de acesso"}),"."]}),"\n",(0,i.jsx)(o.h2,{id:"best-practices-and-security-tips",children:"Boas pr\xe1ticas e dicas de seguran\xe7a"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Sempre valide o contexto da organiza\xe7\xe3o:"})," N\xe3o confie apenas no token; verifique a reivindica\xe7\xe3o ",(0,i.jsx)(o.code,{children:"organization_id"})," para cada chamada de API restrita \xe0 organiza\xe7\xe3o."]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Use restri\xe7\xf5es de p\xfablico:"})," Sempre verifique a reivindica\xe7\xe3o ",(0,i.jsx)(o.code,{children:"aud"})," para garantir que o token \xe9 para a organiza\xe7\xe3o pretendida."]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Mantenha as permiss\xf5es orientadas ao neg\xf3cio:"})," Use nomes claros que correspondam a a\xe7\xf5es reais; conceda apenas o necess\xe1rio para cada papel da organiza\xe7\xe3o."]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Separe permiss\xf5es de API e n\xe3o-API"})," sempre que poss\xedvel (mas ambas podem estar em um \xfanico papel)."]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Mantenha a vida \xfatil dos tokens curta:"})," Reduz o risco caso um token seja vazado."]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Revise regularmente seu template de organiza\xe7\xe3o:"})," Atualize pap\xe9is e permiss\xf5es conforme seu produto evolui."]}),"\n"]}),"\n",(0,i.jsx)(o.h2,{id:"faqs",children:"Perguntas frequentes"}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:(0,i.jsxs)(o.h3,{id:"what-if-i-don-t-include-organization-id-in-my-token-request",children:["O que acontece se eu n\xe3o incluir ",(0,i.jsx)(o.code,{children:"organization_id"})," na minha solicita\xe7\xe3o de token?"]})}),(0,i.jsx)(o.p,{children:"Apenas pap\xe9is/permiss\xf5es globais ser\xe3o avaliados. O RBAC da organiza\xe7\xe3o n\xe3o ser\xe1 aplicado."})]}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)(o.h3,{id:"can-i-mix-organization-and-non-organization-permissions-in-a-single-role",children:"Posso misturar permiss\xf5es de organiza\xe7\xe3o e n\xe3o-organiza\xe7\xe3o em um \xfanico papel?"})}),(0,i.jsx)(o.p,{children:"N\xe3o, permiss\xf5es de organiza\xe7\xe3o (incluindo permiss\xf5es de API em n\xedvel de organiza\xe7\xe3o) s\xe3o definidas pelo template de organiza\xe7\xe3o e n\xe3o podem ser misturadas com permiss\xf5es globais de API. No entanto, voc\xea pode criar pap\xe9is que incluam permiss\xf5es de organiza\xe7\xe3o e permiss\xf5es de API em n\xedvel de organiza\xe7\xe3o."})]}),"\n",(0,i.jsx)(o.h2,{id:"further-reading",children:"Leitura adicional"}),"\n",(0,i.jsx)(h,{href:"/authorization/validate-access-tokens",children:"Como validar tokens de acesso"}),"\n",(0,i.jsx)(h,{href:"/developers/custom-token-claims",children:"Personalizando reivindica\xe7\xf5es de token"}),"\n",(0,i.jsx)(h,{href:"/use-cases/multi-tenancy/build-multi-tenant-saas-application",children:(0,i.jsx)(o.p,{children:"Caso de uso: Construa um aplicativo SaaS multi-locat\xe1rio"})}),"\n",(0,i.jsx)(h,{href:"https://www.rfc-editor.org/rfc/rfc8707.html",children:"RFC 8707: Indicadores de recurso"})]})}function f(e={}){const{wrapper:o}={...(0,r.R)(),...e.components};return o?(0,i.jsx)(o,{...e,children:(0,i.jsx)(v,{...e})}):v(e)}function b(e,o){throw new Error("Expected "+(o?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},39088:(e,o,a)=>{a.d(o,{A:()=>r});var n=a(80173),i=a(25105);const r=e=>{let{resource:o,scope:a}=e;return(0,i.jsx)(n.A,{language:"http",children:`GET /oidc/auth?response_type=code\n&client_id=your-client-id\n&redirect_uri=https://your-app.com/callback\n&scope=openid profile offline_access ${a}\n&resource=${o}\n&code_challenge=abc123\n&code_challenge_method=S256\n&state=xyz\nHTTP/1.1\nHost: your.logto.endpoint\n`})}},78506:(e,o,a)=>{a.d(o,{A:()=>r});var n=a(80173),i=a(25105);const r=e=>{let{resource:o,organizationId:a,scope:r}=e;return(0,i.jsxs)(n.A,{language:"http",children:["POST /oidc/token HTTP/1.1\nHost: your.logto.endpoint\nContent-Type: application/x-www-form-urlencoded\nAuthorization: Basic base64(client_id:client_secret)\n\ngrant_type=client_credentials\n",o&&`&resource=${o}\n`,a&&`&organization_id=${a}\n`,`&scope=${r}\n`]})}},42372:(e,o,a)=>{a.d(o,{A:()=>r});var n=a(80173),i=a(25105);const r=e=>{let{grantType:o,resource:a,organizationId:r}=e;const s=[`grant_type=${o}`,"authorization_code"===o&&"code=authorization-code-received","authorization_code"===o&&"redirect_uri=https://your-app.com/callback","refresh_token"===o&&"refresh_token=your-refresh-token",a&&`resource=${a}`,r&&`organization_id=${r}`].filter(Boolean);return(0,i.jsx)(n.A,{language:"http",children:`POST /oidc/token HTTP/1.1\nHost: your.logto.endpoint\nContent-Type: application/x-www-form-urlencoded\nAuthorization: Basic base64(client_id:client_secret)\n\n${s.join("\n&")}`})}},38552:(e,o,a)=>{a.d(o,{A:()=>s});a(58101);var n=a(13526);const i={tabItem:"tabItem_dgSZ"};var r=a(25105);function s(e){let{children:o,hidden:a,className:s}=e;return(0,r.jsx)("div",{role:"tabpanel",className:(0,n.A)(i.tabItem,s),hidden:a,children:o})}},22002:(e,o,a)=>{a.d(o,{A:()=>k});var n=a(58101),i=a(13526),r=a(60755),s=a(55234),t=a(6635),d=a(4100),c=a(35661),l=a(42752);function u(e){return n.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,n.isValidElement)(e)&&function(e){const{props:o}=e;return!!o&&"object"==typeof o&&"value"in o}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:o,children:a}=e;return(0,n.useMemo)((()=>{const e=o??function(e){return u(e).map((e=>{let{props:{value:o,label:a,attributes:n,default:i}}=e;return{value:o,label:a,attributes:n,default:i}}))}(a);return function(e){const o=(0,c.XI)(e,((e,o)=>e.value===o.value));if(o.length>0)throw new Error(`Docusaurus error: Duplicate values "${o.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[o,a])}function m(e){let{value:o,tabValues:a}=e;return a.some((e=>e.value===o))}function h(e){let{queryString:o=!1,groupId:a}=e;const i=(0,s.W6)(),r=function(e){let{queryString:o=!1,groupId:a}=e;if("string"==typeof o)return o;if(!1===o)return null;if(!0===o&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:o,groupId:a});return[(0,d.aZ)(r),(0,n.useCallback)((e=>{if(!r)return;const o=new URLSearchParams(i.location.search);o.set(r,e),i.replace({...i.location,search:o.toString()})}),[r,i])]}function g(e){const{defaultValue:o,queryString:a=!1,groupId:i}=e,r=p(e),[s,d]=(0,n.useState)((()=>function(e){let{defaultValue:o,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(o){if(!m({value:o,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${o}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return o}const n=a.find((e=>e.default))??a[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:o,tabValues:r}))),[c,u]=h({queryString:a,groupId:i}),[g,x]=function(e){let{groupId:o}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(o),[i,r]=(0,l.Dv)(a);return[i,(0,n.useCallback)((e=>{a&&r.set(e)}),[a,r])]}({groupId:i}),j=(()=>{const e=c??g;return m({value:e,tabValues:r})?e:null})();(0,t.A)((()=>{j&&d(j)}),[j]);return{selectedValue:s,selectValue:(0,n.useCallback)((e=>{if(!m({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);d(e),u(e),x(e)}),[u,x,r]),tabValues:r}}var x=a(21929);const j={tabList:"tabList_osvQ",tabItem:"tabItem_dc4O"};var z=a(25105);function v(e){let{className:o,block:a,selectedValue:n,selectValue:s,tabValues:t}=e;const d=[],{blockElementScrollPositionUntilNextRender:c}=(0,r.a_)(),l=e=>{const o=e.currentTarget,a=d.indexOf(o),i=t[a].value;i!==n&&(c(o),s(i))},u=e=>{let o=null;switch(e.key){case"Enter":l(e);break;case"ArrowRight":{const a=d.indexOf(e.currentTarget)+1;o=d[a]??d[0];break}case"ArrowLeft":{const a=d.indexOf(e.currentTarget)-1;o=d[a]??d[d.length-1];break}}o?.focus()};return(0,z.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":a},o),children:t.map((e=>{let{value:o,label:a,attributes:r}=e;return(0,z.jsx)("li",{role:"tab",tabIndex:n===o?0:-1,"aria-selected":n===o,ref:e=>{d.push(e)},onKeyDown:u,onClick:l,...r,className:(0,i.A)("tabs__item",j.tabItem,r?.className,{"tabs__item--active":n===o}),children:a??o},o)}))})}function f(e){let{lazy:o,children:a,selectedValue:r}=e;const s=(Array.isArray(a)?a:[a]).filter(Boolean);if(o){const e=s.find((e=>e.props.value===r));return e?(0,n.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,z.jsx)("div",{className:"margin-top--md",children:s.map(((e,o)=>(0,n.cloneElement)(e,{key:o,hidden:e.props.value!==r})))})}function b(e){const o=g(e);return(0,z.jsxs)("div",{className:(0,i.A)("tabs-container",j.tabList),children:[(0,z.jsx)(v,{...o,...e}),(0,z.jsx)(f,{...o,...e})]})}function k(e){const o=(0,x.A)();return(0,z.jsx)(b,{...e,children:u(e.children)},String(o))}},55138:(e,o,a)=>{a.d(o,{A:()=>g});var n=a(28259),i=a(6097),r=a(58574),s=a(9484),t=a(76566),d=a(26346),c=a(17867),l=a(17510),u=a(13526),p=a(72355);const m={codeBlockContent:"codeBlockContent_m3Ux",codeBlockTitle:"codeBlockTitle_P25_",codeBlock:"codeBlock_qGQc",codeBlockStandalone:"codeBlockStandalone_zC50",codeBlockLines:"codeBlockLines_p187",codeBlockLinesWithNumbering:"codeBlockLinesWithNumbering_OFgW",buttonGroup:"buttonGroup_6DOT"};var h=a(25105);function g(e){let{children:o,className:a="",metastring:g,title:x,showLineNumbers:j,language:z}=e;const{prism:{defaultLanguage:v,magicComments:f}}=(0,n.p)(),b=function(e){return e?.toLowerCase()}(z??(0,r.Op)(a)??v),k=(0,i.A)(),A=(0,s.f)(),I=(0,r.wt)(g)||x,{lineClassNames:P,code:y}=(0,r.Li)(o,{metastring:g,language:b,magicComments:f}),q=j??(0,r._u)(g);return(0,h.jsxs)(t.A,{as:"div",className:(0,u.A)(a,b&&!a.includes(`language-${b}`)&&`language-${b}`),children:[I&&(0,h.jsx)("div",{className:m.codeBlockTitle,children:I}),(0,h.jsxs)("div",{className:m.codeBlockContent,children:[(0,h.jsx)(p.f4,{theme:k,code:y,language:b??"text",children:e=>{let{className:o,tokens:a,getLineProps:n,getTokenProps:i}=e;return(0,h.jsx)("pre",{ref:A.codeBlockRef,tabIndex:0,className:(0,u.A)(o,m.codeBlock,"thin-scrollbar"),children:(0,h.jsx)("code",{className:(0,u.A)(m.codeBlockLines,q&&m.codeBlockLinesWithNumbering),children:a.map(((e,o)=>(0,h.jsx)(c.A,{line:e,getLineProps:n,getTokenProps:i,classNames:P[o],showLineNumbers:q},o)))})})}}),(0,h.jsxs)("div",{className:m.buttonGroup,children:[(A.isEnabled||A.isCodeScrollable)&&(0,h.jsx)(l.A,{className:m.codeButton,isEnabled:A.isEnabled,onClick:()=>{A.toggle()}}),(0,h.jsx)(d.A,{className:m.codeButton,code:y})]})]})]})}},1242:(e,o,a)=>{a.d(o,{A:()=>n});const n=a.p+"assets/images/rbac-organization-level-api-resources-9533c281f3ee1cf52aefe821717e1fef.png"}}]);