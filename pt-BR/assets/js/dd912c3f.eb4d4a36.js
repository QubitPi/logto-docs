"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[8947],{76329:(e,o,a)=>{a.r(o),a.d(o,{assets:()=>d,contentTitle:()=>c,default:()=>m,frontMatter:()=>t,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"end-user-flows/one-time-token","title":"Magic link (Token de uso \xfanico)","description":"Semelhante \xe0 senha de uso \xfanico (OTP), um token de uso \xfanico \xe9 outro m\xe9todo de autentica\xe7\xe3o sem senha que pode ser usado para verificar a identidade de um usu\xe1rio.","source":"@site/i18n/pt-BR/docusaurus-plugin-content-docs/current/end-user-flows/one-time-token.mdx","sourceDirName":"end-user-flows","slug":"/end-user-flows/one-time-token","permalink":"/pt-BR/end-user-flows/one-time-token","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/pt-BR/docusaurus-plugin-content-docs/current/end-user-flows/one-time-token.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"docsSidebar","previous":{"title":"Login direto","permalink":"/pt-BR/end-user-flows/authentication-parameters/direct-sign-in"},"next":{"title":"Tela de consentimento (Consent screen)","permalink":"/pt-BR/end-user-flows/consent-screen"}}');var n=a(25105),s=a(79621),r=a(88969);const t={sidebar_position:5},c="Magic link (Token de uso \xfanico)",d={},l=[{value:"Fluxo do token de uso \xfanico",id:"one-time-token-flow",level:2},{value:"Guia de implementa\xe7\xe3o",id:"implementation-guide",level:2},{value:"Passo 1: Solicitar token de uso \xfanico",id:"step-1-request-one-time-token",level:3},{value:"Passo 2: Compor seu magic link",id:"step-2-compose-your-magic-link",level:3},{value:"Passo 3: Acionar o fluxo de autentica\xe7\xe3o via Logto SDK",id:"step-3-trigger-the-authentication-flow-via-logto-sdk",level:3},{value:"Passo 4: (Opcional) Limpar tokens em cache na p\xe1gina de callback do login",id:"step-4-clear-cached-tokens-in-sign-in-callback-page",level:3},{value:"Perguntas frequentes",id:"faqs",level:2},{value:"Posso usar o magic link para convidar novos usu\xe1rios para minhas organiza\xe7\xf5es?",id:"can-i-use-the-magic-link-to-invite-new-users-to-my-organizations",level:3},{value:"O token de uso \xfanico expira?",id:"does-the-one-time-token-expire",level:3},{value:"Se eu desativar o registro de usu\xe1rios em &quot;Experi\xeancia de login&quot;, ainda posso usar magic link para convidar usu\xe1rios?",id:"if-i-disable-user-registration-in-sign-in-experience-can-i-still-use-magic-link-to-invite-users",level:3},{value:"O que acontece se um usu\xe1rio j\xe1 estiver autenticado e clicar em outro magic link?",id:"what-will-happen-if-a-user-already-signed-in-and-then-click-another-magic-link",level:3}];function u(e){const o={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",...(0,s.R)(),...e.components},{Details:a}=o;return a||function(e,o){throw new Error("Expected "+(o?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.header,{children:(0,n.jsx)(o.h1,{id:"magic-link-token-de-uso-\xfanico",children:"Magic link (Token de uso \xfanico)"})}),"\n","\n",(0,n.jsx)(r.A,{cloud:!0,oss:{major:1,minor:27}}),"\n",(0,n.jsx)(o.p,{children:"Semelhante \xe0 senha de uso \xfanico (OTP), um token de uso \xfanico \xe9 outro m\xe9todo de autentica\xe7\xe3o sem senha que pode ser usado para verificar a identidade de um usu\xe1rio.\nO token \xe9 v\xe1lido por um per\xedodo limitado de tempo e est\xe1 associado ao endere\xe7o de email do usu\xe1rio final."}),"\n",(0,n.jsx)(o.p,{children:'\xc0s vezes, voc\xea pode querer convidar novos usu\xe1rios para seu aplicativo / organiza\xe7\xe3o sem exigir que eles criem uma conta primeiro.\nOu voc\xea pode esquecer sua senha e querer fazer login / redefinir sua senha rapidamente verificando sua identidade por email.\nNesses casos, o aplicativo pode enviar um "magic link" para seu email. E voc\xea ser\xe1 autenticado imediatamente ao clicar no link.'}),"\n",(0,n.jsx)(o.p,{children:"Os desenvolvedores de aplicativos podem usar o token de uso \xfanico para compor um magic link e envi\xe1-lo para o endere\xe7o de email do usu\xe1rio final."}),"\n",(0,n.jsx)(o.h2,{id:"one-time-token-flow",children:"Fluxo do token de uso \xfanico"}),"\n",(0,n.jsx)(o.p,{children:"Aqui est\xe1 o diagrama de sequ\xeancia do fluxo de autentica\xe7\xe3o usando token de uso \xfanico:"}),"\n",(0,n.jsx)(o.mermaid,{value:"sequenceDiagram\n  participant U as Usu\xe1rio final\n  participant C as Seu aplicativo\n  participant L as Logto\n\n  U ->> C: (Opcional) Usu\xe1rio solicita um magic link do seu aplicativo\n  C ->> L: Solicita token de uso \xfanico\n  L --\x3e> C: Retorna token de uso \xfanico\n  C --\x3e> U: Comp\xf5e um magic link que cont\xe9m o token de uso \xfanico e envia para o email do usu\xe1rio final\n  U ->> C: Usu\xe1rio clica no magic link e \xe9 redirecionado para uma landing page do seu aplicativo\n  C ->> L: Extrai o token de uso \xfanico do magic link e aciona o fluxo de autentica\xe7\xe3o\n  L --\x3e> C: Logto verifica o token de uso \xfanico e retorna o resultado\n  C --\x3e> U: Usu\xe1rio \xe9 autenticado e retorna userinfo para o usu\xe1rio"}),"\n",(0,n.jsx)(o.h2,{id:"implementation-guide",children:"Guia de implementa\xe7\xe3o"}),"\n",(0,n.jsx)(o.p,{children:"O Logto oferece um conjunto de Management APIs e Experience APIs para facilitar a implementa\xe7\xe3o do seu magic link."}),"\n",(0,n.jsxs)(o.p,{children:["Antes de come\xe7ar, certifique-se de que voc\xea tem uma inst\xe2ncia Logto pronta e estabeleceu a conex\xe3o M\xe1quina para M\xe1quina entre o servidor do seu aplicativo\ne o endpoint Logto (necess\xe1rio para as Management APIs). Saiba mais sobre a ",(0,n.jsx)(o.a,{href:"/integrate-logto/interact-with-management-api",children:"Logto Management API"}),"."]}),"\n",(0,n.jsx)(o.h3,{id:"step-1-request-one-time-token",children:"Passo 1: Solicitar token de uso \xfanico"}),"\n",(0,n.jsx)(o.p,{children:"Use a Logto Management API para criar um token de uso \xfanico."}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-bash",children:"POST /api/one-time-tokens\n"})}),"\n",(0,n.jsx)(o.p,{children:"Exemplo de payload do corpo da requisi\xe7\xe3o:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-json",children:'{\n  "email": "user@example.com",\n  // Opcional. Padr\xe3o \xe9 600 (10 minutos).\n  "expiresIn": 3600,\n  // Opcional. O usu\xe1rio ser\xe1 provisionado para as organiza\xe7\xf5es especificadas ap\xf3s verifica\xe7\xe3o bem-sucedida.\n  "context": {\n    "jitOrganizationIds": ["abcdefgh1234"]\n  }\n}\n'})}),"\n",(0,n.jsx)(o.h3,{id:"step-2-compose-your-magic-link",children:"Passo 2: Compor seu magic link"}),"\n",(0,n.jsxs)(o.p,{children:["Depois de obter o token de uso \xfanico, voc\xea pode compor um magic link e envi\xe1-lo para o endere\xe7o de email do usu\xe1rio final.\nO magic link deve conter pelo menos o token e o email do usu\xe1rio como par\xe2metros, e deve direcionar para uma landing page em seu pr\xf3prio aplicativo.\nExemplo: ",(0,n.jsx)(o.code,{children:"https://yourapp.com/landing-page"}),"."]}),"\n",(0,n.jsx)(o.p,{children:"Aqui est\xe1 um exemplo simples de como o magic link pode ser:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{children:"https://yourapp.com/landing-page?token=YHwbXSXxQfL02IoxFqr1hGvkB13uTqcd&email=user@example.com\n"})}),"\n",(0,n.jsx)(o.admonition,{type:"note",children:(0,n.jsx)(o.p,{children:"Os nomes dos par\xe2metros no magic link podem ser totalmente personalizados.\nVoc\xea pode adicionar informa\xe7\xf5es adicionais ao magic link conforme as necessidades do seu aplicativo,\nbem como codificar todos os par\xe2metros da URL."})}),"\n",(0,n.jsx)(o.h3,{id:"step-3-trigger-the-authentication-flow-via-logto-sdk",children:"Passo 3: Acionar o fluxo de autentica\xe7\xe3o via Logto SDK"}),"\n",(0,n.jsxs)(o.p,{children:["Depois que o usu\xe1rio final clicar no magic link e for direcionado ao seu aplicativo, voc\xea pode extrair os par\xe2metros ",(0,n.jsx)(o.code,{children:"token"})," e ",(0,n.jsx)(o.code,{children:"email"})," da URL e ent\xe3o chamar a fun\xe7\xe3o ",(0,n.jsx)(o.code,{children:"signIn()"})," do Logto SDK para acionar o fluxo de autentica\xe7\xe3o."]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-typescript",metastring:'title="TokenLandingPage.tsx"',children:"// Exemplo React\nimport { useLogto } from '@logto/react';\nimport { useEffect } from 'react';\nimport { useSearchParams } from 'react-router-dom';\n\nconst TokenLandingPage = () => {\n  const { signIn } = useLogto();\n  const [searchParams] = useSearchParams();\n\n  useEffect(() => {\n    // Extrai o token e o email do magic link\n    const oneTimeToken = searchParams.get('token');\n    const email = searchParams.get('email');\n\n    // Supondo que este seja seu redirect URI de login\n    const redirectUri = 'https://yourapp.com/callback';\n\n    if (oneTimeToken && email) {\n      signIn({\n        redirectUri,\n        clearTokens: false, // Opcional. Veja o aviso abaixo\n        extraParams: {\n          'one_time_token': oneTimeToken,\n          'login_hint': email,\n        },\n      });\n    }\n  }, [searchParams, signIn]);\n\n  return <>Por favor, aguarde...</>;\n};\n"})}),"\n",(0,n.jsxs)(o.admonition,{type:"warning",children:[(0,n.jsxs)(o.p,{children:["Se um usu\xe1rio j\xe1 estiver autenticado, chamar a fun\xe7\xe3o ",(0,n.jsx)(o.code,{children:"signIn()"})," do SDK ir\xe1 automaticamente limpar todos os tokens em cache (Token de ID, Token de acesso e Token de atualiza\xe7\xe3o) do armazenamento do cliente,\no que resulta na perda do status de autentica\xe7\xe3o do usu\xe1rio atual."]}),(0,n.jsxs)(o.p,{children:["Portanto, voc\xea deve especificar um par\xe2metro adicional de login ",(0,n.jsx)(o.code,{children:"clearTokens: false"})," para evitar a limpeza dos tokens existentes.\nSe isso for especificado, voc\xea tamb\xe9m precisar\xe1 limpar manualmente os tokens na p\xe1gina de callback do login."]}),(0,n.jsx)(o.p,{children:"Ignore isso se seus magic links n\xe3o forem projetados para usu\xe1rios j\xe1 autenticados."})]}),"\n",(0,n.jsx)(o.h3,{id:"step-4-clear-cached-tokens-in-sign-in-callback-page",children:"Passo 4: (Opcional) Limpar tokens em cache na p\xe1gina de callback do login"}),"\n",(0,n.jsxs)(o.p,{children:["Se voc\xea especificar ",(0,n.jsx)(o.code,{children:"clearTokens: false"})," na fun\xe7\xe3o de login, ser\xe1 necess\xe1rio limpar manualmente os tokens na p\xe1gina de callback do login."]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-typescript",metastring:'title="Callback.tsx"',children:"// Exemplo React\nimport { useHandleSignInCallback, useLogto } from '@logto/react';\nimport { useEffect } from 'react';\n\nconst Callback = () => {\n  const { clearAllTokens } = useLogto();\n\n  useEffect(() => {\n    void clearAllTokens();\n  }, [clearAllTokens]);\n\n  useHandleSignInCallback(() => {\n    // Navegue para sua p\xe1gina inicial\n  });\n\n  return <>Por favor, aguarde...</>;\n};\n"})}),"\n",(0,n.jsx)(o.h2,{id:"faqs",children:"Perguntas frequentes"}),"\n",(0,n.jsxs)(a,{children:[(0,n.jsx)("summary",{children:(0,n.jsx)(o.h3,{id:"can-i-use-the-magic-link-to-invite-new-users-to-my-organizations",children:"Posso usar o magic link para convidar novos usu\xe1rios para minhas organiza\xe7\xf5es?"})}),(0,n.jsxs)(o.p,{children:["Sim, voc\xea pode usar o magic link para convidar novos usu\xe1rios para seu aplicativo, bem como para organiza\xe7\xf5es.\nSe quiser convidar novos usu\xe1rios para sua organiza\xe7\xe3o, basta especificar o ",(0,n.jsx)(o.code,{children:"jitOrganizationIds"})," no corpo da requisi\xe7\xe3o."]}),(0,n.jsx)(o.p,{children:'O usu\xe1rio ingressar\xe1 automaticamente nas organiza\xe7\xf5es ap\xf3s a verifica\xe7\xe3o bem-sucedida, e os pap\xe9is padr\xe3o da organiza\xe7\xe3o ser\xe3o atribu\xeddos.\nConfira a se\xe7\xe3o "Just-in-time provisioning" na p\xe1gina de detalhes da sua organiza\xe7\xe3o e configure os pap\xe9is padr\xe3o para suas organiza\xe7\xf5es.'})]}),"\n",(0,n.jsxs)(a,{children:[(0,n.jsx)("summary",{children:(0,n.jsx)(o.h3,{id:"does-the-one-time-token-expire",children:"O token de uso \xfanico expira?"})}),(0,n.jsxs)(o.p,{children:["Sim, o token de uso \xfanico ir\xe1 expirar ap\xf3s o tempo especificado em ",(0,n.jsx)(o.code,{children:"expiresIn"})," (em segundos). O tempo padr\xe3o de expira\xe7\xe3o \xe9 10 minutos."]})]}),"\n",(0,n.jsxs)(a,{children:[(0,n.jsx)("summary",{children:(0,n.jsx)(o.h3,{id:"if-i-disable-user-registration-in-sign-in-experience-can-i-still-use-magic-link-to-invite-users",children:'Se eu desativar o registro de usu\xe1rios em "Experi\xeancia de login", ainda posso usar magic link para convidar usu\xe1rios?'})}),(0,n.jsx)(o.p,{children:'Sim, voc\xea ainda pode usar magic link para convidar usu\xe1rios mesmo que desative o registro de usu\xe1rios em "Experi\xeancia de login".'})]}),"\n",(0,n.jsxs)(a,{children:[(0,n.jsx)("summary",{children:(0,n.jsx)(o.h3,{id:"what-will-happen-if-a-user-already-signed-in-and-then-click-another-magic-link",children:"O que acontece se um usu\xe1rio j\xe1 estiver autenticado e clicar em outro magic link?"})}),(0,n.jsx)(o.p,{children:"Existem v\xe1rios cen\xe1rios poss\xedveis:"}),(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsx)(o.li,{children:"O usu\xe1rio j\xe1 est\xe1 autenticado e clica em um magic link associado \xe0 conta do usu\xe1rio atual. Nesse caso, o Logto ainda ir\xe1 verificar o token de uso \xfanico e provisionar o usu\xe1rio para as organiza\xe7\xf5es especificadas, se necess\xe1rio."}),"\n",(0,n.jsxs)(o.li,{children:["O usu\xe1rio j\xe1 est\xe1 autenticado e clica em um magic link associado a uma conta diferente. Nesse caso, o Logto solicitar\xe1 ao usu\xe1rio que continue como a nova conta ou volte ao aplicativo com a conta atual.","\n",(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsx)(o.li,{children:"Se o usu\xe1rio escolher continuar como a nova conta, o Logto mudar\xe1 para a nova conta ap\xf3s a verifica\xe7\xe3o bem-sucedida do token."}),"\n",(0,n.jsx)(o.li,{children:"Se o usu\xe1rio escolher permanecer na conta atual, o Logto n\xe3o verificar\xe1 o token e retornar\xe1 ao aplicativo com a conta atual."}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(o.li,{children:'Se seu prompt de login estiver definido como "login" ou contiver "login", o Logto far\xe1 automaticamente o login da conta associada ao token de uso \xfanico sem solicitar a troca.'}),"\n"]})]})]})}function m(e={}){const{wrapper:o}={...(0,s.R)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(u,{...e})}):u(e)}},88969:(e,o,a)=>{a.d(o,{A:()=>r});const i="availability_kRMk";var n=a(25105);const s=e=>"comingSoon"===e?"coming soon-blue":"boolean"==typeof e?e?"\u2713 available-4EA254":"not applicable-78767F":`since v${e.major}.${e.minor}-4EA254`,r=e=>{let{cloud:o,oss:a}=e;return(0,n.jsxs)("div",{className:i,children:[(0,n.jsx)("img",{alt:"Cloud availability",src:`https://img.shields.io/badge/Cloud-${s(o)}`}),(0,n.jsx)("img",{alt:"OSS availability",src:`https://img.shields.io/badge/OSS-${s(a)}`})]})}},79621:(e,o,a)=>{a.d(o,{R:()=>r,x:()=>t});var i=a(58101);const n={},s=i.createContext(n);function r(e){const o=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function t(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),i.createElement(s.Provider,{value:o},e.children)}}}]);