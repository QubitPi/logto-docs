"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[2058],{3092:(e,o,a)=>{a.r(o),a.d(o,{assets:()=>d,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"integrate-logto/protected-app","title":"Protected App \u2014 Integra\xe7\xe3o de autentica\xe7\xe3o sem SDK","description":"Adicione facilmente autentica\xe7\xe3o sem c\xf3digo aos seus aplicativos web com o inovador Protected App do Logto, alimentado pelo Cloudflare. Suporta HTTP Basic Authentication e valida\xe7\xe3o de JWT.","source":"@site/i18n/pt-BR/docusaurus-plugin-content-docs/current/integrate-logto/protected-app.mdx","sourceDirName":"integrate-logto","slug":"/integrate-logto/protected-app","permalink":"/pt-BR/integrate-logto/protected-app","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/pt-BR/docusaurus-plugin-content-docs/current/integrate-logto/protected-app.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"description":"Adicione facilmente autentica\xe7\xe3o sem c\xf3digo aos seus aplicativos web com o inovador Protected App do Logto, alimentado pelo Cloudflare. Suporta HTTP Basic Authentication e valida\xe7\xe3o de JWT.","sidebar_label":"Protected App","sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Compreender o fluxo de autentica\xe7\xe3o","permalink":"/pt-BR/integrate-logto/integrate-logto-into-your-application/understand-authentication-flow"},"next":{"title":"Aplicativo SAML","permalink":"/pt-BR/integrate-logto/saml-app/"}}');var n=a(25105),i=a(79621);const r={description:"Adicione facilmente autentica\xe7\xe3o sem c\xf3digo aos seus aplicativos web com o inovador Protected App do Logto, alimentado pelo Cloudflare. Suporta HTTP Basic Authentication e valida\xe7\xe3o de JWT.",sidebar_label:"Protected App",sidebar_position:2},s="Protected App \u2014 Integra\xe7\xe3o de autentica\xe7\xe3o sem SDK",d={},c=[{value:"Como o Protected App funciona",id:"how-protected-app-works",level:2},{value:"Proteja seu servidor de origem",id:"protect-your-origin-server",level:2},{value:"Valida\xe7\xe3o de Cabe\xe7alho HTTP",id:"http-header-validation",level:3},{value:"Valida\xe7\xe3o de JSON Web Tokens (JWT)",id:"json-web-tokens-jwt-validation",level:3},{value:"Obter estado de autentica\xe7\xe3o e informa\xe7\xf5es do usu\xe1rio",id:"get-authentication-state-and-user-information",level:2},{value:"Obter o host original",id:"get-the-original-host",level:2},{value:"Personalizar regras de autentica\xe7\xe3o",id:"customize-authentication-rules",level:2},{value:"Desenvolvimento local",id:"local-development",level:2},{value:"Transi\xe7\xe3o para integra\xe7\xe3o com SDK",id:"transition-to-sdk-integration",level:2},{value:"Recursos relacionados",id:"related-resources",level:2}];function l(e){const o={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",...(0,i.R)(),...e.components},{Url:a}=o;return a||function(e,o){throw new Error("Expected "+(o?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.header,{children:(0,n.jsx)(o.h1,{id:"protected-app--integra\xe7\xe3o-de-autentica\xe7\xe3o-sem-sdk",children:"Protected App \u2014 Integra\xe7\xe3o de autentica\xe7\xe3o sem SDK"})}),"\n",(0,n.jsxs)(o.p,{children:["O Protected App foi projetado para eliminar a complexidade das ",(0,n.jsx)(o.a,{href:"/quick-starts",children:"integra\xe7\xf5es de SDK"})," separando a ",(0,n.jsx)(o.a,{href:"https://auth.wiki/authentication",children:"autentica\xe7\xe3o"})," do seu aplicativo. N\xf3s cuidamos da autentica\xe7\xe3o, permitindo que voc\xea se concentre na sua funcionalidade principal. Uma vez que um usu\xe1rio \xe9 autenticado, o Protected App serve o conte\xfado do seu servidor."]}),"\n",(0,n.jsx)(o.h2,{id:"how-protected-app-works",children:"Como o Protected App funciona"}),"\n",(0,n.jsx)(o.p,{children:"O Protected App, alimentado pelo Cloudflare, opera globalmente em redes de borda, garantindo baixa lat\xeancia e alta disponibilidade para o seu aplicativo."}),"\n",(0,n.jsx)(o.p,{children:"O Protected App mant\xe9m o estado da sess\xe3o e as informa\xe7\xf5es do usu\xe1rio. Se um usu\xe1rio n\xe3o estiver autenticado, o Protected App os redireciona para a p\xe1gina de login. Uma vez autenticado, o Protected App envolve a solicita\xe7\xe3o do usu\xe1rio com autentica\xe7\xe3o e informa\xe7\xf5es do usu\xe1rio, e ent\xe3o a encaminha para o servidor de origem."}),"\n",(0,n.jsx)(o.p,{children:"Este processo \xe9 visualizado no seguinte fluxograma:"}),"\n",(0,n.jsx)(o.mermaid,{value:'graph LR\n  A("Cliente<br/>(Navegador)") --\x3e|Solicita\xe7\xe3o| B(Logto<br/>Protected App)\n  B --\x3e Condition{{Rota<br/>corresponde?}}\n  Condition --\x3e|Sim| Matched{{Est\xe1 autenticado?}}\n  Matched --\x3e|Sim| C(Servidor de origem)\n  Matched --\x3e|N\xe3o| D(Logto login)\n  Condition --\x3e|N\xe3o| C'}),"\n",(0,n.jsx)(o.h2,{id:"protect-your-origin-server",children:"Proteja seu servidor de origem"}),"\n",(0,n.jsx)(o.p,{children:"O servidor de origem, que pode ser um dispositivo f\xedsico ou virtual n\xe3o pertencente ao Protected App do Logto, \xe9 onde reside o conte\xfado do seu aplicativo. Semelhante a um servidor de Rede de Distribui\xe7\xe3o de Conte\xfado (CDN), o Protected App gerencia processos de autentica\xe7\xe3o e recupera conte\xfado do seu servidor de origem. Portanto, se os usu\xe1rios obtiverem acesso direto ao seu servidor de origem, eles podem contornar a autentica\xe7\xe3o e seu aplicativo n\xe3o estar\xe1 mais protegido."}),"\n",(0,n.jsx)(o.p,{children:"Portanto, \xe9 importante proteger as conex\xf5es de origem, isso impede que invasores descubram e acessem seu servidor de origem sem autentica\xe7\xe3o. Existem v\xe1rias maneiras de fazer isso:"}),"\n",(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsx)(o.li,{children:"Valida\xe7\xe3o de Cabe\xe7alho HTTP"}),"\n",(0,n.jsx)(o.li,{children:"Valida\xe7\xe3o de JSON Web Tokens (JWT)"}),"\n"]}),"\n",(0,n.jsx)(o.h3,{id:"http-header-validation",children:"Valida\xe7\xe3o de Cabe\xe7alho HTTP"}),"\n",(0,n.jsxs)(o.p,{children:["Proteger seu servidor de origem pode ser alcan\xe7ado usando ",(0,n.jsx)(o.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Authentication#basic_authentication_scheme",children:"HTTP Basic Authentication"})," para proteger seu servidor de origem."]}),"\n",(0,n.jsx)(o.p,{children:"Cada solicita\xe7\xe3o do Protected App inclui o seguinte cabe\xe7alho:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{children:"Authorization: Basic base64(appId:appSecret)\n"})}),"\n",(0,n.jsx)(o.p,{children:"Ao validar este cabe\xe7alho, voc\xea pode confirmar que a solicita\xe7\xe3o vem do Protected App e negar quaisquer solicita\xe7\xf5es que n\xe3o incluam este cabe\xe7alho."}),"\n",(0,n.jsx)(o.p,{children:"Se voc\xea estiver usando Nginx ou Apache, pode consultar os seguintes guias para implementar HTTP Basic Authentication no seu servidor de origem:"}),"\n",(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsxs)(o.li,{children:["Nginx: ",(0,n.jsx)(o.a,{href:"https://docs.nginx.com/nginx/admin-guide/security-controls/configuring-http-basic-authentication/",children:"Configuring HTTP Basic Authentication"})]}),"\n",(0,n.jsxs)(o.li,{children:["Apache: ",(0,n.jsx)(o.a,{href:"https://httpd.apache.org/docs/2.4/howto/auth.html",children:"Authentication and Authorization"})]}),"\n"]}),"\n",(0,n.jsxs)(o.p,{children:["Para verificar os cabe\xe7alhos dentro do seu aplicativo, consulte o ",(0,n.jsx)(o.a,{href:"https://developers.cloudflare.com/workers/examples/basic-auth/",children:"exemplo de HTTP Basic Authentication"})," fornecido pela Cloudflare para aprender como restringir o acesso usando o esquema HTTP Basic."]}),"\n",(0,n.jsx)(o.h3,{id:"json-web-tokens-jwt-validation",children:"Valida\xe7\xe3o de JSON Web Tokens (JWT)"}),"\n",(0,n.jsx)(o.p,{children:"Outra maneira de proteger seu servidor de origem \xe9 usando JSON Web Tokens (JWT)."}),"\n",(0,n.jsx)(o.p,{children:"Cada solicita\xe7\xe3o autenticada do Protected App inclui o seguinte cabe\xe7alho:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{children:"Logto-ID-Token: <JWT>\n"})}),"\n",(0,n.jsxs)(o.p,{children:["O JWT \xe9 chamado de ",(0,n.jsx)(o.a,{href:"https://auth.wiki/id-token",children:"Token de ID"}),", que \xe9 assinado pelo Logto e cont\xe9m informa\xe7\xf5es do usu\xe1rio. Ao validar este JWT, voc\xea pode confirmar que a solicita\xe7\xe3o vem do Protected App e negar quaisquer solicita\xe7\xf5es que n\xe3o incluam este cabe\xe7alho."]}),"\n",(0,n.jsxs)(o.p,{children:["O token \xe9 criptografado e assinado como um token ",(0,n.jsx)(o.a,{href:"https://auth.wiki/jws",children:"JWS"}),"."]}),"\n",(0,n.jsx)(o.p,{children:"Os passos de valida\xe7\xe3o:"}),"\n",(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsx)(o.li,{children:(0,n.jsx)(o.a,{href:"https://datatracker.ietf.org/doc/html/rfc7519#section-7.2",children:"Validando um JWT"})}),"\n",(0,n.jsx)(o.li,{children:(0,n.jsx)(o.a,{href:"https://datatracker.ietf.org/doc/html/rfc7515#section-5.2",children:"Validando a assinatura JWS"})}),"\n",(0,n.jsxs)(o.li,{children:["O emissor do token \xe9 ",(0,n.jsx)(o.code,{children:"https://<your-logto-domain>/oidc"})," (emitido pelo seu servidor de autentica\xe7\xe3o Logto)"]}),"\n"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-js",children:"const express = require('express');\nconst jwksClient = require('jwks-rsa');\nconst jwt = require('jsonwebtoken');\n\nconst ISSUER = 'https://<your-logto-domain>/oidc';\nconst CERTS_URL = 'https://<your-logto-domain>/oidc/jwks';\n\nconst client = jwksClient({\n  jwksUri: CERTS_URL,\n});\n\nconst getKey = (header, callback) => {\n  client.getSigningKey(header.kid, function (err, key) {\n    callback(err, key?.getPublicKey());\n  });\n};\n\nconst verifyToken = (req, res, next) => {\n  const token = req.headers['Logto-ID-Token'];\n\n  // Certifique-se de que a solicita\xe7\xe3o recebida tenha nosso cabe\xe7alho de token\n  if (!token) {\n    return res\n      .status(403)\n      .send({ status: false, message: 'missing required Logto-ID-Token header' });\n  }\n\n  jwt.verify(token, getKey, { issuer: ISSUER }, (err, decoded) => {\n    if (err) {\n      return res.status(403).send({ status: false, message: 'invalid id token' });\n    }\n\n    req.user = decoded;\n    next();\n  });\n};\n\nconst app = express();\n\napp.use(verifyToken);\n\napp.get('/', (req, res) => {\n  res.send('Hello World!');\n});\n\napp.listen(3000);\n"})}),"\n",(0,n.jsx)(o.h2,{id:"get-authentication-state-and-user-information",children:"Obter estado de autentica\xe7\xe3o e informa\xe7\xf5es do usu\xe1rio"}),"\n",(0,n.jsxs)(o.p,{children:["Se voc\xea precisar obter autentica\xe7\xe3o e informa\xe7\xf5es do usu\xe1rio para seu aplicativo, tamb\xe9m pode usar o cabe\xe7alho ",(0,n.jsx)(o.code,{children:"Logto-ID-Token"}),"."]}),"\n",(0,n.jsx)(o.p,{children:"Se voc\xea apenas quiser decodificar o token, pode usar o seguinte c\xf3digo:"}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-js",children:"const express = require('express');\n\nconst decodeIdToken = (req, res, next) => {\n  const token = req.headers['Logto-ID-Token'];\n\n  if (!token) {\n    return res.status(403).send({\n      status: false,\n      message: 'missing required Logto-ID-Token header',\n    });\n  }\n\n  const parts = token.split('.');\n  if (parts.length !== 3) {\n    throw new Error('Invalid ID token');\n  }\n\n  const payload = parts[1];\n  const decodedPayload = atob(payload.replace(/-/g, '+').replace(/_/g, '/'));\n  const claims = JSON.parse(decodedPayload);\n\n  req.user = claims;\n  next();\n};\n\nconst app = express();\n\napp.use(decodeIdToken);\n\napp.get('/', (req, res) => {\n  res.json(req.user);\n});\n\napp.listen(3000);\n"})}),"\n",(0,n.jsx)(o.h2,{id:"get-the-original-host",children:"Obter o host original"}),"\n",(0,n.jsxs)(o.p,{children:["Se voc\xea precisar obter o host original solicitado pelo cliente, pode usar o cabe\xe7alho ",(0,n.jsx)(o.code,{children:"Logto-Host"})," ou ",(0,n.jsx)(o.code,{children:"x-forwarded-host"}),"."]}),"\n",(0,n.jsx)(o.h2,{id:"customize-authentication-rules",children:"Personalizar regras de autentica\xe7\xe3o"}),"\n",(0,n.jsx)(o.p,{children:'Por padr\xe3o, o Protected App proteger\xe1 todas as rotas. Se voc\xea precisar personalizar as regras de autentica\xe7\xe3o, pode definir o campo "Regras de autentica\xe7\xe3o personalizadas" no Console.'}),"\n",(0,n.jsx)(o.p,{children:"Ele suporta express\xf5es regulares, aqui est\xe3o dois cen\xe1rios de caso:"}),"\n",(0,n.jsxs)(o.ol,{children:["\n",(0,n.jsxs)(o.li,{children:["Para proteger apenas as rotas ",(0,n.jsx)(o.code,{children:"/admin"})," e ",(0,n.jsx)(o.code,{children:"/privacy"})," com autentica\xe7\xe3o: ",(0,n.jsx)(o.code,{children:"^/(admin|privacy)/.*"})]}),"\n",(0,n.jsxs)(o.li,{children:["Para excluir imagens JPG da autentica\xe7\xe3o: ",(0,n.jsx)(o.code,{children:"^(?!.*\\.jpg$).*$"})]}),"\n"]}),"\n",(0,n.jsx)(o.h2,{id:"local-development",children:"Desenvolvimento local"}),"\n",(0,n.jsxs)(o.p,{children:["O Protected App foi projetado para funcionar com seu servidor de origem. No entanto, se seu servidor de origem n\xe3o for acess\xedvel publicamente, voc\xea pode usar uma ferramenta como ",(0,n.jsx)(o.a,{href:"https://ngrok.com/",children:"ngrok"})," ou ",(0,n.jsx)(o.a,{href:"https://developers.cloudflare.com/pages/how-to/preview-with-cloudflare-tunnel/",children:"Cloudflare Tunnels"})," para expor seu servidor local \xe0 internet."]}),"\n",(0,n.jsx)(o.h2,{id:"transition-to-sdk-integration",children:"Transi\xe7\xe3o para integra\xe7\xe3o com SDK"}),"\n",(0,n.jsxs)(o.p,{children:["O Protected App foi projetado para simplificar o processo de autentica\xe7\xe3o. No entanto, se voc\xea decidir fazer a transi\xe7\xe3o para a integra\xe7\xe3o com SDK para melhor controle e personaliza\xe7\xe3o, pode ",(0,n.jsx)(o.a,{href:"/integrate-logto/integrate-logto-into-your-application",children:"criar um novo aplicativo"})," no Logto e configurar a ",(0,n.jsx)(o.a,{href:"/quick-starts",children:"integra\xe7\xe3o com SDK"}),'. E para uma transi\xe7\xe3o suave, voc\xea pode reutilizar as configura\xe7\xf5es do aplicativo do Protected App. O Protected App \xe9, na verdade, um "Aplicativo Web Tradicional" no Logto, voc\xea pode encontrar o "',(0,n.jsx)(o.a,{href:"/integrate-logto/application-data-structure#application-id",children:"AppId"}),'" e o "',(0,n.jsx)(o.a,{href:"/integrate-logto/application-data-structure#application-secret",children:"AppSecret"}),'" nas configura\xe7\xf5es do aplicativo. Ap\xf3s a conclus\xe3o da transi\xe7\xe3o, voc\xea pode remover o Protected App do seu aplicativo.']}),"\n",(0,n.jsx)(o.h2,{id:"related-resources",children:"Recursos relacionados"}),"\n",(0,n.jsx)(a,{href:"https://www.youtube.com/watch?v=ZBrXW3iZyKY",children:(0,n.jsx)(o.p,{children:"Protected App: Construa a autentica\xe7\xe3o do seu aplicativo em cliques. Nenhum c\xf3digo necess\xe1rio."})}),"\n",(0,n.jsx)(a,{href:"https://blog.logto.io/protected-app",children:"A motiva\xe7\xe3o por tr\xe1s do Protected App"}),"\n",(0,n.jsx)(a,{href:"https://blog.logto.io/fastest-way-to-build-auth-system",children:(0,n.jsx)(o.p,{children:"A maneira mais r\xe1pida de construir um sistema de autentica\xe7\xe3o"})})]})}function p(e={}){const{wrapper:o}={...(0,i.R)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},79621:(e,o,a)=>{a.d(o,{R:()=>r,x:()=>s});var t=a(58101);const n={},i=t.createContext(n);function r(e){const o=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function s(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:r(e.components),t.createElement(i.Provider,{value:o},e.children)}}}]);