"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[4373],{7200:(e,s,o)=>{o.r(s),o.d(s,{assets:()=>d,contentTitle:()=>t,default:()=>l,frontMatter:()=>i,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"user-management/user-migration","title":"Migra\xe7\xe3o de usu\xe1rios","description":"O Logto suporta a migra\xe7\xe3o manual de usu\xe1rios existentes de outra plataforma. Este guia mostrar\xe1 como importar usu\xe1rios existentes via Management API e falar\xe1 sobre pontos que voc\xea deve considerar antes de migrar.","source":"@site/i18n/pt-BR/docusaurus-plugin-content-docs/current/user-management/user-migration.mdx","sourceDirName":"user-management","slug":"/user-management/user-migration","permalink":"/pt-BR/user-management/user-migration","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/pt-BR/docusaurus-plugin-content-docs/current/user-management/user-migration.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"docsSidebar","previous":{"title":"Token de acesso pessoal (Personal access token)","permalink":"/pt-BR/user-management/personal-access-token"},"next":{"title":"Gerenciamento de usu\xe1rios","permalink":"/pt-BR/user-management/"}}');var r=o(25105),n=o(79621);const i={sidebar_position:5},t="Migra\xe7\xe3o de usu\xe1rios",d={},c=[{value:"Esquema de usu\xe1rio",id:"user-schema",level:2},{value:"Hash de senha",id:"password-hashing",level:2},{value:"Etapas para migrar",id:"steps-to-migrate",level:2},{value:"Recursos relacionados",id:"related-resources",level:2}];function u(e){const s={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,n.R)(),...e.components},{Url:o}=s;return o||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"migra\xe7\xe3o-de-usu\xe1rios",children:"Migra\xe7\xe3o de usu\xe1rios"})}),"\n",(0,r.jsx)(s.p,{children:"O Logto suporta a migra\xe7\xe3o manual de usu\xe1rios existentes de outra plataforma. Este guia mostrar\xe1 como importar usu\xe1rios existentes via Management API e falar\xe1 sobre pontos que voc\xea deve considerar antes de migrar."}),"\n",(0,r.jsx)(s.h2,{id:"user-schema",children:"Esquema de usu\xe1rio"}),"\n",(0,r.jsxs)(s.p,{children:["Antes de come\xe7armos, vamos dar uma olhada no ",(0,r.jsx)(s.a,{href:"/user-management/user-data/#user-profile",children:"esquema de usu\xe1rio"})," no Logto. Existem 3 partes do esquema de usu\xe1rio que voc\xea deve conhecer:"]}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Dados b\xe1sicos"}),": s\xe3o as informa\xe7\xf5es b\xe1sicas do perfil do usu\xe1rio, voc\xea pode mapear os dados do seu perfil de usu\xe1rio existente."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Dados personalizados"}),": armazena informa\xe7\xf5es adicionais do usu\xe1rio, voc\xea pode usar isso para armazenar arquivos que n\xe3o podem ser mapeados nos dados b\xe1sicos."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Identidades sociais"}),": armazena as informa\xe7\xf5es do usu\xe1rio recuperadas do login social."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Voc\xea pode criar um mapa para associar as informa\xe7\xf5es do seu perfil de usu\xe1rio existente aos ",(0,r.jsx)(s.strong,{children:"dados b\xe1sicos"})," e ",(0,r.jsx)(s.strong,{children:"dados personalizados"}),". Para login social, ser\xe3o necess\xe1rios passos adicionais para importar as identidades sociais; consulte a API de ",(0,r.jsx)(s.a,{href:"https://openapi.logto.io/operation/operation-createuseridentity",children:"Vincular identidade social ao usu\xe1rio"}),"."]}),"\n",(0,r.jsx)(s.h2,{id:"password-hashing",children:"Hash de senha"}),"\n",(0,r.jsxs)(s.p,{children:["O Logto utiliza ",(0,r.jsx)(s.a,{href:"https://en.wikipedia.org/wiki/Argon2",children:"Argon2"})," para hashear a senha do usu\xe1rio, e tamb\xe9m suporta outros algoritmos como ",(0,r.jsx)(s.code,{children:"MD5"}),", ",(0,r.jsx)(s.code,{children:"SHA1"}),", ",(0,r.jsx)(s.code,{children:"SHA256"})," e ",(0,r.jsx)(s.code,{children:"Bcrypt"})," para facilitar a migra\xe7\xe3o. Esses algoritmos s\xe3o considerados inseguros; os hashes de senha correspondentes ser\xe3o migrados para Argon2 no primeiro login bem-sucedido do usu\xe1rio."]}),"\n",(0,r.jsxs)(s.p,{children:["Se voc\xea estiver usando outros algoritmos de hash ou salt, pode definir o ",(0,r.jsx)(s.code,{children:"passwordAlgorithm"})," como ",(0,r.jsx)(s.code,{children:"Legacy"}),", permitindo o uso de qualquer algoritmo de hash suportado pelo Node.js. Voc\xea pode encontrar a lista de algoritmos suportados na ",(0,r.jsx)(s.a,{href:"https://nodejs.org/api/crypto.html#cryptogethashes",children:"documenta\xe7\xe3o do Node.js crypto"}),". Nesse caso, o ",(0,r.jsx)(s.code,{children:"passwordDigest"})," ser\xe1 uma string JSON que cont\xe9m o algoritmo de hash e outros par\xe2metros espec\xedficos do algoritmo."]}),"\n",(0,r.jsx)(s.p,{children:"O formato da string JSON \xe9 o seguinte:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'["hash_algorithm", ["argument1", "argument2", ...], "expected_hashed_value"]\n'})}),"\n",(0,r.jsxs)(s.p,{children:["E voc\xea pode usar ",(0,r.jsx)(s.code,{children:"@"})," como um placeholder para o valor real da senha nos argumentos."]}),"\n",(0,r.jsx)(s.p,{children:"Por exemplo, se voc\xea estiver usando SHA256 com um salt, pode armazenar a senha no seguinte formato:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'["sha256", ["salt123", "@"], "c465f66c6ac481a7a17e9ed5b4e2e7e7288d892f12bf1c95c140901e9a70436e"]\n'})}),"\n",(0,r.jsx)(s.p,{children:"Isso equivale ao seguinte c\xf3digo:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-ts",children:"const hash = crypto.createHash('sha256');\nhash.update('salt123' + 'password123');\nconst expectedHashedValue = hash.digest('hex');\n"})}),"\n",(0,r.jsx)(s.h2,{id:"steps-to-migrate",children:"Etapas para migrar"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Prepare os dados do usu\xe1rio"}),(0,r.jsx)(s.br,{}),"\n","Voc\xea deve primeiro exportar os dados dos usu\xe1rios da sua plataforma atual e, em seguida, mapear as informa\xe7\xf5es do usu\xe1rio para o esquema de usu\xe1rio do Logto. Recomendamos preparar os dados mapeados em formato JSON. Aqui est\xe1 um exemplo dos dados do usu\xe1rio:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'[\n  {\n    "username": "user1",\n    "passwordDigest": "password-encrypted",\n    "passwordAlgorithm": "SHA256"\n  },\n  {\n    "username": "user2",\n    "passwordDigest": "password-encrypted",\n    "passwordAlgorithm": "SHA256"\n  }\n]\n'})}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Crie um tenant Logto"}),(0,r.jsx)(s.br,{}),"\n","Voc\xea precisar\xe1 configurar um tenant no Logto. Voc\xea pode usar tanto o Logto Cloud quanto o Logto OSS. Se ainda n\xe3o fez isso, consulte o guia ",(0,r.jsx)(s.a,{href:"/introduction/set-up-logto-cloud/#create-logto-tenant",children:"Configurar Logto cloud"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Configure a conex\xe3o com a Management API"}),(0,r.jsx)(s.br,{}),"\n","Usaremos a Management API para importar os dados dos usu\xe1rios. Voc\xea pode consultar a ",(0,r.jsx)(s.a,{href:"/integrate-logto/interact-with-management-api",children:"Management API"})," para aprender como configurar a conex\xe3o em seu ambiente de desenvolvimento."]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.strong,{children:"Importe os dados dos usu\xe1rios"}),(0,r.jsx)(s.br,{}),"\n","Recomenda-se preparar um script para importar os dados dos usu\xe1rios um por um. Chamaremos a API ",(0,r.jsx)(s.a,{href:"https://openapi.logto.io/operation/operation-createuser",children:"criar usu\xe1rio"})," para importar os dados. Veja um exemplo de script:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-jsx",children:"const users = require('./users.json');\n\nconst importUsers = async () => {\n  for (const user of users) {\n    try {\n      await fetch('https://[tenant_id].logto.app/api/users', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: 'Bearer [your-access-token]',\n        },\n        body: JSON.stringify(user),\n      });\n      // Aguarde um tempo para evitar limite de taxa\n      await new Promise((resolve) => setTimeout(resolve, 200));\n    } catch (error) {\n      console.error(`Falha ao importar usu\xe1rio ${user.username}: ${error.message}`);\n    }\n  }\n};\n\nimportUsers();\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["Observe que o endpoint da API possui limite de taxa; voc\xea deve adicionar uma pausa entre cada requisi\xe7\xe3o para evitar o rate limit. Consulte nossa p\xe1gina de ",(0,r.jsx)(s.a,{href:"/integrate-logto/interact-with-management-api/#rate-limit",children:"limites de taxa"})," para mais detalhes."]}),"\n",(0,r.jsxs)(s.p,{children:["Se voc\xea tiver uma grande quantidade de dados de usu\xe1rios (100k+ usu\xe1rios), pode ",(0,r.jsx)(s.a,{href:"https://logto.io/contact",children:"entrar em contato conosco"})," para aumentar o limite de taxa."]}),"\n",(0,r.jsx)(s.h2,{id:"related-resources",children:"Recursos relacionados"}),"\n",(0,r.jsx)(o,{href:"https://blog.logto.io/general-migration-guide",children:(0,r.jsx)(s.p,{children:"Um guia geral para migrar seu banco de dados de usu\xe1rios existente para o Logto"})})]})}function l(e={}){const{wrapper:s}={...(0,n.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},79621:(e,s,o)=>{o.d(s,{R:()=>i,x:()=>t});var a=o(58101);const r={},n=a.createContext(r);function i(e){const s=a.useContext(n);return a.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(n.Provider,{value:s},e.children)}}}]);