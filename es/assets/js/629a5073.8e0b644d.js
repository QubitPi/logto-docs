"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[6616],{25600:(e,n,r)=>{r.d(n,{Ay:()=>o,RM:()=>a});var s=r(25105),i=r(79621);const a=[];function t(e){const n={admonition:"admonition",p:"p",...(0,i.R)(),...e.components};return(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:['Esta gu\xeda asume que has creado una Aplicaci\xf3n del tipo "',e.type,'" en la Consola de Administraci\xf3n.']})})}function o(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},76094:(e,n,r)=>{r.d(n,{Ay:()=>o,RM:()=>a});var s=r(25105),i=r(79621);const a=[];function t(e){const n={p:"p",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["Vamos a cambiar a la p\xe1gina de detalles de la aplicaci\xf3n en Logto Console. A\xf1ade un URI de redirecci\xf3n ",(0,s.jsx)("code",{children:e.redirectUri}),' y haz clic en "Guardar cambios".']}),"\n",(0,s.jsx)("img",{alt:"URI de redirecci\xf3n en Logto Console",src:e.figureSrc,width:"600px"})]})}function o(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},75846:(e,n,r)=>{r.d(n,{Ay:()=>o,RM:()=>a});var s=r(25105),i=r(79621);const a=[];function t(e){const{Url:n}={...(0,i.R)(),...e.components};return n||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n,{href:"/end-user-flows",children:" Flujos de usuario final: flujos de autenticaci\xf3n, flujos de cuenta y flujos de organizaci\xf3n "}),"\n",(0,s.jsx)(n,{href:"/connectors",children:" Configurar conectores "}),"\n",(0,s.jsx)(n,{href:"/authorization",children:" Autorizaci\xf3n (Authorization) "})]})}function o(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},97113:(e,n,r)=>{r.d(n,{Ay:()=>o,RM:()=>a});var s=r(25105),i=r(79621);const a=[];function t(e){const n={admonition:"admonition",p:"p",...(0,i.R)(),...e.components};return(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsx)("p",{children:(0,s.jsx)(n.p,{children:'Puedes encontrar y copiar el "App Secret" desde la p\xe1gina de detalles de la aplicaci\xf3n en la\nConsola de Administraci\xf3n:'})}),(0,s.jsx)("img",{alt:"App Secret",src:"/img/assets/app-secret.png",width:"586px"})]})}function o(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},8358:(e,n,r)=>{r.d(n,{Ay:()=>o,RM:()=>a});var s=r(25105),i=r(79621);const a=[{value:"Sobre el inicio de sesi\xf3n basado en redirecci\xf3n",id:"regarding-redirect-based-sign-in",level:3}];function t(e){const n={a:"a",h3:"h3",li:"li",ol:"ol",p:"p",...(0,i.R)(),...e.components},{Details:r,MainSiteUrl:a}=n;return r||c("Details",!0),a||c("MainSiteUrl",!0),(0,s.jsxs)(r,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)(n.h3,{id:"regarding-redirect-based-sign-in",children:"Sobre el inicio de sesi\xf3n basado en redirecci\xf3n"})}),(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Este proceso de autenticaci\xf3n sigue el protocolo ",(0,s.jsx)(n.a,{href:"https://openid.net/specs/openid-connect-core-1_0.html",children:"OpenID Connect (OIDC)"}),", y Logto aplica medidas de seguridad estrictas para proteger el inicio de sesi\xf3n del usuario."]}),"\n",(0,s.jsx)(n.li,{children:"Si tienes m\xfaltiples aplicaciones, puedes usar el mismo proveedor de identidad (Logto). Una vez que el usuario inicia sesi\xf3n en una aplicaci\xf3n, Logto completar\xe1 autom\xe1ticamente el proceso de inicio de sesi\xf3n cuando el usuario acceda a otra aplicaci\xf3n."}),"\n"]}),(0,s.jsxs)(n.p,{children:["Para aprender m\xe1s sobre la l\xf3gica y los beneficios del inicio de sesi\xf3n basado en redirecci\xf3n, consulta ",(0,s.jsx)(a,{href:"/concepts/sign-in-experience",children:"Experiencia de inicio de sesi\xf3n de Logto explicada"}),"."]})]})}function o(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}function c(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},26484:(e,n,r)=>{r.d(n,{Ay:()=>o,RM:()=>a});var s=r(25105),i=r(79621);const a=[];function t(e){const n={admonition:"admonition",p:"p",...(0,i.R)(),...e.components};return(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["Antes de llamar a ",(0,s.jsx)("code",{children:e.calling}),", aseg\xfarate de haber configurado correctamente el URI de redirecci\xf3n en la Consola de Administraci\xf3n."]})})}function o(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(t,{...e})}):t(e)}},37220:(e,n,r)=>{r.d(n,{Ay:()=>c,RM:()=>t});var s=r(25105),i=r(79621),a=r(8358);const t=[...a.RM];function o(e){const n={hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Antes de profundizar en los detalles, aqu\xed tienes una visi\xf3n general r\xe1pida de la experiencia del usuario final. El proceso de inicio de sesi\xf3n se puede simplificar de la siguiente manera:"}),"\n",(0,s.jsx)(n.mermaid,{value:"graph LR\n    A(Tu aplicaci\xf3n) --\x3e|1. Invocar inicio de sesi\xf3n| B(Logto)\n    B --\x3e|2. Finalizar inicio de sesi\xf3n| A"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Tu aplicaci\xf3n invoca el m\xe9todo de inicio de sesi\xf3n."}),"\n",(0,s.jsx)(n.li,{children:"El usuario es redirigido a la p\xe1gina de inicio de sesi\xf3n de Logto. Para aplicaciones nativas, se abre el navegador del sistema."}),"\n",(0,s.jsx)(n.li,{children:"El usuario inicia sesi\xf3n y es redirigido de vuelta a tu aplicaci\xf3n (configurada como el URI de redirecci\xf3n)."}),"\n"]}),"\n",(0,s.jsx)(a.Ay,{}),"\n",(0,s.jsx)(n.hr,{})]})}function c(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},2399:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>x,contentTitle:()=>m,default:()=>b,frontMatter:()=>g,metadata:()=>s,toc:()=>j});const s=JSON.parse('{"id":"quick-starts/generic/traditional/README","title":"A\xf1ade autenticaci\xf3n a tu aplicaci\xf3n web tradicional","description":"Tu aplicaci\xf3n puede ejecutarse en el lado del servidor en lugar del navegador, utilizando frameworks como Django, Laravel, etc. Eso se llama una aplicaci\xf3n web tradicional. Si no puedes encontrar un SDK adecuado en esta p\xe1gina, probablemente necesites integrarlo manualmente.","source":"@site/i18n/es/docusaurus-plugin-content-docs/current/quick-starts/generic/traditional/README.mdx","sourceDirName":"quick-starts/generic/traditional","slug":"/quick-starts/traditional-web","permalink":"/es/quick-starts/traditional-web","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/es/docusaurus-plugin-content-docs/current/quick-starts/generic/traditional/README.mdx","tags":[],"version":"current","frontMatter":{"slug":"/quick-starts/traditional-web","sidebar_label":"Web tradicional","sidebar_custom_props":{"description":"Integra Logto con aplicaciones web tradicionales que se ejecutan en el servidor."}},"sidebar":"quickStartSidebar","previous":{"title":"M\xe1quina a m\xe1quina","permalink":"/es/quick-starts/m2m"},"next":{"title":"Hasura","permalink":"/es/quick-starts/hasura"}}');var i=r(25105),a=r(79621),t=r(38552),o=r(22002),c=r(25600),l=r(76094),d=r(75846),u=r(97113),p=r(26484),h=r(37220);const g={slug:"/quick-starts/traditional-web",sidebar_label:"Web tradicional",sidebar_custom_props:{description:"Integra Logto con aplicaciones web tradicionales que se ejecutan en el servidor."}},m="A\xf1ade autenticaci\xf3n a tu aplicaci\xf3n web tradicional",x={},j=[...c.RM,{value:"Obtener el c\xf3digo fuente",id:"get-source-code",level:2},{value:"Iniciar un proyecto Express",id:"start-an-express-project",level:2},{value:"Instalar dependencias",id:"install-dependencies",level:2},{value:"Usar sesi\xf3n",id:"use-session",level:2},{value:"Implementar funciones para autenticar usuarios",id:"implement-functions-to-authenticate-users",level:2},...u.RM,{value:"Iniciar sesi\xf3n",id:"sign-in",level:2},...h.RM,{value:"Configurar URI de redirecci\xf3n",id:"configure-redirect-uri",level:3},...l.RM,{value:"Implementar ruta de inicio de sesi\xf3n",id:"implement-sign-in-route",level:3},...p.RM,{value:"Cerrar sesi\xf3n",id:"sign-out",level:2},{value:"Acceder a recursos protegidos",id:"access-protected-resource",level:2},{value:"Lecturas adicionales",id:"further-readings",level:2},...d.RM];function f(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components},{Url:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"a\xf1ade-autenticaci\xf3n-a-tu-aplicaci\xf3n-web-tradicional",children:"A\xf1ade autenticaci\xf3n a tu aplicaci\xf3n web tradicional"})}),"\n",(0,i.jsx)(c.Ay,{type:"Traditional web"}),"\n",(0,i.jsx)(n.p,{children:"Tu aplicaci\xf3n puede ejecutarse en el lado del servidor en lugar del navegador, utilizando frameworks como Django, Laravel, etc. Eso se llama una aplicaci\xf3n web tradicional. Si no puedes encontrar un SDK adecuado en esta p\xe1gina, probablemente necesites integrarlo manualmente."}),"\n",(0,i.jsx)(n.p,{children:"Este art\xedculo te gu\xeda sobre c\xf3mo completarlo paso a paso. Y tomamos Express en Node.js como ejemplo."}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["Este art\xedculo no es solo para Express, y si est\xe1s utilizando otros frameworks o incluso otros lenguajes, puedes reemplazar ",(0,i.jsx)(n.code,{children:"@logto/js"})," con el SDK principal del lenguaje correspondiente y luego ajustar algunos de los pasos."]})}),"\n",(0,i.jsx)(n.h2,{id:"get-source-code",children:"Obtener el c\xf3digo fuente"}),"\n",(0,i.jsxs)(n.p,{children:["Puedes ir a ",(0,i.jsx)(n.a,{href:"https://github.com/logto-io/express-example",children:"GitHub"})," para obtener el c\xf3digo final de esta gu\xeda."]}),"\n",(0,i.jsx)(n.h2,{id:"start-an-express-project",children:"Iniciar un proyecto Express"}),"\n",(0,i.jsxs)(n.p,{children:["Con ",(0,i.jsx)(n.code,{children:"express-generator"}),", puedes iniciar r\xe1pidamente un proyecto Express."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"mkdir express-logto\ncd express-logto\nnpx express-generator\n"})}),"\n",(0,i.jsx)(n.h2,{id:"install-dependencies",children:"Instalar dependencias"}),"\n",(0,i.jsx)(n.p,{children:"La aplicaci\xf3n de demostraci\xf3n necesitar\xe1 4 dependencias:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"@logto/js"}),": El SDK principal de Logto para JavaScript."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"node-fetch"}),": C\xf3digo m\xednimo para una API compatible con ",(0,i.jsx)(n.code,{children:"window.fetch"})," en el entorno de Node.js."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"express-session"}),": Un middleware de sesi\xf3n, usaremos la sesi\xf3n para almacenar tokens de usuario."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"js-base64"}),": Otro transcodificador Base64."]}),"\n"]}),"\n",(0,i.jsxs)(o.A,{children:[(0,i.jsx)(t.A,{value:"npm",label:"npm",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm i @logto/js node-fetch@v2 express-session js-base64\n"})})}),(0,i.jsx)(t.A,{value:"yarn",label:"Yarn",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"yarn add @logto/js node-fetch@v2 express-session js-base64\n"})})}),(0,i.jsx)(t.A,{value:"pnpm",label:"pnpm",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pnpm add @logto/js node-fetch@v2 express-session js-base64\n"})})})]}),"\n",(0,i.jsx)(n.h2,{id:"use-session",children:"Usar sesi\xf3n"}),"\n",(0,i.jsx)(n.p,{children:"Cuando los usuarios inician sesi\xf3n, obtendr\xe1n un conjunto de tokens (Token de acceso, Token de ID, Token de actualizaci\xf3n) y datos de interacci\xf3n, y la sesi\xf3n es un excelente lugar para almacenarlos."}),"\n",(0,i.jsxs)(n.p,{children:["Hemos instalado ",(0,i.jsx)(n.a,{href:"https://github.com/expressjs/session",children:"express-session"})," en el paso anterior, as\xed que ahora simplemente agreguemos el siguiente c\xf3digo para configurarlo:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// app.js\n\nconst session = require('express-session');\n\napp.use(\n  session({\n    secret: 'keyboard cat', // Cambia a tu propia clave secreta\n    cookie: { maxAge: 86400 },\n  })\n);\n"})}),"\n",(0,i.jsx)(n.h2,{id:"implement-functions-to-authenticate-users",children:"Implementar funciones para autenticar usuarios"}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["Asumimos que la aplicaci\xf3n se est\xe1 ejecutando en ",(0,i.jsx)(n.code,{children:"http://localhost:3000"})," en los siguientes fragmentos de c\xf3digo."]})}),"\n",(0,i.jsx)(n.p,{children:"En este paso, necesitamos implementar las siguientes funciones de autenticaci\xf3n:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"getSignInUrl"}),": construye y devuelve una URL completa del Servidor de Autorizaci\xf3n de Logto a la que los usuarios ser\xe1n redirigidos."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"handleSignIn"}),": analiza la URL de callback despu\xe9s de que el proceso de autenticaci\xf3n se completa, obtiene el par\xe1metro de consulta de c\xf3digo y luego obtiene tokens (un token de acceso, el token de actualizaci\xf3n y un token de ID) para completar el proceso de inicio de sesi\xf3n."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"refreshTokens"}),": intercambia un nuevo token de acceso usando el token de actualizaci\xf3n."]}),"\n"]}),"\n",(0,i.jsx)(u.Ay,{}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// logto.js\n\nconst {\n  withReservedScopes,\n  fetchOidcConfig,\n  discoveryPath,\n  generateSignInUri,\n  verifyAndParseCodeFromCallbackUri,\n  fetchTokenByAuthorizationCode,\n  fetchTokenByRefreshToken,\n} = require('@logto/js');\nconst fetch = require('node-fetch');\nconst { randomFillSync, createHash } = require('crypto');\nconst { fromUint8Array } = require('js-base64');\n\nconst config = {\n  endpoint: 'https://logto.dev',\n  appId: 'foo',\n  appSecret: '<your-app-secret-copied-from-console>',\n  redirectUri: 'http://localhost:3000/callback', // Puede que necesites reemplazarlo con la direcci\xf3n de producci\xf3n de tu aplicaci\xf3n\n  scopes: withReservedScopes().split(' '),\n};\n\nconst requester = (input, init) => {\n  const { appId, appSecret } = config;\n\n  return fetch(input, {\n    ...init,\n    headers: {\n      ...init?.headers,\n      authorization: `Basic ${Buffer.from(`${appId}:${appSecret}`, 'utf8').toString('base64')}`,\n    },\n  });\n};\n\nconst generateRandomString = (length = 64) => {\n  return fromUint8Array(randomFillSync(new Uint8Array(length)), true);\n};\n\nconst generateCodeChallenge = async (codeVerifier) => {\n  const encodedCodeVerifier = new TextEncoder().encode(codeVerifier);\n  const hash = createHash('sha256');\n  hash.update(encodedCodeVerifier);\n  const codeChallenge = hash.digest();\n  return fromUint8Array(codeChallenge, true);\n};\n\nconst getOidcConfig = async () => {\n  return fetchOidcConfig(new URL(discoveryPath, config.endpoint).toString(), requester);\n};\n\nexports.getSignInUrl = async () => {\n  const { authorizationEndpoint } = await getOidcConfig();\n  const codeVerifier = generateRandomString();\n  const codeChallenge = await generateCodeChallenge(codeVerifier);\n  const state = generateRandomString();\n\n  const { redirectUri, scopes, appId: clientId } = config;\n\n  const signInUri = generateSignInUri({\n    authorizationEndpoint,\n    clientId,\n    redirectUri: redirectUri,\n    codeChallenge,\n    state,\n    scopes,\n  });\n\n  return { redirectUri, codeVerifier, state, signInUri };\n};\n\nexports.handleSignIn = async (signInSession, callbackUri) => {\n  const { redirectUri, state, codeVerifier } = signInSession;\n  const code = verifyAndParseCodeFromCallbackUri(callbackUri, redirectUri, state);\n\n  const { appId: clientId } = config;\n  const { tokenEndpoint } = await getOidcConfig();\n  const codeTokenResponse = await fetchTokenByAuthorizationCode(\n    {\n      clientId,\n      tokenEndpoint,\n      redirectUri,\n      codeVerifier,\n      code,\n    },\n    requester\n  );\n\n  return codeTokenResponse;\n};\n\nexports.refreshTokens = async (refreshToken) => {\n  const { appId: clientId, scopes } = config;\n  const { tokenEndpoint } = await getOidcConfig();\n  const tokenResponse = await fetchTokenByRefreshToken(\n    {\n      clientId,\n      tokenEndpoint,\n      refreshToken,\n      scopes,\n    },\n    requester\n  );\n\n  return tokenResponse;\n};\n"})}),"\n",(0,i.jsx)(n.h2,{id:"sign-in",children:"Iniciar sesi\xf3n"}),"\n",(0,i.jsx)(h.Ay,{}),"\n",(0,i.jsx)(n.h3,{id:"configure-redirect-uri",children:"Configurar URI de redirecci\xf3n"}),"\n",(0,i.jsx)(l.Ay,{figureSrc:"/img/assets/web-redirect-uri.png",redirectUri:"http://localhost:3000/callback"}),"\n",(0,i.jsx)(n.h3,{id:"implement-sign-in-route",children:"Implementar ruta de inicio de sesi\xf3n"}),"\n",(0,i.jsx)(p.Ay,{calling:"getSignInUrl()"}),"\n",(0,i.jsx)(n.p,{children:"Crea una ruta en Express para iniciar sesi\xf3n:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const { getSignInUrl } = require('./logto');\n\napp.get('/sign-in', async (req, res) => {\n  const { redirectUri, codeVerifier, state, signInUri } = await getSignInUrl();\n  req.session.signIn = { codeVerifier, state, redirectUri };\n  res.redirect(signInUri);\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:"y una ruta para manejar el callback:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"app.get('/callback', async (req, res) => {\n  if (!req.session.signIn) {\n    res.send('Solicitud incorrecta.');\n    return;\n  }\n\n  const response = await handleSignIn(\n    req.session.signIn,\n    `${req.protocol}://${req.get('host')}${req.originalUrl}`\n  );\n  req.session.tokens = {\n    ...response,\n    expiresAt: response.expiresIn + Date.now(),\n    idToken: decodeIdToken(response.idToken),\n  };\n  req.session.signIn = null;\n\n  res.redirect('/');\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"sign-out",children:"Cerrar sesi\xf3n"}),"\n",(0,i.jsx)(n.p,{children:'TODO: enlace al cap\xedtulo "session & cookies" en la referencia de usuarios.'}),"\n",(0,i.jsx)(n.p,{children:'Puedes borrar los tokens en la sesi\xf3n para cerrar la sesi\xf3n de un usuario de esta aplicaci\xf3n. Y consulta este enlace para leer m\xe1s sobre "cerrar sesi\xf3n".'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"app.get('/sign-out', (req, res) => {\n  req.session.tokens = null;\n  res.send('Cierre de sesi\xf3n exitoso');\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"access-protected-resource",children:"Acceder a recursos protegidos"}),"\n",(0,i.jsxs)(n.p,{children:["Crea un middleware llamado ",(0,i.jsx)(n.code,{children:"withAuth"})," para adjuntar un objeto ",(0,i.jsx)(n.code,{children:"auth"})," a ",(0,i.jsx)(n.code,{children:"req"}),", y verificar si un usuario ha iniciado sesi\xf3n."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"// auth.js\n\nconst { decodeIdToken } = require('@logto/js');\nconst { refreshTokens } = require('./logto');\n\nconst withAuth =\n  ({ requireAuth } = { requireAuth: true }) =>\n  async (req, res, next) => {\n    if (requireAuth && !req.session.tokens) {\n      res.redirect('/sign-in');\n      return;\n    }\n\n    if (req.session.tokens) {\n      if (req.session.tokens.expiresAt >= Date.now()) {\n        // Token de acceso expirado, refrescar para obtener nuevos tokens\n        try {\n          const response = await refreshTokens(req.session.tokens.refreshToken);\n          req.session.tokens = {\n            ...response,\n            expiresAt: response.expiresIn + Date.now(),\n            idToken: decodeIdToken(response.idToken),\n          };\n        } catch {\n          // Intercambio fallido, redirigir para iniciar sesi\xf3n\n          res.redirect('/sign-in');\n          return;\n        }\n      }\n\n      req.auth = req.session.tokens.idToken.sub;\n    }\n\n    next();\n  };\n\nmodule.exports = withAuth;\n"})}),"\n",(0,i.jsxs)(n.p,{children:["crea la p\xe1gina ",(0,i.jsx)(n.code,{children:"index"}),", muestra un enlace de inicio de sesi\xf3n para invitados y un enlace para ir al perfil para usuarios que ya han iniciado sesi\xf3n:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"router.get('/', withAuth({ requireAuth: false }), function (req, res, next) {\n  res.render('index', { auth: Boolean(req.auth) });\n});\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-jade",children:'extends layout\n\nblock content\n  h1 Hola logto\n  if auth\n    p: a(href="/user") Ir al perfil\n  else\n    p: a(href="/sign-in") Haz clic aqu\xed para iniciar sesi\xf3n\n'})}),"\n",(0,i.jsxs)(n.p,{children:["crea la p\xe1gina ",(0,i.jsx)(n.code,{children:"user"}),", para mostrar ",(0,i.jsx)(n.code,{children:"userId"})," (",(0,i.jsx)(n.code,{children:"subject"}),"):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"app.get('/user', withAuth(), (req, res, next) => {\n  res.render('user', { userId: req.auth });\n});\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-jade",children:"extends layout\n\nblock content\n  h1 Hola logto\n  p userId: #{userId}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"further-readings",children:"Lecturas adicionales"}),"\n",(0,i.jsx)(d.Ay,{}),"\n",(0,i.jsx)(r,{href:"https://blog.logto.io/gpt-action-oauth",children:(0,i.jsx)(n.p,{children:"Autenticar usuarios en acciones GPT: Construir un asistente de agenda personal"})})]})}function b(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(f,{...e})}):f(e)}},38552:(e,n,r)=>{r.d(n,{A:()=>t});r(58101);var s=r(13526);const i={tabItem:"tabItem_dgSZ"};var a=r(25105);function t(e){let{children:n,hidden:r,className:t}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,s.A)(i.tabItem,t),hidden:r,children:n})}},22002:(e,n,r)=>{r.d(n,{A:()=>k});var s=r(58101),i=r(13526),a=r(60755),t=r(55234),o=r(6635),c=r(4100),l=r(35661),d=r(42752);function u(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:r}=e;return(0,s.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:r,attributes:s,default:i}}=e;return{value:n,label:r,attributes:s,default:i}}))}(r);return function(e){const n=(0,l.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,r])}function h(e){let{value:n,tabValues:r}=e;return r.some((e=>e.value===n))}function g(e){let{queryString:n=!1,groupId:r}=e;const i=(0,t.W6)(),a=function(e){let{queryString:n=!1,groupId:r}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:n,groupId:r});return[(0,c.aZ)(a),(0,s.useCallback)((e=>{if(!a)return;const n=new URLSearchParams(i.location.search);n.set(a,e),i.replace({...i.location,search:n.toString()})}),[a,i])]}function m(e){const{defaultValue:n,queryString:r=!1,groupId:i}=e,a=p(e),[t,c]=(0,s.useState)((()=>function(e){let{defaultValue:n,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!h({value:n,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const s=r.find((e=>e.default))??r[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:n,tabValues:a}))),[l,u]=g({queryString:r,groupId:i}),[m,x]=function(e){let{groupId:n}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(n),[i,a]=(0,d.Dv)(r);return[i,(0,s.useCallback)((e=>{r&&a.set(e)}),[r,a])]}({groupId:i}),j=(()=>{const e=l??m;return h({value:e,tabValues:a})?e:null})();(0,o.A)((()=>{j&&c(j)}),[j]);return{selectedValue:t,selectValue:(0,s.useCallback)((e=>{if(!h({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);c(e),u(e),x(e)}),[u,x,a]),tabValues:a}}var x=r(21929);const j={tabList:"tabList_osvQ",tabItem:"tabItem_dc4O"};var f=r(25105);function b(e){let{className:n,block:r,selectedValue:s,selectValue:t,tabValues:o}=e;const c=[],{blockElementScrollPositionUntilNextRender:l}=(0,a.a_)(),d=e=>{const n=e.currentTarget,r=c.indexOf(n),i=o[r].value;i!==s&&(l(n),t(i))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const r=c.indexOf(e.currentTarget)+1;n=c[r]??c[0];break}case"ArrowLeft":{const r=c.indexOf(e.currentTarget)-1;n=c[r]??c[c.length-1];break}}n?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":r},n),children:o.map((e=>{let{value:n,label:r,attributes:a}=e;return(0,f.jsx)("li",{role:"tab",tabIndex:s===n?0:-1,"aria-selected":s===n,ref:e=>{c.push(e)},onKeyDown:u,onClick:d,...a,className:(0,i.A)("tabs__item",j.tabItem,a?.className,{"tabs__item--active":s===n}),children:r??n},n)}))})}function v(e){let{lazy:n,children:r,selectedValue:a}=e;const t=(Array.isArray(r)?r:[r]).filter(Boolean);if(n){const e=t.find((e=>e.props.value===a));return e?(0,s.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:t.map(((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==a})))})}function y(e){const n=m(e);return(0,f.jsxs)("div",{className:(0,i.A)("tabs-container",j.tabList),children:[(0,f.jsx)(b,{...n,...e}),(0,f.jsx)(v,{...n,...e})]})}function k(e){const n=(0,x.A)();return(0,f.jsx)(y,{...e,children:u(e.children)},String(n))}},79621:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>o});var s=r(58101);const i={},a=s.createContext(i);function t(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);