"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[2806],{76993:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"integrate-logto/protected-app","title":"Protected App \u2014 Integraci\xf3n de autenticaci\xf3n sin SDK","description":"A\xf1ade f\xe1cilmente autenticaci\xf3n sin c\xf3digo a tus aplicaciones web con la innovadora Protected App de Logto, impulsada por Cloudflare. Soporta HTTP Basic Authentication y validaci\xf3n de JWT.","source":"@site/i18n/es/docusaurus-plugin-content-docs/current/integrate-logto/protected-app.mdx","sourceDirName":"integrate-logto","slug":"/integrate-logto/protected-app","permalink":"/es/integrate-logto/protected-app","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/es/docusaurus-plugin-content-docs/current/integrate-logto/protected-app.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"description":"A\xf1ade f\xe1cilmente autenticaci\xf3n sin c\xf3digo a tus aplicaciones web con la innovadora Protected App de Logto, impulsada por Cloudflare. Soporta HTTP Basic Authentication y validaci\xf3n de JWT.","sidebar_label":"Protected App","sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Comprender el flujo de autenticaci\xf3n","permalink":"/es/integrate-logto/integrate-logto-into-your-application/understand-authentication-flow"},"next":{"title":"Aplicaci\xf3n SAML","permalink":"/es/integrate-logto/saml-app/"}}');var t=a(25105),o=a(79621);const r={description:"A\xf1ade f\xe1cilmente autenticaci\xf3n sin c\xf3digo a tus aplicaciones web con la innovadora Protected App de Logto, impulsada por Cloudflare. Soporta HTTP Basic Authentication y validaci\xf3n de JWT.",sidebar_label:"Protected App",sidebar_position:2},s="Protected App \u2014 Integraci\xf3n de autenticaci\xf3n sin SDK",c={},d=[{value:"C\xf3mo funciona Protected App",id:"how-protected-app-works",level:2},{value:"Protege tu servidor de origen",id:"protect-your-origin-server",level:2},{value:"Validaci\xf3n de cabeceras HTTP",id:"http-header-validation",level:3},{value:"Validaci\xf3n de JSON Web Tokens (JWT)",id:"json-web-tokens-jwt-validation",level:3},{value:"Obtener el estado de autenticaci\xf3n e informaci\xf3n del usuario",id:"get-authentication-state-and-user-information",level:2},{value:"Obtener el host original",id:"get-the-original-host",level:2},{value:"Personalizar reglas de autenticaci\xf3n",id:"customize-authentication-rules",level:2},{value:"Desarrollo local",id:"local-development",level:2},{value:"Transici\xf3n a la integraci\xf3n con SDK",id:"transition-to-sdk-integration",level:2},{value:"Recursos relacionados",id:"related-resources",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",...(0,o.R)(),...e.components},{Url:a}=n;return a||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"protected-app--integraci\xf3n-de-autenticaci\xf3n-sin-sdk",children:"Protected App \u2014 Integraci\xf3n de autenticaci\xf3n sin SDK"})}),"\n",(0,t.jsxs)(n.p,{children:["La Protected App est\xe1 dise\xf1ada para eliminar la complejidad de las ",(0,t.jsx)(n.a,{href:"/quick-starts",children:"integraciones de SDK"})," separando la ",(0,t.jsx)(n.a,{href:"https://auth.wiki/authentication",children:"autenticaci\xf3n"})," de tu aplicaci\xf3n. Nosotros manejamos la autenticaci\xf3n, permiti\xe9ndote enfocarte en tu funcionalidad principal. Una vez que un usuario est\xe1 autenticado, la Protected App sirve el contenido desde tu servidor."]}),"\n",(0,t.jsx)(n.h2,{id:"how-protected-app-works",children:"C\xf3mo funciona Protected App"}),"\n",(0,t.jsx)(n.p,{children:"La Protected App, impulsada por Cloudflare, opera globalmente en redes de borde, asegurando baja latencia y alta disponibilidad para tu aplicaci\xf3n."}),"\n",(0,t.jsx)(n.p,{children:"La Protected App mantiene el estado de la sesi\xf3n y la informaci\xf3n del usuario. Si un usuario no est\xe1 autenticado, la Protected App lo redirige a la p\xe1gina de inicio de sesi\xf3n. Una vez autenticado, la Protected App envuelve la solicitud del usuario con autenticaci\xf3n e informaci\xf3n del usuario, y luego la reenv\xeda al servidor de origen."}),"\n",(0,t.jsx)(n.p,{children:"Este proceso se visualiza en el siguiente diagrama de flujo:"}),"\n",(0,t.jsx)(n.mermaid,{value:'graph LR\n  A("Cliente<br/>(Navegador)") --\x3e|Solicitud| B(Logto<br/>Protected App)\n  B --\x3e Condition{{\xbfCoincide la ruta?}}\n  Condition --\x3e|S\xed| Matched{{\xbfEst\xe1 autenticado?}}\n  Matched --\x3e|S\xed| C(Servidor de origen)\n  Matched --\x3e|No| D(Inicio de sesi\xf3n de Logto)\n  Condition --\x3e|No| C'}),"\n",(0,t.jsx)(n.h2,{id:"protect-your-origin-server",children:"Protege tu servidor de origen"}),"\n",(0,t.jsx)(n.p,{children:"El servidor de origen, que podr\xeda ser un dispositivo f\xedsico o virtual no propiedad de la Protected App de Logto, es donde reside el contenido de tu aplicaci\xf3n. Similar a un servidor de Content Delivery Network (CDN), la Protected App gestiona los procesos de autenticaci\xf3n y recupera contenido de tu servidor de origen. Por lo tanto, si los usuarios obtienen acceso directo a tu servidor de origen, pueden eludir la autenticaci\xf3n y tu aplicaci\xf3n ya no est\xe1 protegida."}),"\n",(0,t.jsx)(n.p,{children:"Por lo tanto, es importante asegurar las conexiones de origen, ya que previene que los atacantes descubran y accedan a tu servidor de origen sin autenticaci\xf3n. Hay varias maneras de hacer esto:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Validaci\xf3n de cabeceras HTTP"}),"\n",(0,t.jsx)(n.li,{children:"Validaci\xf3n de JSON Web Tokens (JWT)"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"http-header-validation",children:"Validaci\xf3n de cabeceras HTTP"}),"\n",(0,t.jsxs)(n.p,{children:["Asegurar tu servidor de origen se puede lograr usando ",(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Authentication#basic_authentication_scheme",children:"HTTP Basic Authentication"})," para asegurar tu servidor de origen."]}),"\n",(0,t.jsx)(n.p,{children:"Cada solicitud de la Protected App incluye la siguiente cabecera:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Authorization: Basic base64(appId:appSecret)\n"})}),"\n",(0,t.jsx)(n.p,{children:"Al validar esta cabecera, puedes confirmar que la solicitud proviene de la Protected App y negar cualquier solicitud que no incluya esta cabecera."}),"\n",(0,t.jsx)(n.p,{children:"Si est\xe1s usando Nginx o Apache, puedes consultar las siguientes gu\xedas para implementar HTTP Basic Authentication en tu servidor de origen:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Nginx: ",(0,t.jsx)(n.a,{href:"https://docs.nginx.com/nginx/admin-guide/security-controls/configuring-http-basic-authentication/",children:"Configuring HTTP Basic Authentication"})]}),"\n",(0,t.jsxs)(n.li,{children:["Apache: ",(0,t.jsx)(n.a,{href:"https://httpd.apache.org/docs/2.4/howto/auth.html",children:"Authentication and Authorization"})]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Para verificar las cabeceras dentro de tu aplicaci\xf3n, consulta el ",(0,t.jsx)(n.a,{href:"https://developers.cloudflare.com/workers/examples/basic-auth/",children:"ejemplo de HTTP Basic Authentication"})," proporcionado por Cloudflare para aprender c\xf3mo restringir el acceso usando el esquema HTTP Basic."]}),"\n",(0,t.jsx)(n.h3,{id:"json-web-tokens-jwt-validation",children:"Validaci\xf3n de JSON Web Tokens (JWT)"}),"\n",(0,t.jsx)(n.p,{children:"Otra forma de asegurar tu servidor de origen es usando JSON Web Tokens (JWT)."}),"\n",(0,t.jsx)(n.p,{children:"Cada solicitud autenticada de la Protected App incluye la siguiente cabecera:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Logto-ID-Token: <JWT>\n"})}),"\n",(0,t.jsxs)(n.p,{children:["El JWT se llama ",(0,t.jsx)(n.a,{href:"https://auth.wiki/id-token",children:"Token de ID"})," que est\xe1 firmado por Logto y contiene informaci\xf3n del usuario. Al validar este JWT, puedes confirmar que la solicitud proviene de la Protected App y negar cualquier solicitud que no incluya esta cabecera."]}),"\n",(0,t.jsxs)(n.p,{children:["El token est\xe1 encriptado y firmado como un token ",(0,t.jsx)(n.a,{href:"https://auth.wiki/jws",children:"JWS"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Los pasos de validaci\xf3n:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc7519#section-7.2",children:"Validar un JWT"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://datatracker.ietf.org/doc/html/rfc7515#section-5.2",children:"Validar la firma JWS"})}),"\n",(0,t.jsxs)(n.li,{children:["El emisor del token es ",(0,t.jsx)(n.code,{children:"https://<your-logto-domain>/oidc"})," (emitido por tu servidor de autenticaci\xf3n Logto)"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const express = require('express');\nconst jwksClient = require('jwks-rsa');\nconst jwt = require('jsonwebtoken');\n\nconst ISSUER = 'https://<your-logto-domain>/oidc';\nconst CERTS_URL = 'https://<your-logto-domain>/oidc/jwks';\n\nconst client = jwksClient({\n  jwksUri: CERTS_URL,\n});\n\nconst getKey = (header, callback) => {\n  client.getSigningKey(header.kid, function (err, key) {\n    callback(err, key?.getPublicKey());\n  });\n};\n\nconst verifyToken = (req, res, next) => {\n  const token = req.headers['Logto-ID-Token'];\n\n  // Aseg\xfarate de que la solicitud entrante tenga nuestra cabecera de token\n  if (!token) {\n    return res\n      .status(403)\n      .send({ status: false, message: 'falta la cabecera requerida Logto-ID-Token' });\n  }\n\n  jwt.verify(token, getKey, { issuer: ISSUER }, (err, decoded) => {\n    if (err) {\n      return res.status(403).send({ status: false, message: 'token de ID inv\xe1lido' });\n    }\n\n    req.user = decoded;\n    next();\n  });\n};\n\nconst app = express();\n\napp.use(verifyToken);\n\napp.get('/', (req, res) => {\n  res.send('\xa1Hola Mundo!');\n});\n\napp.listen(3000);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"get-authentication-state-and-user-information",children:"Obtener el estado de autenticaci\xf3n e informaci\xf3n del usuario"}),"\n",(0,t.jsxs)(n.p,{children:["Si necesitas obtener la autenticaci\xf3n y la informaci\xf3n del usuario para tu aplicaci\xf3n, tambi\xe9n puedes usar la cabecera ",(0,t.jsx)(n.code,{children:"Logto-ID-Token"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Si solo deseas decodificar el token, puedes usar el siguiente c\xf3digo:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:"const express = require('express');\n\nconst decodeIdToken = (req, res, next) => {\n  const token = req.headers['Logto-ID-Token'];\n\n  if (!token) {\n    return res.status(403).send({\n      status: false,\n      message: 'falta la cabecera requerida Logto-ID-Token',\n    });\n  }\n\n  const parts = token.split('.');\n  if (parts.length !== 3) {\n    throw new Error('Token de ID inv\xe1lido');\n  }\n\n  const payload = parts[1];\n  const decodedPayload = atob(payload.replace(/-/g, '+').replace(/_/g, '/'));\n  const claims = JSON.parse(decodedPayload);\n\n  req.user = claims;\n  next();\n};\n\nconst app = express();\n\napp.use(decodeIdToken);\n\napp.get('/', (req, res) => {\n  res.json(req.user);\n});\n\napp.listen(3000);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"get-the-original-host",children:"Obtener el host original"}),"\n",(0,t.jsxs)(n.p,{children:["Si necesitas obtener el host original solicitado por el cliente, puedes usar la cabecera ",(0,t.jsx)(n.code,{children:"Logto-Host"})," o ",(0,t.jsx)(n.code,{children:"x-forwarded-host"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"customize-authentication-rules",children:"Personalizar reglas de autenticaci\xf3n"}),"\n",(0,t.jsx)(n.p,{children:'Por defecto, la Protected App proteger\xe1 todas las rutas. Si necesitas personalizar las reglas de autenticaci\xf3n, puedes establecer el campo "Reglas de autenticaci\xf3n personalizadas" en la Consola.'}),"\n",(0,t.jsx)(n.p,{children:"Soporta expresiones regulares, aqu\xed hay dos escenarios de caso:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Para proteger solo las rutas ",(0,t.jsx)(n.code,{children:"/admin"})," y ",(0,t.jsx)(n.code,{children:"/privacy"})," con autenticaci\xf3n: ",(0,t.jsx)(n.code,{children:"^/(admin|privacy)/.*"})]}),"\n",(0,t.jsxs)(n.li,{children:["Para excluir im\xe1genes JPG de la autenticaci\xf3n: ",(0,t.jsx)(n.code,{children:"^(?!.*\\.jpg$).*$"})]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"local-development",children:"Desarrollo local"}),"\n",(0,t.jsxs)(n.p,{children:["La Protected App est\xe1 dise\xf1ada para trabajar con tu servidor de origen. Sin embargo, si tu servidor de origen no es accesible p\xfablicamente, puedes usar una herramienta como ",(0,t.jsx)(n.a,{href:"https://ngrok.com/",children:"ngrok"})," o ",(0,t.jsx)(n.a,{href:"https://developers.cloudflare.com/pages/how-to/preview-with-cloudflare-tunnel/",children:"Cloudflare Tunnels"})," para exponer tu servidor local a internet."]}),"\n",(0,t.jsx)(n.h2,{id:"transition-to-sdk-integration",children:"Transici\xf3n a la integraci\xf3n con SDK"}),"\n",(0,t.jsxs)(n.p,{children:["La Protected App est\xe1 dise\xf1ada para simplificar el proceso de autenticaci\xf3n. Sin embargo, si decides hacer la transici\xf3n a la integraci\xf3n con SDK para un mejor control y personalizaci\xf3n, puedes ",(0,t.jsx)(n.a,{href:"/integrate-logto/integrate-logto-into-your-application",children:"crear una nueva aplicaci\xf3n"})," en Logto y configurar la ",(0,t.jsx)(n.a,{href:"/quick-starts",children:"integraci\xf3n con SDK"}),'. Y para una transici\xf3n sin problemas, puedes reutilizar las configuraciones de la aplicaci\xf3n de la Protected App. La Protected App es en realidad una "Aplicaci\xf3n Web Tradicional" en Logto, puedes encontrar el "',(0,t.jsx)(n.a,{href:"/integrate-logto/application-data-structure#application-id",children:"AppId"}),'" y el "',(0,t.jsx)(n.a,{href:"/integrate-logto/application-data-structure#application-secret",children:"AppSecret"}),'" en la configuraci\xf3n de la aplicaci\xf3n. Una vez que la transici\xf3n est\xe9 completa, puedes eliminar la Protected App de tu aplicaci\xf3n.']}),"\n",(0,t.jsx)(n.h2,{id:"related-resources",children:"Recursos relacionados"}),"\n",(0,t.jsx)(a,{href:"https://www.youtube.com/watch?v=ZBrXW3iZyKY",children:(0,t.jsx)(n.p,{children:"Protected App: Construye la autenticaci\xf3n de tu aplicaci\xf3n en clics. No se requiere c\xf3digo."})}),"\n",(0,t.jsx)(a,{href:"https://blog.logto.io/protected-app",children:"La motivaci\xf3n detr\xe1s de Protected App"}),"\n",(0,t.jsx)(a,{href:"https://blog.logto.io/fastest-way-to-build-auth-system",children:(0,t.jsx)(n.p,{children:"La forma m\xe1s r\xe1pida de construir un sistema de autenticaci\xf3n"})})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},79621:(e,n,a)=>{a.d(n,{R:()=>r,x:()=>s});var i=a(58101);const t={},o=i.createContext(t);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);