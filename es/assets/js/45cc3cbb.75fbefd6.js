"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[7110],{88622:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"developers/custom-token-claims/create-script","title":"Crear un script de reclamos personalizados de token","description":"Para a\xf1adir reclamos personalizados al token de acceso (Access token), necesitas proporcionar un script que devuelva un objeto que contenga esos reclamos. El script debe estar escrito como una funci\xf3n de JavaScript que retorne un objeto con los reclamos personalizados.","source":"@site/i18n/es/docusaurus-plugin-content-docs/current/developers/custom-token-claims/create-script.mdx","sourceDirName":"developers/custom-token-claims","slug":"/developers/custom-token-claims/create-script","permalink":"/es/developers/custom-token-claims/create-script","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/es/docusaurus-plugin-content-docs/current/developers/custom-token-claims/create-script.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"create-script","title":"Crear un script de reclamos personalizados de token","sidebar_label":"Crear un script de reclamos personalizados de token","sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Casos de uso comunes","permalink":"/es/developers/custom-token-claims/common-use-cases"},"next":{"title":"Suplantaci\xf3n de usuario","permalink":"/es/developers/user-impersonation"}}');var r=s(25105),o=s(79621);const a={id:"create-script",title:"Crear un script de reclamos personalizados de token",sidebar_label:"Crear un script de reclamos personalizados de token",sidebar_position:3},d="Crear un script de reclamos personalizados de token",t={},c=[{value:"Implementar la funci\xf3n <code>getCustomJwtClaims()</code>",id:"implement-getcustomjwtclaims-function",level:2},{value:"Paso 1: Editar el script",id:"step-1-edit-the-script",level:2},{value:"Paso 2: Par\xe1metros de entrada",id:"step-2-input-parameters",level:2},{value:"token",id:"token",level:3},{value:"context (Solo disponible para token de acceso de usuario)",id:"context-only-available-for-user-access-token",level:3},{value:"environmentVariables",id:"environmentvariables",level:3},{value:"api",id:"api",level:3},{value:"Paso 3: Obtener datos externos",id:"step-3-fetch-external-data",level:2},{value:"Paso 4: Probar el script",id:"step-4-test-the-script",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components},{CloudLink:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("CloudLink",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"crear-un-script-de-reclamos-personalizados-de-token",children:"Crear un script de reclamos personalizados de token"})}),"\n",(0,r.jsxs)(n.p,{children:["Para ",(0,r.jsx)(n.a,{href:"/developers/custom-token-claims",children:"a\xf1adir reclamos personalizados"})," al ",(0,r.jsx)(n.a,{href:"https://auth.wiki/access-token",children:"token de acceso (Access token)"}),", necesitas proporcionar un script que devuelva un objeto que contenga esos reclamos. El script debe estar escrito como una funci\xf3n de ",(0,r.jsx)(n.code,{children:"JavaScript"})," que retorne un objeto con los reclamos personalizados."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Navega a ",(0,r.jsx)(s,{to:"/customize-jwt",children:"Consola > JWT personalizado"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Hay dos tipos diferentes de tokens de acceso para los que puedes personalizar los reclamos del token de acceso:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Token de acceso de usuario"}),": El token de acceso emitido para usuarios finales. Por ejemplo, para aplicaciones web o aplicaciones m\xf3viles."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Token de acceso m\xe1quina a m\xe1quina"}),": El token de acceso emitido para servicios o aplicaciones. Por ejemplo, para ",(0,r.jsx)(n.a,{href:"/quick-starts/m2m",children:"aplicaciones m\xe1quina a m\xe1quina"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Diferentes tipos de tokens de acceso pueden tener diferentes contextos de carga \xfatil del token. Puedes personalizar los reclamos del token para cada tipo de token de acceso por separado."}),"\n",(0,r.jsxs)(n.p,{children:["Elige cualquier tipo de token de acceso para el que quieras personalizar los reclamos del token y haz clic en el bot\xf3n ",(0,r.jsx)(n.strong,{children:"A\xf1adir reclamos personalizados"})," para crear un nuevo script."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsx)(n.p,{children:"La funci\xf3n de reclamos personalizados de token solo est\xe1 disponible para:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Usuarios de ",(0,r.jsx)(n.a,{href:"/logto-oss",children:"Logto OSS"})]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/logto-cloud/tenant-settings#development",children:"Inquilinos de Logto Cloud con entorno de desarrollo"})}),"\n",(0,r.jsxs)(n.li,{children:["Inquilinos de pago de Logto Cloud con entorno de producci\xf3n (incluyendo ",(0,r.jsx)(n.a,{href:"https://logto.io/pricing",children:"Inquilinos Pro y Enterprise"}),")"]}),"\n"]})]}),"\n",(0,r.jsxs)(n.h2,{id:"implement-getcustomjwtclaims-function",children:["Implementar la funci\xf3n ",(0,r.jsx)(n.code,{children:"getCustomJwtClaims()"})]}),"\n",(0,r.jsxs)(n.p,{children:["En la p\xe1gina de detalles de ",(0,r.jsx)(n.strong,{children:"JWT personalizado"}),", puedes encontrar el editor de scripts para escribir tu script de reclamos personalizados de token. El script debe ser una funci\xf3n de ",(0,r.jsx)(n.code,{children:"JavaScript"})," que devuelva un objeto de reclamos personalizados."]}),"\n",(0,r.jsx)("img",{src:"/img/assets/custom-jwt-detail-page.png",alt:"P\xe1gina de detalles de reclamos personalizados de token"}),"\n",(0,r.jsx)(n.h2,{id:"step-1-edit-the-script",children:"Paso 1: Editar el script"}),"\n",(0,r.jsxs)(n.p,{children:["Utiliza el editor de c\xf3digo en el lado izquierdo para modificar el script. Se proporciona una funci\xf3n ",(0,r.jsx)(n.code,{children:"getCustomJwtClaims"})," predeterminada que retorna un objeto vac\xedo para que puedas comenzar. Puedes modificar la funci\xf3n para que retorne un objeto con tus propios reclamos personalizados."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"const getCustomJwtClaims = async ({ token, context, environmentVariables }) => {\n  return {};\n};\n"})}),"\n",(0,r.jsx)(n.p,{children:"Este editor utiliza el servidor de lenguaje JavaScript para proporcionar resaltado de sintaxis b\xe1sico, autocompletado de c\xf3digo y verificaci\xf3n de errores. El par\xe1metro de entrada est\xe1 bien tipado y documentado en estilo jsDoc. Puedes usar IntelliSense del editor para acceder correctamente a las propiedades del objeto de entrada. Puedes encontrar las definiciones detalladas de los par\xe1metros en el lado derecho de la p\xe1gina."}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["Esta funci\xf3n se exportar\xe1 como un m\xf3dulo. Aseg\xfarate de mantener el nombre de la funci\xf3n como ",(0,r.jsx)(n.code,{children:"getCustomJwtClaims"})," para que el m\xf3dulo pueda exportar la funci\xf3n correctamente."]})}),"\n",(0,r.jsx)(n.h2,{id:"step-2-input-parameters",children:"Paso 2: Par\xe1metros de entrada"}),"\n",(0,r.jsxs)(n.p,{children:["La funci\xf3n ",(0,r.jsx)(n.code,{children:"getCustomJwtClaims"})," toma un objeto como par\xe1metro de entrada. El objeto de entrada contiene las siguientes propiedades:"]}),"\n",(0,r.jsx)(n.h3,{id:"token",children:"token"}),"\n",(0,r.jsx)(n.p,{children:"El objeto de carga \xfatil del token. Este objeto contiene los reclamos originales del token y metadatos que puedes necesitar acceder en el script."}),"\n",(0,r.jsx)(n.p,{children:"Puedes encontrar la definici\xf3n de tipo detallada del objeto de carga \xfatil del token y del objeto de datos de usuario en el lado derecho de la p\xe1gina. El IntelliSense del editor tambi\xe9n te ayudar\xe1 a acceder correctamente a estas propiedades del objeto de entrada."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Objeto de datos del token de acceso de usuario","\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Propiedad"}),(0,r.jsx)(n.th,{children:"Descripci\xf3n"}),(0,r.jsx)(n.th,{children:"Tipo"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"jti"})}),(0,r.jsx)(n.td,{children:"El identificador \xfanico del JWT"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"aud"})}),(0,r.jsx)(n.td,{children:"La audiencia (Audience) del token"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"scope"})}),(0,r.jsx)(n.td,{children:"Los alcances (Scopes) del token"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"clientId"})}),(0,r.jsx)(n.td,{children:"El id del cliente del token"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"accountId"})}),(0,r.jsx)(n.td,{children:"El id de usuario del token"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"expiresWithSession"})}),(0,r.jsx)(n.td,{children:"Si el token expirar\xe1 con la sesi\xf3n"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"boolean"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"grantId"})}),(0,r.jsx)(n.td,{children:"El id de concesi\xf3n de autenticaci\xf3n actual del token"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"gty"})}),(0,r.jsx)(n.td,{children:"El tipo de concesi\xf3n del token"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"kind"})}),(0,r.jsx)(n.td,{children:"El tipo de token"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"AccessToken"})})]})]})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Objeto de datos del token de acceso m\xe1quina a m\xe1quina","\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Propiedad"}),(0,r.jsx)(n.th,{children:"Descripci\xf3n"}),(0,r.jsx)(n.th,{children:"Tipo"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"jti"})}),(0,r.jsx)(n.td,{children:"El identificador \xfanico del JWT"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"aud"})}),(0,r.jsx)(n.td,{children:"La audiencia (Audience) del token"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"scope"})}),(0,r.jsx)(n.td,{children:"Los alcances (Scopes) del token"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"clientId"})}),(0,r.jsx)(n.td,{children:"El id del cliente del token"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"kind"})}),(0,r.jsx)(n.td,{children:"El tipo de token"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"ClientCredentials"})})]})]})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"context-only-available-for-user-access-token",children:"context (Solo disponible para token de acceso de usuario)"}),"\n",(0,r.jsx)(n.p,{children:"El objeto de contexto contiene los datos del usuario y los datos de la concesi\xf3n relevantes para el proceso de autorizaci\xf3n (Authorization) actual."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Objeto de datos de usuario"}),"\nPara el token de acceso de usuario, Logto proporciona un contexto adicional de datos de usuario para que puedas acceder. El objeto de datos de usuario contiene todos los datos del perfil del usuario y los datos de membres\xeda de organizaci\xf3n (Organization) que puedas necesitar para configurar los reclamos personalizados. Consulta ",(0,r.jsx)(n.a,{href:"/user-management/user-data",children:"Usuarios"})," y ",(0,r.jsx)(n.a,{href:"/organizations/organization-data",children:"Organizaciones"})," para m\xe1s detalles."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Objeto de datos de concesi\xf3n"}),"\nPara el token de acceso de usuario concedido por intercambio de token de suplantaci\xf3n, Logto proporciona un contexto adicional de datos de concesi\xf3n para que puedas acceder. El objeto de datos de concesi\xf3n contiene el contexto personalizado del token de sujeto. Consulta ",(0,r.jsx)(n.a,{href:"/developers/user-impersonation",children:"Suplantaci\xf3n de usuario"})," para m\xe1s detalles."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Objeto de datos de interacci\xf3n de usuario"}),"\nPara un token de acceso de usuario dado, puede haber casos en los que necesites acceder a los detalles de interacci\xf3n del usuario para la sesi\xf3n de autorizaci\xf3n (Authorization) actual. Por ejemplo, podr\xedas necesitar recuperar la identidad de SSO empresarial utilizada por el usuario para iniciar sesi\xf3n. Este objeto de datos de interacci\xf3n de usuario contiene los datos de interacci\xf3n m\xe1s recientes enviados por el usuario, incluyendo:"]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Propiedad"}),(0,r.jsx)(n.th,{children:"Descripci\xf3n"}),(0,r.jsx)(n.th,{children:"Tipo"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"interactionEvent"})}),(0,r.jsx)(n.td,{children:"El evento de interacci\xf3n de la interacci\xf3n actual del usuario"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"SignIn"})," o ",(0,r.jsx)(n.code,{children:"Register"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"userId"})}),(0,r.jsx)(n.td,{children:"El id de usuario de la interacci\xf3n actual del usuario"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"string"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"verificationRecords"})}),(0,r.jsx)(n.td,{children:"Una lista de registros de verificaci\xf3n enviados por el usuario para identificar y verificar su identidad durante las interacciones."}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"VerificationRecord[]"})})]})]})]}),"\n",(0,r.jsx)(n.p,{children:"Tipo de registro de verificaci\xf3n:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// VerificationType.Password\n{\n  id: string;\n  type: 'Password';\n  identifier: {\n    type: 'username' | 'email' | 'phone' | 'userId';\n    value: string;\n  }\n  verified: boolean;\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// VerificationType.EmailVerificationCode\n{\n  id: string;\n  templateType: 'SignIn' | 'Register' | 'ForgotPassword' | 'Generic';\n  verified: boolean;\n  type: 'EmailVerificationCode';\n  identifier: {\n    type: 'email';\n    value: string;\n  }\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// VerificationType.PhoneVerificationCode\n{\n  id: string;\n  templateType: 'SignIn' | 'Register' | 'ForgotPassword' | 'Generic';\n  verified: boolean;\n  type: 'PhoneVerificationCode';\n  identifier: {\n    type: 'phone';\n    value: string;\n  }\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// VerificationType.Social\n{\n  id: string;\n  type: 'Social';\n  connectorId: string;\n  socialUserInfo?: {\n    id: string;\n    email?: string | undefined;\n    phone?: string | undefined;\n    name?: string | undefined;\n    avatar?: string | undefined;\n    rawData?: Record<string, unknown> | undefined;\n  } | undefined;\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// VerificationType.EnterpriseSso\n{\n  id: string;\n  type: 'EnterpriseSso';\n  connectorId: string;\n  enterpriseUserInfo?: {\n    id: string;\n    email?: string | undefined;\n    phone?: string | undefined;\n    name?: string | undefined;\n    avatar?: string | undefined;\n    [key: string]?: unknown;\n  } | undefined;\n  issuer?: string | undefined;\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// VerificationType.Totp (MFA)\n{\n  id: string;\n  type: 'Totp';\n  userId: string;\n  verified: boolean;\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// VerificationType.WebAuthn (MFA)\n{\n  id: string;\n  type: 'WebAuthn';\n  userId: string;\n  verified: boolean;\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'// VerificationType.BackupCode (MFA)\n{\n  id: string;\n  type: "BackupCode";\n  userId: string;\n  code?: string | undefined;\n}\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:'// VerificationType.OneTimeToken\n{\n  id: string;\n  type: "OneTimeToken";\n  verified: boolean;\n  identifier: {\n    type: "email";\n    value: string;\n  };\n  oneTimeTokenContext?: {\n    jitOrganizationIds?: string[] | undefined;\n  } | undefined;\n}\n'})}),"\n",(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsx)(n.p,{children:"Puede haber m\xfaltiples registros de verificaci\xf3n en el objeto de datos de interacci\xf3n de usuario, especialmente cuando el usuario ha pasado por varios procesos de inicio de sesi\xf3n o registro."}),(0,r.jsxs)(n.p,{children:["Por ejemplo, el usuario ha iniciado sesi\xf3n usando un registro de verificaci\xf3n ",(0,r.jsx)(n.code,{children:"Social"}),", luego ha vinculado una nueva direcci\xf3n de correo electr\xf3nico mediante un registro de verificaci\xf3n ",(0,r.jsx)(n.code,{children:"EmailVerificationCode"}),", y luego ha verificado el estado de MFA con un registro de verificaci\xf3n ",(0,r.jsx)(n.code,{children:"Totp"}),". En este caso, es posible que debas manejar todos los registros de verificaci\xf3n en tu script."]}),(0,r.jsx)(n.p,{children:"Cada tipo de registro de verificaci\xf3n solo estar\xe1 presente una vez en el objeto de datos de interacci\xf3n de usuario."})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"environmentvariables",children:"environmentVariables"}),"\n",(0,r.jsxs)(n.p,{children:["Utiliza la secci\xf3n ",(0,r.jsx)(n.strong,{children:"Configurar variables de entorno"})," en la parte derecha para configurar las variables de entorno para tu script. Puedes usar estas variables para almacenar informaci\xf3n sensible o datos de configuraci\xf3n que no quieras codificar directamente en el script, por ejemplo, claves de API, secretos o URLs."]}),"\n",(0,r.jsxs)(n.p,{children:["Todas las variables de entorno que configures aqu\xed estar\xe1n disponibles en el script. Usa el objeto ",(0,r.jsx)(n.code,{children:"environmentVariables"})," en el par\xe1metro de entrada para acceder a estas variables."]}),"\n",(0,r.jsx)(n.h3,{id:"api",children:"api"}),"\n",(0,r.jsxs)(n.p,{children:["El objeto ",(0,r.jsx)(n.code,{children:"api"})," proporciona un conjunto de funciones utilitarias que puedes usar en tu script para un control de acceso adicional sobre el proceso de emisi\xf3n del token. El objeto ",(0,r.jsx)(n.code,{children:"api"})," contiene las siguientes funciones:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"api.denyAccess(message?: string): void\n"})}),"\n",(0,r.jsxs)(n.p,{children:["La funci\xf3n ",(0,r.jsx)(n.code,{children:"api.denyAccess()"})," te permite denegar el proceso de emisi\xf3n del token con un mensaje personalizado. Puedes usar esta funci\xf3n para aplicar validaciones de acceso adicionales sobre el proceso de emisi\xf3n del token."]}),"\n",(0,r.jsx)(n.h2,{id:"step-3-fetch-external-data",children:"Paso 3: Obtener datos externos"}),"\n",(0,r.jsxs)(n.p,{children:["Puedes usar la funci\xf3n incorporada de node ",(0,r.jsx)(n.code,{children:"fetch"})," para obtener datos externos en tu script. La funci\xf3n ",(0,r.jsx)(n.code,{children:"fetch"})," es una funci\xf3n basada en promesas que te permite hacer solicitudes HTTP a APIs externas."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-jsx",children:"const getCustomJwtClaims = async ({ environmentVariables }) => {\n  const response = await fetch('https://api.example.com/data', {\n    headers: {\n      Authorization: `Bearer ${environmentVariables.API_KEY}`,\n    },\n  });\n\n  const data = await response.json();\n\n  return {\n    data,\n  };\n};\n"})}),"\n",(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsx)(n.p,{children:"Ten en cuenta que cualquier obtenci\xf3n de datos externos puede introducir latencia en el proceso de emisi\xf3n del token. Aseg\xfarate de que la API externa sea lo suficientemente confiable y r\xe1pida para cumplir con tus requisitos."}),(0,r.jsx)(n.p,{children:"Adem\xe1s:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Maneja correctamente los errores y los tiempos de espera en tu script para evitar que el proceso de emisi\xf3n del token se bloquee."}),"\n",(0,r.jsx)(n.li,{children:"Usa encabezados de autorizaci\xf3n adecuados para proteger tu API externa de accesos no autorizados."}),"\n"]})]}),"\n",(0,r.jsx)(n.h2,{id:"step-4-test-the-script",children:"Paso 4: Probar el script"}),"\n",(0,r.jsxs)(n.p,{children:["Aseg\xfarate de probar tu script antes de guardarlo. Haz clic en la pesta\xf1a ",(0,r.jsx)(n.strong,{children:"Contexto de prueba"})," en el lado derecho de la p\xe1gina para modificar la carga \xfatil simulada del token y el contexto de datos de usuario para las pruebas."]}),"\n",(0,r.jsxs)(n.p,{children:["Haz clic en ",(0,r.jsx)(n.strong,{children:"Ejecutar prueba"})," en la esquina superior derecha del editor para ejecutar el script con los datos simulados. El resultado del script se mostrar\xe1 en el panel ",(0,r.jsx)(n.strong,{children:"Resultado de la prueba"}),"."]}),"\n",(0,r.jsx)("img",{src:"/img/assets/test-custom-jwt-script.png",alt:"Probar script JWT personalizado"}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["El resultado de la prueba es la salida de la funci\xf3n ",(0,r.jsx)(n.code,{children:"getCustomJwtClaims"}),' con los datos simulados que configures ("reclamos extra del token" obtenidos despu\xe9s de completar el paso 3 en ',(0,r.jsx)(n.a,{href:"/developers/custom-token-claims/#how-do-custom-token-claims-work",children:"el diagrama de secuencia"}),"). La carga \xfatil real del token y el contexto de datos de usuario ser\xe1n diferentes cuando el script se ejecute en el proceso de emisi\xf3n del token."]})}),"\n",(0,r.jsxs)(n.p,{children:["Haz clic en el bot\xf3n ",(0,r.jsx)(n.strong,{children:"Crear"})," para guardar el script. El script de reclamos personalizados de token se guardar\xe1 y aplicar\xe1 al proceso de emisi\xf3n del token de acceso."]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},79621:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>d});var i=s(58101);const r={},o=i.createContext(r);function a(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);