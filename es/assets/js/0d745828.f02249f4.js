"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[61503],{93022:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>s,contentTitle:()=>c,default:()=>u,frontMatter:()=>t,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"authorization/organization-template/protect-api-reources","title":"Proteger el recurso de API con plantilla de organizaci\xf3n","description":"Adem\xe1s de Proteger tu API, que asegura los recursos garantizando que un JWT v\xe1lido est\xe9 presente, los roles de organizaci\xf3n tambi\xe9n se pueden aplicar para filtrar los alcances. En este art\xedculo, nos centraremos en c\xf3mo el rol de la organizaci\xf3n afecta la delegaci\xf3n y validaci\xf3n de alcances en tu flujo de autenticaci\xf3n.","source":"@site/i18n/es/docusaurus-plugin-content-docs/current/authorization/organization-template/protect-api-reources.mdx","sourceDirName":"authorization/organization-template","slug":"/authorization/organization-template/protect-api-reources","permalink":"/es/authorization/organization-template/protect-api-reources","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/es/docusaurus-plugin-content-docs/current/authorization/organization-template/protect-api-reources.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Proteger recursos de la organizaci\xf3n","permalink":"/es/authorization/organization-template/protect-organization-resources"},"next":{"title":"Autorizaci\xf3n","permalink":"/es/authorization/"}}');var i=n(25105),r=n(79621);const t={sidebar_position:3},c="Proteger el recurso de API con plantilla de organizaci\xf3n",s={},l=[{value:"El par\xe1metro adicional <code>organization_id</code>",id:"the-additional-organization_id-parameter",level:2},{value:"Configuraci\xf3n del cliente",id:"client-setup",level:2},{value:"Validaci\xf3n del servidor API",id:"api-server-validation",level:2}];function d(e){const o={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",mermaid:"mermaid",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.header,{children:(0,i.jsx)(o.h1,{id:"proteger-el-recurso-de-api-con-plantilla-de-organizaci\xf3n",children:"Proteger el recurso de API con plantilla de organizaci\xf3n"})}),"\n",(0,i.jsxs)(o.p,{children:["Adem\xe1s de ",(0,i.jsx)(o.a,{href:"/authorization/api-resources/protect-your-api",children:"Proteger tu API"}),", que asegura los recursos garantizando que un JWT v\xe1lido est\xe9 presente, los roles de organizaci\xf3n tambi\xe9n se pueden aplicar para filtrar los alcances. En este art\xedculo, nos centraremos en c\xf3mo el rol de la organizaci\xf3n afecta la delegaci\xf3n y validaci\xf3n de alcances en tu flujo de autenticaci\xf3n."]}),"\n",(0,i.jsx)(o.mermaid,{value:"sequenceDiagram\n    participant Cliente\n    participant Logto\n    participant API\n\n    Note over Cliente,API: Solicitud de Token\n    Cliente->>Logto: POST /oidc/token\n    Note right of Cliente: con recurso, organization_id,<br/>y alcances solicitados\n\n    Note over Logto: Verificar que el usuario pertenece a<br/>la organizaci\xf3n especificada\n    Logto--\x3e>Cliente: Devuelve token de acceso JWT\n    Note left of Logto: El token contiene:<br/>- Reclamos est\xe1ndar de JWT<br/>- organization_id<br/>- Alcances filtrados por rol de organizaci\xf3n\n\n    Note over Cliente,API: Solicitud de API\n    Cliente->>API: Solicitud con token Bearer\n\n    Note over API: Validar token JWT:<br/>1. Validaci\xf3n est\xe1ndar de JWT<br/>2. Verificar organization_id<br/>3. Verificar alcances\n\n    alt Token Inv\xe1lido\n        API--\x3e>Cliente: 401 No autorizado\n    else Token V\xe1lido\n        alt organization_id y alcance v\xe1lidos\n            API--\x3e>Cliente: Recurso Protegido\n        else De lo contrario\n            API--\x3e>Cliente: 403 Prohibido\n        end\n    end"}),"\n",(0,i.jsxs)(o.h2,{id:"the-additional-organization_id-parameter",children:["El par\xe1metro adicional ",(0,i.jsx)(o.code,{children:"organization_id"})]}),"\n",(0,i.jsxs)(o.p,{children:["Adem\xe1s de la solicitud normal de concesi\xf3n de token de acceso, en el diagrama a\xf1adimos un par\xe1metro adicional ",(0,i.jsx)(o.code,{children:"organization_id"}),", esto le indica a Logto que reduzca los alcances a los roles espec\xedficos de la organizaci\xf3n."]}),"\n",(0,i.jsx)(o.h2,{id:"client-setup",children:"Configuraci\xf3n del cliente"}),"\n",(0,i.jsxs)(o.p,{children:["Si est\xe1s utilizando el SDK de Logto, puedes agregar ",(0,i.jsx)(o.code,{children:"organization_id"})," como el segundo par\xe1metro del m\xe9todo ",(0,i.jsx)(o.code,{children:"getAccessToken"}),"."]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-tsx",children:"const accessToken = await logto.getAccessToken('https://my-resource.com/api', 'org_1');\n\n// O obtener reclamos directamente\nconst accessTokenClaims = await logto.getAccessTokenClaims('https://my-resource.com/api', 'org_1');\nconsole.log(accessTokenClaims.organization_id); // 'org_1'\nconsole.log(accessTokenClaims.aud); // 'https://my-resource.com/api'\n"})}),"\n",(0,i.jsxs)(o.p,{children:["Entonces, solo los alcances heredados de los roles de esta organizaci\xf3n se incluir\xe1n en el token de acceso, as\xed como un reclamo adicional ",(0,i.jsx)(o.code,{children:"organization_id"}),"."]}),"\n",(0,i.jsx)(o.h2,{id:"api-server-validation",children:"Validaci\xf3n del servidor API"}),"\n",(0,i.jsxs)(o.p,{children:["Adem\xe1s de la validaci\xf3n normal del token de acceso JWT, necesitar\xe1s agregar un nivel adicional para verificar si ",(0,i.jsx)(o.code,{children:"organization_id"})," est\xe1 presente y es v\xe1lido."]})]})}function u(e={}){const{wrapper:o}={...(0,r.R)(),...e.components};return o?(0,i.jsx)(o,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},79621:(e,o,n)=>{n.d(o,{R:()=>t,x:()=>c});var a=n(58101);const i={},r=a.createContext(i);function t(e){const o=a.useContext(r);return a.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function c(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),a.createElement(r.Provider,{value:o},e.children)}}}]);