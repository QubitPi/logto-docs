"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[4214],{89275:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>x,default:()=>w,frontMatter:()=>g,metadata:()=>r,toc:()=>j});const r=JSON.parse('{"id":"quick-starts/framework/flutterflow/README","title":"\u4f7f\u7528 Logto SDK \u81ea\u5b9a\u4e49 FlutterFlow CustomAuthManager","description":"FlutterFlow \u5177\u6709\u5185\u7f6e\u7684 custom authentication \u529f\u80fd\uff0c\u5141\u8bb8\u4f60\u4f7f\u7528\u81ea\u5df1\u7684\u540e\u7aef\u5bf9\u7528\u6237\u8fdb\u884c\u8ba4\u8bc1\u3002\u7136\u800c\uff0c\u5185\u7f6e\u7684\u81ea\u5b9a\u4e49\u8ba4\u8bc1\u6d41\u7a0b\u8bbe\u8ba1\u4e3a\u4ec5\u652f\u6301\u5355\u4e2a\u8ba4\u8bc1 API \u8c03\u7528\u3002\u5982\u679c\u4f60\u4f7f\u7528\u7b2c\u4e09\u65b9\u8eab\u4efd\u63d0\u4f9b\u5546 (IdP)\uff0c\u8ba4\u8bc1\u8bf7\u6c42\u53ea\u80fd\u4f7f\u7528 Resource Owner Password Credentials \u6388\u6743\u7c7b\u578b\uff0c\u8fd9\u4e0d\u63a8\u8350\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u3002\u6709\u5173\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 Deprecated ropc grant type\u3002","source":"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/quick-starts/framework/flutterflow/README.mdx","sourceDirName":"quick-starts/framework/flutterflow","slug":"/quick-starts/flutter-flow","permalink":"/zh-CN/quick-starts/flutter-flow","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/zh-CN/docusaurus-plugin-content-docs/current/quick-starts/framework/flutterflow/README.mdx","tags":[],"version":"current","frontMatter":{"slug":"/quick-starts/flutter-flow","sidebar_label":"FlutterFlow","sidebar_custom_props":{"description":"FlutterFlow \u662f\u4e00\u4e2a\u7528\u4e8e\u6784\u5efa\u6df7\u5408 Flutter \u5e94\u7528\u7684\u4f4e\u4ee3\u7801\u6846\u67b6\u3002"}},"sidebar":"quickStartSidebar","previous":{"title":"Flutter","permalink":"/zh-CN/quick-starts/flutter"},"next":{"title":"Go","permalink":"/zh-CN/quick-starts/go"}}');var o=n(25105),i=n(79621);function l(e){const t={code:"code",pre:"pre",...(0,i.R)(),...e.components};return(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-dart",children:"// lib/auth/custom_auth/custom_auth_manager.dart\n\nimport 'dart:async';\n\nimport 'package:flutter/foundation.dart';\nimport 'package:http/http.dart' as http;\nimport 'package:logto_dart_sdk/logto_client.dart';\nimport 'package:logto_dart_sdk/src/modules/id_token.dart';\n\nimport 'custom_auth_user_provider.dart';\n\nexport 'custom_auth_manager.dart';\n\n\nclass CustomAuthManager {\n  late LogtoClient logtoClient;\n\n  final logtoConfig = const LogtoConfig(\n      appId: '<YOUR-APP-ID>',\n      endpoint: '<YOUR-LOGTO-ENDPOINT>');\n\n\n  // ...\n\n  FlutterFlowAuthAuthUser? _updateCurrentUser(\n      {bool loggedIn = false, String? uid, OpenIdClaims? idToken}) {\n    // \u66f4\u65b0\u5f53\u524d\u7528\u6237\u6d41\u3002\n    final updatedUser = FlutterFlowAuthAuthUser(\n      loggedIn: loggedIn,\n      uid: uid,\n      idToken: idToken,\n    );\n\n    flutterFlowAuthAuthUserSubject.add(updatedUser);\n\n    return updatedUser;\n  }\n\n  Future initialize() async {\n    logtoClient = LogtoClient(config: logtoConfig, httpClient: http.Client());\n\n    late OpenIdClaims? idToken;\n\n    try {\n      idToken = await logtoClient.idTokenClaims;\n    } catch (e) {\n      if (kDebugMode) {\n        print('\u521d\u59cb\u5316\u8ba4\u8bc1\u65f6\u51fa\u9519: $e');\n      }\n    }\n\n    _updateCurrentUser(\n        loggedIn: idToken != null, uid: idToken?.subject, idToken: idToken);\n  }\n}\n\nFlutterFlowAuthAuthUser? currentUser;\nbool get loggedIn => currentUser?.loggedIn ?? false;\n\n"})})}function s(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}function a(e){const t={code:"code",pre:"pre",...(0,i.R)(),...e.components};return(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-dart",children:"// lib/auth/custom_auth/custom_auth_user_provider.dart\n\nimport 'package:logto_dart_sdk/src/modules/id_token.dart';\nimport 'package:rxdart/rxdart.dart';\n\nimport 'custom_auth_manager.dart';\n\nclass FlutterFlowAuthAuthUser {\n  FlutterFlowAuthAuthUser({required this.loggedIn, this.uid, this.idToken});\n\n  bool loggedIn;\n  String? uid;\n  OpenIdClaims? idToken;\n}\n\n/// \u751f\u6210\u8ba4\u8bc1\u7528\u6237\u7684\u6d41\u3002\nBehaviorSubject<FlutterFlowAuthAuthUser> flutterFlowAuthAuthUserSubject =\n    BehaviorSubject.seeded(FlutterFlowAuthAuthUser(loggedIn: false));\nStream<FlutterFlowAuthAuthUser> flutterFlowAuthAuthUserStream() =>\n    flutterFlowAuthAuthUserSubject\n        .asBroadcastStream()\n        .map((user) => currentUser = user);\n\n"})})}function d(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}function u(e){const t={a:"a",admonition:"admonition",code:"code",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components},{Details:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,o.jsxs)(n,{children:[(0,o.jsx)("summary",{children:(0,o.jsx)(t.h3,{id:"flutter_secure_storage",children:"flutter_secure_storage"})}),(0,o.jsxs)(t.p,{children:["\u6211\u4eec\u4f7f\u7528 ",(0,o.jsx)(t.a,{href:"https://pub.dev/packages/flutter_secure_storage",children:"flutter_secure_storage"})," \u6765\u5b9e\u73b0\u8de8\u5e73\u53f0\u7684\u6301\u4e45\u5b89\u5168\u4ee4\u724c\u5b58\u50a8\u3002\u5176\u5e95\u5c42\u5b9e\u73b0\uff1a"]}),(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"iOS \u4f7f\u7528 Keychain"}),"\n",(0,o.jsx)(t.li,{children:"Android \u4f7f\u7528 AES \u52a0\u5bc6\u3002"}),"\n"]}),(0,o.jsx)(t.h3,{id:"config-android-version",children:"\u914d\u7f6e Android \u7248\u672c\uff1a"}),(0,o.jsx)(t.p,{children:"\u5728 [project]/android/app/build.gradle \u4e2d\u5c06 minSdkVersion \u8bbe\u7f6e\u4e3a >= 18\u3002"}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-kotlin",children:"  android {\n      ...\n\n      defaultConfig {\n          ...\n          minSdkVersion 18\n          ...\n      }\n  }\n"})}),(0,o.jsx)(t.h3,{id:"disable-autobackup",children:"\u7981\u7528\u81ea\u52a8\u5907\u4efd\uff1a"}),(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsxs)(t.p,{children:["\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cAndroid \u4f1a\u5728 Google Drive \u4e0a\u5907\u4efd\u6570\u636e\u3002\u8fd9\u53ef\u80fd\u5bfc\u81f4\u5f02\u5e38 java.security.InvalidKeyException",":Failed"," to unwrap key\u3002"]})}),(0,o.jsx)(t.p,{children:"\u4e3a\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c\u4f60\u53ef\u4ee5\u7981\u7528\u5e94\u7528\u7684\u81ea\u52a8\u5907\u4efd\u6216\u4ece FlutterSecureStorage \u4e2d\u6392\u9664 sharedprefs\u3002"}),(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsxs)(t.p,{children:["\u8981\u7981\u7528\u81ea\u52a8\u5907\u4efd\uff0c\u8bf7\u8f6c\u5230\u5e94\u7528\u7684 manifest \u6587\u4ef6\u5e76\u8bbe\u7f6e\u5e03\u5c14\u503c android",":allowBackup","\uff1a"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-xml",children:'<manifest ... >\n    ...\n    <application\n      android:allowBackup="false"\n      android:fullBackupContent="false"\n      ...\n    >\n        ...\n    </application>\n</manifest>\n\n'})}),"\n"]}),"\n",(0,o.jsxs)(t.li,{children:["\n",(0,o.jsx)(t.p,{children:"\u4ece FlutterSecureStorage \u4e2d\u6392\u9664 sharedprefs\u3002"}),"\n",(0,o.jsxs)(t.p,{children:["\u5982\u679c\u4f60\u9700\u8981\u4e3a\u5e94\u7528\u542f\u7528 android",":fullBackupContent","\u3002\u8bbe\u7f6e\u4e00\u4e2a\u5907\u4efd\u89c4\u5219\u4ee5 ",(0,o.jsx)(t.a,{href:"https://developer.android.com/guide/topics/data/autobackup#IncludingFiles",children:"\u6392\u9664"})," \u63d2\u4ef6\u4f7f\u7528\u7684 prefs\uff1a"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-xml",children:'<application ...\n  android:fullBackupContent="@xml/backup_rules">\n</application>\n'})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-xml",children:'<?xml version="1.0" encoding="utf-8"?>\n<full-backup-content>\n  <exclude domain="sharedpref" path="FlutterSecureStorage"/>\n</full-backup-content>\n'})}),"\n",(0,o.jsxs)(t.p,{children:["\u8bf7\u67e5\u770b ",(0,o.jsx)(t.a,{href:"https://pub.dev/packages/flutter_secure_storage#configure-android-version",children:"flutter_secure_storage"})," \u4e86\u89e3\u66f4\u591a\u8be6\u60c5\u3002"]}),"\n"]}),"\n"]})]})}function c(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}function h(e){const t={a:"a",admonition:"admonition",code:"code",h3:"h3",p:"p",pre:"pre",...(0,i.R)(),...e.components},{Details:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,o.jsxs)(n,{children:[(0,o.jsx)("summary",{children:(0,o.jsx)(t.h3,{id:"flutter_web_auth",children:"flutter_web_auth"})}),(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.a,{href:"https://pub.dev/packages/flutter_web_auth",children:"flutter_web_auth"})," \u5728 Logto \u7684 flutter SDK \u4e2d\u4f7f\u7528\u3002\u6211\u4eec\u4f9d\u8d56\u5176\u57fa\u4e8e webview \u7684\u4ea4\u4e92\u754c\u9762\u6765\u6253\u5f00 Logto \u7684\u6388\u6743\u9875\u9762\u3002"]}),(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsx)(t.p,{children:"\u8fd9\u4e2a\u63d2\u4ef6\u5728 iOS 12+ \u548c macOS 10.15+ \u4e0a\u4f7f\u7528 ASWebAuthenticationSession\uff0c\u5728 iOS 11 \u4e0a\u4f7f\u7528 SFAuthenticationSession\uff0c\u5728 Android \u4e0a\u4f7f\u7528 Chrome Custom Tabs\uff0c\u5e76\u5728 Web \u4e0a\u6253\u5f00\u4e00\u4e2a\u65b0\u7a97\u53e3\u3002\n\u4f60\u53ef\u4ee5\u5728 iOS 8+ \u4e0a\u6784\u5efa\u5b83\uff0c\u4f46\u76ee\u524d\u4ec5\u652f\u6301 iOS 11 \u6216\u66f4\u9ad8\u7248\u672c\u3002"})}),(0,o.jsx)(t.h3,{id:"register-the-callback-url-on-android",children:"\u5728 Android \u4e0a\u6ce8\u518c\u56de\u8c03 url"}),(0,o.jsx)(t.p,{children:"\u4e3a\u4e86\u4ece Logto \u7684\u767b\u5f55\u7f51\u9875\u6355\u83b7\u56de\u8c03 url\uff0c\u4f60\u9700\u8981\u5c06\u4f60\u7684\u767b\u5f55 redirectUri \u6ce8\u518c\u5230 AndroidManifest.xml \u4e2d\u3002"}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-xml",children:'<activity android:name="com.linusu.flutter_web_auth.CallbackActivity" android:exported="true">\n    <intent-filter android:label="flutter_web_auth">\n        <action android:name="android.intent.action.VIEW"/>\n        <category android:name="android.intent.category.DEFAULT"/>\n        <category android:name="android.intent.category.BROWSABLE"/>\n        <data android:scheme="io.logto"/>\n    </intent-filter>\n</activity>\n'})})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}const g={slug:"/quick-starts/flutter-flow",sidebar_label:"FlutterFlow",sidebar_custom_props:{description:"FlutterFlow \u662f\u4e00\u4e2a\u7528\u4e8e\u6784\u5efa\u6df7\u5408 Flutter \u5e94\u7528\u7684\u4f4e\u4ee3\u7801\u6846\u67b6\u3002"}},x="\u4f7f\u7528 Logto SDK \u81ea\u5b9a\u4e49 FlutterFlow CustomAuthManager",m={},j=[{value:"\u524d\u63d0\u6761\u4ef6",id:"prerequisites",level:2},{value:"\u542f\u7528 FlutterFlow \u81ea\u5b9a\u4e49\u4ee3\u7801",id:"enable-flutterflow-custom-code",level:2},{value:"\u5728 FlutterFlow \u4e2d\u521b\u5efa\u4f60\u7684 UI",id:"create-your-ui-in-flutterflow",level:2},{value:"\u81ea\u5b9a\u4e49 CustomAuthManager",id:"customize-the-customauthmanager",level:2},{value:"\u5b89\u88c5 Logto SDK \u4f9d\u8d56",id:"install-logto-sdk-dependency",level:3},{value:"\u66f4\u65b0 UserProvider",id:"update-the-userprovider",level:3},{value:"\u5728 CustomAuthManager \u4e2d\u521d\u59cb\u5316 logto \u5ba2\u6237\u7aef",id:"init-the-logto-client-in-customauthmanager",level:3},{value:"\u5b9e\u73b0\u767b\u5f55\u65b9\u6cd5",id:"implement-the-sign-in-method",level:3},{value:"\u5b9e\u73b0\u6ce8\u9500\u65b9\u6cd5",id:"implement-the-sign-out-method",level:3},{value:"\u66f4\u65b0\u8ba4\u8bc1\u5de5\u5177\u65b9\u6cd5",id:"update-the-auth-util-methods",level:3},{value:"\u5728\u4f60\u7684 UI \u4e2d\u96c6\u6210\u81ea\u5b9a\u4e49\u8ba4\u8bc1",id:"integrate-the-custom-authentication-in-your-ui",level:2},{value:"\u4e3b\u9875",id:"home-page",level:3},{value:"\u7528\u6237\u8d44\u6599\u9875\u9762",id:"user-profile-page",level:3},{value:"\u8fdb\u4e00\u6b65\u9605\u8bfb",id:"further-readings",level:2},{value:"\u4f9d\u8d56\u95ee\u9898\u6392\u67e5",id:"dependency-troubleshooting",level:2},{value:"flutter_secure_storage",id:"flutter_secure_storage",level:3},{value:"\u914d\u7f6e Android \u7248\u672c\uff1a",id:"config-android-version",level:3},{value:"\u7981\u7528\u81ea\u52a8\u5907\u4efd\uff1a",id:"disable-autobackup",level:3},{value:"flutter_web_auth",id:"flutter_web_auth",level:3},{value:"\u5728 Android \u4e0a\u6ce8\u518c\u56de\u8c03 url",id:"register-the-callback-url-on-android",level:3}];function f(e){const t={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"\u4f7f\u7528-logto-sdk-\u81ea\u5b9a\u4e49-flutterflow-customauthmanager",children:"\u4f7f\u7528 Logto SDK \u81ea\u5b9a\u4e49 FlutterFlow CustomAuthManager"})}),"\n",(0,o.jsxs)(t.p,{children:["FlutterFlow \u5177\u6709\u5185\u7f6e\u7684 ",(0,o.jsx)(t.a,{href:"https://docs.flutterflow.io/data-and-backend/custom-authentication",children:"custom authentication"})," \u529f\u80fd\uff0c\u5141\u8bb8\u4f60\u4f7f\u7528\u81ea\u5df1\u7684\u540e\u7aef\u5bf9\u7528\u6237\u8fdb\u884c\u8ba4\u8bc1\u3002\u7136\u800c\uff0c\u5185\u7f6e\u7684\u81ea\u5b9a\u4e49\u8ba4\u8bc1\u6d41\u7a0b\u8bbe\u8ba1\u4e3a\u4ec5\u652f\u6301\u5355\u4e2a\u8ba4\u8bc1 API \u8c03\u7528\u3002\u5982\u679c\u4f60\u4f7f\u7528\u7b2c\u4e09\u65b9\u8eab\u4efd\u63d0\u4f9b\u5546 (IdP)\uff0c\u8ba4\u8bc1\u8bf7\u6c42\u53ea\u80fd\u4f7f\u7528 ",(0,o.jsx)(t.code,{children:"Resource Owner Password Credentials"})," \u6388\u6743\u7c7b\u578b\uff0c\u8fd9\u4e0d\u63a8\u8350\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u3002\u6709\u5173\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 ",(0,o.jsx)(t.a,{href:"https://blog.logto.io/deprecated-ropc-grant-type/",children:"Deprecated ropc grant type"}),"\u3002"]}),"\n",(0,o.jsxs)(t.p,{children:["\u6807\u51c6\u7684 OpenID Connect (OIDC) \u8ba4\u8bc1\u6d41\u7a0b\u6d89\u53ca\u591a\u4e2a\u6b65\u9aa4\uff0c\u4f8b\u5982\u6388\u6743\u3001\u4ee4\u724c\u4ea4\u6362\u548c\u7528\u6237\u4fe1\u606f\u68c0\u7d22\u3002\u8981\u4f7f\u7528\u50cf Logto \u8fd9\u6837\u7684 IdP \u5b9e\u73b0\u6807\u51c6\u7684 OIDC \u8ba4\u8bc1\u6d41\u7a0b\uff0c\u4f60\u9700\u8981\u5728 FlutterFlow \u4e2d\u81ea\u5b9a\u4e49 ",(0,o.jsx)(t.code,{children:"CustomAuthManager"})," \u7c7b\u3002"]}),"\n",(0,o.jsxs)(t.p,{children:["\u672c\u6559\u7a0b\u5c06\u5411\u4f60\u5c55\u793a\u5982\u4f55\u4f7f\u7528 Logto ",(0,o.jsx)(t.a,{href:"/zh-CN/quick-starts/flutter",children:"Flutter SDK"})," \u81ea\u5b9a\u4e49 FlutterFlow \u4e2d\u7684 ",(0,o.jsx)(t.code,{children:"CustomAuthManager"})," \u7c7b\u3002\u4f60\u53ef\u4ee5\u5229\u7528 Logto SDK \u5b9e\u73b0\u6807\u51c6\u7684 OIDC \u8ba4\u8bc1\u6d41\u7a0b\uff0c\u540c\u65f6\u4fdd\u7559 FlutterFlow UI \u6784\u5efa\u5668\u7684\u4f18\u52bf\u3002"]}),"\n",(0,o.jsx)(t.admonition,{type:"tip",children:(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["Logto SDK \u5305\u53ef\u5728 ",(0,o.jsx)(t.a,{href:"https://pub.dev/packages/logto_dart_sdk",children:"pub.dev"})," \u548c Logto ",(0,o.jsx)(t.a,{href:"https://github.com/logto-io/dart",children:"github repository"})," \u4e0a\u83b7\u53d6\u3002"]}),"\n",(0,o.jsx)(t.li,{children:"SDK \u76ee\u524d\u4ec5\u9002\u7528\u4e8e Android \u548c iOS \u5e73\u53f0\u3002"}),"\n"]})}),"\n",(0,o.jsx)(t.h2,{id:"prerequisites",children:"\u524d\u63d0\u6761\u4ef6"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\u4e00\u4e2a ",(0,o.jsx)(t.a,{href:"https://cloud.logto.io",children:"Logto Cloud"})," \u8d26\u6237\u6216\u4e00\u4e2a ",(0,o.jsx)(t.a,{href:"/introduction/set-up-logto-oss",children:"self-hosted Logto"}),"\u3002"]}),"\n",(0,o.jsx)(t.li,{children:"\u521b\u5efa\u4e00\u4e2a Logto Flutter \u5e94\u7528\u3002"}),"\n",(0,o.jsx)(t.li,{children:"\u4e00\u4e2a FlutterFlow \u9879\u76ee\u3002"}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"enable-flutterflow-custom-code",children:"\u542f\u7528 FlutterFlow \u81ea\u5b9a\u4e49\u4ee3\u7801"}),"\n",(0,o.jsxs)(t.p,{children:["\u4e3a\u4e86\u81ea\u5b9a\u4e49 ",(0,o.jsx)(t.code,{children:"CustomAuthManager"})," \u7c7b\uff0c\u4f60\u9700\u8981\u5728 FlutterFlow \u4e2d\u542f\u7528\u81ea\u5b9a\u4e49\u4ee3\u7801\u529f\u80fd\u3002\u6309\u7167 ",(0,o.jsx)(t.a,{href:"https://docs.flutterflow.io/customizing-your-app/manage-custom-code-in-github",children:"Manage Custom Code In GitHub"})," \u6307\u5357\u5c06\u4f60\u7684 FlutterFlow \u9879\u76ee\u4e0e GitHub \u540c\u6b65\u3002"]}),"\n",(0,o.jsx)(t.admonition,{type:"note",children:(0,o.jsx)(t.p,{children:"\u5728 GitHub \u4e2d\u7ba1\u7406\u81ea\u5b9a\u4e49\u4ee3\u7801\u662f FlutterFlow \u7684\u9ad8\u7ea7\u529f\u80fd\u3002\u4f60\u9700\u8981\u5c06 FlutterFlow \u5347\u7ea7\u5230\u4e13\u4e1a\u8ba1\u5212\u4ee5\u542f\u7528\u6b64\u529f\u80fd\u3002"})}),"\n",(0,o.jsx)(t.p,{children:"\u5b8c\u6210\u540e\uff0c\u4f60\u5c06\u5728 GitHub FlutterFlow \u4ed3\u5e93\u4e0b\u62e5\u6709\u4e09\u4e2a\u4e0d\u540c\u7684\u5206\u652f\uff1a"}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"main"}),"\uff1aFlutter \u9879\u76ee\u7684\u4e3b\u5206\u652f\u3002\u4f60\u9700\u8981\u6b64\u5206\u652f\u6765\u90e8\u7f72\u4f60\u7684\u9879\u76ee\u3002"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"flutterflow"}),"\uff1a",(0,o.jsx)(t.code,{children:"FlutterFlow"})," \u5c06\u4ece FlutterFlow \u7f16\u8f91\u5668\u540c\u6b65\u66f4\u6539\u7684\u5206\u652f\u3002"]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"develop"}),"\uff1a\u4f60\u53ef\u4ee5\u5728\u6b64\u5206\u652f\u4e2d\u4fee\u6539\u81ea\u5b9a\u4e49\u4ee3\u7801\u3002"]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"create-your-ui-in-flutterflow",children:"\u5728 FlutterFlow \u4e2d\u521b\u5efa\u4f60\u7684 UI"}),"\n",(0,o.jsxs)(t.p,{children:["\u9996\u5148\uff0c\u5728 FlutterFlow \u4e2d\u521b\u5efa\u4f60\u7684 UI\u3002\u4f60\u53ef\u4ee5\u6309\u7167 ",(0,o.jsx)(t.a,{href:"https://docs.flutterflow.io/",children:"FlutterFlow \u6587\u6863"})," \u6839\u636e\u4f60\u7684\u9700\u6c42\u521b\u5efa UI\u3002\u5bf9\u4e8e\u672c\u6559\u7a0b\uff0c\u6700\u4f4e\u8981\u6c42\u662f\u521b\u5efa\u4e24\u4e2a\u9875\u9762\uff1a"]}),"\n",(0,o.jsxs)(t.ol,{children:["\n",(0,o.jsx)(t.li,{children:"\u4e00\u4e2a\u5e26\u6709\u767b\u5f55\u6309\u94ae\u7684\u7b80\u5355\u4e3b\u9875\u3002"}),"\n",(0,o.jsx)(t.li,{children:"\u4e00\u4e2a\u663e\u793a\u7528\u6237\u4fe1\u606f\u548c\u6ce8\u9500\u6309\u94ae\u7684\u7528\u6237\u8d44\u6599\u9875\u9762\u3002"}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["\u8fdb\u5165 ",(0,o.jsx)(t.code,{children:"App Settings"})," -> ",(0,o.jsx)(t.code,{children:"Authentication"})," \u9875\u9762\u5e76\u542f\u7528\u81ea\u5b9a\u4e49\u8ba4\u8bc1\u3002\u8fd9\u5c06\u5728\u4f60\u7684 FlutterFlow \u9879\u76ee\u4e2d\u521b\u5efa\u4e00\u4e2a ",(0,o.jsx)(t.code,{children:"CustomAuthManager"})," \u7c7b\u3002"]}),"\n",(0,o.jsx)("center",{children:(0,o.jsx)("img",{src:"/img/assets/flutter-flow-custom-authentication.png",alt:"FlutterFlow custom authentication"})}),"\n",(0,o.jsxs)(t.p,{children:["\u51c6\u5907\u597d UI \u540e\uff0c\u5bfc\u822a\u5230 ",(0,o.jsx)(t.code,{children:"integrations"})," -> ",(0,o.jsx)(t.code,{children:"GitHub"})," \u9875\u9762\u5e76\u70b9\u51fb ",(0,o.jsx)(t.code,{children:"Push to Repository"})," \u6309\u94ae\uff0c\u5c06\u66f4\u6539\u63a8\u9001\u5230 ",(0,o.jsx)(t.code,{children:"flutterflow"})," \u5206\u652f\u3002"]}),"\n",(0,o.jsx)("center",{children:(0,o.jsx)("img",{src:"/img/assets/flutter-flow-github-push.png",alt:"FlutterFlow GitHub push"})}),"\n",(0,o.jsx)(t.h2,{id:"customize-the-customauthmanager",children:"\u81ea\u5b9a\u4e49 CustomAuthManager"}),"\n",(0,o.jsxs)(t.p,{children:["\u5207\u6362\u5230 GitHub \u4ed3\u5e93\u4e2d\u7684 ",(0,o.jsx)(t.code,{children:"develop"})," \u5206\u652f\uff0c\u5e76\u5408\u5e76\u6765\u81ea ",(0,o.jsx)(t.code,{children:"flutterflow"})," \u5206\u652f\u7684\u6700\u65b0\u66f4\u6539\u3002\u5305\u62ec\u4f60\u7684 UI \u9875\u9762\u548c\u9884\u6784\u5efa\u7684 ",(0,o.jsx)(t.code,{children:"CustomAuthManager"})," \u7c7b\u3002"]}),"\n",(0,o.jsx)(t.h3,{id:"install-logto-sdk-dependency",children:"\u5b89\u88c5 Logto SDK \u4f9d\u8d56"}),"\n",(0,o.jsx)(t.p,{children:"\u5c06 Logto SDK \u4f9d\u8d56\u6dfb\u52a0\u5230\u4f60\u7684\u9879\u76ee\u4e2d\u3002"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"  flutter pub add logto_dart_sdk\n"})}),"\n",(0,o.jsxs)(t.admonition,{type:"note",children:[(0,o.jsx)(t.p,{children:"\u53ef\u9009\u7684 Http \u5305\uff1a"}),(0,o.jsxs)(t.p,{children:["Logto \u5ba2\u6237\u7aef\u9700\u8981\u4e00\u4e2a http \u5ba2\u6237\u7aef\u6765\u8fdb\u884c API \u8c03\u7528\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528 ",(0,o.jsx)(t.code,{children:"http"})," \u5305\u6216\u4efb\u4f55\u5176\u4ed6\u4f60\u9009\u62e9\u7684 http \u5ba2\u6237\u7aef\u5305\u3002"]}),(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"  flutter pub add http\n"})})]}),"\n",(0,o.jsx)(t.h3,{id:"update-the-userprovider",children:"\u66f4\u65b0 UserProvider"}),"\n",(0,o.jsxs)(t.p,{children:["\u5c06 ",(0,o.jsx)(t.code,{children:"OpenIdClaims"})," \u7c7b\u6dfb\u52a0\u5230 ",(0,o.jsx)(t.code,{children:"CustomAuthUserProvider"})," \u7c7b\u4e2d\u4ee5\u5b58\u50a8\u7528\u6237\u4fe1\u606f\u3002"]}),"\n",(0,o.jsxs)(t.blockquote,{children:["\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"OpenIdClaims"})," \u7c7b\u662f Logto SDK \u7684\u4e00\u90e8\u5206\uff0c\u5b83\u5c06\u4e3a\u8ba4\u8bc1\u7528\u6237\u63d0\u4f9b ",(0,o.jsx)(t.code,{children:"id_token"})," \u58f0\u660e\u3002"]}),"\n"]}),"\n",(0,o.jsx)(d,{}),"\n",(0,o.jsx)(t.h3,{id:"init-the-logto-client-in-customauthmanager",children:"\u5728 CustomAuthManager \u4e2d\u521d\u59cb\u5316 logto \u5ba2\u6237\u7aef"}),"\n",(0,o.jsxs)(t.p,{children:["\u5728 ",(0,o.jsx)(t.code,{children:"CustomAuthManager"})," \u7c7b\u4e2d\u521d\u59cb\u5316 Logto \u5ba2\u6237\u7aef\u3002"]}),"\n",(0,o.jsx)(s,{}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"initialize"})," \u65b9\u6cd5\u5c06\u521d\u59cb\u5316 Logto \u5ba2\u6237\u7aef\uff0c\u5e76\u4f7f\u7528\u672c\u5730\u5b58\u50a8\u4e2d\u6301\u4e45\u5316\u7684\u7528\u6237\u8ba4\u8bc1\u72b6\u6001\u66f4\u65b0\u5f53\u524d\u7528\u6237\u6d41\u3002"]}),"\n",(0,o.jsxs)(t.blockquote,{children:["\n",(0,o.jsxs)(t.p,{children:["Logto SDK \u4f7f\u7528 ",(0,o.jsx)(t.a,{href:"https://pub.dev/packages/flutter_secure_storage",children:"flutter_secure_storage"})," \u5305\u6765\u5b89\u5168\u5730\u5b58\u50a8\u7528\u6237\u8ba4\u8bc1\u4fe1\u606f\u3002"]}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"implement-the-sign-in-method",children:"\u5b9e\u73b0\u767b\u5f55\u65b9\u6cd5"}),"\n",(0,o.jsxs)(t.p,{children:["\u8c03\u7528 ",(0,o.jsx)(t.code,{children:"LogtoClient.signIn"})," \u65b9\u6cd5\u5c06\u542f\u52a8\u6807\u51c6\u7684 OIDC \u8ba4\u8bc1\u6d41\u7a0b\u3002Logto \u767b\u5f55\u9875\u9762\u5c06\u5728 webview \u4e2d\u4f7f\u7528 ",(0,o.jsx)(t.a,{href:"https://pub.dev/packages/flutter_web_auth",children:"flutter_web_auth"})," \u6253\u5f00\u3002"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-dart",children:"// lib/auth/custom_auth/custom_auth_manager.dart\n\nFuture<FlutterFlowAuthAuthUser?> signIn(\n    String redirectUri,\n  ) async {\n    await logtoClient.signIn(redirectUri);\n\n    var idTokenClaims = await logtoClient.idTokenClaims;\n\n    return _updateCurrentUser(\n      loggedIn: idTokenClaims != null,\n      uid: idTokenClaims?.subject,\n      idToken: idTokenClaims,\n    );\n  }\n\n"})}),"\n",(0,o.jsxs)(t.p,{children:["LogtoClient \u5c06\u5904\u7406\u6388\u6743\u3001\u4ee4\u724c\u4ea4\u6362\u548c\u7528\u6237\u4fe1\u606f\u68c0\u7d22\u6b65\u9aa4\u3002\u4e00\u65e6\u7528\u6237\u8ba4\u8bc1\u6210\u529f\uff0c",(0,o.jsx)(t.code,{children:"idTokenClaims"})," \u5c06\u5b58\u50a8\u5728\u672c\u5730\u5b58\u50a8\u4e2d\u3002\n\u4ece LogtoClient \u4e2d\u68c0\u7d22 ",(0,o.jsx)(t.code,{children:"idTokenClaims"})," \u5e76\u66f4\u65b0\u5f53\u524d\u7528\u6237\u6d41\u3002"]}),"\n",(0,o.jsx)(t.h3,{id:"implement-the-sign-out-method",children:"\u5b9e\u73b0\u6ce8\u9500\u65b9\u6cd5"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-dart",children:"// lib/auth/custom_auth/custom_auth_manager.dart\n\nFuture signOut() async {\n    await logtoClient.signOut();\n\n    flutterFlowAuthAuthUserSubject.add(\n      FlutterFlowAuthAuthUser(loggedIn: false),\n    );\n  }\n"})}),"\n",(0,o.jsx)(t.h3,{id:"update-the-auth-util-methods",children:"\u66f4\u65b0\u8ba4\u8bc1\u5de5\u5177\u65b9\u6cd5"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["\u6dfb\u52a0 ",(0,o.jsx)(t.code,{children:"authManager"})," getter \u4ee5\u8bbf\u95ee ",(0,o.jsx)(t.code,{children:"CustomAuthManager"})," \u5b9e\u4f8b\u3002"]}),"\n",(0,o.jsxs)(t.li,{children:["\u6dfb\u52a0 ",(0,o.jsx)(t.code,{children:"currentUserUid"})," getter \u4ee5\u83b7\u53d6\u5f53\u524d\u7528\u6237 uid\u3002"]}),"\n",(0,o.jsxs)(t.li,{children:["\u6dfb\u52a0 ",(0,o.jsx)(t.code,{children:"currentUserData"})," getter \u4ee5\u83b7\u53d6\u5f53\u524d\u7528\u6237\u6570\u636e\u3002"]}),"\n",(0,o.jsxs)(t.li,{children:["\u6dfb\u52a0 ",(0,o.jsx)(t.code,{children:"logtoClient"})," getter \u4ee5\u8bbf\u95ee Logto \u5ba2\u6237\u7aef\u5b9e\u4f8b\u3002"]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-dart",children:"// lib/auth/custom_auth/auth_util.dart\n\nimport 'package:logto_dart_sdk/logto_client.dart';\nimport 'package:logto_dart_sdk/src/modules/id_token.dart';\n\nimport 'custom_auth_manager.dart';\n\nexport 'custom_auth_manager.dart';\n\nfinal _authManager = CustomAuthManager();\nCustomAuthManager get authManager => _authManager;\nString get currentUserUid => currentUser?.uid ?? '';\nOpenIdClaims? get currentUserData => currentUser?.idToken;\nLogtoClient get logtoClient => _authManager.logtoClient;\n"})}),"\n",(0,o.jsx)(t.h2,{id:"integrate-the-custom-authentication-in-your-ui",children:"\u5728\u4f60\u7684 UI \u4e2d\u96c6\u6210\u81ea\u5b9a\u4e49\u8ba4\u8bc1"}),"\n",(0,o.jsx)(t.h3,{id:"home-page",children:"\u4e3b\u9875"}),"\n",(0,o.jsxs)(t.p,{children:["\u5f53\u7528\u6237\u70b9\u51fb\u767b\u5f55\u6309\u94ae\u65f6\uff0c\u8c03\u7528 ",(0,o.jsx)(t.code,{children:"authManager.signIn"})," \u65b9\u6cd5\u4ee5\u542f\u52a8\u8ba4\u8bc1\u6d41\u7a0b\u3002"]}),"\n",(0,o.jsxs)(t.blockquote,{children:["\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.code,{children:"redirectUri"})," \u662f\u7528\u4e8e\u6355\u83b7\u6765\u81ea Logto \u767b\u5f55\u9875\u9762\u7684\u6388\u6743\u56de\u8c03\u7684\u56de\u8c03 URL\u3002\n\u6709\u5173 redirectUri \u7684\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605 ",(0,o.jsx)(t.a,{href:"/zh-CN/quick-starts/flutter#implement-sign-in",children:"Flutter SDK"}),"\u3002"]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-dart",children:"// lib/pages/home_page/home_page_widget.dart\n\nfinal redirectUri = 'io.logto://callback';\n\n// ...\n\nFFButtonWidget(\n  onPressed: () async {\n    GoRouter.of(context).prepareAuthEvent();\n\n    await authManager.signIn(redirectUri);\n\n    context.replaceNamed('user');\n  },\n  text: 'Sign In',\n  // ...\n)\n"})}),"\n",(0,o.jsx)(t.h3,{id:"user-profile-page",children:"\u7528\u6237\u8d44\u6599\u9875\u9762"}),"\n",(0,o.jsx)(t.p,{children:"\u4f7f\u7528\u8ba4\u8bc1\u5de5\u5177 getter \u8bbf\u95ee\u5f53\u524d\u7528\u6237\u6570\u636e\u548c Logto \u5ba2\u6237\u7aef\u5b9e\u4f8b\u3002"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-dart",children:"// lib/pages/user/user_widget.dart\n\nimport '/auth/custom_auth/auth_util.dart';\n\n// ...\n\nchildren: [\n  Text(\n    'User ID: $currentUserUid',\n  ),\n  Text(\n    'Display Name: ${currentUserData?.name}',\n  ),\n  Text(\n    'Username: ${currentUserData?.username}',\n  ),\n  Text(\n    'Email: ${currentUserData?.emailVerified ?? currentUserData?.email}',\n  ),\n]\n\n"})}),"\n",(0,o.jsx)(t.p,{children:"\u5f53\u7528\u6237\u70b9\u51fb\u6ce8\u9500\u6309\u94ae\u65f6\uff0c\u5b9e\u73b0\u6ce8\u9500\u65b9\u6cd5\u3002"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-dart",children:"// lib/pages/user/user_widget.dart\n\nFFButtonWidget(\n  onPressed: () async {\n    await authManager.signOut();\n\n    context.replaceNamed('HomePage');\n  },\n  text: 'Sign Out',\n  // ...\n)\n"})}),"\n",(0,o.jsx)(t.h2,{id:"further-readings",children:"\u8fdb\u4e00\u6b65\u9605\u8bfb"}),"\n",(0,o.jsxs)(t.p,{children:["Logto SDK \u63d0\u4f9b\u4e86\u66f4\u591a\u4e0e Logto API \u4ea4\u4e92\u7684\u65b9\u6cd5\u3002\u4f60\u53ef\u4ee5\u8fdb\u4e00\u6b65\u81ea\u5b9a\u4e49 ",(0,o.jsx)(t.code,{children:"CustomAuthManager"})," \u7c7b\u4ee5\u5b9e\u73b0\u66f4\u591a\u529f\u80fd\u3002"]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"/zh-CN/quick-starts/flutter#get-user-information",children:"\u7528\u6237\u8d44\u6599"})}),"\n",(0,o.jsx)(t.li,{children:(0,o.jsx)(t.a,{href:"/zh-CN/quick-starts/flutter#api-resources-and-organizations",children:"API \u8d44\u6e90\u548c\u7ec4\u7ec7"})}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"dependency-troubleshooting",children:"\u4f9d\u8d56\u95ee\u9898\u6392\u67e5"}),"\n",(0,o.jsx)(c,{}),"\n",(0,o.jsx)(p,{})]})}function w(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(f,{...e})}):f(e)}},79621:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>s});var r=n(58101);const o={},i=r.createContext(o);function l(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);