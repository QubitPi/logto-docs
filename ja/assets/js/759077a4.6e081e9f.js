"use strict";(self.webpackChunk_logto_docs=self.webpackChunk_logto_docs||[]).push([[6665],{7057:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>ye,contentTitle:()=>fe,default:()=>ve,frontMatter:()=>je,metadata:()=>r,toc:()=>Ae});const r=JSON.parse('{"id":"authorization/validate-access-tokens/README","title":"API \u30b5\u30fc\u30d3\u30b9\u3084\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3067\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3\u3092\u691c\u8a3c\u3059\u308b\u65b9\u6cd5","description":"\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3\u306e\u691c\u8a3c\u306f\u3001Logto \u306b\u304a\u3051\u308b \u30ed\u30fc\u30eb\u30d9\u30fc\u30b9\u306e\u30a2\u30af\u30bb\u30b9\u5236\u5fa1 (RBAC) \u3092\u5f37\u5236\u3059\u308b\u4e0a\u3067\u91cd\u8981\u306a\u90e8\u5206\u3067\u3059\u3002\u3053\u306e\u30ac\u30a4\u30c9\u3067\u306f\u3001\u30d0\u30c3\u30af\u30a8\u30f3\u30c9 / API \u3067 Logto \u304c\u767a\u884c\u3057\u305f JWT \u3092\u691c\u8a3c\u3057\u3001\u7f72\u540d\u3001\u767a\u884c\u8005 (Issuer)\u3001\u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9 (Audience)\u3001\u6709\u52b9\u671f\u9650\u3001\u6a29\u9650 (\u30b9\u30b3\u30fc\u30d7)\u3001\u7d44\u7e54 (Organization) \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u78ba\u8a8d\u3059\u308b\u65b9\u6cd5\u3092\u8aac\u660e\u3057\u307e\u3059\u3002","source":"@site/i18n/ja/docusaurus-plugin-content-docs/current/authorization/validate-access-tokens/README.mdx","sourceDirName":"authorization/validate-access-tokens","slug":"/authorization/validate-access-tokens/","permalink":"/ja/authorization/validate-access-tokens/","draft":false,"unlisted":false,"editUrl":"https://github.com/logto-io/docs/tree/master/i18n/ja/docusaurus-plugin-content-docs/current/authorization/validate-access-tokens/README.mdx","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"sidebar_label":"API \u3067\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3\u3092\u691c\u8a3c\u3059\u308b"},"sidebar":"docsSidebar","previous":{"title":"\u7d44\u7e54\u30ec\u30d9\u30eb\u306e API \u30ea\u30bd\u30fc\u30b9\u3092\u4fdd\u8b77\u3059\u308b","permalink":"/ja/authorization/organization-level-api-resources"},"next":{"title":"\u8a8d\u53ef (Authorization)","permalink":"/ja/authorization/"}}');var o=t(25105),a=t(79621),i=t(38552),s=t(22002),c=t(12953),l=t(22698),d=t(79057),u=t(91529),p=t(1938),h=t(87289),g=t(60283),m=t(30961),x=t(62765),j=t(84940),f=t(521),y=t(40561);const A=[...y.RM,...j.RM,...f.RM,...x.RM];function w(e){return(0,o.jsxs)(s.A,{groupId:"go-framework",children:[(0,o.jsx)(i.A,{value:"gin",label:"Gin",children:(0,o.jsx)(y.Ay,{})}),(0,o.jsx)(i.A,{value:"echo",label:"Echo",children:(0,o.jsx)(j.Ay,{})}),(0,o.jsx)(i.A,{value:"fiber",label:"Fiber",children:(0,o.jsx)(f.Ay,{})}),(0,o.jsx)(i.A,{value:"chi",label:"Chi",children:(0,o.jsx)(x.Ay,{})})]})}function v(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(w,{...e})}):w()}var _=t(1429),k=t(14087),b=t(30585),I=t(71423),S=t(73833),R=t(89991);const z=[...S.RM,...I.RM,...b.RM,...R.RM];function E(e){return(0,o.jsxs)(s.A,{groupId:"api-framework",children:[(0,o.jsx)(i.A,{value:"spring-boot",label:"Spring Boot",children:(0,o.jsx)(S.Ay,{})}),(0,o.jsx)(i.A,{value:"quarkus",label:"Quarkus",children:(0,o.jsx)(I.Ay,{})}),(0,o.jsx)(i.A,{value:"micronaut",label:"Micronaut",children:(0,o.jsx)(b.Ay,{})}),(0,o.jsx)(i.A,{value:"vertx-web",label:"Vert.x Web",children:(0,o.jsx)(R.Ay,{})})]})}function T(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(E,{...e})}):E()}var J=t(33403),P=t(24277);function q(e){const n={code:"code",pre:"pre",...(0,a.R)(),...e.components};return(0,o.jsxs)(s.A,{groupId:"api-framework",children:[(0,o.jsx)(i.A,{value:"express",label:"Express.js",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'title="app.ts"',children:"import express from 'express';\nimport { verifyAccessToken } from './auth-middleware.js';\n\nconst app = express();\n\napp.get('/api/protected', verifyAccessToken, (req, res) => {\n  // \u8a8d\u8a3c\u60c5\u5831\u3078 req.auth \u304b\u3089\u76f4\u63a5\u30a2\u30af\u30bb\u30b9\n  res.json({ auth: req.auth });\n});\n\napp.get('/api/protected/detailed', verifyAccessToken, (req, res) => {\n  // \u4fdd\u8b77\u3055\u308c\u305f\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u30ed\u30b8\u30c3\u30af\n  res.json({\n    auth: req.auth,\n    message: '\u4fdd\u8b77\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3078\u306e\u30a2\u30af\u30bb\u30b9\u306b\u6210\u529f\u3057\u307e\u3057\u305f',\n  });\n});\n\napp.listen(3000);\n"})})}),(0,o.jsx)(i.A,{value:"koa",label:"Koa.js",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'title="app.ts"',children:"import Koa from 'koa';\nimport Router from '@koa/router';\nimport { koaVerifyAccessToken } from './auth-middleware.js';\n\nconst app = new Koa();\nconst router = new Router();\n\nrouter.get('/api/protected', koaVerifyAccessToken, (ctx) => {\n  // \u8a8d\u8a3c\u60c5\u5831\u3078 ctx.state.auth \u304b\u3089\u76f4\u63a5\u30a2\u30af\u30bb\u30b9\n  ctx.body = { auth: ctx.state.auth };\n});\n\nrouter.get('/api/protected/detailed', koaVerifyAccessToken, (ctx) => {\n  // \u4fdd\u8b77\u3055\u308c\u305f\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u30ed\u30b8\u30c3\u30af\n  ctx.body = {\n    auth: ctx.state.auth,\n    message: '\u4fdd\u8b77\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3078\u306e\u30a2\u30af\u30bb\u30b9\u306b\u6210\u529f\u3057\u307e\u3057\u305f',\n  };\n});\n\napp.use(router.routes());\napp.listen(3000);\n"})})}),(0,o.jsx)(i.A,{value:"fastify",label:"Fastify",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'title="app.ts"',children:"import Fastify from 'fastify';\nimport { fastifyVerifyAccessToken } from './auth-middleware.js';\n\nconst fastify = Fastify();\n\nserver.get('/api/protected', { preHandler: fastifyVerifyAccessToken }, (request, reply) => {\n  // \u8a8d\u8a3c\u60c5\u5831\u3078 request.auth \u304b\u3089\u76f4\u63a5\u30a2\u30af\u30bb\u30b9\n  reply.send({ auth: request.auth });\n});\n\nserver.get(\n  '/api/protected/detailed',\n  { preHandler: fastifyVerifyAccessToken },\n  (request, reply) => {\n    // \u4fdd\u8b77\u3055\u308c\u305f\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u30ed\u30b8\u30c3\u30af\n    reply.send({\n      auth: request.auth,\n      message: '\u4fdd\u8b77\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3078\u306e\u30a2\u30af\u30bb\u30b9\u306b\u6210\u529f\u3057\u307e\u3057\u305f',\n    });\n  }\n);\n\nfastify.listen({ port: 3000 });\n"})})}),(0,o.jsx)(i.A,{value:"hapi",label:"Hapi.js",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'title="app.ts"',children:"import Hapi from '@hapi/hapi';\nimport { hapiVerifyAccessToken } from './auth-middleware.js';\n\nconst server = Hapi.server({ port: 3000 });\n\nserver.route({\n  method: 'GET',\n  path: '/api/protected',\n  options: {\n    pre: [{ method: hapiVerifyAccessToken }],\n    handler: (request, h) => {\n      // \u8a8d\u8a3c\u60c5\u5831\u3078 request.app.auth \u304b\u3089\u30a2\u30af\u30bb\u30b9\n      return { auth: request.app.auth };\n    },\n  },\n});\n\nserver.route({\n  method: 'GET',\n  path: '/api/protected/detailed',\n  options: {\n    pre: [{ method: hapiVerifyAccessToken }],\n    handler: (request, h) => {\n      // \u4fdd\u8b77\u3055\u308c\u305f\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u30ed\u30b8\u30c3\u30af\n      return {\n        auth: request.app.auth,\n        message: '\u4fdd\u8b77\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3078\u306e\u30a2\u30af\u30bb\u30b9\u306b\u6210\u529f\u3057\u307e\u3057\u305f',\n      };\n    },\n  },\n});\n\nawait server.start();\n"})})}),(0,o.jsx)(i.A,{value:"nestjs",label:"NestJS",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'title="protected.controller.ts"',children:"import { Controller, Get, UseGuards, Req } from '@nestjs/common';\nimport { AccessTokenGuard } from './access-token.guard.js';\n\n@Controller('api')\nexport class ProtectedController {\n  @Get('protected')\n  @UseGuards(AccessTokenGuard)\n  getProtected(@Req() req: any) {\n    // \u8a8d\u8a3c\u60c5\u5831\u3078 req.auth \u304b\u3089\u30a2\u30af\u30bb\u30b9\n    return { auth: req.auth };\n  }\n\n  @Get('protected/detailed')\n  @UseGuards(AccessTokenGuard)\n  getDetailedProtected(@Req() req: any) {\n    // \u4fdd\u8b77\u3055\u308c\u305f\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u30ed\u30b8\u30c3\u30af\n    return {\n      auth: req.auth,\n      message: '\u4fdd\u8b77\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3078\u306e\u30a2\u30af\u30bb\u30b9\u306b\u6210\u529f\u3057\u307e\u3057\u305f',\n    };\n  }\n}\n"})})})]})}function C(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(q,{...e})}):q(e)}var N=t(22),$=t(43801),M=t(33435),V=t(69088),O=t(89558),F=t(95416);const W=[...V.RM,...F.RM,...O.RM];function H(e){return(0,o.jsxs)(s.A,{groupId:"api-framework",children:[(0,o.jsx)(i.A,{value:"laravel",label:(0,M.My)("laravel"),children:(0,o.jsx)(V.Ay,{})}),(0,o.jsx)(i.A,{value:"symfony",label:(0,M.My)("symfony"),children:(0,o.jsx)(F.Ay,{})}),(0,o.jsx)(i.A,{value:"slim",label:(0,M.My)("slim"),children:(0,o.jsx)(O.Ay,{})})]})}function D(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(H,{...e})}):H()}var L=t(5923),B=t(68287),U=t(61702),K=t(24699),G=t(60769),Y=t(62868);const Q=[...G.RM,...Y.RM,...U.RM,...K.RM];function X(e){return(0,o.jsxs)(s.A,{groupId:"api-framework",children:[(0,o.jsx)(i.A,{value:"fastapi",label:(0,M.My)("fastapi"),children:(0,o.jsx)(G.Ay,{})}),(0,o.jsx)(i.A,{value:"flask",label:(0,M.My)("flask"),children:(0,o.jsx)(Y.Ay,{})}),(0,o.jsx)(i.A,{value:"django",label:(0,M.My)("django"),children:(0,o.jsx)(U.Ay,{})}),(0,o.jsx)(i.A,{value:"django-rest",label:(0,M.My)("django-rest"),children:(0,o.jsx)(K.Ay,{})})]})}function Z(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(X,{...e})}):X()}var ee=t(86825),ne=t(21351),te=t(86138),re=t(12516),oe=t(87531);const ae=[...re.RM,...oe.RM,...te.RM];function ie(e){return(0,o.jsxs)(s.A,{groupId:"api-framework",children:[(0,o.jsx)(i.A,{value:"rails",label:(0,M.My)("rails"),children:(0,o.jsx)(re.Ay,{})}),(0,o.jsx)(i.A,{value:"sinatra",label:(0,M.My)("sinatra"),children:(0,o.jsx)(oe.Ay,{})}),(0,o.jsx)(i.A,{value:"grape",label:(0,M.My)("grape"),children:(0,o.jsx)(te.Ay,{})})]})}function se(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(ie,{...e})}):ie()}var ce=t(52259),le=t(38448),de=t(5545),ue=t(15326),pe=t(59965);const he=[...ue.RM,...de.RM,...pe.RM];function ge(e){return(0,o.jsxs)(s.A,{groupId:"api-framework",children:[(0,o.jsx)(i.A,{value:"axum",label:(0,M.My)("axum"),children:(0,o.jsx)(ue.Ay,{})}),(0,o.jsx)(i.A,{value:"actix-web",label:(0,M.My)("actix-web"),children:(0,o.jsx)(de.Ay,{})}),(0,o.jsx)(i.A,{value:"rocket",label:(0,M.My)("rocket"),children:(0,o.jsx)(pe.Ay,{})})]})}function me(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(ge,{...e})}):ge()}var xe=t(85669);const je={sidebar_position:6,sidebar_label:"API \u3067\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3\u3092\u691c\u8a3c\u3059\u308b"},fe="API \u30b5\u30fc\u30d3\u30b9\u3084\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3067\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3\u3092\u691c\u8a3c\u3059\u308b\u65b9\u6cd5",ye={},Ae=[{value:"\u59cb\u3081\u308b\u524d\u306b",id:"before-you-start",level:2},{value:"\u30b9\u30c6\u30c3\u30d7 1: \u5b9a\u6570\u3068\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u306e\u521d\u671f\u5316",id:"step-1-initialize-constants-and-utilities",level:2},...u.RM,...N.RM,...ee.RM,..._.RM,...J.RM,...d.RM,...L.RM,...ce.RM,...xe.RM,{value:"\u30b9\u30c6\u30c3\u30d7 2: Logto \u30c6\u30ca\u30f3\u30c8\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b",id:"step-2-retrieve-info-about-your-logto-tenant",level:2},...p.RM,{value:"\u30b9\u30c6\u30c3\u30d7 3: \u30c8\u30fc\u30af\u30f3\u3068\u6a29\u9650\u3092\u691c\u8a3c\u3059\u308b",id:"step-3-validate-the-token-and-permissions",level:2},...g.RM,{value:"\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\u3092\u8ffd\u52a0\u3059\u308b",id:"add-the-validation-logic",level:3},...P.RM,...B.RM,...m.RM,...k.RM,...c.RM,...$.RM,...ne.RM,...le.RM,{value:"\u30b9\u30c6\u30c3\u30d7 4: API \u306b\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u9069\u7528\u3059\u308b",id:"step-4-apply-middleware-to-your-api",level:2},...Q,...A,...z,...l.RM,...W,...ae,...he,{value:"\u30b9\u30c6\u30c3\u30d7 5: \u5b9f\u88c5\u3092\u30c6\u30b9\u30c8\u3059\u308b",id:"step-5-test-your-implementation",level:2},...h.RM,{value:"\u95a2\u9023\u30ea\u30bd\u30fc\u30b9",id:"related-resources",level:2}];function we(e){const n={a:"a",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",ul:"ul",...(0,a.R)(),...e.components},{Url:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Url",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"api-\u30b5\u30fc\u30d3\u30b9\u3084\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3067\u30a2\u30af\u30bb\u30b9-\u30c8\u30fc\u30af\u30f3\u3092\u691c\u8a3c\u3059\u308b\u65b9\u6cd5",children:"API \u30b5\u30fc\u30d3\u30b9\u3084\u30d0\u30c3\u30af\u30a8\u30f3\u30c9\u3067\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3\u3092\u691c\u8a3c\u3059\u308b\u65b9\u6cd5"})}),"\n",(0,o.jsxs)(n.p,{children:["\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3\u306e\u691c\u8a3c\u306f\u3001Logto \u306b\u304a\u3051\u308b ",(0,o.jsx)(n.a,{href:"/authorization/role-based-access-control",children:"\u30ed\u30fc\u30eb\u30d9\u30fc\u30b9\u306e\u30a2\u30af\u30bb\u30b9\u5236\u5fa1 (RBAC)"})," \u3092\u5f37\u5236\u3059\u308b\u4e0a\u3067\u91cd\u8981\u306a\u90e8\u5206\u3067\u3059\u3002\u3053\u306e\u30ac\u30a4\u30c9\u3067\u306f\u3001\u30d0\u30c3\u30af\u30a8\u30f3\u30c9 / API \u3067 Logto \u304c\u767a\u884c\u3057\u305f JWT \u3092\u691c\u8a3c\u3057\u3001\u7f72\u540d\u3001\u767a\u884c\u8005 (Issuer)\u3001\u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9 (Audience)\u3001\u6709\u52b9\u671f\u9650\u3001\u6a29\u9650 (\u30b9\u30b3\u30fc\u30d7)\u3001\u7d44\u7e54 (Organization) \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u78ba\u8a8d\u3059\u308b\u65b9\u6cd5\u3092\u8aac\u660e\u3057\u307e\u3059\u3002"]}),"\n",(0,o.jsx)(n.h2,{id:"before-you-start",children:"\u59cb\u3081\u308b\u524d\u306b"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"\u3053\u306e\u30ac\u30a4\u30c9\u306f\u3001Logto \u306e RBAC \u6982\u5ff5\u306b\u7cbe\u901a\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u524d\u63d0\u3068\u3057\u3066\u3044\u307e\u3059\u3002"}),"\n",(0,o.jsxs)(n.li,{children:["API \u30ea\u30bd\u30fc\u30b9\u3092\u4fdd\u8b77\u3059\u308b\u5834\u5408\u3001\u3053\u306e\u30ac\u30a4\u30c9\u306f ",(0,o.jsx)(n.a,{href:"/authorization/global-api-resources",children:"\u30b0\u30ed\u30fc\u30d0\u30eb API \u30ea\u30bd\u30fc\u30b9\u306e\u4fdd\u8b77"})," \u30ac\u30a4\u30c9\u3092\u5b8c\u4e86\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u524d\u63d0\u3068\u3057\u3066\u3044\u307e\u3059\u3002"]}),"\n",(0,o.jsxs)(n.li,{children:["\u30a2\u30d7\u30ea\u5185\u6a5f\u80fd\u3084\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\uff08\u975e API \u6a29\u9650\uff09\u3092\u4fdd\u8b77\u3059\u308b\u5834\u5408\u3001\u3053\u306e\u30ac\u30a4\u30c9\u306f ",(0,o.jsx)(n.a,{href:"/authorization/organization-permissions",children:"\u7d44\u7e54 (Organization)\uff08\u975e API\uff09\u6a29\u9650\u306e\u4fdd\u8b77"})," \u30ac\u30a4\u30c9\u3092\u5b8c\u4e86\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u524d\u63d0\u3068\u3057\u3066\u3044\u307e\u3059\u3002"]}),"\n",(0,o.jsxs)(n.li,{children:["\u7d44\u7e54\u30ec\u30d9\u30eb\u306e API \u30ea\u30bd\u30fc\u30b9\u3092\u4fdd\u8b77\u3059\u308b\u5834\u5408\u3001\u3053\u306e\u30ac\u30a4\u30c9\u306f ",(0,o.jsx)(n.a,{href:"/authorization/organization-level-api-resources",children:"\u7d44\u7e54\u30ec\u30d9\u30eb\u306e API \u30ea\u30bd\u30fc\u30b9\u306e\u4fdd\u8b77"})," \u30ac\u30a4\u30c9\u3092\u5b8c\u4e86\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u524d\u63d0\u3068\u3057\u3066\u3044\u307e\u3059\u3002"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"step-1-initialize-constants-and-utilities",children:"\u30b9\u30c6\u30c3\u30d7 1: \u5b9a\u6570\u3068\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u306e\u521d\u671f\u5316"}),"\n",(0,o.jsx)(u.Ay,{}),"\n",(0,o.jsxs)(s.A,{groupId:"api-language",children:[(0,o.jsx)(i.A,{value:"node",label:"Node.js",children:(0,o.jsx)(N.Ay,{})}),(0,o.jsx)(i.A,{value:"python",label:"Python",children:(0,o.jsx)(ee.Ay,{})}),(0,o.jsx)(i.A,{value:"go",label:"Go",children:(0,o.jsx)(_.Ay,{})}),(0,o.jsx)(i.A,{value:"java",label:"Java",children:(0,o.jsx)(J.Ay,{})}),(0,o.jsx)(i.A,{value:"dotnet",label:".NET",children:(0,o.jsx)(d.Ay,{})}),(0,o.jsx)(i.A,{value:"php",label:"PHP",children:(0,o.jsx)(L.Ay,{})}),(0,o.jsx)(i.A,{value:"ruby",label:"Ruby",children:(0,o.jsx)(ce.Ay,{})}),(0,o.jsx)(i.A,{value:"rust",label:"Rust",children:(0,o.jsx)(xe.Ay,{})})]}),"\n",(0,o.jsx)(n.h2,{id:"step-2-retrieve-info-about-your-logto-tenant",children:"\u30b9\u30c6\u30c3\u30d7 2: Logto \u30c6\u30ca\u30f3\u30c8\u306e\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b"}),"\n",(0,o.jsx)(p.Ay,{}),"\n",(0,o.jsx)(n.h2,{id:"step-3-validate-the-token-and-permissions",children:"\u30b9\u30c6\u30c3\u30d7 3: \u30c8\u30fc\u30af\u30f3\u3068\u6a29\u9650\u3092\u691c\u8a3c\u3059\u308b"}),"\n",(0,o.jsx)(g.Ay,{}),"\n",(0,o.jsx)(n.h3,{id:"add-the-validation-logic",children:"\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\u3092\u8ffd\u52a0\u3059\u308b"}),"\n",(0,o.jsxs)(s.A,{groupId:"api-language",children:[(0,o.jsx)(i.A,{value:"node",label:"Node.js",children:(0,o.jsx)(P.Ay,{})}),(0,o.jsx)(i.A,{value:"python",label:"Python",children:(0,o.jsx)(B.Ay,{})}),(0,o.jsx)(i.A,{value:"go",label:"Go",children:(0,o.jsx)(m.Ay,{})}),(0,o.jsx)(i.A,{value:"java",label:"Java",children:(0,o.jsx)(k.Ay,{})}),(0,o.jsx)(i.A,{value:"dotnet",label:".NET",children:(0,o.jsx)(c.Ay,{})}),(0,o.jsx)(i.A,{value:"php",label:"PHP",children:(0,o.jsx)($.Ay,{})}),(0,o.jsx)(i.A,{value:"ruby",label:"Ruby",children:(0,o.jsx)(ne.Ay,{})}),(0,o.jsx)(i.A,{value:"rust",label:"Rust",children:(0,o.jsx)(le.Ay,{})})]}),"\n",(0,o.jsx)(n.h2,{id:"step-4-apply-middleware-to-your-api",children:"\u30b9\u30c6\u30c3\u30d7 4: API \u306b\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u9069\u7528\u3059\u308b"}),"\n",(0,o.jsx)(n.p,{children:"\u4fdd\u8b77\u3057\u305f\u3044 API \u30eb\u30fc\u30c8\u306b\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u9069\u7528\u3057\u307e\u3059\u3002"}),"\n",(0,o.jsxs)(s.A,{groupId:"api-language",children:[(0,o.jsx)(i.A,{value:"node",label:"Node.js",children:(0,o.jsx)(C,{})}),(0,o.jsx)(i.A,{value:"python",label:"Python",children:(0,o.jsx)(Z,{})}),(0,o.jsx)(i.A,{value:"go",label:"Go",children:(0,o.jsx)(v,{})}),(0,o.jsx)(i.A,{value:"java",label:"Java",children:(0,o.jsx)(T,{})}),(0,o.jsx)(i.A,{value:"dotnet",label:".NET",children:(0,o.jsx)(l.Ay,{})}),(0,o.jsx)(i.A,{value:"php",label:"PHP",children:(0,o.jsx)(D,{})}),(0,o.jsx)(i.A,{value:"ruby",label:"Ruby",children:(0,o.jsx)(se,{})}),(0,o.jsx)(i.A,{value:"rust",label:"Rust",children:(0,o.jsx)(me,{})})]}),"\n",(0,o.jsx)(n.h2,{id:"step-5-test-your-implementation",children:"\u30b9\u30c6\u30c3\u30d7 5: \u5b9f\u88c5\u3092\u30c6\u30b9\u30c8\u3059\u308b"}),"\n",(0,o.jsx)(h.Ay,{}),"\n",(0,o.jsx)(n.h2,{id:"related-resources",children:"\u95a2\u9023\u30ea\u30bd\u30fc\u30b9"}),"\n",(0,o.jsx)(t,{href:"/developers/custom-token-claims",children:"\u30c8\u30fc\u30af\u30f3 \u30af\u30ec\u30fc\u30e0\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba"}),"\n",(0,o.jsx)(t,{href:"https://auth.wiki/jwt",children:"JSON Web Token (JWT)"}),"\n",(0,o.jsx)(t,{href:"https://openid.net/specs/openid-connect-discovery-1_0.html",children:(0,o.jsx)(n.p,{children:"OpenID Connect Discovery"})}),"\n",(0,o.jsx)(t,{href:"https://www.rfc-editor.org/rfc/rfc8707.html",children:"RFC 8707: \u30ea\u30bd\u30fc\u30b9\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc"})]})}function ve(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(we,{...e})}):we(e)}},12953:(e,n,t)=>{t.d(n,{Ay:()=>l,RM:()=>s});var r=t(25105),o=t(79621),a=t(38552),i=t(22002);const s=[];function c(e){const n={code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"JWT \u8a8d\u8a3c (Authentication) \u306b\u5fc5\u8981\u306a NuGet \u30d1\u30c3\u30b1\u30fc\u30b8\u3092\u8ffd\u52a0\u3057\u307e\u3059\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:'<PackageReference Include="Microsoft.AspNetCore.Authentication.JwtBearer" Version="8.0.0" />\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u30c8\u30fc\u30af\u30f3\u691c\u8a3c\u3092\u51e6\u7406\u3059\u308b\u305f\u3081\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",metastring:'title="JwtValidationService.cs"',children:'using System.Security.Claims;\nusing Microsoft.AspNetCore.Authentication.JwtBearer;\nusing YourApiNamespace.Exceptions;\n\nnamespace YourApiNamespace.Services\n{\n    public interface IJwtValidationService\n    {\n        Task ValidateTokenAsync(TokenValidatedContext context);\n    }\n\n    public class JwtValidationService : IJwtValidationService\n    {\n        public async Task ValidateTokenAsync(TokenValidatedContext context)\n        {\n            var principal = context.Principal!;\n\n            try\n            {\n                // \u6a29\u9650 (Permission) \u30e2\u30c7\u30eb\u306b\u57fa\u3065\u304f\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30ed\u30b8\u30c3\u30af\u3092\u3053\u3053\u306b\u8ffd\u52a0\n                ValidatePayload(principal);\n            }\n            catch (AuthorizationException)\n            {\n                throw; // \u8a8d\u53ef (Authorization) \u4f8b\u5916\u3092\u518d\u30b9\u30ed\u30fc\n            }\n            catch (Exception ex)\n            {\n                throw new AuthorizationException($"Token validation failed: {ex.Message}", 401);\n            }\n        }\n\n        private void ValidatePayload(ClaimsPrincipal principal)\n        {\n            // \u6a29\u9650 (Permission) \u30e2\u30c7\u30eb\u306b\u57fa\u3065\u304f\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\u3092\u3053\u3053\u306b\u5b9f\u88c5\n            // \u3053\u306e\u5185\u5bb9\u306f\u4e0b\u8a18\u306e\u6a29\u9650 (Permission) \u30e2\u30c7\u30eb\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u793a\u3057\u307e\u3059\n        }\n    }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"Program.cs"})," \u3067 JWT \u8a8d\u8a3c (Authentication) \u3092\u8a2d\u5b9a\u3057\u307e\u3059\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",metastring:'title="Program.cs"',children:'using Microsoft.AspNetCore.Authentication.JwtBearer;\nusing Microsoft.IdentityModel.Tokens;\nusing YourApiNamespace.Services;\nusing YourApiNamespace.Exceptions;\n\nvar builder = WebApplication.CreateBuilder(args);\n\n// \u30b5\u30fc\u30d3\u30b9\u3092\u30b3\u30f3\u30c6\u30ca\u306b\u8ffd\u52a0\nbuilder.Services.AddControllers();\nbuilder.Services.AddScoped<IJwtValidationService, JwtValidationService>();\n\n// JWT \u8a8d\u8a3c (Authentication) \u3092\u8a2d\u5b9a\nbuilder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)\n    .AddJwtBearer(options =>\n    {\n        options.Authority = AuthConstants.Issuer;\n        options.MetadataAddress = $"{AuthConstants.Issuer}/.well-known/openid-configuration";\n        options.RequireHttpsMetadata = true;\n        options.TokenValidationParameters = new TokenValidationParameters\n        {\n            ValidateIssuer = true,\n            ValidIssuer = AuthConstants.Issuer,\n            ValidateAudience = false, // \u6a29\u9650 (Permission) \u30e2\u30c7\u30eb\u306b\u57fa\u3065\u304d\u624b\u52d5\u3067\u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9\u3092\u691c\u8a3c\n            ValidateLifetime = true,\n            ValidateIssuerSigningKey = true,\n            ClockSkew = TimeSpan.FromMinutes(5)\n        };\n\n        options.Events = new JwtBearerEvents\n        {\n            OnTokenValidated = async context =>\n            {\n                var validationService = context.HttpContext.RequestServices\n                    .GetRequiredService<IJwtValidationService>();\n\n                await validationService.ValidateTokenAsync(context);\n            },\n            OnAuthenticationFailed = context =>\n            {\n                // JWT \u30e9\u30a4\u30d6\u30e9\u30ea\u30a8\u30e9\u30fc\u3092 401 \u3068\u3057\u3066\u51e6\u7406\n                context.Response.StatusCode = 401;\n                context.Response.ContentType = "application/json";\n                context.Response.WriteAsync($"{{\\"error\\": \\"Invalid token\\"}}");\n                context.HandleResponse();\n                return Task.CompletedTask;\n            }\n        };\n    });\n\nbuilder.Services.AddAuthorization();\n\nvar app = builder.Build();\n\n// \u8a8d\u8a3c (Authentication) / \u8a8d\u53ef (Authorization) \u5931\u6557\u6642\u306e\u30b0\u30ed\u30fc\u30d0\u30eb\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\napp.Use(async (context, next) =>\n{\n    try\n    {\n        await next();\n    }\n    catch (AuthorizationException ex)\n    {\n        context.Response.StatusCode = ex.StatusCode;\n        context.Response.ContentType = "application/json";\n        await context.Response.WriteAsync($"{{\\"error\\": \\"{ex.Message}\\"}}");\n    }\n});\n\n// HTTP \u30ea\u30af\u30a8\u30b9\u30c8\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u8a2d\u5b9a\napp.UseAuthentication();\napp.UseAuthorization();\n\napp.MapControllers();\n\napp.Run();\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u6a29\u9650 (Permission) \u30e2\u30c7\u30eb\u306b\u5fdc\u3058\u3066\u3001",(0,r.jsx)(n.code,{children:"JwtValidationService"})," \u3067\u9069\u5207\u306a\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30ed\u30b8\u30c3\u30af\u3092\u5b9f\u88c5\u3057\u307e\u3059\uff1a"]}),"\n",(0,r.jsxs)(i.A,{groupId:"permission-models",children:[(0,r.jsx)(a.A,{value:"global-api-resources",label:"\u30b0\u30ed\u30fc\u30d0\u30eb API \u30ea\u30bd\u30fc\u30b9",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",metastring:'title="JwtValidationService.cs"',children:'private void ValidatePayload(ClaimsPrincipal principal)\n{\n    // \u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9 (Audience) \u30af\u30ec\u30fc\u30e0\u304c API \u30ea\u30bd\u30fc\u30b9\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n    var audiences = principal.FindAll("aud").Select(c => c.Value).ToList();\n    if (!audiences.Contains("https://your-api-resource-indicator"))\n    {\n        throw new AuthorizationException("Invalid audience");\n    }\n\n    // \u30b0\u30ed\u30fc\u30d0\u30eb API \u30ea\u30bd\u30fc\u30b9\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7 (Scope) \u3092\u78ba\u8a8d\n    var requiredScopes = new[] { "api:read", "api:write" }; // \u5b9f\u969b\u306e\u5fc5\u8981\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n    var tokenScopes = principal.FindFirst("scope")?.Value?.Split(\' \') ?? Array.Empty<string>();\n\n    if (!requiredScopes.All(scope => tokenScopes.Contains(scope)))\n    {\n        throw new AuthorizationException("Insufficient scope");\n    }\n}\n'})})}),(0,r.jsx)(a.A,{value:"organization-permissions",label:"\u7d44\u7e54 (\u975e API) \u6a29\u9650 (Permission)",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",metastring:'title="JwtValidationService.cs"',children:'private void ValidatePayload(ClaimsPrincipal principal)\n{\n    // \u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9 (Audience) \u30af\u30ec\u30fc\u30e0\u304c\u7d44\u7e54\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n    var audiences = principal.FindAll("aud").Select(c => c.Value).ToList();\n    var hasOrgAudience = audiences.Any(aud => aud.StartsWith("urn:logto:organization:"));\n\n    if (!hasOrgAudience)\n    {\n        throw new AuthorizationException("Invalid audience for organization permissions");\n    }\n\n    // \u7d44\u7e54 ID \u304c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\u304c\u5fc5\u8981\u306a\u5834\u5408\u3042\u308a\uff09\n    var expectedOrgId = "your-organization-id"; // \u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\n    var expectedAud = $"urn:logto:organization:{expectedOrgId}";\n    if (!audiences.Contains(expectedAud))\n    {\n        throw new AuthorizationException("Organization ID mismatch");\n    }\n\n    // \u5fc5\u8981\u306a\u7d44\u7e54\u30b9\u30b3\u30fc\u30d7 (Scope) \u3092\u78ba\u8a8d\n    var requiredScopes = new[] { "invite:users", "manage:settings" }; // \u5b9f\u969b\u306e\u5fc5\u8981\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n    var tokenScopes = principal.FindFirst("scope")?.Value?.Split(\' \') ?? Array.Empty<string>();\n\n    if (!requiredScopes.All(scope => tokenScopes.Contains(scope)))\n    {\n        throw new AuthorizationException("Insufficient organization scope");\n    }\n}\n'})})}),(0,r.jsx)(a.A,{value:"organization-level-api-resources",label:"\u7d44\u7e54\u30ec\u30d9\u30eb API \u30ea\u30bd\u30fc\u30b9",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",metastring:'title="JwtValidationService.cs"',children:'private void ValidatePayload(ClaimsPrincipal principal)\n{\n    // \u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9 (Audience) \u30af\u30ec\u30fc\u30e0\u304c API \u30ea\u30bd\u30fc\u30b9\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n    var audiences = principal.FindAll("aud").Select(c => c.Value).ToList();\n    if (!audiences.Contains("https://your-api-resource-indicator"))\n    {\n        throw new AuthorizationException("Invalid audience for organization-level API resources");\n    }\n\n    // \u7d44\u7e54 ID \u304c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\u304c\u5fc5\u8981\u306a\u5834\u5408\u3042\u308a\uff09\n    var expectedOrgId = "your-organization-id"; // \u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\n    var orgId = principal.FindFirst("organization_id")?.Value;\n    if (!expectedOrgId.Equals(orgId))\n    {\n        throw new AuthorizationException("Organization ID mismatch");\n    }\n\n    // \u7d44\u7e54\u30ec\u30d9\u30eb API \u30ea\u30bd\u30fc\u30b9\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7 (Scope) \u3092\u78ba\u8a8d\n    var requiredScopes = new[] { "api:read", "api:write" }; // \u5b9f\u969b\u306e\u5fc5\u8981\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n    var tokenScopes = principal.FindFirst("scope")?.Value?.Split(\' \') ?? Array.Empty<string>();\n\n    if (!requiredScopes.All(scope => tokenScopes.Contains(scope)))\n    {\n        throw new AuthorizationException("Insufficient organization-level API scopes");\n    }\n}\n'})})})]})]})}function l(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},22698:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"\u524d\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u3059\u3067\u306b\u8a8d\u8a3c (Authentication) \u304a\u3088\u3073\u8a8d\u53ef (Authorization) \u306e\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u8a2d\u5b9a\u3057\u307e\u3057\u305f\u3002\u3053\u308c\u3067\u3001\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3\u3092\u691c\u8a3c\u3057\u3001\u8a8d\u8a3c\u6e08\u307f\u30ea\u30af\u30a8\u30b9\u30c8\u304b\u3089\u30af\u30ec\u30fc\u30e0 (Claims) \u3092\u62bd\u51fa\u3059\u308b\u4fdd\u8b77\u3055\u308c\u305f\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u3092\u4f5c\u6210\u3067\u304d\u307e\u3059\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",metastring:'title="ProtectedController.cs"',children:'using Microsoft.AspNetCore.Authorization;\nusing Microsoft.AspNetCore.Mvc;\nusing System.Security.Claims;\n\nnamespace YourApiNamespace.Controllers\n{\n    [ApiController]\n    [Route("api/[controller]")]\n    [Authorize] // \u3053\u306e\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u5185\u306e\u3059\u3079\u3066\u306e\u30a2\u30af\u30b7\u30e7\u30f3\u306b\u8a8d\u8a3c (Authentication) \u3092\u8981\u6c42\n    public class ProtectedController : ControllerBase\n    {\n        [HttpGet]\n        public IActionResult GetProtectedData()\n        {\n            // \u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3\u60c5\u5831\u3092 User \u30af\u30ec\u30fc\u30e0 (Claims) \u304b\u3089\u76f4\u63a5\u53d6\u5f97\n            var sub = User.FindFirst(ClaimTypes.NameIdentifier)?.Value ?? User.FindFirst("sub")?.Value;\n            var clientId = User.FindFirst("client_id")?.Value;\n            var organizationId = User.FindFirst("organization_id")?.Value;\n            var scopes = User.FindFirst("scope")?.Value?.Split(\' \') ?? Array.Empty<string>();\n            var audience = User.FindAll("aud").Select(c => c.Value).ToArray();\n\n            return Ok(new {\n                sub,\n                client_id = clientId,\n                organization_id = organizationId,\n                scopes,\n                audience\n            });\n        }\n\n        [HttpGet("claims")]\n        public IActionResult GetAllClaims()\n        {\n            // \u30c7\u30d0\u30c3\u30b0\u3084\u78ba\u8a8d\u7528\u306b\u3059\u3079\u3066\u306e\u30af\u30ec\u30fc\u30e0 (Claims) \u3092\u8fd4\u3059\n            var claims = User.Claims.Select(c => new { c.Type, c.Value }).ToList();\n            return Ok(new { claims });\n        }\n    }\n}\n'})})]})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},79057:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",metastring:'title="AuthConstants.cs"',children:'namespace YourApiNamespace\n{\n    public static class AuthConstants\n    {\n        public const string Issuer = "https://your-tenant.logto.app/oidc";\n    }\n}\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-csharp",metastring:'title="AuthenticationExceptions.cs"',children:"namespace YourApiNamespace.Exceptions\n{\n    public class AuthorizationException : Exception\n    {\n        public int StatusCode { get; }\n\n        public AuthorizationException(string message, int statusCode = 403) : base(message)\n        {\n            StatusCode = statusCode;\n        }\n    }\n}\n"})})]})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},91529:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",p:"p",...(0,o.R)(),...e.components};return(0,r.jsxs)(n.p,{children:["\u30c8\u30fc\u30af\u30f3\u306e\u62bd\u51fa\u3068\u691c\u8a3c\u3092\u51e6\u7406\u3059\u308b\u305f\u3081\u306b\u3001\u30b3\u30fc\u30c9\u5185\u3067\u5fc5\u8981\u306a\u5b9a\u6570\u3084\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u3092\u5b9a\u7fa9\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u6709\u52b9\u306a\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u306f\u3001",(0,r.jsx)(n.code,{children:"Authorization"})," \u30d8\u30c3\u30c0\u30fc\u304c ",(0,r.jsx)(n.code,{children:"Bearer <\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3 (Access token)>"})," \u306e\u5f62\u5f0f\u3067\u542b\u307e\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002"]})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},1938:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[{value:"OpenID Connect \u30c7\u30a3\u30b9\u30ab\u30d0\u30ea\u30fc\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u304b\u3089\u53d6\u5f97\u3059\u308b",id:"fetch-from-openid-connect-discovery-endpoint",level:3},{value:"\u30b3\u30fc\u30c9\u5185\u306b\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3059\u308b\uff08\u63a8\u5968\u3055\u308c\u307e\u305b\u3093\uff09",id:"hardcode-in-your-code-not-recommended",level:3}];function i(e){const n={code:"code",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Logto \u304c\u767a\u884c\u3057\u305f\u30c8\u30fc\u30af\u30f3\u3092\u691c\u8a3c\u3059\u308b\u306b\u306f\u3001\u6b21\u306e\u5024\u304c\u5fc5\u8981\u3067\u3059\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"JSON Web Key Set (JWKS) URI\uff1aJWT \u7f72\u540d\u3092\u691c\u8a3c\u3059\u308b\u305f\u3081\u306b\u4f7f\u7528\u3055\u308c\u308b Logto \u306e\u516c\u958b\u9375\u306e URL\u3002"}),"\n",(0,r.jsx)(n.li,{children:"\u767a\u884c\u8005 (Issuer)\uff1a\u671f\u5f85\u3055\u308c\u308b\u767a\u884c\u8005\u5024\uff08Logto \u306e OIDC URL\uff09\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u307e\u305a\u3001Logto \u30c6\u30ca\u30f3\u30c8\u306e\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u3092\u898b\u3064\u3051\u307e\u3059\u3002\u3053\u308c\u306f\u3055\u307e\u3056\u307e\u306a\u5834\u6240\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Logto \u30b3\u30f3\u30bd\u30fc\u30eb\u306e ",(0,r.jsx)(n.strong,{children:"\u8a2d\u5b9a"})," \u2192 ",(0,r.jsx)(n.strong,{children:"\u30c9\u30e1\u30a4\u30f3"})," \u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["Logto \u3067\u8a2d\u5b9a\u3057\u305f\u4efb\u610f\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u8a2d\u5b9a\u5185\u306e ",(0,r.jsx)(n.strong,{children:"\u8a2d\u5b9a"})," \u2192 ",(0,r.jsx)(n.strong,{children:"\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8 & \u8cc7\u683c\u60c5\u5831"})," \u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"fetch-from-openid-connect-discovery-endpoint",children:"OpenID Connect \u30c7\u30a3\u30b9\u30ab\u30d0\u30ea\u30fc\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u304b\u3089\u53d6\u5f97\u3059\u308b"}),"\n",(0,r.jsx)(n.p,{children:"\u3053\u308c\u3089\u306e\u5024\u306f\u3001Logto \u306e OpenID Connect \u30c7\u30a3\u30b9\u30ab\u30d0\u30ea\u30fc\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u304b\u3089\u53d6\u5f97\u3067\u304d\u307e\u3059\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"https://<your-logto-endpoint>/oidc/.well-known/openid-configuration\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u4ee5\u4e0b\u306f\u30ec\u30b9\u30dd\u30f3\u30b9\u4f8b\u3067\u3059\uff08\u4ed6\u306e\u30d5\u30a3\u30fc\u30eb\u30c9\u306f\u7701\u7565\u3057\u3066\u3044\u307e\u3059\uff09\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "jwks_uri": "https://your-tenant.logto.app/oidc/jwks",\n  "issuer": "https://your-tenant.logto.app/oidc"\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"hardcode-in-your-code-not-recommended",children:"\u30b3\u30fc\u30c9\u5185\u306b\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3059\u308b\uff08\u63a8\u5968\u3055\u308c\u307e\u305b\u3093\uff09"}),"\n",(0,r.jsx)(n.p,{children:"Logto \u3067\u306f JWKS URI \u3084\u767a\u884c\u8005 (Issuer) \u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u304c\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u3053\u308c\u3089\u306e\u5024\u3092\u30b3\u30fc\u30c9\u5185\u306b\u30cf\u30fc\u30c9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002\u305f\u3060\u3057\u3001\u5c06\u6765\u7684\u306b\u8a2d\u5b9a\u304c\u5909\u66f4\u3055\u308c\u305f\u5834\u5408\u306e\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u8ca0\u8377\u304c\u5897\u52a0\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u305f\u3081\u3001\u672c\u756a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u306f\u63a8\u5968\u3055\u308c\u307e\u305b\u3093\u3002"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["JWKS URI\uff1a",(0,r.jsx)(n.code,{children:"https://<your-logto-endpoint>/oidc/jwks"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u767a\u884c\u8005 (Issuer)\uff1a",(0,r.jsx)(n.code,{children:"https://<your-logto-endpoint>/oidc"})]}),"\n"]})]})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},87289:(e,n,t)=>{t.d(n,{Ay:()=>l,RM:()=>s});var r=t(25105),o=t(79621),a=t(38552),i=t(22002);const s=[{value:"\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3 (Access tokens) \u306e\u53d6\u5f97",id:"get-access-tokens",level:3},{value:"\u4fdd\u8b77\u3055\u308c\u305f\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u30c6\u30b9\u30c8",id:"test-protected-endpoints",level:3},{value:"\u6a29\u9650\u30e2\u30c7\u30eb\u3054\u3068\u306e\u30c6\u30b9\u30c8",id:"permission-model-specific-testing",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h3,{id:"get-access-tokens",children:"\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3 (Access tokens) \u306e\u53d6\u5f97"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u304b\u3089:"}),"\n\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u7d71\u5408\u3092\u8a2d\u5b9a\u3057\u3066\u3044\u308b\u5834\u5408\u3001\u30a2\u30d7\u30ea\u306f\u81ea\u52d5\u7684\u306b\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3 (Access token) \u3092\u62bd\u51fa\u3057\u3001API \u30ea\u30af\u30a8\u30b9\u30c8\u3067\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"curl / Postman \u3067\u306e\u30c6\u30b9\u30c8\u7528:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u30e6\u30fc\u30b6\u30fc\u30c8\u30fc\u30af\u30f3:"})," \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30a2\u30d7\u30ea\u306e\u958b\u767a\u8005\u30c4\u30fc\u30eb\u3092\u4f7f\u3044\u3001localStorage \u307e\u305f\u306f\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u30bf\u30d6\u304b\u3089\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3 (Access token) \u3092\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u30de\u30b7\u30f3\u9593\u901a\u4fe1\u30c8\u30fc\u30af\u30f3:"})," \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30af\u30ec\u30c7\u30f3\u30b7\u30e3\u30eb\u30d5\u30ed\u30fc\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u4ee5\u4e0b\u306f curl \u3092\u4f7f\u3063\u305f\u975e\u516c\u5f0f\u306a\u4f8b\u3067\u3059\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X POST https://your-tenant.logto.app/oidc/token \\\n  -H "Content-Type: application/x-www-form-urlencoded" \\\n  -d "grant_type=client_credentials" \\\n  -d "client_id=your-m2m-client-id" \\\n  -d "client_secret=your-m2m-client-secret" \\\n  -d "resource=https://your-api-resource-indicator" \\\n  -d "scope=api:read api:write"\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"resource"})," \u3084 ",(0,r.jsx)(n.code,{children:"scope"})," \u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306f API \u30ea\u30bd\u30fc\u30b9\u3084\u6a29\u9650\u306b\u5fdc\u3058\u3066\u8abf\u6574\u304c\u5fc5\u8981\u3067\u3059\u3002API \u304c\u7d44\u7e54\u30b9\u30b3\u30fc\u30d7\u306e\u5834\u5408\u306f ",(0,r.jsx)(n.code,{children:"organization_id"})," \u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3082\u5fc5\u8981\u306b\u306a\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["\u30c8\u30fc\u30af\u30f3\u306e\u5185\u5bb9\u3092\u78ba\u8a8d\u3057\u305f\u3044\u5834\u5408\u306f\u3001 ",(0,r.jsx)(n.a,{href:"https://logto.io/jwt-decoder",children:"JWT \u30c7\u30b3\u30fc\u30c0\u30fc"})," \u3092\u4f7f\u3063\u3066 JWT \u3092\u30c7\u30b3\u30fc\u30c9\u30fb\u691c\u8a3c\u3067\u304d\u307e\u3059\u3002"]})}),"\n",(0,r.jsx)(n.h3,{id:"test-protected-endpoints",children:"\u4fdd\u8b77\u3055\u308c\u305f\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u30c6\u30b9\u30c8"}),"\n",(0,r.jsxs)(t,{children:[(0,r.jsx)("summary",{children:(0,r.jsx)(n.strong,{children:"\u6709\u52b9\u306a\u30c8\u30fc\u30af\u30f3\u30ea\u30af\u30a8\u30b9\u30c8"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -H "Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..." \\\n  http://localhost:3000/api/protected\n'})}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u671f\u5f85\u3055\u308c\u308b\u30ec\u30b9\u30dd\u30f3\u30b9:"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "auth": {\n    "sub": "user123",\n    "clientId": "app456",\n    "organizationId": "org789",\n    "scopes": ["api:read", "api:write"],\n    "audience": ["https://your-api-resource-indicator"]\n  }\n}\n'})})]}),"\n",(0,r.jsxs)(t,{children:[(0,r.jsx)("summary",{children:(0,r.jsx)(n.strong,{children:"\u30c8\u30fc\u30af\u30f3\u306a\u3057"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:3000/api/protected\n"})}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u671f\u5f85\u3055\u308c\u308b\u30ec\u30b9\u30dd\u30f3\u30b9 (401):"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "error": "Authorization header is missing"\n}\n'})})]}),"\n",(0,r.jsxs)(t,{children:[(0,r.jsx)("summary",{children:(0,r.jsx)(n.strong,{children:"\u7121\u52b9\u306a\u30c8\u30fc\u30af\u30f3"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -H "Authorization: Bearer invalid-token" \\\n  http://localhost:3000/api/protected\n'})}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u671f\u5f85\u3055\u308c\u308b\u30ec\u30b9\u30dd\u30f3\u30b9 (401):"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "error": "Invalid token"\n}\n'})})]}),"\n",(0,r.jsx)(n.h3,{id:"permission-model-specific-testing",children:"\u6a29\u9650\u30e2\u30c7\u30eb\u3054\u3068\u306e\u30c6\u30b9\u30c8"}),"\n",(0,r.jsxs)(i.A,{groupId:"permission-models",children:[(0,r.jsxs)(a.A,{value:"global-api-resources",label:"\u30b0\u30ed\u30fc\u30d0\u30eb API \u30ea\u30bd\u30fc\u30b9",children:[(0,r.jsx)(n.p,{children:"\u30b0\u30ed\u30fc\u30d0\u30eb\u30b9\u30b3\u30fc\u30d7\u3067\u4fdd\u8b77\u3055\u308c\u305f API \u306e\u30c6\u30b9\u30c8\u30b7\u30ca\u30ea\u30aa\uff1a"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6709\u52b9\u306a\u30b9\u30b3\u30fc\u30d7:"})," \u5fc5\u8981\u306a API \u30b9\u30b3\u30fc\u30d7\uff08\u4f8b: ",(0,r.jsx)(n.code,{children:"api:read"}),", ",(0,r.jsx)(n.code,{children:"api:write"}),"\uff09\u3092\u542b\u3080\u30c8\u30fc\u30af\u30f3\u3067\u30c6\u30b9\u30c8"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u30b9\u30b3\u30fc\u30d7\u4e0d\u8db3:"})," \u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u304c\u306a\u3044\u5834\u5408\u306f ",(0,r.jsx)(n.strong,{children:"403 Forbidden"})," \u3092\u671f\u5f85"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8aa4\u3063\u305f\u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9:"})," \u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9\u304c API \u30ea\u30bd\u30fc\u30b9\u3068\u4e00\u81f4\u3057\u306a\u3044\u5834\u5408\u306f ",(0,r.jsx)(n.strong,{children:"403 Forbidden"})," \u3092\u671f\u5f85"]}),"\n"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# \u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u304c\u306a\u3044\u30c8\u30fc\u30af\u30f3 - 403 \u3092\u671f\u5f85\ncurl -H "Authorization: Bearer token-without-required-scopes" \\\n  http://localhost:3000/api/protected\n'})})]}),(0,r.jsxs)(a.A,{value:"organization-permissions",label:"\u7d44\u7e54 (\u975e API) \u6a29\u9650",children:[(0,r.jsx)(n.p,{children:"\u7d44\u7e54\u56fa\u6709\u306e\u30a2\u30af\u30bb\u30b9\u5236\u5fa1\u306e\u30c6\u30b9\u30c8\u30b7\u30ca\u30ea\u30aa\uff1a"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6709\u52b9\u306a\u7d44\u7e54\u30c8\u30fc\u30af\u30f3:"})," \u6b63\u3057\u3044\u7d44\u7e54\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\uff08\u7d44\u7e54 ID \u3068\u30b9\u30b3\u30fc\u30d7\uff09\u3092\u542b\u3080\u30c8\u30fc\u30af\u30f3\u3067\u30c6\u30b9\u30c8"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u30b9\u30b3\u30fc\u30d7\u4e0d\u8db3:"})," \u30e6\u30fc\u30b6\u30fc\u304c\u8981\u6c42\u3055\u308c\u305f\u64cd\u4f5c\u306e\u6a29\u9650\u3092\u6301\u305f\u306a\u3044\u5834\u5408\u306f ",(0,r.jsx)(n.strong,{children:"403 Forbidden"})," \u3092\u671f\u5f85"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8aa4\u3063\u305f\u7d44\u7e54:"})," \u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9\u304c\u7d44\u7e54\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\uff08",(0,r.jsx)(n.code,{children:"urn:logto:organization:<organization_id>"}),"\uff09\u3068\u4e00\u81f4\u3057\u306a\u3044\u5834\u5408\u306f ",(0,r.jsx)(n.strong,{children:"403 Forbidden"})," \u3092\u671f\u5f85"]}),"\n"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# \u5225\u306e\u7d44\u7e54\u7528\u30c8\u30fc\u30af\u30f3 - 403 \u3092\u671f\u5f85\ncurl -H "Authorization: Bearer token-for-different-organization" \\\n  http://localhost:3000/api/protected\n'})})]}),(0,r.jsxs)(a.A,{value:"organization-level-api-resources",label:"\u7d44\u7e54\u30ec\u30d9\u30eb API \u30ea\u30bd\u30fc\u30b9",children:[(0,r.jsx)(n.p,{children:"API \u30ea\u30bd\u30fc\u30b9\u691c\u8a3c\u3068\u7d44\u7e54\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u7d44\u307f\u5408\u308f\u305b\u305f\u30c6\u30b9\u30c8\u30b7\u30ca\u30ea\u30aa\uff1a"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6709\u52b9\u306a\u7d44\u7e54 + API \u30b9\u30b3\u30fc\u30d7:"})," \u7d44\u7e54\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u5fc5\u8981\u306a API \u30b9\u30b3\u30fc\u30d7\u306e\u4e21\u65b9\u3092\u6301\u3064\u30c8\u30fc\u30af\u30f3\u3067\u30c6\u30b9\u30c8"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"API \u30b9\u30b3\u30fc\u30d7\u4e0d\u8db3:"})," \u7d44\u7e54\u30c8\u30fc\u30af\u30f3\u306b\u5fc5\u8981\u306a API \u6a29\u9650\u304c\u306a\u3044\u5834\u5408\u306f ",(0,r.jsx)(n.strong,{children:"403 Forbidden"})," \u3092\u671f\u5f85"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8aa4\u3063\u305f\u7d44\u7e54:"})," \u5225\u306e\u7d44\u7e54\u306e\u30c8\u30fc\u30af\u30f3\u3067 API \u306b\u30a2\u30af\u30bb\u30b9\u3057\u305f\u5834\u5408\u306f ",(0,r.jsx)(n.strong,{children:"403 Forbidden"})," \u3092\u671f\u5f85"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8aa4\u3063\u305f\u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9:"})," \u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9\u304c\u7d44\u7e54\u30ec\u30d9\u30eb\u306e API \u30ea\u30bd\u30fc\u30b9\u3068\u4e00\u81f4\u3057\u306a\u3044\u5834\u5408\u306f ",(0,r.jsx)(n.strong,{children:"403 Forbidden"})," \u3092\u671f\u5f85"]}),"\n"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# API \u30b9\u30b3\u30fc\u30d7\u304c\u306a\u3044\u7d44\u7e54\u30c8\u30fc\u30af\u30f3 - 403 \u3092\u671f\u5f85\ncurl -H "Authorization: Bearer organization-token-without-api-scopes" \\\n  http://localhost:3000/api/protected\n'})})]})]})]})}function l(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},60283:(e,n,t)=>{t.d(n,{Ay:()=>l,RM:()=>s});var r=t(25105),o=t(79621),a=t(38552),i=t(22002);const s=[{value:"\u5404\u6a29\u9650\u30e2\u30c7\u30eb\u3067\u78ba\u8a8d\u3059\u3079\u304d\u3053\u3068",id:"what-to-check-for-each-permission-model",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h3:"h3",li:"li",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"\u30c8\u30fc\u30af\u30f3\u3092\u62bd\u51fa\u3057 OIDC \u8a2d\u5b9a\u3092\u53d6\u5f97\u3057\u305f\u5f8c\u3001\u6b21\u306e\u70b9\u3092\u691c\u8a3c\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u7f72\u540d"}),"\uff1aJWT \u306f\u6709\u52b9\u3067\u3042\u308a\u3001Logto\uff08JWKS \u7d4c\u7531\uff09\u306b\u3088\u3063\u3066\u7f72\u540d\u3055\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u767a\u884c\u8005 (Issuer)"}),"\uff1aLogto \u30c6\u30ca\u30f3\u30c8\u306e\u767a\u884c\u8005 (Issuer) \u3068\u4e00\u81f4\u3057\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9 (Audience)"}),"\uff1aLogto \u306b\u767b\u9332\u3055\u308c\u305f API \u306e\u30ea\u30bd\u30fc\u30b9\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u3001\u307e\u305f\u306f\u8a72\u5f53\u3059\u308b\u5834\u5408\u306f\u7d44\u7e54\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u4e00\u81f4\u3057\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6709\u52b9\u671f\u9650"}),"\uff1a\u30c8\u30fc\u30af\u30f3\u304c\u6709\u52b9\u671f\u9650\u5207\u308c\u3067\u306a\u3044\u3053\u3068\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6a29\u9650 (\u30b9\u30b3\u30fc\u30d7) (Permissions (scopes))"}),"\uff1a\u30c8\u30fc\u30af\u30f3\u306b API / \u30a2\u30af\u30b7\u30e7\u30f3\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30b9\u30b3\u30fc\u30d7\u306f ",(0,r.jsx)(n.code,{children:"scope"})," \u30af\u30ec\u30fc\u30e0\u5185\u306e\u30b9\u30da\u30fc\u30b9\u533a\u5207\u308a\u6587\u5b57\u5217\u3067\u3059\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u7d44\u7e54\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8"}),"\uff1a\u7d44\u7e54\u30ec\u30d9\u30eb\u306e API \u30ea\u30bd\u30fc\u30b9\u3092\u4fdd\u8b77\u3059\u308b\u5834\u5408\u3001",(0,r.jsx)(n.code,{children:"organization_id"})," \u30af\u30ec\u30fc\u30e0\u3092\u691c\u8a3c\u3057\u3066\u304f\u3060\u3055\u3044\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["JWT \u306e\u69cb\u9020\u3084\u30af\u30ec\u30fc\u30e0\u306b\u3064\u3044\u3066\u8a73\u3057\u304f\u306f ",(0,r.jsx)(n.a,{href:"https://auth.wiki/jwt",children:"JSON Web Token"})," \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"what-to-check-for-each-permission-model",children:"\u5404\u6a29\u9650\u30e2\u30c7\u30eb\u3067\u78ba\u8a8d\u3059\u3079\u304d\u3053\u3068"}),"\n",(0,r.jsx)(n.p,{children:"\u30af\u30ec\u30fc\u30e0\u3084\u691c\u8a3c\u30eb\u30fc\u30eb\u306f\u6a29\u9650\u30e2\u30c7\u30eb\u306b\u3088\u3063\u3066\u7570\u306a\u308a\u307e\u3059\uff1a"}),"\n",(0,r.jsxs)(i.A,{groupId:"permission-models",children:[(0,r.jsx)(a.A,{value:"global-api-resources",label:"\u30b0\u30ed\u30fc\u30d0\u30eb API \u30ea\u30bd\u30fc\u30b9",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["\u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9\u30af\u30ec\u30fc\u30e0 (",(0,r.jsx)(n.code,{children:"aud"}),"):"]})," API \u30ea\u30bd\u30fc\u30b9\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["\u7d44\u7e54\u30af\u30ec\u30fc\u30e0 (",(0,r.jsx)(n.code,{children:"organization_id"}),"):"]})," ",(0,r.jsx)(n.em,{children:"\u306a\u3057"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["\u30c1\u30a7\u30c3\u30af\u3059\u308b\u30b9\u30b3\u30fc\u30d7\uff08\u6a29\u9650\uff09 (",(0,r.jsx)(n.code,{children:"scope"}),"):"]})," API \u30ea\u30bd\u30fc\u30b9\u6a29\u9650"]}),"\n"]})}),(0,r.jsx)(a.A,{value:"organization-permissions",label:"\u7d44\u7e54\uff08\u975e API\uff09\u6a29\u9650",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["\u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9\u30af\u30ec\u30fc\u30e0 (",(0,r.jsx)(n.code,{children:"aud"}),"):"]})," ",(0,r.jsx)(n.code,{children:"urn:logto:organization:<id>"}),"\uff08\u7d44\u7e54\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304c ",(0,r.jsx)(n.code,{children:"aud"})," \u30af\u30ec\u30fc\u30e0\u306b\u542b\u307e\u308c\u308b\uff09"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["\u7d44\u7e54\u30af\u30ec\u30fc\u30e0 (",(0,r.jsx)(n.code,{children:"organization_id"}),"):"]})," ",(0,r.jsx)(n.em,{children:"\u306a\u3057"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["\u30c1\u30a7\u30c3\u30af\u3059\u308b\u30b9\u30b3\u30fc\u30d7\uff08\u6a29\u9650\uff09 (",(0,r.jsx)(n.code,{children:"scope"}),"):"]})," \u7d44\u7e54\u6a29\u9650"]}),"\n"]})}),(0,r.jsx)(a.A,{value:"organization-level-api-resources",label:"\u7d44\u7e54\u30ec\u30d9\u30eb API \u30ea\u30bd\u30fc\u30b9",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["\u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9\u30af\u30ec\u30fc\u30e0 (",(0,r.jsx)(n.code,{children:"aud"}),"):"]})," API \u30ea\u30bd\u30fc\u30b9\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["\u7d44\u7e54\u30af\u30ec\u30fc\u30e0 (",(0,r.jsx)(n.code,{children:"organization_id"}),"):"]})," \u7d44\u7e54 ID\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u3068\u4e00\u81f4\u3059\u308b\u5fc5\u8981\u3042\u308a\uff09"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["\u30c1\u30a7\u30c3\u30af\u3059\u308b\u30b9\u30b3\u30fc\u30d7\uff08\u6a29\u9650\uff09 (",(0,r.jsx)(n.code,{children:"scope"}),"):"]})," API \u30ea\u30bd\u30fc\u30b9\u6a29\u9650"]}),"\n"]})})]}),"\n",(0,r.jsx)("small",{children:(0,r.jsxs)(n.p,{children:["\u975e API \u7d44\u7e54\u6a29\u9650\u306e\u5834\u5408\u3001\u7d44\u7e54\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306f ",(0,r.jsx)(n.code,{children:"aud"}),"\n\u30af\u30ec\u30fc\u30e0\uff08\u4f8b\uff1a",(0,r.jsx)(n.code,{children:"urn:logto:organization:abc123"}),"\uff09\u3067\u8868\u3055\u308c\u307e\u3059\u3002",(0,r.jsx)(n.code,{children:"organization_id"}),"\n\u30af\u30ec\u30fc\u30e0\u306f\u7d44\u7e54\u30ec\u30d9\u30eb API \u30ea\u30bd\u30fc\u30b9\u30c8\u30fc\u30af\u30f3\u306b\u306e\u307f\u5b58\u5728\u3057\u307e\u3059\u3002"]})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"\u30bb\u30ad\u30e5\u30a2\u306a\u30de\u30eb\u30c1\u30c6\u30ca\u30f3\u30c8 API \u306e\u305f\u3081\u3001\u5fc5\u305a\u6a29\u9650\uff08\u30b9\u30b3\u30fc\u30d7\uff09\u3068\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\uff08\u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9\u3001\u7d44\u7e54\uff09\u306e\u4e21\u65b9\u3092\u691c\u8a3c\u3057\u3066\u304f\u3060\u3055\u3044\u3002"})})]})}function l(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},30961:(e,n,t)=>{t.d(n,{Ay:()=>m,RM:()=>h});var r=t(25105),o=t(79621),a=t(33435),i=t(38552),s=t(22002);function c(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="auth_middleware.go"',children:'import (\n    "context"\n    "encoding/json"\n    "net/http"\n)\n\ntype contextKey string\n\nconst AuthContextKey contextKey = "auth"\n\nfunc VerifyAccessToken(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        tokenString, err := extractBearerTokenFromHeaders(r)\n        if err != nil {\n            authErr := err.(*AuthorizationError)\n            w.Header().Set("Content-Type", "application/json")\n            w.WriteHeader(authErr.Status)\n            json.NewEncoder(w).Encode(map[string]string{"error": authErr.Message})\n            return\n        }\n\n        token, err := validateJWT(tokenString)\n        if err != nil {\n            authErr := err.(*AuthorizationError)\n            w.Header().Set("Content-Type", "application/json")\n            w.WriteHeader(authErr.Status)\n            json.NewEncoder(w).Encode(map[string]string{"error": authErr.Message})\n            return\n        }\n\n        // \u30c8\u30fc\u30af\u30f3\u3092\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306b\u4fdd\u5b58\u3057\u3001\u6c4e\u7528\u7684\u306b\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n        ctx := context.WithValue(r.Context(), AuthContextKey, token)\n        next.ServeHTTP(w, r.WithContext(ctx))\n    })\n}\n'})})}function l(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="auth_middleware.go"',children:'import "github.com/labstack/echo/v4"\n\nfunc VerifyAccessToken(next echo.HandlerFunc) echo.HandlerFunc {\n    return func(c echo.Context) error {\n        tokenString, err := extractBearerTokenFromHeaders(c.Request())\n        if err != nil {\n            authErr := err.(*AuthorizationError)\n            return c.JSON(authErr.Status, echo.Map{"error": authErr.Message})\n        }\n\n        token, err := validateJWT(tokenString)\n        if err != nil {\n            authErr := err.(*AuthorizationError)\n            return c.JSON(authErr.Status, echo.Map{"error": authErr.Message})\n        }\n\n        // \u30c8\u30fc\u30af\u30f3\u3092\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306b\u4fdd\u5b58\u3057\u3001\u6c4e\u7528\u7684\u306b\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n        c.Set("auth", token)\n        return next(c)\n    }\n}\n'})})}function d(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="auth_middleware.go"',children:'import (\n    "net/http"\n    "github.com/gofiber/fiber/v2"\n)\n\nfunc VerifyAccessToken(c *fiber.Ctx) error {\n    // Fiber \u30ea\u30af\u30a8\u30b9\u30c8\u3092 http.Request \u306b\u5909\u63db\u3057\u3066\u4e92\u63db\u6027\u3092\u78ba\u4fdd\n    req := &http.Request{\n        Header: make(http.Header),\n    }\n    req.Header.Set("Authorization", c.Get("Authorization"))\n\n    tokenString, err := extractBearerTokenFromHeaders(req)\n    if err != nil {\n        authErr := err.(*AuthorizationError)\n        return c.Status(authErr.Status).JSON(fiber.Map{"error": authErr.Message})\n    }\n\n    token, err := validateJWT(tokenString)\n    if err != nil {\n        authErr := err.(*AuthorizationError)\n        return c.Status(authErr.Status).JSON(fiber.Map{"error": authErr.Message})\n    }\n\n    // \u30c8\u30fc\u30af\u30f3\u3092 locals \u306b\u4fdd\u5b58\u3057\u3001\u6c4e\u7528\u7684\u306b\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n    c.Locals("auth", token)\n    return c.Next()\n}\n'})})}function u(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="auth_middleware.go"',children:'import "github.com/gin-gonic/gin"\n\nfunc VerifyAccessToken() gin.HandlerFunc {\n    return func(c *gin.Context) {\n        tokenString, err := extractBearerTokenFromHeaders(c.Request)\n        if err != nil {\n            authErr := err.(*AuthorizationError)\n            c.JSON(authErr.Status, gin.H{"error": authErr.Message})\n            c.Abort()\n            return\n        }\n\n        token, err := validateJWT(tokenString)\n        if err != nil {\n            authErr := err.(*AuthorizationError)\n            c.JSON(authErr.Status, gin.H{"error": authErr.Message})\n            c.Abort()\n            return\n        }\n\n        // \u30c8\u30fc\u30af\u30f3\u3092\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306b\u4fdd\u5b58\u3057\u3001\u6c4e\u7528\u7684\u306b\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n        c.Set("auth", token)\n        c.Next()\n    }\n}\n'})})}const p=Object.freeze({gin:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}),{}),fiber:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}),{}),echo:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}),{}),chi:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}),{})}),h=[];function g(e){const n={a:"a",code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://github.com/lestrrat-go/jwx",children:"github.com/lestrrat-go/jwx"})," \u3092\u4f7f\u7528\u3057\u3066 JWT \u306e\u691c\u8a3c\u3092\u884c\u3044\u307e\u3059\u3002\u307e\u3060\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"go mod init your-project\ngo get github.com/lestrrat-go/jwx/v3\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u307e\u305a\u3001\u3053\u308c\u3089\u306e\u5171\u901a\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092 ",(0,r.jsx)(n.code,{children:"auth_middleware.go"})," \u306b\u8ffd\u52a0\u3057\u307e\u3059\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="auth_middleware.go"',children:'import (\n    "context"\n    "strings"\n    "time"\n\n    "github.com/lestrrat-go/jwx/v3/jwk"\n    "github.com/lestrrat-go/jwx/v3/jwt"\n)\n\nvar jwkSet jwk.Set\n\nfunc init() {\n    // JWKS \u30ad\u30e3\u30c3\u30b7\u30e5\u306e\u521d\u671f\u5316\n    ctx, cancel := context.WithTimeout(context.Background(), 10*time.Second)\n    defer cancel()\n\n    var err error\n    jwkSet, err = jwk.Fetch(ctx, JWKS_URI)\n    if err != nil {\n        panic("Failed to fetch JWKS: " + err.Error())\n    }\n}\n\n// validateJWT \u306f JWT \u3092\u691c\u8a3c\u3057\u3001\u30d1\u30fc\u30b9\u6e08\u307f\u30c8\u30fc\u30af\u30f3\u3092\u8fd4\u3057\u307e\u3059\nfunc validateJWT(tokenString string) (jwt.Token, error) {\n    token, err := jwt.Parse([]byte(tokenString), jwt.WithKeySet(jwkSet))\n    if err != nil {\n        return nil, NewAuthorizationError("Invalid token: "+err.Error(), http.StatusUnauthorized)\n    }\n\n    // \u767a\u884c\u8005 (Issuer) \u306e\u691c\u8a3c\n    if token.Issuer() != ISSUER {\n        return nil, NewAuthorizationError("Invalid issuer", http.StatusUnauthorized)\n    }\n\n    if err := verifyPayload(token); err != nil {\n        return nil, err\n    }\n\n    return token, nil\n}\n\n// \u30c8\u30fc\u30af\u30f3\u30c7\u30fc\u30bf\u3092\u62bd\u51fa\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u95a2\u6570\nfunc getStringClaim(token jwt.Token, key string) string {\n    if val, ok := token.Get(key); ok {\n        if str, ok := val.(string); ok {\n            return str\n        }\n    }\n    return ""\n}\n\nfunc getScopesFromToken(token jwt.Token) []string {\n    if val, ok := token.Get("scope"); ok {\n        if scope, ok := val.(string); ok && scope != "" {\n            return strings.Split(scope, " ")\n        }\n    }\n    return []string{}\n}\n\nfunc getAudienceFromToken(token jwt.Token) []string {\n    return token.Audience()\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u6b21\u306b\u3001\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u306e\u691c\u8a3c\u7528\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u5b9f\u88c5\u3057\u307e\u3059\uff1a"}),"\n",e.framework?p[e.framework]:(0,r.jsx)(s.A,{groupId:"api-framework",children:Object.entries(p).map((([e,n])=>(0,r.jsx)(i.A,{value:e,label:(0,a.My)(e),children:n},e)))}),"\n",(0,r.jsxs)(n.p,{children:["\u6a29\u9650\u30e2\u30c7\u30eb\u306b\u5fdc\u3058\u3066\u3001\u7570\u306a\u308b ",(0,r.jsx)(n.code,{children:"verifyPayload"})," \u30ed\u30b8\u30c3\u30af\u3092\u63a1\u7528\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff1a"]}),"\n",(0,r.jsxs)(s.A,{groupId:"permission-models",children:[(0,r.jsx)(i.A,{value:"global-api-resources",label:"\u30b0\u30ed\u30fc\u30d0\u30eb API \u30ea\u30bd\u30fc\u30b9",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="auth_middleware.go"',children:'func verifyPayload(token jwt.Token) error {\n    // audience \u30af\u30ec\u30fc\u30e0\u304c API \u30ea\u30bd\u30fc\u30b9\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n    if !hasAudience(token, "https://your-api-resource-indicator") {\n        return NewAuthorizationError("Invalid audience")\n    }\n\n    // \u30b0\u30ed\u30fc\u30d0\u30eb API \u30ea\u30bd\u30fc\u30b9\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u3092\u78ba\u8a8d\n    requiredScopes := []string{"api:read", "api:write"} // \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n    if !hasRequiredScopes(token, requiredScopes) {\n        return NewAuthorizationError("Insufficient scope")\n    }\n\n    return nil\n}\n'})})}),(0,r.jsx)(i.A,{value:"organization-permissions",label:"\u7d44\u7e54\uff08\u975e API\uff09\u6a29\u9650",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="auth_middleware.go"',children:'func verifyPayload(token jwt.Token) error {\n    // audience \u30af\u30ec\u30fc\u30e0\u304c\u7d44\u7e54\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n    if !hasOrganizationAudience(token) {\n        return NewAuthorizationError("Invalid audience for organization permissions")\n    }\n\n    // \u7d44\u7e54 ID \u304c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff09\n    expectedOrgID := "your-organization-id" // \u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\n    if !hasMatchingOrganization(token, expectedOrgID) {\n        return NewAuthorizationError("Organization ID mismatch")\n    }\n\n    // \u5fc5\u8981\u306a\u7d44\u7e54\u30b9\u30b3\u30fc\u30d7\u3092\u78ba\u8a8d\n    requiredScopes := []string{"invite:users", "manage:settings"} // \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n    if !hasRequiredScopes(token, requiredScopes) {\n        return NewAuthorizationError("Insufficient organization scope")\n    }\n\n    return nil\n}\n'})})}),(0,r.jsx)(i.A,{value:"organization-level-api-resources",label:"\u7d44\u7e54\u30ec\u30d9\u30eb API \u30ea\u30bd\u30fc\u30b9",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="auth_middleware.go"',children:'func verifyPayload(token jwt.Token) error {\n    // audience \u30af\u30ec\u30fc\u30e0\u304c API \u30ea\u30bd\u30fc\u30b9\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n    if !hasAudience(token, "https://your-api-resource-indicator") {\n        return NewAuthorizationError("Invalid audience for organization-level API resources")\n    }\n\n    // \u7d44\u7e54 ID \u304c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff09\n    expectedOrgID := "your-organization-id" // \u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\n    if !hasMatchingOrganizationID(token, expectedOrgID) {\n        return NewAuthorizationError("Organization ID mismatch")\n    }\n\n    // \u7d44\u7e54\u30ec\u30d9\u30eb API \u30ea\u30bd\u30fc\u30b9\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u3092\u78ba\u8a8d\n    requiredScopes := []string{"api:read", "api:write"} // \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n    if !hasRequiredScopes(token, requiredScopes) {\n        return NewAuthorizationError("Insufficient organization-level API scopes")\n    }\n\n    return nil\n}\n'})})})]}),"\n",(0,r.jsx)(n.p,{children:"\u30da\u30a4\u30ed\u30fc\u30c9\u691c\u8a3c\u7528\u306e\u30d8\u30eb\u30d1\u30fc\u95a2\u6570\u3092\u8ffd\u52a0\u3057\u307e\u3059\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="auth_middleware.go"',children:'// hasAudience \u306f\u30c8\u30fc\u30af\u30f3\u306b\u6307\u5b9a\u3055\u308c\u305f audience \u304c\u542b\u307e\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\nfunc hasAudience(token jwt.Token, expectedAud string) bool {\n    audiences := token.Audience()\n    for _, aud := range audiences {\n        if aud == expectedAud {\n            return true\n        }\n    }\n    return false\n}\n\n// hasOrganizationAudience \u306f\u30c8\u30fc\u30af\u30f3\u306b\u7d44\u7e54 audience \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\nfunc hasOrganizationAudience(token jwt.Token) bool {\n    audiences := token.Audience()\n    for _, aud := range audiences {\n        if strings.HasPrefix(aud, "urn:logto:organization:") {\n            return true\n        }\n    }\n    return false\n}\n\n// hasRequiredScopes \u306f\u30c8\u30fc\u30af\u30f3\u306b\u3059\u3079\u3066\u306e\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\nfunc hasRequiredScopes(token jwt.Token, requiredScopes []string) bool {\n    scopes := getScopesFromToken(token)\n    for _, required := range requiredScopes {\n        found := false\n        for _, scope := range scopes {\n            if scope == required {\n                found = true\n                break\n            }\n        }\n        if !found {\n            return false\n        }\n    }\n    return true\n}\n\n// hasMatchingOrganization \u306f\u30c8\u30fc\u30af\u30f3\u306e audience \u304c\u671f\u5f85\u3055\u308c\u308b\u7d44\u7e54\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\nfunc hasMatchingOrganization(token jwt.Token, expectedOrgID string) bool {\n    expectedAud := fmt.Sprintf("urn:logto:organization:%s", expectedOrgID)\n    return hasAudience(token, expectedAud)\n}\n\n// hasMatchingOrganizationID \u306f\u30c8\u30fc\u30af\u30f3\u306e organization_id \u304c\u671f\u5f85\u3055\u308c\u308b\u3082\u306e\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\u3057\u307e\u3059\nfunc hasMatchingOrganizationID(token jwt.Token, expectedOrgID string) bool {\n    orgID := getStringClaim(token, "organization_id")\n    return orgID == expectedOrgID\n}\n'})})]})}function m(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(g,{...e})}):g(e)}},1429:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="auth_middleware.go"',children:'package main\n\nimport (\n    "fmt"\n    "net/http"\n    "strings"\n)\n\nconst (\n    JWKS_URI = "https://your-tenant.logto.app/oidc/jwks"\n    ISSUER   = "https://your-tenant.logto.app/oidc"\n)\n\ntype AuthorizationError struct {\n    Message string\n    Status  int\n}\n\nfunc (e *AuthorizationError) Error() string {\n    return e.Message\n}\n\nfunc NewAuthorizationError(message string, status ...int) *AuthorizationError {\n    statusCode := http.StatusForbidden // \u30c7\u30d5\u30a9\u30eb\u30c8\u306f 403 Forbidden\n    if len(status) > 0 {\n        statusCode = status[0]\n    }\n    return &AuthorizationError{\n        Message: message,\n        Status:  statusCode,\n    }\n}\n\nfunc extractBearerTokenFromHeaders(r *http.Request) (string, error) {\n    const bearerPrefix = "Bearer "\n\n    authorization := r.Header.Get("Authorization")\n    if authorization == "" {\n        return "", NewAuthorizationError("Authorization \u30d8\u30c3\u30c0\u30fc\u304c\u3042\u308a\u307e\u305b\u3093", http.StatusUnauthorized)\n    }\n\n    if !strings.HasPrefix(authorization, bearerPrefix) {\n        return "", NewAuthorizationError(fmt.Sprintf("Authorization \u30d8\u30c3\u30c0\u30fc\u306f \\"%s\\" \u3067\u59cb\u307e\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059", bearerPrefix), http.StatusUnauthorized)\n    }\n\n    return strings.TrimPrefix(authorization, bearerPrefix), nil\n}\n'})})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},62765:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="main.go"',children:'package main\n\nimport (\n    "encoding/json"\n    "net/http"\n\n    "github.com/go-chi/chi/v5"\n    "github.com/lestrrat-go/jwx/v3/jwt"\n)\n\nfunc main() {\n    r := chi.NewRouter()\n\n    // \u4fdd\u8b77\u3055\u308c\u305f\u30eb\u30fc\u30c8\u306b\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u9069\u7528\n    r.With(VerifyAccessToken).Get("/api/protected", func(w http.ResponseWriter, r *http.Request) {\n        // \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u76f4\u63a5\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3 (Access token) \u60c5\u5831\u3092\u53d6\u5f97\n        tokenInterface := r.Context().Value(AuthContextKey)\n        if tokenInterface == nil {\n            w.Header().Set("Content-Type", "application/json")\n            w.WriteHeader(http.StatusInternalServerError)\n            json.NewEncoder(w).Encode(map[string]string{"error": "Token not found"})\n            return\n        }\n\n        token := tokenInterface.(jwt.Token)\n\n        w.Header().Set("Content-Type", "application/json")\n        json.NewEncoder(w).Encode(map[string]interface{}{\n            "sub":             token.Subject(),\n            "client_id":       getStringClaim(token, "client_id"),\n            "organization_id": getStringClaim(token, "organization_id"),\n            "scopes":          getScopesFromToken(token),\n            "audience":        getAudienceFromToken(token),\n        })\n    })\n\n    http.ListenAndServe(":8080", r)\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u307e\u305f\u306f\u30eb\u30fc\u30c8\u30b0\u30eb\u30fc\u30d7\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\uff1a"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="main.go"',children:'package main\n\nimport (\n    "encoding/json"\n    "net/http"\n\n    "github.com/go-chi/chi/v5"\n    "github.com/lestrrat-go/jwx/v3/jwt"\n)\n\nfunc main() {\n    r := chi.NewRouter()\n\n    // \u4fdd\u8b77\u3055\u308c\u305f\u30eb\u30fc\u30c8\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\n    r.Route("/api", func(r chi.Router) {\n        r.Use(VerifyAccessToken)\n        r.Get("/protected", func(w http.ResponseWriter, r *http.Request) {\n            // \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u76f4\u63a5\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3 (Access token) \u60c5\u5831\u3092\u53d6\u5f97\n            token := r.Context().Value(AuthContextKey).(jwt.Token)\n\n            w.Header().Set("Content-Type", "application/json")\n            json.NewEncoder(w).Encode(map[string]interface{}{\n                "sub":             token.Subject(),\n                "client_id":       getStringClaim(token, "client_id"),\n                "organization_id": getStringClaim(token, "organization_id"),\n                "scopes":          getScopesFromToken(token),\n                "audience":        getAudienceFromToken(token),\n                "message":         "\u4fdd\u8b77\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3078\u306e\u30a2\u30af\u30bb\u30b9\u306b\u6210\u529f\u3057\u307e\u3057\u305f",\n            })\n        })\n    })\n\n    http.ListenAndServe(":8080", r)\n}\n'})})]})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},84940:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="main.go"',children:'package main\n\nimport (\n    "net/http"\n\n    "github.com/labstack/echo/v4"\n    "github.com/lestrrat-go/jwx/v3/jwt"\n)\n\nfunc main() {\n    e := echo.New()\n\n    // \u4fdd\u8b77\u3055\u308c\u305f\u30eb\u30fc\u30c8\u306b\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u9069\u7528\n    e.GET("/api/protected", func(c echo.Context) error {\n        // \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u76f4\u63a5\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3 (Access token) \u60c5\u5831\u3092\u53d6\u5f97\n        tokenInterface := c.Get("auth")\n        if tokenInterface == nil {\n            return c.JSON(http.StatusInternalServerError, echo.Map{"error": "Token not found"})\n        }\n\n        token := tokenInterface.(jwt.Token)\n\n        return c.JSON(http.StatusOK, echo.Map{\n            "sub":             token.Subject(),\n            "client_id":       getStringClaim(token, "client_id"),\n            "organization_id": getStringClaim(token, "organization_id"),\n            "scopes":          getScopesFromToken(token),\n            "audience":        getAudienceFromToken(token),\n        })\n    }, VerifyAccessToken)\n\n    e.Start(":8080")\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u307e\u305f\u306f\u30eb\u30fc\u30c8\u30b0\u30eb\u30fc\u30d7\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\uff1a"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="main.go"',children:'package main\n\nimport (\n    "github.com/labstack/echo/v4"\n    "github.com/lestrrat-go/jwx/v3/jwt"\n)\n\nfunc main() {\n    e := echo.New()\n\n    // \u4fdd\u8b77\u3055\u308c\u305f\u30eb\u30fc\u30c8\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\n    api := e.Group("/api", VerifyAccessToken)\n    api.GET("/protected", func(c echo.Context) error {\n        // \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u76f4\u63a5\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3 (Access token) \u60c5\u5831\u3092\u53d6\u5f97\n        token := c.Get("auth").(jwt.Token)\n\n        return c.JSON(200, echo.Map{\n            "sub":             token.Subject(),\n            "client_id":       getStringClaim(token, "client_id"),\n            "organization_id": getStringClaim(token, "organization_id"),\n            "scopes":          getScopesFromToken(token),\n            "audience":        getAudienceFromToken(token),\n            "message":         "\u4fdd\u8b77\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3078\u306e\u30a2\u30af\u30bb\u30b9\u306b\u6210\u529f\u3057\u307e\u3057\u305f",\n        })\n    })\n\n    e.Start(":8080")\n}\n'})})]})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},521:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="main.go"',children:'package main\n\nimport (\n    "github.com/gofiber/fiber/v2"\n    "github.com/lestrrat-go/jwx/v3/jwt"\n)\n\nfunc main() {\n    app := fiber.New()\n\n    // \u4fdd\u8b77\u3055\u308c\u305f\u30eb\u30fc\u30c8\u306b\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u9069\u7528\n    app.Get("/api/protected", VerifyAccessToken, func(c *fiber.Ctx) error {\n        // \u30ed\u30fc\u30ab\u30eb\u304b\u3089\u76f4\u63a5\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3 (Access token) \u60c5\u5831\u3092\u53d6\u5f97\n        tokenInterface := c.Locals("auth")\n        if tokenInterface == nil {\n            return c.Status(fiber.StatusInternalServerError).JSON(fiber.Map{"error": "Token not found"})\n        }\n\n        token := tokenInterface.(jwt.Token)\n\n        return c.JSON(fiber.Map{\n            "sub":             token.Subject(),\n            "client_id":       getStringClaim(token, "client_id"),\n            "organization_id": getStringClaim(token, "organization_id"),\n            "scopes":          getScopesFromToken(token),\n            "audience":        getAudienceFromToken(token),\n        })\n    })\n\n    app.Listen(":8080")\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u307e\u305f\u306f\u30eb\u30fc\u30c8\u30b0\u30eb\u30fc\u30d7\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\uff1a"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="main.go"',children:'package main\n\nimport (\n    "github.com/gofiber/fiber/v2"\n    "github.com/lestrrat-go/jwx/v3/jwt"\n)\n\nfunc main() {\n    app := fiber.New()\n\n    // \u4fdd\u8b77\u3055\u308c\u305f\u30eb\u30fc\u30c8\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\n    api := app.Group("/api", VerifyAccessToken)\n    api.Get("/protected", func(c *fiber.Ctx) error {\n        // \u30ed\u30fc\u30ab\u30eb\u304b\u3089\u76f4\u63a5\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3 (Access token) \u60c5\u5831\u3092\u53d6\u5f97\n        token := c.Locals("auth").(jwt.Token)\n\n        return c.JSON(fiber.Map{\n            "sub":             token.Subject(),\n            "client_id":       getStringClaim(token, "client_id"),\n            "organization_id": getStringClaim(token, "organization_id"),\n            "scopes":          getScopesFromToken(token),\n            "audience":        getAudienceFromToken(token),\n            "message":         "\u4fdd\u8b77\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3078\u306e\u30a2\u30af\u30bb\u30b9\u306b\u6210\u529f\u3057\u307e\u3057\u305f",\n        })\n    })\n\n    app.Listen(":8080")\n}\n'})})]})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},40561:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",metastring:'title="main.go"',children:'package main\n\nimport (\n    "net/http"\n\n    "github.com/gin-gonic/gin"\n    "github.com/lestrrat-go/jwx/v3/jwt"\n)\n\nfunc main() {\n    r := gin.Default()\n\n    // \u4fdd\u8b77\u3055\u308c\u305f\u30eb\u30fc\u30c8\u306b\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u9069\u7528\n    r.GET("/api/protected", VerifyAccessToken(), func(c *gin.Context) {\n        // \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u76f4\u63a5 \u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3 (Access token) \u60c5\u5831\u3092\u53d6\u5f97\n        tokenInterface, exists := c.Get("auth")\n        if !exists {\n            c.JSON(http.StatusInternalServerError, gin.H{"error": "Token not found"})\n            return\n        }\n\n        token := tokenInterface.(jwt.Token)\n\n        c.JSON(http.StatusOK, gin.H{\n            "sub":             token.Subject(),\n            "client_id":       getStringClaim(token, "client_id"),\n            "organization_id": getStringClaim(token, "organization_id"),\n            "scopes":          getScopesFromToken(token),\n            "audience":        getAudienceFromToken(token),\n        })\n    })\n\n    r.Run(":8080")\n}\n'})})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},14087:(e,n,t)=>{t.d(n,{Ay:()=>m,RM:()=>h});var r=t(25105),o=t(79621),a=t(33435),i=t(38552),s=t(22002);function c(e){const n={code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"pom.xml"})," \u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>io.micronaut.security</groupId>\n    <artifactId>micronaut-security-jwt</artifactId>\n</dependency>\n<dependency>\n    <groupId>io.micronaut</groupId>\n    <artifactId>micronaut-http-server-netty</artifactId>\n</dependency>\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="application.yml"',children:"micronaut:\n  security:\n    authentication: bearer\n    token:\n      jwt:\n        signatures:\n          jwks:\n            logto:\n              url: ${JWKS_URI:https://your-tenant.logto.app/oidc/jwks}\n        claims-validators:\n          issuer: ${JWT_ISSUER:https://your-tenant.logto.app/oidc}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="JwtClaimsValidator.java"',children:'import io.micronaut.security.token.Claims;\nimport io.micronaut.security.token.validator.TokenValidator;\nimport jakarta.inject.Singleton;\nimport org.reactivestreams.Publisher;\nimport reactor.core.publisher.Mono;\nimport java.util.Arrays;\nimport java.util.List;\n\n@Singleton\npublic class JwtClaimsValidator implements TokenValidator {\n\n    @Override\n    public Publisher<Boolean> validateToken(String token, Claims claims) {\n        try {\n            verifyPayload(claims);\n            return Mono.just(true);\n        } catch (AuthorizationException e) {\n            // Micronaut \u304c\u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9\u3092\u9069\u5207\u306b\u51e6\u7406\u3057\u307e\u3059\n            return Mono.just(false);\n        }\n    }\n\n    private void verifyPayload(Claims claims) {\n        // \u767a\u884c\u8005 (Issuer) \u306e\u691c\u8a3c\u306f Micronaut JWT \u8a2d\u5b9a\u306b\u3088\u3063\u3066\u81ea\u52d5\u7684\u306b\u51e6\u7406\u3055\u308c\u307e\u3059\n        // \u3053\u3053\u3067\u6a29\u9650\u30e2\u30c7\u30eb\u306b\u57fa\u3065\u3044\u305f\u8ffd\u52a0\u306e\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\u3092\u5b9f\u88c5\u3057\u3066\u304f\u3060\u3055\u3044\n        // \u4e0b\u8a18\u306e\u30d8\u30eb\u30d1\u30fc\u30e1\u30bd\u30c3\u30c9\u3092\u30af\u30ec\u30fc\u30e0 (Claim) \u62bd\u51fa\u306b\u5229\u7528\u3067\u304d\u307e\u3059\n\n        // \u4f8b: throw new AuthorizationException("Insufficient permissions");\n    }\n\n    // Micronaut JWT \u7528\u30d8\u30eb\u30d1\u30fc\u30e1\u30bd\u30c3\u30c9\n    @SuppressWarnings("unchecked")\n    private List<String> extractAudiences(Claims claims) {\n        Object aud = claims.get("aud");\n        if (aud instanceof List) {\n            return (List<String>) aud;\n        } else if (aud instanceof String) {\n            return Arrays.asList((String) aud);\n        }\n        return List.of();\n    }\n\n    private String extractScopes(Claims claims) {\n        return (String) claims.get("scope");\n    }\n\n    private String extractOrganizationId(Claims claims) {\n        return (String) claims.get("organization_id");\n    }\n}\n'})})]})}function l(e){const n={code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"pom.xml"})," \u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>io.quarkus</groupId>\n    <artifactId>quarkus-smallrye-jwt</artifactId>\n</dependency>\n<dependency>\n    <groupId>io.quarkus</groupId>\n    <artifactId>quarkus-resteasy-reactive</artifactId>\n</dependency>\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-properties",metastring:'title="application.properties"',children:"# JWT \u8a2d\u5b9a\nmp.jwt.verify.publickey.location=${JWKS_URI:https://your-tenant.logto.app/oidc/jwks}\nmp.jwt.verify.issuer=${JWT_ISSUER:https://your-tenant.logto.app/oidc}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="JwtVerificationFilter.java"',children:'import org.eclipse.microprofile.jwt.JsonWebToken;\nimport jakarta.enterprise.context.ApplicationScoped;\nimport jakarta.inject.Inject;\nimport jakarta.ws.rs.container.ContainerRequestContext;\nimport jakarta.ws.rs.container.ContainerRequestFilter;\nimport jakarta.ws.rs.core.Response;\nimport jakarta.ws.rs.ext.Provider;\nimport java.util.ArrayList;\nimport java.util.List;\n\n@Provider\n@ApplicationScoped\npublic class JwtVerificationFilter implements ContainerRequestFilter {\n\n    @Inject\n    JsonWebToken jwt;\n\n    @Override\n    public void filter(ContainerRequestContext requestContext) {\n        if (requestContext.getUriInfo().getPath().startsWith("/api/protected")) {\n            try {\n                verifyPayload(jwt);\n                requestContext.setProperty("auth", jwt);\n            } catch (AuthorizationException e) {\n                requestContext.abortWith(\n                    Response.status(e.getStatusCode())\n                        .entity("{\\"error\\": \\"" + e.getMessage() + "\\"}")\n                        .build()\n                );\n            } catch (Exception e) {\n                requestContext.abortWith(\n                    Response.status(401)\n                        .entity("{\\"error\\": \\"Invalid token\\"}")\n                        .build()\n                );\n            }\n        }\n    }\n\n    private void verifyPayload(JsonWebToken jwt) {\n        // \u767a\u884c\u8005 (Issuer) \u306e\u691c\u8a3c\u306f Quarkus JWT \u62e1\u5f35\u6a5f\u80fd\u306b\u3088\u3063\u3066\u81ea\u52d5\u7684\u306b\u51e6\u7406\u3055\u308c\u307e\u3059\n        // \u6a29\u9650\u30e2\u30c7\u30eb\u306b\u57fa\u3065\u3044\u305f\u8ffd\u52a0\u306e\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\u3092\u3053\u3053\u306b\u5b9f\u88c5\u3057\u3066\u304f\u3060\u3055\u3044\n        // \u4e0b\u8a18\u306e\u30d8\u30eb\u30d1\u30fc\u30e1\u30bd\u30c3\u30c9\u3092\u30af\u30ec\u30fc\u30e0 (Claim) \u62bd\u51fa\u306b\u5229\u7528\u3067\u304d\u307e\u3059\n    }\n\n    // Quarkus JWT \u7528\u30d8\u30eb\u30d1\u30fc\u30e1\u30bd\u30c3\u30c9\n    private List<String> extractAudiences(JsonWebToken jwt) {\n        return new ArrayList<>(jwt.getAudience());\n    }\n\n    private String extractScopes(JsonWebToken jwt) {\n        return jwt.getClaim("scope");\n    }\n\n    private String extractOrganizationId(JsonWebToken jwt) {\n        return jwt.getClaim("organization_id");\n    }\n}\n'})})]})}function d(e){const n={code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"pom.xml"})," \u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-security</artifactId>\n</dependency>\n<dependency>\n    <groupId>org.springframework.security</groupId>\n    <artifactId>spring-security-oauth2-resource-server</artifactId>\n</dependency>\n<dependency>\n    <groupId>org.springframework.security</groupId>\n    <artifactId>spring-security-oauth2-jose</artifactId>\n</dependency>\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="JwtSecurityConfig.java"',children:'import org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.oauth2.jwt.JwtDecoder;\nimport org.springframework.security.oauth2.jwt.NimbusJwtDecoder;\nimport org.springframework.security.web.SecurityFilterChain;\n\n@Configuration\n@EnableWebSecurity\npublic class JwtSecurityConfig {\n\n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        http\n            .authorizeHttpRequests(authz -> authz\n                .requestMatchers("/api/protected/**").authenticated()\n                .anyRequest().permitAll()\n            )\n            .oauth2ResourceServer(oauth2 -> oauth2\n                .jwt(jwt -> jwt.decoder(jwtDecoder()))\n            );\n        return http.build();\n    }\n\n    @Bean\n    public JwtDecoder jwtDecoder() {\n        // \u3053\u308c\u3089\u306e\u74b0\u5883\u5909\u6570\u3092\u30c7\u30d7\u30ed\u30a4\u6642\u306b\u5fc5\u305a\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\n        String jwksUri = System.getenv("JWKS_URI");\n        String issuer = System.getenv("JWT_ISSUER");\n\n        return NimbusJwtDecoder.withJwkSetUri(jwksUri)\n            .issuer(issuer)\n            .build();\n    }\n}\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="JwtValidator.java"',children:'import org.springframework.security.oauth2.jwt.Jwt;\nimport org.springframework.stereotype.Component;\nimport java.util.List;\n\n@Component\npublic class JwtValidator {\n\n    public void verifyPayload(Jwt jwt) {\n        // \u767a\u884c\u8005 (Issuer) \u306e\u691c\u8a3c\u306f Spring Security JWT \u30c7\u30b3\u30fc\u30c0\u30fc\u306b\u3088\u3063\u3066\u81ea\u52d5\u7684\u306b\u51e6\u7406\u3055\u308c\u307e\u3059\n        // \u3053\u3053\u3067\u6a29\u9650\u30e2\u30c7\u30eb\u306b\u57fa\u3065\u3044\u305f\u8ffd\u52a0\u306e\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\u3092\u5b9f\u88c5\u3057\u3066\u304f\u3060\u3055\u3044\n        // \u4e0b\u8a18\u306e\u30d8\u30eb\u30d1\u30fc\u30e1\u30bd\u30c3\u30c9\u3092\u30af\u30ec\u30fc\u30e0 (Claim) \u62bd\u51fa\u306b\u5229\u7528\u3067\u304d\u307e\u3059\n\n        // \u4f8b: throw new AuthorizationException("Insufficient permissions");\n        // \u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9\u306f Spring Security \u306e\u4f8b\u5916\u51e6\u7406\u306b\u3088\u3063\u3066\u51e6\u7406\u3055\u308c\u307e\u3059\n    }\n\n    // Spring Boot JWT \u7528\u306e\u30d8\u30eb\u30d1\u30fc\u30e1\u30bd\u30c3\u30c9\n    private List<String> extractAudiences(Jwt jwt) {\n        return jwt.getAudience();\n    }\n\n    private String extractScopes(Jwt jwt) {\n        return jwt.getClaimAsString("scope");\n    }\n\n    private String extractOrganizationId(Jwt jwt) {\n        return jwt.getClaimAsString("organization_id");\n    }\n}\n'})})]})}function u(e){const n={code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"pom.xml"})," \u306b\u4ee5\u4e0b\u3092\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>io.vertx</groupId>\n    <artifactId>vertx-web</artifactId>\n</dependency>\n<dependency>\n    <groupId>io.vertx</groupId>\n    <artifactId>vertx-auth-jwt</artifactId>\n</dependency>\n<dependency>\n    <groupId>io.vertx</groupId>\n    <artifactId>vertx-web-client</artifactId>\n</dependency>\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="JwtAuthHandler.java"',children:'import io.vertx.core.Future;\nimport io.vertx.core.Handler;\nimport io.vertx.core.Vertx;\nimport io.vertx.core.json.JsonArray;\nimport io.vertx.core.json.JsonObject;\nimport io.vertx.ext.auth.jwt.JWTAuth;\nimport io.vertx.ext.auth.jwt.JWTAuthOptions;\nimport io.vertx.ext.web.RoutingContext;\nimport io.vertx.ext.web.client.WebClient;\nimport java.util.List;\nimport java.util.ArrayList;\n\npublic class JwtAuthHandler implements Handler<RoutingContext> {\n\n    private final JWTAuth jwtAuth;\n    private final WebClient webClient;\n    private final String expectedIssuer;\n    private final String jwksUri;\n\n    public JwtAuthHandler(Vertx vertx) {\n        this.webClient = WebClient.create(vertx);\n        this.jwtAuth = JWTAuth.create(vertx, new JWTAuthOptions());\n\n        // \u30c7\u30d7\u30ed\u30a4\u6642\u306b\u3053\u308c\u3089\u306e\u74b0\u5883\u5909\u6570\u3092\u5fc5\u305a\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044\n        this.expectedIssuer = System.getenv("JWT_ISSUER");\n        this.jwksUri = System.getenv("JWKS_URI");\n\n        // JWKS \u3092\u53d6\u5f97\u3057\u3066 JWT \u8a8d\u8a3c\u3092\u69cb\u6210\n        fetchJWKS().onSuccess(jwks -> {\n            // JWKS \u306e\u69cb\u6210\uff08\u7c21\u7565\u5316 - \u9069\u5207\u306a JWKS \u30d1\u30fc\u30b5\u30fc\u304c\u5fc5\u8981\u306a\u5834\u5408\u304c\u3042\u308a\u307e\u3059\uff09\n        });\n    }\n\n    @Override\n    public void handle(RoutingContext context) {\n        String authHeader = context.request().getHeader("Authorization");\n        if (authHeader == null || !authHeader.startsWith("Bearer ")) {\n            context.response()\n                .setStatusCode(401)\n                .putHeader("Content-Type", "application/json")\n                .end("{\\"error\\": \\"Authorization header missing or invalid\\"}");\n            return;\n        }\n\n        String token = authHeader.substring(7);\n        jwtAuth.authenticate(new JsonObject().put("jwt", token))\n            .onSuccess(user -> {\n                try {\n                    JsonObject principal = user.principal();\n                    verifyPayload(principal);\n                    context.put("auth", principal);\n                    context.next();\n                } catch (AuthorizationException e) {\n                    context.response()\n                        .setStatusCode(e.getStatusCode())  // \u4f8b\u5916\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u30b3\u30fc\u30c9\u3092\u4f7f\u7528\n                        .putHeader("Content-Type", "application/json")\n                        .end("{\\"error\\": \\"" + e.getMessage() + "\\"}");\n                } catch (Exception e) {\n                    context.response()\n                        .setStatusCode(401)\n                        .putHeader("Content-Type", "application/json")\n                        .end("{\\"error\\": \\"Invalid token\\"}");\n                }\n            })\n            .onFailure(err -> {\n                context.response()\n                    .setStatusCode(401)\n                    .putHeader("Content-Type", "application/json")\n                    .end("{\\"error\\": \\"Invalid token: " + err.getMessage() + "\\"}");\n            });\n    }\n\n    private Future<JsonObject> fetchJWKS() {\n        return webClient.getAbs(this.jwksUri)\n            .send()\n            .map(response -> response.bodyAsJsonObject());\n    }\n\n    private void verifyPayload(JsonObject principal) {\n        // Vert.x \u7528\u306b\u767a\u884c\u8005 (Issuer) \u3092\u624b\u52d5\u3067\u691c\u8a3c\n        String issuer = principal.getString("iss");\n        if (issuer == null || !expectedIssuer.equals(issuer)) {\n            throw new AuthorizationException("Invalid issuer: " + issuer);\n        }\n\n        // \u6a29\u9650\u30e2\u30c7\u30eb\u306b\u57fa\u3065\u304f\u8ffd\u52a0\u306e\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\u3092\u3053\u3053\u306b\u5b9f\u88c5\u3057\u3066\u304f\u3060\u3055\u3044\n        // \u4e0b\u8a18\u306e\u30d8\u30eb\u30d1\u30fc\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u30af\u30ec\u30fc\u30e0 (Claim) \u3092\u62bd\u51fa\u3067\u304d\u307e\u3059\n    }\n\n    // Vert.x JWT \u7528\u30d8\u30eb\u30d1\u30fc\u30e1\u30bd\u30c3\u30c9\n    private List<String> extractAudiences(JsonObject principal) {\n        JsonArray audiences = principal.getJsonArray("aud");\n        if (audiences != null) {\n            List<String> result = new ArrayList<>();\n            for (Object aud : audiences) {\n                result.add(aud.toString());\n            }\n            return result;\n        }\n        return List.of();\n    }\n\n    private String extractScopes(JsonObject principal) {\n        return principal.getString("scope");\n    }\n\n    private String extractOrganizationId(JsonObject principal) {\n        return principal.getString("organization_id");\n    }\n}\n'})})]})}const p=Object.freeze({"spring-boot":(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}),{}),quarkus:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}),{}),micronaut:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}),{}),"vertx-web":(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}),{})}),h=[];function g(e){const n={code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306b\u3088\u3063\u3066\u7570\u306a\u308b JWT \u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u5fc5\u8981\u306a\u4f9d\u5b58\u95a2\u4fc2\u3092\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"}),"\n",e.framework?p[e.framework]:(0,r.jsx)(s.A,{groupId:"api-framework",children:Object.entries(p).map((([e,n])=>(0,r.jsx)(i.A,{value:e,label:(0,a.My)(e),children:n},e)))}),"\n",(0,r.jsx)(n.p,{children:"\u6a29\u9650 (Permission) \u30e2\u30c7\u30eb\u306b\u5f93\u3063\u3066\u3001\u9069\u5207\u306a\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\u3092\u5b9f\u88c5\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"}),"\n",(0,r.jsxs)(s.A,{groupId:"permission-models",children:[(0,r.jsx)(i.A,{value:"global-api-resources",label:"\u30b0\u30ed\u30fc\u30d0\u30eb API \u30ea\u30bd\u30fc\u30b9",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// audience \u30af\u30ec\u30fc\u30e0\u304c API \u30ea\u30bd\u30fc\u30b9\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\nList<String> audiences = extractAudiences(token); // \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u56fa\u6709\u306e\u62bd\u51fa\nif (!audiences.contains("https://your-api-resource-indicator")) {\n    throw new AuthorizationException("Invalid audience");\n}\n\n// \u30b0\u30ed\u30fc\u30d0\u30eb API \u30ea\u30bd\u30fc\u30b9\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u3092\u78ba\u8a8d\nList<String> requiredScopes = Arrays.asList("api:read", "api:write"); // \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\nString scopes = extractScopes(token); // \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u56fa\u6709\u306e\u62bd\u51fa\nList<String> tokenScopes = scopes != null ? Arrays.asList(scopes.split(" ")) : List.of();\n\nif (!tokenScopes.containsAll(requiredScopes)) {\n    throw new AuthorizationException("Insufficient scope");\n}\n'})})}),(0,r.jsx)(i.A,{value:"organization-permissions",label:"\u7d44\u7e54 (Organization)\uff08\u975e API\uff09\u6a29\u9650 (Permissions)",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// audience \u30af\u30ec\u30fc\u30e0\u304c\u7d44\u7e54 (Organization) \u5f62\u5f0f\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\nList<String> audiences = extractAudiences(token); // \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u56fa\u6709\u306e\u62bd\u51fa\nboolean hasOrgAudience = audiences.stream()\n    .anyMatch(aud -> aud.startsWith("urn:logto:organization:"));\n\nif (!hasOrgAudience) {\n    throw new AuthorizationException("Invalid audience for organization permissions");\n}\n\n// \u7d44\u7e54 ID \u304c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\u304c\u5fc5\u8981\u306a\u5834\u5408\u3042\u308a\uff09\nString expectedOrgId = "your-organization-id"; // \u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\nString expectedAud = "urn:logto:organization:" + expectedOrgId;\nif (!audiences.contains(expectedAud)) {\n    throw new AuthorizationException("Organization ID mismatch");\n}\n\n// \u5fc5\u8981\u306a\u7d44\u7e54 (Organization) \u30b9\u30b3\u30fc\u30d7\u3092\u78ba\u8a8d\nList<String> requiredScopes = Arrays.asList("invite:users", "manage:settings"); // \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\nString scopes = extractScopes(token); // \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u56fa\u6709\u306e\u62bd\u51fa\nList<String> tokenScopes = scopes != null ? Arrays.asList(scopes.split(" ")) : List.of();\n\nif (!tokenScopes.containsAll(requiredScopes)) {\n    throw new AuthorizationException("Insufficient organization scope");\n}\n'})})}),(0,r.jsx)(i.A,{value:"organization-level-api-resources",label:"\u7d44\u7e54\u30ec\u30d9\u30eb API \u30ea\u30bd\u30fc\u30b9",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'// audience \u30af\u30ec\u30fc\u30e0\u304c API \u30ea\u30bd\u30fc\u30b9\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\nList<String> audiences = extractAudiences(token); // \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u56fa\u6709\u306e\u62bd\u51fa\nif (!audiences.contains("https://your-api-resource-indicator")) {\n    throw new AuthorizationException("Invalid audience for organization-level API resources");\n}\n\n// \u7d44\u7e54 ID \u304c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\u304c\u5fc5\u8981\u306a\u5834\u5408\u3042\u308a\uff09\nString expectedOrgId = "your-organization-id"; // \u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\nString orgId = extractOrganizationId(token); // \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u56fa\u6709\u306e\u62bd\u51fa\nif (!expectedOrgId.equals(orgId)) {\n    throw new AuthorizationException("Organization ID mismatch");\n}\n\n// \u7d44\u7e54\u30ec\u30d9\u30eb API \u30ea\u30bd\u30fc\u30b9\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u3092\u78ba\u8a8d\nList<String> requiredScopes = Arrays.asList("api:read", "api:write"); // \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\nString scopes = extractScopes(token); // \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u56fa\u6709\u306e\u62bd\u51fa\nList<String> tokenScopes = scopes != null ? Arrays.asList(scopes.split(" ")) : List.of();\n\nif (!tokenScopes.containsAll(requiredScopes)) {\n    throw new AuthorizationException("Insufficient organization-level API scopes");\n}\n'})})})]}),"\n",(0,r.jsx)(n.p,{children:"\u30af\u30ec\u30fc\u30e0 (Claims) \u3092\u62bd\u51fa\u3059\u308b\u305f\u3081\u306e\u30d8\u30eb\u30d1\u30fc\u30e1\u30bd\u30c3\u30c9\u306f\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3054\u3068\u306b\u7570\u306a\u308a\u307e\u3059\u3002\u4e0a\u8a18\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u56fa\u6709\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30d5\u30a1\u30a4\u30eb\u3067\u5b9f\u88c5\u306e\u8a73\u7d30\u3092\u78ba\u8a8d\u3057\u3066\u304f\u3060\u3055\u3044\u3002"})]})}function m(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(g,{...e})}):g(e)}},33403:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="AuthorizationException.java"',children:"public class AuthorizationException extends RuntimeException {\n    private final int statusCode;\n\n    public AuthorizationException(String message) {\n        this(message, 403); // \u30c7\u30d5\u30a9\u30eb\u30c8\u306f 403 Forbidden\n    }\n\n    public AuthorizationException(String message, int statusCode) {\n        super(message);\n        this.statusCode = statusCode;\n    }\n\n    public int getStatusCode() {\n        return statusCode;\n    }\n}\n"})})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},30585:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="ProtectedController.java"',children:'import io.micronaut.http.annotation.Controller;\nimport io.micronaut.http.annotation.Get;\nimport io.micronaut.security.annotation.Secured;\nimport io.micronaut.security.authentication.Authentication;\nimport io.micronaut.security.rules.SecurityRule;\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.Map;\n\n@Controller("/api")\n@Secured(SecurityRule.IS_AUTHENTICATED)\npublic class ProtectedController {\n\n    @Get("/protected")\n    public Map<String, Object> protectedEndpoint(Authentication authentication) {\n        // \u8a8d\u8a3c (Authentication) \u304b\u3089\u76f4\u63a5\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3\u60c5\u5831\u3078\u30a2\u30af\u30bb\u30b9\n        String scopes = (String) authentication.getAttributes().get("scope");\n        List<String> scopeList = scopes != null ? Arrays.asList(scopes.split(" ")) : List.of();\n\n        return Map.of(\n            "sub", authentication.getName(),\n            "client_id", authentication.getAttributes().get("client_id"),\n            "organization_id", authentication.getAttributes().get("organization_id"),\n            "scopes", scopeList,\n            "audience", authentication.getAttributes().get("aud")\n        );\n    }\n}\n'})})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},71423:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="ProtectedResource.java"',children:'import org.eclipse.microprofile.jwt.JsonWebToken;\nimport jakarta.inject.Inject;\nimport jakarta.ws.rs.GET;\nimport jakarta.ws.rs.Path;\nimport jakarta.ws.rs.Produces;\nimport jakarta.ws.rs.core.MediaType;\nimport jakarta.ws.rs.core.Context;\nimport jakarta.ws.rs.container.ContainerRequestContext;\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.Map;\n\n@Path("/api")\npublic class ProtectedResource {\n\n    @Inject\n    JsonWebToken jwt;\n\n    @GET\n    @Path("/protected")\n    @Produces(MediaType.APPLICATION_JSON)\n    public Map<String, Object> protectedEndpoint(@Context ContainerRequestContext requestContext) {\n        // JWT \u3092\u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u307e\u305f\u306f\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u76f4\u63a5\u53d6\u5f97\n        JsonWebToken token = (JsonWebToken) requestContext.getProperty("auth");\n        if (token == null) {\n            token = jwt; // \u30a4\u30f3\u30b8\u30a7\u30af\u30c8\u3055\u308c\u305f JWT \u3092\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u3068\u3057\u3066\u4f7f\u7528\n        }\n\n        String scopes = token.getClaim("scope");\n        List<String> scopeList = scopes != null ? Arrays.asList(scopes.split(" ")) : List.of();\n\n        return Map.of(\n            "sub", token.getSubject(),\n            "client_id", token.<String>getClaim("client_id"),\n            "organization_id", token.<String>getClaim("organization_id"),\n            "scopes", scopeList,\n            "audience", token.getAudience()\n        );\n    }\n}\n'})})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},73833:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="ProtectedController.java"',children:'import org.springframework.security.core.annotation.AuthenticationPrincipal;\nimport org.springframework.security.oauth2.jwt.Jwt;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.RestController;\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.Map;\n\n@RestController\npublic class ProtectedController {\n\n    @GetMapping("/api/protected")\n    public Map<String, Object> protectedEndpoint(@AuthenticationPrincipal Jwt jwt) {\n        // JWT \u304b\u3089\u76f4\u63a5\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3\u60c5\u5831\u3092\u53d6\u5f97\n        String scopes = jwt.getClaimAsString("scope");\n        List<String> scopeList = scopes != null ? Arrays.asList(scopes.split(" ")) : List.of();\n\n        return Map.of(\n            "sub", jwt.getSubject(),\n            "client_id", jwt.getClaimAsString("client_id"),\n            "organization_id", jwt.getClaimAsString("organization_id"),\n            "scopes", scopeList,\n            "audience", jwt.getAudience()\n        );\n    }\n}\n'})})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},89991:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="MainVerticle.java"',children:'import io.vertx.core.AbstractVerticle;\nimport io.vertx.core.Promise;\nimport io.vertx.core.json.JsonObject;\nimport io.vertx.ext.web.Router;\nimport io.vertx.ext.web.RoutingContext;\n\npublic class MainVerticle extends AbstractVerticle {\n\n    @Override\n    public void start(Promise<Void> startPromise) throws Exception {\n        Router router = Router.router(vertx);\n\n        // \u4fdd\u8b77\u3055\u308c\u305f\u30eb\u30fc\u30c8\u306b\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u9069\u7528\n        router.route("/api/protected*").handler(new JwtAuthHandler(vertx));\n        router.get("/api/protected").handler(this::protectedEndpoint);\n\n        vertx.createHttpServer()\n            .requestHandler(router)\n            .listen(8080, result -> {\n                if (result.succeeded()) {\n                    startPromise.complete();\n                } else {\n                    startPromise.fail(result.cause());\n                }\n            });\n    }\n\n    private void protectedEndpoint(RoutingContext context) {\n        // \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089 JWT \u30d7\u30ea\u30f3\u30b7\u30d1\u30eb\u306b\u76f4\u63a5\u30a2\u30af\u30bb\u30b9\n        JsonObject principal = context.get("auth");\n        if (principal == null) {\n            context.response()\n                .setStatusCode(500)\n                .putHeader("Content-Type", "application/json")\n                .end("{\\"error\\": \\"JWT principal not found\\"}");\n            return;\n        }\n\n        String scopes = principal.getString("scope");\n        JsonObject response = new JsonObject()\n            .put("sub", principal.getString("sub"))\n            .put("client_id", principal.getString("client_id"))\n            .put("organization_id", principal.getString("organization_id"))\n            .put("scopes", scopes != null ? scopes.split(" ") : new String[0])\n            .put("audience", principal.getJsonArray("aud"));\n\n        context.response()\n            .putHeader("Content-Type", "application/json")\n            .end(response.encode());\n    }\n}\n'})})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},24277:(e,n,t)=>{t.d(n,{Ay:()=>x,RM:()=>g});var r=t(25105),o=t(79621),a=t(33435),i=t(38552),s=t(22002);function c(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="auth-middleware.ts"',children:"import { Request, Response, NextFunction } from 'express';\nimport { validateJwt, createAuthInfo } from './jwt-validator.js';\n\n// Express Request \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u62e1\u5f35\u3057\u3066 auth \u3092\u8ffd\u52a0\ndeclare global {\n  namespace Express {\n    interface Request {\n      auth?: AuthInfo;\n    }\n  }\n}\n\nexport async function verifyAccessToken(req: Request, res: Response, next: NextFunction) {\n  try {\n    const token = extractBearerTokenFromHeaders(req.headers);\n    const payload = await validateJwt(token);\n\n    // \u30ea\u30af\u30a8\u30b9\u30c8\u306b\u8a8d\u8a3c\u60c5\u5831\u3092\u683c\u7d0d\u3057\u3001\u6c4e\u7528\u7684\u306b\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n    req.auth = createAuthInfo(payload);\n\n    next();\n  } catch (err: any) {\n    return res.status(err.status ?? 401).json({ error: err.message });\n  }\n}\n"})})}function l(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="auth-middleware.ts"',children:"import { FastifyRequest, FastifyReply } from 'fastify';\nimport { validateJwt, createAuthInfo } from './jwt-validator.js';\n\n// Fastify Request \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u62e1\u5f35\u3057\u3066 auth \u3092\u8ffd\u52a0\ndeclare module 'fastify' {\n  interface FastifyRequest {\n    auth?: AuthInfo;\n  }\n}\n\nexport async function fastifyVerifyAccessToken(request: FastifyRequest, reply: FastifyReply) {\n  try {\n    const token = extractBearerTokenFromHeaders(request.headers);\n    const payload = await validateJwt(token);\n\n    // \u8a8d\u8a3c\u60c5\u5831\u3092\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u4fdd\u5b58\u3057\u3001\u6c4e\u7528\u7684\u306b\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n    request.auth = createAuthInfo(payload);\n  } catch (err: any) {\n    reply.code(err.status ?? 401).send({ error: err.message });\n  }\n}\n"})})}function d(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="auth-middleware.ts"',children:"import { Request, ResponseToolkit } from '@hapi/hapi';\nimport { validateJwt, createAuthInfo } from './jwt-validator.js';\n\nexport async function hapiVerifyAccessToken(request: Request, h: ResponseToolkit) {\n  try {\n    const token = extractBearerTokenFromHeaders(request.headers);\n    const payload = await validateJwt(token);\n\n    // \u8a8d\u8a3c\u60c5\u5831\u3092 request.app \u306b\u4fdd\u5b58\u3057\u3001\u6c4e\u7528\u7684\u306b\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n    request.app.auth = createAuthInfo(payload);\n\n    return h.continue;\n  } catch (err: any) {\n    return h\n      .response({ error: err.message })\n      .code(err.status ?? 401)\n      .takeover();\n  }\n}\n"})})}function u(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="auth-middleware.ts"',children:"import { Context, Next } from 'koa';\nimport { validateJwt, createAuthInfo } from './jwt-validator.js';\n\nexport async function koaVerifyAccessToken(ctx: Context, next: Next) {\n  try {\n    const token = extractBearerTokenFromHeaders(ctx.request.headers);\n    const payload = await validateJwt(token);\n\n    // \u8a8d\u8a3c\u60c5\u5831\u3092 state \u306b\u4fdd\u5b58\u3057\u3001\u6c4e\u7528\u7684\u306b\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n    ctx.state.auth = createAuthInfo(payload);\n\n    await next();\n  } catch (err: any) {\n    ctx.status = err.status ?? 401;\n    ctx.body = { error: err.message };\n  }\n}\n"})})}function p(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="access-token.guard.ts"',children:"import {\n  Injectable,\n  CanActivate,\n  ExecutionContext,\n  UnauthorizedException,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { validateJwt, createAuthInfo } from './jwt-validator.js';\n\n@Injectable()\nexport class AccessTokenGuard implements CanActivate {\n  async canActivate(context: ExecutionContext): Promise<boolean> {\n    const req = context.switchToHttp().getRequest();\n\n    try {\n      const token = extractBearerTokenFromHeaders(req.headers);\n      const payload = await validateJwt(token);\n\n      // \u8a8d\u8a3c\u60c5\u5831\u3092\u30ea\u30af\u30a8\u30b9\u30c8\u306b\u4fdd\u5b58\u3057\u3001\u6c4e\u7528\u7684\u306b\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n      req.auth = createAuthInfo(payload);\n\n      return true;\n    } catch (err: any) {\n      if (err.status === 401) throw new UnauthorizedException(err.message);\n      throw new ForbiddenException(err.message);\n    }\n  }\n}\n"})})}const h=Object.freeze({express:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}),{}),fastify:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}),{}),hapi:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}),{}),koa:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}),{}),nestjs:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}),{})}),g=[];function m(e){const n={a:"a",code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["\u3053\u306e\u4f8b\u3067\u306f ",(0,r.jsx)(n.a,{href:"https://github.com/panva/jose",children:"jose"})," \u3092\u4f7f\u7528\u3057\u3066 JWT \u3092\u691c\u8a3c\u3057\u307e\u3059\u3002\u307e\u3060\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u3001\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm install jose\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u307e\u305f\u306f\u3001\u304a\u597d\u307f\u306e\u30d1\u30c3\u30b1\u30fc\u30b8\u30de\u30cd\u30fc\u30b8\u30e3\u30fc\uff08\u4f8b\uff1a ",(0,r.jsx)(n.code,{children:"pnpm"})," \u3084 ",(0,r.jsx)(n.code,{children:"yarn"}),"\uff09\u3092\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u307e\u305a\u3001JWT \u691c\u8a3c\u3092\u51e6\u7406\u3059\u308b\u305f\u3081\u306e\u5171\u901a\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u3092\u8ffd\u52a0\u3057\u307e\u3059\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="jwt-validator.ts"',children:"import { createRemoteJWKSet, jwtVerify, JWTPayload } from 'jose';\nimport { AuthInfo, AuthorizationError } from './auth-middleware.js';\n\nconst jwks = createRemoteJWKSet(new URL(JWKS_URI));\n\nexport async function validateJwt(token: string): Promise<JWTPayload> {\n  const { payload } = await jwtVerify(token, jwks, {\n    issuer: ISSUER,\n  });\n\n  verifyPayload(payload);\n  return payload;\n}\n\nexport function createAuthInfo(payload: JWTPayload): AuthInfo {\n  const scopes = (payload.scope as string)?.split(' ') ?? [];\n  const audience = Array.isArray(payload.aud) ? payload.aud : payload.aud ? [payload.aud] : [];\n\n  return new AuthInfo(\n    payload.sub!,\n    payload.client_id as string,\n    payload.organization_id as string,\n    scopes,\n    audience\n  );\n}\n\nfunction verifyPayload(payload: JWTPayload): void {\n  // \u6a29\u9650\u30e2\u30c7\u30eb\u306b\u57fa\u3065\u304f\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\u3092\u3053\u3053\u306b\u5b9f\u88c5\u3057\u3066\u304f\u3060\u3055\u3044\n  // \u3053\u306e\u5185\u5bb9\u306f\u4e0b\u8a18\u306e\u6a29\u9650\u30e2\u30c7\u30eb\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u793a\u3057\u307e\u3059\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6b21\u306b\u3001\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u691c\u8a3c\u3059\u308b\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u5b9f\u88c5\u3057\u307e\u3059\uff1a"}),"\n",e.framework?h[e.framework]:(0,r.jsx)(s.A,{groupId:"api-framework",children:Object.entries(h).map((([e,n])=>(0,r.jsx)(i.A,{value:e,label:(0,a.My)(e),children:n},e)))}),"\n",(0,r.jsxs)(n.p,{children:["\u6a29\u9650\u30e2\u30c7\u30eb\u306b\u5fdc\u3058\u3066\u3001",(0,r.jsx)(n.code,{children:"jwt-validator.ts"})," \u5185\u3067\u9069\u5207\u306a\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\u3092\u5b9f\u88c5\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"]}),"\n",(0,r.jsxs)(s.A,{groupId:"permission-models",children:[(0,r.jsx)(i.A,{value:"global-api-resources",label:"\u30b0\u30ed\u30fc\u30d0\u30eb API \u30ea\u30bd\u30fc\u30b9",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="jwt-validator.ts"',children:"function verifyPayload(payload: JWTPayload): void {\n  // audience \u30af\u30ec\u30fc\u30e0\u304c API \u30ea\u30bd\u30fc\u30b9\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n  const audiences = Array.isArray(payload.aud) ? payload.aud : payload.aud ? [payload.aud] : [];\n  if (!audiences.includes('https://your-api-resource-indicator')) {\n    throw new AuthorizationError('Invalid audience');\n  }\n\n  // \u30b0\u30ed\u30fc\u30d0\u30eb API \u30ea\u30bd\u30fc\u30b9\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u3092\u78ba\u8a8d\n  const requiredScopes = ['api:read', 'api:write']; // \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n  const scopes = (payload.scope as string)?.split(' ') ?? [];\n  if (!requiredScopes.every((scope) => scopes.includes(scope))) {\n    throw new AuthorizationError('Insufficient scope');\n  }\n}\n"})})}),(0,r.jsx)(i.A,{value:"organization-permissions",label:"\u7d44\u7e54\uff08\u975e API\uff09\u6a29\u9650",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="jwt-validator.ts"',children:"function verifyPayload(payload: JWTPayload): void {\n  // audience \u30af\u30ec\u30fc\u30e0\u304c\u7d44\u7e54\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n  const audiences = Array.isArray(payload.aud) ? payload.aud : payload.aud ? [payload.aud] : [];\n  const hasOrgAudience = audiences.some((aud) => aud.startsWith('urn:logto:organization:'));\n\n  if (!hasOrgAudience) {\n    throw new AuthorizationError('Invalid audience for organization permissions');\n  }\n\n  // \u7d44\u7e54 ID \u304c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\u304c\u5fc5\u8981\u306a\u5834\u5408\u3042\u308a\uff09\n  const expectedOrgId = 'your-organization-id'; // \u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\n  const expectedAud = `urn:logto:organization:${expectedOrgId}`;\n  if (!audiences.includes(expectedAud)) {\n    throw new AuthorizationError('Organization ID mismatch');\n  }\n\n  // \u5fc5\u8981\u306a\u7d44\u7e54\u30b9\u30b3\u30fc\u30d7\u3092\u78ba\u8a8d\n  const requiredScopes = ['invite:users', 'manage:settings']; // \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n  const scopes = (payload.scope as string)?.split(' ') ?? [];\n  if (!requiredScopes.every((scope) => scopes.includes(scope))) {\n    throw new AuthorizationError('Insufficient organization scope');\n  }\n}\n"})})}),(0,r.jsx)(i.A,{value:"organization-level-api-resources",label:"\u7d44\u7e54\u30ec\u30d9\u30eb API \u30ea\u30bd\u30fc\u30b9",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="jwt-validator.ts"',children:"function verifyPayload(payload: JWTPayload): void {\n  // audience \u30af\u30ec\u30fc\u30e0\u304c API \u30ea\u30bd\u30fc\u30b9\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n  const audiences = Array.isArray(payload.aud) ? payload.aud : payload.aud ? [payload.aud] : [];\n  if (!audiences.includes('https://your-api-resource-indicator')) {\n    throw new AuthorizationError('Invalid audience for organization-level API resources');\n  }\n\n  // \u7d44\u7e54 ID \u304c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\u304c\u5fc5\u8981\u306a\u5834\u5408\u3042\u308a\uff09\n  const expectedOrgId = 'your-organization-id'; // \u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\n  const orgId = payload.organization_id as string;\n  if (expectedOrgId !== orgId) {\n    throw new AuthorizationError('Organization ID mismatch');\n  }\n\n  // \u7d44\u7e54\u30ec\u30d9\u30eb API \u30ea\u30bd\u30fc\u30b9\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u3092\u78ba\u8a8d\n  const requiredScopes = ['api:read', 'api:write']; // \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n  const scopes = (payload.scope as string)?.split(' ') ?? [];\n  if (!requiredScopes.every((scope) => scopes.includes(scope))) {\n    throw new AuthorizationError('Insufficient organization-level API scopes');\n  }\n}\n"})})})]})]})}function x(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(m,{...e})}):m(e)}},22:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:'title="auth-middleware.ts"',children:"import { IncomingHttpHeaders } from 'http';\n\nconst JWKS_URI = 'https://your-tenant.logto.app/oidc/jwks';\nconst ISSUER = 'https://your-tenant.logto.app/oidc';\n\nexport class AuthInfo {\n  constructor(\n    public sub: string,\n    public clientId?: string,\n    public organizationId?: string,\n    public scopes: string[] = [],\n    public audience: string[] = []\n  ) {}\n}\n\nexport class AuthorizationError extends Error {\n  name = 'AuthorizationError';\n  constructor(\n    message: string,\n    public status = 403\n  ) {\n    super(message);\n  }\n}\n\nexport function extractBearerTokenFromHeaders({ authorization }: IncomingHttpHeaders): string {\n  const bearerPrefix = 'Bearer ';\n\n  if (!authorization) {\n    throw new AuthorizationError('Authorization header is missing', 401);\n  }\n\n  if (!authorization.startsWith(bearerPrefix)) {\n    throw new AuthorizationError(`Authorization header must start with \"${bearerPrefix}\"`, 401);\n  }\n\n  return authorization.slice(bearerPrefix.length);\n}\n"})})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},43801:(e,n,t)=>{t.d(n,{Ay:()=>g,RM:()=>p});var r=t(25105),o=t(79621),a=t(33435),i=t(38552),s=t(22002);function c(e){const n={code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",metastring:'title="app/Http/Middleware/VerifyAccessToken.php"',children:"<?php\n\nnamespace App\\Http\\Middleware;\n\nuse Closure;\nuse Illuminate\\Http\\Request;\nuse Illuminate\\Http\\Response;\n\nclass VerifyAccessToken\n{\n    use AuthHelpers;\n\n    public function handle(Request $request, Closure $next): Response\n    {\n        try {\n            $token = $this->extractBearerToken($request->headers->all());\n            $payload = JwtValidator::validateJwt($token);\n\n            // \u8a8d\u8a3c\u60c5\u5831\u3092\u30ea\u30af\u30a8\u30b9\u30c8\u5c5e\u6027\u306b\u4fdd\u5b58\u3057\u3001\u6c4e\u7528\u7684\u306b\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n            $request->attributes->set('auth', JwtValidator::createAuthInfo($payload));\n\n            return $next($request);\n\n        } catch (AuthorizationException $e) {\n            return response()->json(['error' => $e->getMessage()], $e->statusCode);\n        }\n    }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092 ",(0,r.jsx)(n.code,{children:"app/Http/Kernel.php"})," \u306b\u767b\u9332\u3057\u307e\u3059\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",metastring:'title="app/Http/Kernel.php"',children:"protected $middlewareAliases = [\n    // ... \u4ed6\u306e\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\n    'auth.token' => \\App\\Http\\Middleware\\VerifyAccessToken::class,\n];\n"})})]})}function l(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",metastring:'title="src/Middleware/JwtMiddleware.php"',children:"<?php\n\nnamespace App\\Middleware;\n\nuse Psr\\Http\\Message\\ResponseInterface;\nuse Psr\\Http\\Message\\ServerRequestInterface;\nuse Psr\\Http\\Server\\MiddlewareInterface;\nuse Psr\\Http\\Server\\RequestHandlerInterface;\nuse Slim\\Psr7\\Response;\n\nclass JwtMiddleware implements MiddlewareInterface\n{\n    use AuthHelpers;\n\n    public function process(ServerRequestInterface $request, RequestHandlerInterface $handler): ResponseInterface\n    {\n        try {\n            $headers = $request->getHeaders();\n            $token = $this->extractBearerToken($headers);\n            $payload = JwtValidator::validateJwt($token);\n\n            // \u8a8d\u8a3c\u60c5\u5831\u3092\u30ea\u30af\u30a8\u30b9\u30c8\u5c5e\u6027\u306b\u4fdd\u5b58\u3057\u3001\u6c4e\u7528\u7684\u306b\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n            $request = $request->withAttribute('auth', JwtValidator::createAuthInfo($payload));\n\n            return $handler->handle($request);\n\n        } catch (AuthorizationException $e) {\n            $response = new Response();\n            $response->getBody()->write(json_encode(['error' => $e->getMessage()]));\n            return $response\n                ->withHeader('Content-Type', 'application/json')\n                ->withStatus($e->statusCode);\n        }\n    }\n}\n"})})}function d(e){const n={code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",metastring:'title="src/Security/JwtAuthenticator.php"',children:"<?php\n\nnamespace App\\Security;\n\nuse Symfony\\Component\\HttpFoundation\\JsonResponse;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\HttpFoundation\\Response;\nuse Symfony\\Component\\Security\\Core\\Authentication\\Token\\TokenInterface;\nuse Symfony\\Component\\Security\\Core\\Exception\\AuthenticationException;\nuse Symfony\\Component\\Security\\Http\\Authenticator\\AbstractAuthenticator;\nuse Symfony\\Component\\Security\\Http\\Authenticator\\Passport\\Badge\\UserBadge;\nuse Symfony\\Component\\Security\\Http\\Authenticator\\Passport\\Passport;\nuse Symfony\\Component\\Security\\Http\\Authenticator\\Passport\\SelfValidatingPassport;\n\nclass JwtAuthenticator extends AbstractAuthenticator\n{\n    use AuthHelpers;\n\n    public function supports(Request $request): ?bool\n    {\n        return $request->headers->has('authorization');\n    }\n\n    public function authenticate(Request $request): Passport\n    {\n        try {\n            $token = $this->extractBearerToken($request->headers->all());\n            $payload = JwtValidator::validateJwt($token);\n            $authInfo = JwtValidator::createAuthInfo($payload);\n\n            // \u8a8d\u8a3c\u60c5\u5831\u3092\u30ea\u30af\u30a8\u30b9\u30c8\u5c5e\u6027\u306b\u4fdd\u5b58\u3057\u3001\u6c4e\u7528\u7684\u306b\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\n            $request->attributes->set('auth', $authInfo);\n\n            return new SelfValidatingPassport(new UserBadge($payload['sub']));\n\n        } catch (AuthorizationException $e) {\n            throw new AuthenticationException($e->getMessage());\n        }\n    }\n\n    public function onAuthenticationSuccess(Request $request, TokenInterface $token, string $firewallName): ?Response\n    {\n        return null; // \u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u3078\u51e6\u7406\u3092\u7d99\u7d9a\n    }\n\n    public function onAuthenticationFailure(Request $request, AuthenticationException $exception): ?Response\n    {\n        return new JsonResponse(['error' => $exception->getMessage()], Response::HTTP_UNAUTHORIZED);\n    }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"config/packages/security.yaml"})," \u3067\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u3092\u8a2d\u5b9a\u3057\u307e\u3059\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="config/packages/security.yaml"',children:"security:\n  firewalls:\n    api:\n      pattern: ^/api/protected\n      stateless: true\n      custom_authenticators:\n        - App\\Security\\JwtAuthenticator\n"})})]})}const u=Object.freeze({laravel:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}),{}),symfony:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}),{}),slim:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}),{})}),p=[];function h(e){const n={a:"a",code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://github.com/firebase/php-jwt",children:"firebase/php-jwt"})," \u3092\u4f7f\u7528\u3057\u3066 JWT \u306e\u691c\u8a3c\u3092\u884c\u3044\u307e\u3059\u3002Composer \u3092\u4f7f\u3063\u3066\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"composer require firebase/php-jwt\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u307e\u305a\u3001JWT \u691c\u8a3c\u3092\u51e6\u7406\u3059\u308b\u305f\u3081\u306e\u5171\u901a\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u3092\u8ffd\u52a0\u3057\u307e\u3059\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",metastring:'title="JwtValidator.php"',children:"<?php\n\nuse Firebase\\JWT\\JWT;\nuse Firebase\\JWT\\JWK;\nuse Firebase\\JWT\\Key;\n\nclass JwtValidator\n{\n    use AuthHelpers;\n\n    private static ?array $jwks = null;\n\n    public static function fetchJwks(): array\n    {\n        if (self::$jwks === null) {\n            $jwksData = file_get_contents(AuthConstants::JWKS_URI);\n            if ($jwksData === false) {\n                throw new AuthorizationException('Failed to fetch JWKS', 401);\n            }\n\n            self::$jwks = json_decode($jwksData, true);\n        }\n\n        return self::$jwks;\n    }\n\n    public static function validateJwt(string $token): array\n    {\n        try {\n            $jwks = self::fetchJwks();\n            $keys = JWK::parseKeySet($jwks);\n\n            $decoded = JWT::decode($token, $keys);\n            $payload = (array) $decoded;\n\n            // \u767a\u884c\u8005 (Issuer) \u306e\u691c\u8a3c\n            if (($payload['iss'] ?? '') !== AuthConstants::ISSUER) {\n                throw new AuthorizationException('Invalid issuer', 401);\n            }\n\n            self::verifyPayload($payload);\n            return $payload;\n\n        } catch (AuthorizationException $e) {\n            throw $e;\n        } catch (Exception $e) {\n            throw new AuthorizationException('Invalid token: ' . $e->getMessage(), 401);\n        }\n    }\n\n    public static function createAuthInfo(array $payload): AuthInfo\n    {\n        $scopes = !empty($payload['scope']) ? explode(' ', $payload['scope']) : [];\n        $audience = $payload['aud'] ?? [];\n\n        if (is_string($audience)) {\n            $audience = [$audience];\n        }\n\n        return new AuthInfo(\n            sub: $payload['sub'],\n            clientId: $payload['client_id'] ?? null,\n            organizationId: $payload['organization_id'] ?? null,\n            scopes: $scopes,\n            audience: $audience\n        );\n    }\n\n    private static function verifyPayload(array $payload): void\n    {\n        // \u6a29\u9650\u30e2\u30c7\u30eb\u306b\u57fa\u3065\u304f\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\u3092\u3053\u3053\u306b\u5b9f\u88c5\u3057\u3066\u304f\u3060\u3055\u3044\n        // \u3053\u306e\u5185\u5bb9\u306f\u4e0b\u8a18\u306e\u6a29\u9650\u30e2\u30c7\u30eb\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u8aac\u660e\u3057\u307e\u3059\n    }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6b21\u306b\u3001\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3\u3092\u691c\u8a3c\u3059\u308b\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u5b9f\u88c5\u3057\u307e\u3059\uff1a"}),"\n",e.framework?u[e.framework]:(0,r.jsx)(s.A,{groupId:"api-framework",children:Object.entries(u).map((([e,n])=>(0,r.jsx)(i.A,{value:e,label:(0,a.My)(e),children:n},e)))}),"\n",(0,r.jsxs)(n.p,{children:["\u6a29\u9650\u30e2\u30c7\u30eb\u306b\u5fdc\u3058\u3066\u3001",(0,r.jsx)(n.code,{children:"JwtValidator"})," \u5185\u3067\u9069\u5207\u306a\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\u3092\u5b9f\u88c5\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"]}),"\n",(0,r.jsxs)(s.A,{groupId:"permission-models",children:[(0,r.jsx)(i.A,{value:"global-api-resources",label:"\u30b0\u30ed\u30fc\u30d0\u30eb API \u30ea\u30bd\u30fc\u30b9",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",metastring:'title="JwtValidator.php"',children:"private static function verifyPayload(array $payload): void\n{\n    // \u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9 (Audience) \u30af\u30ec\u30fc\u30e0\u304c API \u30ea\u30bd\u30fc\u30b9\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n    $audiences = $payload['aud'] ?? [];\n    if (is_string($audiences)) {\n        $audiences = [$audiences];\n    }\n\n    if (!in_array('https://your-api-resource-indicator', $audiences)) {\n        throw new AuthorizationException('Invalid audience');\n    }\n\n    // \u30b0\u30ed\u30fc\u30d0\u30eb API \u30ea\u30bd\u30fc\u30b9\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7 (Scope) \u3092\u78ba\u8a8d\n    $requiredScopes = ['api:read', 'api:write']; // \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n    $scopes = !empty($payload['scope']) ? explode(' ', $payload['scope']) : [];\n\n    foreach ($requiredScopes as $scope) {\n        if (!in_array($scope, $scopes)) {\n            throw new AuthorizationException('Insufficient scope');\n        }\n    }\n}\n"})})}),(0,r.jsx)(i.A,{value:"organization-permissions",label:"\u7d44\u7e54 (\u975e API) \u6a29\u9650",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",metastring:'title="JwtValidator.php"',children:"private static function verifyPayload(array $payload): void\n{\n    // \u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9 (Audience) \u30af\u30ec\u30fc\u30e0\u304c\u7d44\u7e54\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n    $audiences = $payload['aud'] ?? [];\n    if (is_string($audiences)) {\n        $audiences = [$audiences];\n    }\n\n    $hasOrgAudience = false;\n    foreach ($audiences as $aud) {\n        if (str_starts_with($aud, 'urn:logto:organization:')) {\n            $hasOrgAudience = true;\n            break;\n        }\n    }\n\n    if (!$hasOrgAudience) {\n        throw new AuthorizationException('Invalid audience for organization permissions');\n    }\n\n    // \u7d44\u7e54 ID \u304c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u53d6\u5f97\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff09\n    $expectedOrgId = 'your-organization-id'; // \u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u53d6\u5f97\n    $expectedAud = \"urn:logto:organization:{$expectedOrgId}\";\n    if (!in_array($expectedAud, $audiences)) {\n        throw new AuthorizationException('Organization ID mismatch');\n    }\n\n    // \u5fc5\u8981\u306a\u7d44\u7e54\u30b9\u30b3\u30fc\u30d7 (Scope) \u3092\u78ba\u8a8d\n    $requiredScopes = ['invite:users', 'manage:settings']; // \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n    $scopes = !empty($payload['scope']) ? explode(' ', $payload['scope']) : [];\n\n    foreach ($requiredScopes as $scope) {\n        if (!in_array($scope, $scopes)) {\n            throw new AuthorizationException('Insufficient organization scope');\n        }\n    }\n}\n"})})}),(0,r.jsx)(i.A,{value:"organization-level-api-resources",label:"\u7d44\u7e54\u30ec\u30d9\u30eb API \u30ea\u30bd\u30fc\u30b9",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",metastring:'title="JwtValidator.php"',children:"private static function verifyPayload(array $payload): void\n{\n    // \u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9 (Audience) \u30af\u30ec\u30fc\u30e0\u304c API \u30ea\u30bd\u30fc\u30b9\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n    $audiences = $payload['aud'] ?? [];\n    if (is_string($audiences)) {\n        $audiences = [$audiences];\n    }\n\n    if (!in_array('https://your-api-resource-indicator', $audiences)) {\n        throw new AuthorizationException('Invalid audience for organization-level API resources');\n    }\n\n    // \u7d44\u7e54 ID \u304c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u53d6\u5f97\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff09\n    $expectedOrgId = 'your-organization-id'; // \u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u53d6\u5f97\n    $orgId = $payload['organization_id'] ?? null;\n    if ($expectedOrgId !== $orgId) {\n        throw new AuthorizationException('Organization ID mismatch');\n    }\n\n    // \u7d44\u7e54\u30ec\u30d9\u30eb API \u30ea\u30bd\u30fc\u30b9\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7 (Scope) \u3092\u78ba\u8a8d\n    $requiredScopes = ['api:read', 'api:write']; // \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n    $scopes = !empty($payload['scope']) ? explode(' ', $payload['scope']) : [];\n\n    foreach ($requiredScopes as $scope) {\n        if (!in_array($scope, $scopes)) {\n            throw new AuthorizationException('Insufficient organization-level API scopes');\n        }\n    }\n}\n"})})})]})]})}function g(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},5923:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",metastring:'title="AuthConstants.php"',children:"<?php\n\nclass AuthConstants\n{\n    public const JWKS_URI = 'https://your-tenant.logto.app/oidc/jwks';\n    public const ISSUER = 'https://your-tenant.logto.app/oidc';\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",metastring:'title="AuthInfo.php"',children:"<?php\n\nclass AuthInfo\n{\n    public function __construct(\n        public readonly string $sub,\n        public readonly ?string $clientId = null,\n        public readonly ?string $organizationId = null,\n        public readonly array $scopes = [],\n        public readonly array $audience = []\n    ) {}\n\n    public function toArray(): array\n    {\n        return [\n            'sub' => $this->sub,\n            'client_id' => $this->clientId,\n            'organization_id' => $this->organizationId,\n            'scopes' => $this->scopes,\n            'audience' => $this->audience,\n        ];\n    }\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",metastring:'title="AuthorizationException.php"',children:"<?php\n\nclass AuthorizationException extends Exception\n{\n    public function __construct(\n        string $message,\n        public readonly int $statusCode = 403\n    ) {\n        parent::__construct($message);\n    }\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",metastring:'title="AuthHelpers.php"',children:"<?php\n\ntrait AuthHelpers\n{\n    protected function extractBearerToken(array $headers): string\n    {\n        $authorization = $headers['authorization'][0] ?? $headers['Authorization'][0] ?? null;\n\n        if (!$authorization) {\n            throw new AuthorizationException('Authorization \u30d8\u30c3\u30c0\u30fc\u304c\u3042\u308a\u307e\u305b\u3093 (Authorization header is missing)', 401);\n        }\n\n        if (!str_starts_with($authorization, 'Bearer ')) {\n            throw new AuthorizationException('Authorization \u30d8\u30c3\u30c0\u30fc\u306f \"Bearer \" \u3067\u59cb\u307e\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059 (Authorization header must start with \"Bearer \")', 401);\n        }\n\n        return substr($authorization, 7); // 'Bearer ' \u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u524a\u9664\n    }\n}\n"})})]})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},69088:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",metastring:'title="routes/api.php"',children:"<?php\n\nuse Illuminate\\Http\\Request;\nuse Illuminate\\Support\\Facades\\Route;\n\nRoute::middleware('auth.token')->group(function () {\n    Route::get('/api/protected', function (Request $request) {\n        // \u30ea\u30af\u30a8\u30b9\u30c8\u5c5e\u6027\u304b\u3089\u8a8d\u8a3c\u60c5\u5831\u3078\u30a2\u30af\u30bb\u30b9\n        $auth = $request->attributes->get('auth');\n        return ['auth' => $auth->toArray()];\n    });\n});\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u307e\u305f\u306f\u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\uff1a"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",metastring:'title="app/Http/Controllers/Api/ProtectedController.php"',children:"<?php\n\nnamespace App\\Http\\Controllers\\Api;\n\nuse App\\Http\\Controllers\\Controller;\nuse Illuminate\\Http\\Request;\n\nclass ProtectedController extends Controller\n{\n    public function __construct()\n    {\n        $this->middleware('auth.token');\n    }\n\n    public function index(Request $request)\n    {\n        // \u30ea\u30af\u30a8\u30b9\u30c8\u5c5e\u6027\u304b\u3089\u8a8d\u8a3c\u60c5\u5831\u3078\u30a2\u30af\u30bb\u30b9\n        $auth = $request->attributes->get('auth');\n        return ['auth' => $auth->toArray()];\n    }\n\n    public function show(Request $request)\n    {\n        // \u4fdd\u8b77\u3055\u308c\u305f\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u30ed\u30b8\u30c3\u30af\n        $auth = $request->attributes->get('auth');\n        return [\n            'auth' => $auth->toArray(),\n            'message' => '\u4fdd\u8b77\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3078\u306e\u30a2\u30af\u30bb\u30b9\u306b\u6210\u529f\u3057\u307e\u3057\u305f'\n        ];\n    }\n}\n"})})]})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},89558:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",metastring:'title="src/Controllers/ProtectedController.php"',children:"<?php\n\nnamespace App\\Controllers;\n\nuse Psr\\Http\\Message\\ResponseInterface as Response;\nuse Psr\\Http\\Message\\ServerRequestInterface as Request;\n\nclass ProtectedController\n{\n    public function index(Request $request, Response $response): Response\n    {\n        // \u30ea\u30af\u30a8\u30b9\u30c8\u5c5e\u6027\u304b\u3089\u8a8d\u8a3c (Authentication) \u60c5\u5831\u3078\u30a2\u30af\u30bb\u30b9\n        $auth = $request->getAttribute('auth');\n        $response->getBody()->write(json_encode(['auth' => $auth->toArray()]));\n        return $response->withHeader('Content-Type', 'application/json');\n    }\n\n    public function detailed(Request $request, Response $response): Response\n    {\n        // \u4fdd\u8b77\u3055\u308c\u305f\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\u306e\u30ed\u30b8\u30c3\u30af\n        $auth = $request->getAttribute('auth');\n        $data = [\n            'auth' => $auth->toArray(),\n            'message' => '\u4fdd\u8b77\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3078\u306e\u30a2\u30af\u30bb\u30b9\u306b\u6210\u529f\u3057\u307e\u3057\u305f'\n        ];\n        $response->getBody()->write(json_encode($data));\n        return $response->withHeader('Content-Type', 'application/json');\n    }\n}\n"})})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},95416:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-php",metastring:'title="src/Controller/Api/ProtectedController.php"',children:"<?php\n\nnamespace App\\Controller\\Api;\n\nuse Symfony\\Bundle\\FrameworkBundle\\Controller\\AbstractController;\nuse Symfony\\Component\\HttpFoundation\\JsonResponse;\nuse Symfony\\Component\\HttpFoundation\\Request;\nuse Symfony\\Component\\Routing\\Annotation\\Route;\nuse Symfony\\Component\\Security\\Http\\Attribute\\IsGranted;\n\n#[Route('/api/protected')]\n#[IsGranted('IS_AUTHENTICATED_FULLY')]\nclass ProtectedController extends AbstractController\n{\n    #[Route('', methods: ['GET'])]\n    public function index(Request $request): JsonResponse\n    {\n        // \u30ea\u30af\u30a8\u30b9\u30c8\u5c5e\u6027\u304b\u3089\u8a8d\u8a3c (Authentication) \u60c5\u5831\u3078\u30a2\u30af\u30bb\u30b9\n        $auth = $request->attributes->get('auth');\n        return $this->json(['auth' => $auth->toArray()]);\n    }\n}\n"})})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},68287:(e,n,t)=>{t.d(n,{Ay:()=>m,RM:()=>h});var r=t(25105),o=t(79621),a=t(33435),i=t(38552),s=t(22002);function c(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",metastring:'title="auth_middleware.py"',children:"from django.http import JsonResponse\nfrom jwt_validator import validate_jwt, create_auth_info\n\ndef require_access_token(view_func):\n    def wrapper(request, *args, **kwargs):\n        try:\n            headers = {key.replace('HTTP_', '').replace('_', '-').lower(): value\n                      for key, value in request.META.items() if key.startswith('HTTP_')}\n\n            token = extract_bearer_token_from_headers(headers)\n            payload = validate_jwt(token)\n\n            # \u8a8d\u8a3c\u60c5\u5831 (auth info) \u3092\u30ea\u30af\u30a8\u30b9\u30c8\u3078\u6dfb\u4ed8\u3057\u3001\u6c4e\u7528\u7684\u306b\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n            request.auth = create_auth_info(payload)\n\n            return view_func(request, *args, **kwargs)\n\n        except AuthorizationError as e:\n            return JsonResponse({'error': str(e)}, status=e.status)\n\n    return wrapper\n"})})}function l(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",metastring:'title="auth_middleware.py"',children:"from rest_framework.authentication import TokenAuthentication\nfrom rest_framework import exceptions\nfrom jwt_validator import validate_jwt, create_auth_info\n\nclass AccessTokenAuthentication(TokenAuthentication):\n    keyword = 'Bearer'  # 'Token' \u306e\u4ee3\u308f\u308a\u306b 'Bearer' \u3092\u4f7f\u7528\n\n    def authenticate_credentials(self, key):\n        \"\"\"\n        \u30c8\u30fc\u30af\u30f3\u3092 JWT \u3068\u3057\u3066\u691c\u8a3c\u3057\u3001\u8a8d\u8a3c (Authentication) \u3057\u307e\u3059\u3002\n        \"\"\"\n        try:\n            payload = validate_jwt(key)\n            auth_info = create_auth_info(payload)\n\n            # \u6c4e\u7528\u7684\u306b\u8a8d\u8a3c\u60c5\u5831\u3092\u4fdd\u6301\u3059\u308b\u30e6\u30fc\u30b6\u30fc\u30e9\u30a4\u30af\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\n            user = type('User', (), {\n                'auth': auth_info,\n                'is_authenticated': True,\n                'is_anonymous': False,\n                'is_active': True,\n            })()\n\n            return (user, key)\n\n        except AuthorizationError as e:\n            if e.status == 401:\n                raise exceptions.AuthenticationFailed(str(e))\n            else:  # 403\n                raise exceptions.PermissionDenied(str(e))\n"})})}function d(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",metastring:'title="auth_middleware.py"',children:"from fastapi import HTTPException, Depends\nfrom fastapi.security import HTTPBearer, HTTPAuthorizationCredentials\nfrom jwt_validator import validate_jwt, create_auth_info\n\nsecurity = HTTPBearer()\n\nasync def verify_access_token(credentials: HTTPAuthorizationCredentials = Depends(security)) -> AuthInfo:\n    try:\n        token = credentials.credentials\n        payload = validate_jwt(token)\n        return create_auth_info(payload)\n\n    except AuthorizationError as e:\n        raise HTTPException(status_code=e.status, detail=str(e))\n"})})}function u(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",metastring:'title="auth_middleware.py"',children:"from functools import wraps\nfrom flask import request, jsonify, g\nfrom jwt_validator import validate_jwt, create_auth_info\n\ndef verify_access_token(f):\n    @wraps(f)\n    def decorated_function(*args, **kwargs):\n        try:\n            token = extract_bearer_token_from_headers(dict(request.headers))\n            payload = validate_jwt(token)\n\n            # Flask \u306e g \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u8a8d\u8a3c\u60c5\u5831 (auth info) \u3092\u4fdd\u5b58\u3057\u3001\u6c4e\u7528\u7684\u306b\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\n            g.auth = create_auth_info(payload)\n\n            return f(*args, **kwargs)\n\n        except AuthorizationError as e:\n            return jsonify({'error': str(e)}), e.status\n\n    return decorated_function\n"})})}const p=Object.freeze({fastapi:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}),{}),flask:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}),{}),django:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}),{}),"django-rest":(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}),{})}),h=[];function g(e){const n={a:"a",code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://github.com/jpadilla/pyjwt",children:"PyJWT"})," \u3092\u4f7f\u7528\u3057\u3066 JWT \u306e\u691c\u8a3c\u3092\u884c\u3044\u307e\u3059\u3002\u307e\u3060\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u3044\u306a\u3044\u5834\u5408\u306f\u3001\u6b21\u306e\u30b3\u30de\u30f3\u30c9\u3067\u30a4\u30f3\u30b9\u30c8\u30fc\u30eb\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pip install pyjwt[crypto]\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u307e\u305a\u3001JWT \u691c\u8a3c\u3092\u51e6\u7406\u3059\u308b\u305f\u3081\u306e\u5171\u901a\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u3092\u8ffd\u52a0\u3057\u307e\u3059\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",metastring:'title="jwt_validator.py"',children:"import jwt\nfrom jwt import PyJWKClient\nfrom typing import Dict, Any\nfrom auth_middleware import AuthInfo, AuthorizationError, JWKS_URI, ISSUER\n\njwks_client = PyJWKClient(JWKS_URI)\n\ndef validate_jwt(token: str) -> Dict[str, Any]:\n    \"\"\"JWT \u3092\u691c\u8a3c\u3057\u3001\u30da\u30a4\u30ed\u30fc\u30c9\u3092\u8fd4\u3059\"\"\"\n    try:\n        signing_key = jwks_client.get_signing_key_from_jwt(token)\n\n        payload = jwt.decode(\n            token,\n            signing_key.key,\n            algorithms=['RS256'],\n            issuer=ISSUER,\n            options={'verify_aud': False}  # \u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9\u306f\u624b\u52d5\u3067\u691c\u8a3c\u3057\u307e\u3059\n        )\n\n        verify_payload(payload)\n        return payload\n\n    except jwt.InvalidTokenError as e:\n        raise AuthorizationError(f'Invalid token: {str(e)}', 401)\n    except Exception as e:\n        raise AuthorizationError(f'Token validation failed: {str(e)}', 401)\n\ndef create_auth_info(payload: Dict[str, Any]) -> AuthInfo:\n    \"\"\"JWT \u30da\u30a4\u30ed\u30fc\u30c9\u304b\u3089 AuthInfo \u3092\u4f5c\u6210\"\"\"\n    scopes = payload.get('scope', '').split(' ') if payload.get('scope') else []\n    audience = payload.get('aud', [])\n    if isinstance(audience, str):\n        audience = [audience]\n\n    return AuthInfo(\n        sub=payload.get('sub'),\n        client_id=payload.get('client_id'),\n        organization_id=payload.get('organization_id'),\n        scopes=scopes,\n        audience=audience\n    )\n\ndef verify_payload(payload: Dict[str, Any]) -> None:\n    \"\"\"\u6a29\u9650\u30e2\u30c7\u30eb\u306b\u57fa\u3065\u3044\u3066\u30da\u30a4\u30ed\u30fc\u30c9\u3092\u691c\u8a3c\"\"\"\n    # \u6a29\u9650\u30e2\u30c7\u30eb\u306b\u57fa\u3065\u304f\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\u3092\u3053\u3053\u306b\u5b9f\u88c5\u3057\u3066\u304f\u3060\u3055\u3044\n    # \u4e0b\u8a18\u306e\u6a29\u9650\u30e2\u30c7\u30eb\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u8aac\u660e\u3057\u307e\u3059\n    pass\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6b21\u306b\u3001\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u691c\u8a3c\u3059\u308b\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u5b9f\u88c5\u3057\u307e\u3059\uff1a"}),"\n",e.framework?p[e.framework]:(0,r.jsx)(s.A,{groupId:"api-framework",children:Object.entries(p).map((([e,n])=>(0,r.jsx)(i.A,{value:e,label:(0,a.My)(e),children:n},e)))}),"\n",(0,r.jsxs)(n.p,{children:["\u6a29\u9650\u30e2\u30c7\u30eb\u306b\u5fdc\u3058\u3066\u3001",(0,r.jsx)(n.code,{children:"jwt_validator.py"})," \u5185\u3067\u9069\u5207\u306a\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\u3092\u5b9f\u88c5\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"]}),"\n",(0,r.jsxs)(s.A,{groupId:"permission-models",children:[(0,r.jsx)(i.A,{value:"global-api-resources",label:"\u30b0\u30ed\u30fc\u30d0\u30eb API \u30ea\u30bd\u30fc\u30b9",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",metastring:'title="jwt_validator.py"',children:"def verify_payload(payload: Dict[str, Any]) -> None:\n    \"\"\"\u30b0\u30ed\u30fc\u30d0\u30eb API \u30ea\u30bd\u30fc\u30b9\u7528\u306e\u30da\u30a4\u30ed\u30fc\u30c9\u3092\u691c\u8a3c\"\"\"\n    # \u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9\u30af\u30ec\u30fc\u30e0\u304c API \u30ea\u30bd\u30fc\u30b9\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n    audiences = payload.get('aud', [])\n    if isinstance(audiences, str):\n        audiences = [audiences]\n\n    if 'https://your-api-resource-indicator' not in audiences:\n        raise AuthorizationError('Invalid audience')\n\n    # \u30b0\u30ed\u30fc\u30d0\u30eb API \u30ea\u30bd\u30fc\u30b9\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u3092\u78ba\u8a8d\n    required_scopes = ['api:read', 'api:write']  # \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n    scopes = payload.get('scope', '').split(' ') if payload.get('scope') else []\n    if not all(scope in scopes for scope in required_scopes):\n        raise AuthorizationError('Insufficient scope')\n"})})}),(0,r.jsx)(i.A,{value:"organization-permissions",label:"\u7d44\u7e54\uff08\u975e API\uff09\u6a29\u9650",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",metastring:'title="jwt_validator.py"',children:"def verify_payload(payload: Dict[str, Any]) -> None:\n    \"\"\"\u7d44\u7e54\u6a29\u9650\u7528\u306e\u30da\u30a4\u30ed\u30fc\u30c9\u3092\u691c\u8a3c\"\"\"\n    # \u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9\u30af\u30ec\u30fc\u30e0\u304c\u7d44\u7e54\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n    audiences = payload.get('aud', [])\n    if isinstance(audiences, str):\n        audiences = [audiences]\n\n    has_org_audience = any(aud.startswith('urn:logto:organization:') for aud in audiences)\n    if not has_org_audience:\n        raise AuthorizationError('Invalid audience for organization permissions')\n\n    # \u7d44\u7e54 ID \u304c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u53d6\u5f97\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff09\n    expected_org_id = 'your-organization-id'  # \u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u53d6\u5f97\n    expected_aud = f'urn:logto:organization:{expected_org_id}'\n    if expected_aud not in audiences:\n        raise AuthorizationError('Organization ID mismatch')\n\n    # \u5fc5\u8981\u306a\u7d44\u7e54\u30b9\u30b3\u30fc\u30d7\u3092\u78ba\u8a8d\n    required_scopes = ['invite:users', 'manage:settings']  # \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n    scopes = payload.get('scope', '').split(' ') if payload.get('scope') else []\n    if not all(scope in scopes for scope in required_scopes):\n        raise AuthorizationError('Insufficient organization scope')\n"})})}),(0,r.jsx)(i.A,{value:"organization-level-api-resources",label:"\u7d44\u7e54\u30ec\u30d9\u30eb API \u30ea\u30bd\u30fc\u30b9",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",metastring:'title="jwt_validator.py"',children:"def verify_payload(payload: Dict[str, Any]) -> None:\n    \"\"\"\u7d44\u7e54\u30ec\u30d9\u30eb API \u30ea\u30bd\u30fc\u30b9\u7528\u306e\u30da\u30a4\u30ed\u30fc\u30c9\u3092\u691c\u8a3c\"\"\"\n    # \u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9\u30af\u30ec\u30fc\u30e0\u304c API \u30ea\u30bd\u30fc\u30b9\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n    audiences = payload.get('aud', [])\n    if isinstance(audiences, str):\n        audiences = [audiences]\n\n    if 'https://your-api-resource-indicator' not in audiences:\n        raise AuthorizationError('Invalid audience for organization-level API resources')\n\n    # \u7d44\u7e54 ID \u304c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u53d6\u5f97\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff09\n    expected_org_id = 'your-organization-id'  # \u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u53d6\u5f97\n    org_id = payload.get('organization_id')\n    if expected_org_id != org_id:\n        raise AuthorizationError('Organization ID mismatch')\n\n    # \u7d44\u7e54\u30ec\u30d9\u30eb API \u30ea\u30bd\u30fc\u30b9\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u3092\u78ba\u8a8d\n    required_scopes = ['api:read', 'api:write']  # \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n    scopes = payload.get('scope', '').split(' ') if payload.get('scope') else []\n    if not all(scope in scopes for scope in required_scopes):\n        raise AuthorizationError('Insufficient organization-level API scopes')\n"})})})]})]})}function m(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(g,{...e})}):g(e)}},86825:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",metastring:'title="auth_middleware.py"',children:"JWKS_URI = 'https://your-tenant.logto.app/oidc/jwks'\nISSUER = 'https://your-tenant.logto.app/oidc'\n\nclass AuthInfo:\n    def __init__(self, sub: str, client_id: str = None, organization_id: str = None,\n                 scopes: list = None, audience: list = None):\n        self.sub = sub\n        self.client_id = client_id\n        self.organization_id = organization_id\n        self.scopes = scopes or []\n        self.audience = audience or []\n\n    def to_dict(self):\n        return {\n            'sub': self.sub,\n            'client_id': self.client_id,\n            'organization_id': self.organization_id,\n            'scopes': self.scopes,\n            'audience': self.audience\n        }\n\nclass AuthorizationError(Exception):\n    def __init__(self, message: str, status: int = 403):\n        self.message = message\n        self.status = status\n        super().__init__(self.message)\n\ndef extract_bearer_token_from_headers(headers: dict) -> str:\n    \"\"\"\n    HTTP \u30d8\u30c3\u30c0\u30fc\u304b\u3089\u30d9\u30a2\u30e9\u30fc\u30c8\u30fc\u30af\u30f3\u3092\u62bd\u51fa\u3057\u307e\u3059\u3002\n\n    \u6ce8\u610f: FastAPI \u304a\u3088\u3073 Django REST Framework \u306b\u306f\u7d44\u307f\u8fbc\u307f\u306e\u30c8\u30fc\u30af\u30f3\u62bd\u51fa\u6a5f\u80fd\u304c\u3042\u308a\u307e\u3059\u3002\n    \u3053\u306e\u95a2\u6570\u306f\u4e3b\u306b Flask \u3084\u305d\u306e\u4ed6\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u5411\u3051\u3067\u3059\u3002\n    \"\"\"\n    authorization = headers.get('authorization') or headers.get('Authorization')\n\n    if not authorization:\n        raise AuthorizationError('Authorization header is missing', 401)\n\n    if not authorization.startswith('Bearer '):\n        raise AuthorizationError('Authorization header must start with \"Bearer \"', 401)\n\n    return authorization[7:]  # 'Bearer ' \u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u524a\u9664\n"})})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},24699:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",metastring:'title="views.py"',children:"from rest_framework.decorators import api_view, authentication_classes\nfrom rest_framework.response import Response\nfrom auth_middleware import AccessTokenAuthentication\n\n@api_view(['GET'])\n@authentication_classes([AccessTokenAuthentication])\ndef protected_view(request):\n    # request.user.auth \u304b\u3089\u8a8d\u8a3c\u60c5\u5831 (auth information) \u306b\u30a2\u30af\u30bb\u30b9\n    return Response({\"auth\": request.user.auth.to_dict()})\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u307e\u305f\u306f\u30af\u30e9\u30b9\u30d9\u30fc\u30b9\u30d3\u30e5\u30fc\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\uff1a"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",metastring:'title="views.py"',children:'from rest_framework.views import APIView\nfrom rest_framework.response import Response\nfrom auth_middleware import AccessTokenAuthentication\n\nclass ProtectedView(APIView):\n    authentication_classes = [AccessTokenAuthentication]\n\n    def get(self, request):\n        # request.user.auth \u304b\u3089\u8a8d\u8a3c\u60c5\u5831 (auth information) \u306b\u30a2\u30af\u30bb\u30b9\n        return Response({"auth": request.user.auth.to_dict()})\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",metastring:'title="urls.py"',children:"from django.urls import path\nfrom . import views\n\nurlpatterns = [\n    path('api/protected/', views.protected_view, name='protected'),\n    # \u30af\u30e9\u30b9\u30d9\u30fc\u30b9\u30d3\u30e5\u30fc\u306e\u5834\u5408\u306f\u4ee5\u4e0b\u3092\u4f7f\u7528\uff1a\n    # path('api/protected/', views.ProtectedView.as_view(), name='protected'),\n]\n"})})]})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},61702:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",metastring:'title="views.py"',children:'from django.http import JsonResponse\nfrom auth_middleware import require_access_token\n\n@require_access_token\ndef protected_view(request):\n    # \u30ea\u30af\u30a8\u30b9\u30c8\u306e request.auth \u304b\u3089\u8a8d\u8a3c (Authentication) \u60c5\u5831\u306b\u30a2\u30af\u30bb\u30b9\n    return JsonResponse({"auth": request.auth.to_dict()})\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",metastring:'title="urls.py"',children:"from django.urls import path\nfrom . import views\n\nurlpatterns = [\n    path('api/protected/', views.protected_view, name='protected'),\n]\n"})})]})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},60769:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",metastring:'title="app.py"',children:'from fastapi import FastAPI, Depends\nfrom auth_middleware import verify_access_token, AuthInfo\n\napp = FastAPI()\n\n@app.get("/api/protected")\nasync def protected_endpoint(auth: AuthInfo = Depends(verify_access_token)):\n    # auth \u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u304b\u3089\u8a8d\u8a3c\u60c5\u5831 (auth information) \u306b\u76f4\u63a5\u30a2\u30af\u30bb\u30b9\u3067\u304d\u307e\u3059\n    return {"auth": auth.to_dict()}\n'})})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},62868:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-py",metastring:'title="app.py"',children:"from flask import Flask, g, jsonify\nfrom auth_middleware import verify_access_token\n\napp = Flask(__name__)\n\n@app.route('/api/protected', methods=['GET'])\n@verify_access_token\ndef protected_endpoint():\n    # g.auth \u304b\u3089\u8a8d\u8a3c (Authentication) \u60c5\u5831\u3078\u30a2\u30af\u30bb\u30b9\n    return jsonify({\"auth\": g.auth.to_dict()})\n"})})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},21351:(e,n,t)=>{t.d(n,{Ay:()=>g,RM:()=>p});var r=t(25105),o=t(79621),a=t(33435),i=t(38552),s=t(22002);function c(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",metastring:'title="auth_helpers.rb"',children:"module GrapeAuthHelpers\n  include AuthHelpers\n\n  def authenticate_user!\n    begin\n      token = extract_bearer_token(request)\n      decoded_token = JwtValidator.validate_jwt(token)\n\n      # \u6c4e\u7528\u7684\u306b\u8a8d\u8a3c\u60c5\u5831\u3092\u4fdd\u5b58\n      @auth = JwtValidator.create_auth_info(decoded_token)\n\n    rescue AuthorizationError => e\n      error!({ error: e.message }, e.status)\n    rescue JWT::DecodeError, JWT::VerificationError, JWT::ExpiredSignature => e\n      error!({ error: '\u7121\u52b9\u306a\u30c8\u30fc\u30af\u30f3' }, 401)\n    end\n  end\n\n  def auth\n    @auth\n  end\nend\n"})})}function l(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",metastring:'title="app/controllers/concerns/jwt_authentication.rb"',children:"module JwtAuthentication\n  extend ActiveSupport::Concern\n  include AuthHelpers\n\n  included do\n    before_action :verify_access_token, only: [:protected_action] # \u7279\u5b9a\u306e\u30a2\u30af\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0\n  end\n\n  private\n\n  def verify_access_token\n    begin\n      token = extract_bearer_token(request)\n      decoded_token = JwtValidator.validate_jwt(token)\n\n      # \u8a8d\u8a3c\u60c5\u5831\u3092\u6c4e\u7528\u7684\u306b\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u4fdd\u5b58\n      @auth = JwtValidator.create_auth_info(decoded_token)\n\n    rescue AuthorizationError => e\n      render json: { error: e.message }, status: e.status\n    rescue JWT::DecodeError, JWT::VerificationError, JWT::ExpiredSignature => e\n      render json: { error: '\u7121\u52b9\u306a\u30c8\u30fc\u30af\u30f3' }, status: 401\n    end\n  end\nend\n"})})}function d(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",metastring:'title="auth_middleware.rb"',children:"class AuthMiddleware\n  include AuthHelpers\n\n  def initialize(app)\n    @app = app\n  end\n\n  def call(env)\n    request = Rack::Request.new(env)\n\n    # \u7279\u5b9a\u306e\u30eb\u30fc\u30c8\u306e\u307f\u3092\u4fdd\u8b77\n    if request.path.start_with?('/api/protected')\n      begin\n        token = extract_bearer_token(request)\n        decoded_token = JwtValidator.validate_jwt(token)\n\n        # \u8a8d\u8a3c\u60c5\u5831\u3092 env \u306b\u4fdd\u5b58\u3057\u3001\u6c4e\u7528\u7684\u306b\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n        env['auth'] = JwtValidator.create_auth_info(decoded_token)\n\n      rescue AuthorizationError => e\n        return [e.status, { 'Content-Type' => 'application/json' }, [{ error: e.message }.to_json]]\n      rescue JWT::DecodeError, JWT::VerificationError, JWT::ExpiredSignature => e\n        return [401, { 'Content-Type' => 'application/json' }, [{ error: 'Invalid token' }.to_json]]\n      end\n    end\n\n    @app.call(env)\n  end\nend\n"})})}const u=Object.freeze({rails:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}),{}),sinatra:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}),{}),grape:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}),{})}),p=[];function h(e){const n={a:"a",code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://github.com/jwt/ruby-jwt",children:" jwt "})," gem \u3092\u4f7f\u7528\u3057\u3066 JWT \u3092\u691c\u8a3c\u3057\u307e\u3059\u3002Gemfile \u306b\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",metastring:'title="Gemfile"',children:"gem 'jwt'\n# net-http \u306f Ruby 2.7 \u4ee5\u964d\u306e\u6a19\u6e96\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u4e00\u90e8\u306a\u306e\u3067\u3001\u660e\u793a\u7684\u306b\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6b21\u306b\u3001\u4ee5\u4e0b\u3092\u5b9f\u884c\u3057\u307e\u3059\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"bundle install\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u307e\u305a\u3001JWKS \u3068\u30c8\u30fc\u30af\u30f3\u691c\u8a3c\u3092\u6271\u3046\u305f\u3081\u306e\u5171\u901a\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u3092\u8ffd\u52a0\u3057\u307e\u3059\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",metastring:'title="jwt_validator.rb"',children:"require 'jwt'\nrequire 'net/http'\nrequire 'json'\n\nclass JwtValidator\n  include AuthHelpers\n\n  def self.fetch_jwks\n    @jwks ||= begin\n      uri = URI(AuthConstants::JWKS_URI)\n      response = Net::HTTP.get_response(uri)\n      raise AuthorizationError.new('Failed to fetch JWKS', 401) unless response.is_a?(Net::HTTPSuccess)\n\n      jwks_data = JSON.parse(response.body)\n      JWT::JWK::Set.new(jwks_data)\n    end\n  end\n\n  def self.validate_jwt(token)\n    jwks = fetch_jwks\n\n    # JWT \u30e9\u30a4\u30d6\u30e9\u30ea\u306b JWKS \u304b\u3089\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u691c\u51fa\u3092\u4efb\u305b\u308b\n    decoded_token = JWT.decode(token, nil, true, {\n      iss: AuthConstants::ISSUER,\n      verify_iss: true,\n      verify_aud: false, # \u6a29\u9650\u30e2\u30c7\u30eb\u306b\u57fa\u3065\u304d\u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9\u306f\u624b\u52d5\u3067\u691c\u8a3c\u3057\u307e\u3059\n      jwks: jwks\n    })[0]\n\n    verify_payload(decoded_token)\n    decoded_token\n  end\n\n  def self.create_auth_info(payload)\n    scopes = payload['scope']&.split(' ') || []\n    audience = payload['aud'] || []\n\n    AuthInfo.new(\n      payload['sub'],\n      payload['client_id'],\n      payload['organization_id'],\n      scopes,\n      audience\n    )\n  end\n\n  def self.verify_payload(payload)\n    # \u6a29\u9650\u30e2\u30c7\u30eb\u306b\u57fa\u3065\u304f\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\u3092\u3053\u3053\u306b\u5b9f\u88c5\u3057\u3066\u304f\u3060\u3055\u3044\n    # \u3053\u306e\u5185\u5bb9\u306f\u4e0b\u8a18\u306e\u6a29\u9650\u30e2\u30c7\u30eb\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u793a\u3057\u307e\u3059\n  end\nend\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6b21\u306b\u3001\u30a2\u30af\u30bb\u30b9 \u30c8\u30fc\u30af\u30f3 (Access token) \u3092\u691c\u8a3c\u3059\u308b\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u5b9f\u88c5\u3057\u307e\u3059\uff1a"}),"\n",e.framework?u[e.framework]:(0,r.jsx)(s.A,{groupId:"api-framework",children:Object.entries(u).map((([e,n])=>(0,r.jsx)(i.A,{value:e,label:(0,a.My)(e),children:n},e)))}),"\n",(0,r.jsxs)(n.p,{children:["\u6a29\u9650\u30e2\u30c7\u30eb\u306b\u5f93\u3044\u3001",(0,r.jsx)(n.code,{children:"JwtValidator"})," \u5185\u3067\u9069\u5207\u306a\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\u3092\u5b9f\u88c5\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"]}),"\n",(0,r.jsxs)(s.A,{groupId:"permission-models",children:[(0,r.jsx)(i.A,{value:"global-api-resources",label:"\u30b0\u30ed\u30fc\u30d0\u30eb API \u30ea\u30bd\u30fc\u30b9",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",metastring:'title="jwt_validator.rb"',children:"def self.verify_payload(payload)\n  # audience \u30af\u30ec\u30fc\u30e0\u304c API \u30ea\u30bd\u30fc\u30b9\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n  audiences = payload['aud'] || []\n  unless audiences.include?('https://your-api-resource-indicator')\n    raise AuthorizationError.new('Invalid audience')\n  end\n\n  # \u30b0\u30ed\u30fc\u30d0\u30eb API \u30ea\u30bd\u30fc\u30b9\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u3092\u78ba\u8a8d\n  required_scopes = ['api:read', 'api:write'] # \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n  token_scopes = payload['scope']&.split(' ') || []\n\n  unless required_scopes.all? { |scope| token_scopes.include?(scope) }\n    raise AuthorizationError.new('Insufficient scope')\n  end\nend\n"})})}),(0,r.jsx)(i.A,{value:"organization-permissions",label:"\u7d44\u7e54 (Organization) \u6a29\u9650\uff08\u975e API\uff09",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",metastring:'title="jwt_validator.rb"',children:"def self.verify_payload(payload)\n  # audience \u30af\u30ec\u30fc\u30e0\u304c\u7d44\u7e54 (Organization) \u5f62\u5f0f\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n  audiences = payload['aud'] || []\n  has_org_audience = audiences.any? { |aud| aud.start_with?('urn:logto:organization:') }\n\n  unless has_org_audience\n    raise AuthorizationError.new('Invalid audience for organization permissions')\n  end\n\n  # \u7d44\u7e54 ID \u304c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\u304c\u5fc5\u8981\u306a\u5834\u5408\u3042\u308a\uff09\n  expected_org_id = 'your-organization-id' # \u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\n  expected_aud = \"urn:logto:organization:#{expected_org_id}\"\n  unless audiences.include?(expected_aud)\n    raise AuthorizationError.new('Organization ID mismatch')\n  end\n\n  # \u5fc5\u8981\u306a\u7d44\u7e54 (Organization) \u30b9\u30b3\u30fc\u30d7\u3092\u78ba\u8a8d\n  required_scopes = ['invite:users', 'manage:settings'] # \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n  token_scopes = payload['scope']&.split(' ') || []\n\n  unless required_scopes.all? { |scope| token_scopes.include?(scope) }\n    raise AuthorizationError.new('Insufficient organization scope')\n  end\nend\n"})})}),(0,r.jsx)(i.A,{value:"organization-level-api-resources",label:"\u7d44\u7e54\u30ec\u30d9\u30eb API \u30ea\u30bd\u30fc\u30b9",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",metastring:'title="jwt_validator.rb"',children:"def self.verify_payload(payload)\n  # audience \u30af\u30ec\u30fc\u30e0\u304c API \u30ea\u30bd\u30fc\u30b9\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n  audiences = payload['aud'] || []\n  unless audiences.include?('https://your-api-resource-indicator')\n    raise AuthorizationError.new('Invalid audience for organization-level API resources')\n  end\n\n  # \u7d44\u7e54 ID \u304c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\u304c\u5fc5\u8981\u306a\u5834\u5408\u3042\u308a\uff09\n  expected_org_id = 'your-organization-id' # \u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\n  org_id = payload['organization_id']\n  unless expected_org_id == org_id\n    raise AuthorizationError.new('Organization ID mismatch')\n  end\n\n  # \u7d44\u7e54\u30ec\u30d9\u30eb API \u30ea\u30bd\u30fc\u30b9\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u3092\u78ba\u8a8d\n  required_scopes = ['api:read', 'api:write'] # \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n  token_scopes = payload['scope']&.split(' ') || []\n\n  unless required_scopes.all? { |scope| token_scopes.include?(scope) }\n    raise AuthorizationError.new('Insufficient organization-level API scopes')\n  end\nend\n"})})})]})]})}function g(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},52259:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",metastring:'title="auth_constants.rb"',children:"module AuthConstants\n  JWKS_URI = 'https://your-tenant.logto.app/oidc/jwks'\n  ISSUER = 'https://your-tenant.logto.app/oidc'\nend\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",metastring:'title="auth_info.rb"',children:"class AuthInfo\n  attr_accessor :sub, :client_id, :organization_id, :scopes, :audience\n\n  def initialize(sub, client_id = nil, organization_id = nil, scopes = [], audience = [])\n    @sub = sub\n    @client_id = client_id\n    @organization_id = organization_id\n    @scopes = scopes\n    @audience = audience\n  end\n\n  def to_h\n    {\n      sub: @sub,\n      client_id: @client_id,\n      organization_id: @organization_id,\n      scopes: @scopes,\n      audience: @audience\n    }\n  end\nend\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",metastring:'title="authorization_error.rb"',children:"class AuthorizationError < StandardError\n  attr_reader :status\n\n  def initialize(message, status = 403)\n    super(message)\n    @status = status\n  end\nend\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",metastring:'title="auth_helpers.rb"',children:"module AuthHelpers\n  def extract_bearer_token(request)\n    authorization = request.headers['Authorization']\n\n    raise AuthorizationError.new('Authorization header is missing', 401) unless authorization\n    raise AuthorizationError.new('Authorization header must start with \"Bearer \"', 401) unless authorization.start_with?('Bearer ')\n\n    authorization[7..-1] # 'Bearer ' \u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u524a\u9664\n  end\nend\n"})})]})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},86138:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",metastring:'title="api.rb"',children:"require 'grape'\nrequire_relative 'auth_helpers'\nrequire_relative 'auth_constants'\nrequire_relative 'auth_info'\nrequire_relative 'authorization_error'\nrequire_relative 'jwt_validator'\n\nclass API < Grape::API\n  format :json\n\n  helpers GrapeAuthHelpers\n\n  namespace :api do\n    namespace :protected do\n      before do\n        authenticate_user!\n      end\n\n      get do\n        # \u8a8d\u8a3c (Authentication) \u30d8\u30eb\u30d1\u30fc\u304b\u3089\u8a8d\u8a3c\u60c5\u5831\u3078\u30a2\u30af\u30bb\u30b9\n        { auth: auth.to_h }\n      end\n    end\n  end\n\n  # \u516c\u958b\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff08\u4fdd\u8b77\u3055\u308c\u3066\u3044\u307e\u305b\u3093\uff09\n  get :public do\n    { message: \"\u516c\u958b\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\" }\n  end\nend\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",metastring:'title="config.ru"',children:"require_relative 'api'\n\nrun API\n"})})]})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},12516:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",metastring:'title="app/controllers/application_controller.rb"',children:"class ApplicationController < ActionController::API # API \u5c02\u7528\u30a2\u30d7\u30ea\u306e\u5834\u5408\n# class ApplicationController < ActionController::Base # \u30d5\u30eb Rails \u30a2\u30d7\u30ea\u306e\u5834\u5408\n  include JwtAuthentication\nend\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",metastring:'title="app/controllers/api/protected_controller.rb"',children:"class Api::ProtectedController < ApplicationController\n  before_action :verify_access_token\n\n  def index\n    # @auth \u304b\u3089\u8a8d\u8a3c\u60c5\u5831\u3078\u30a2\u30af\u30bb\u30b9\n    render json: { auth: @auth.to_h }\n  end\nend\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",metastring:'title="config/routes.rb"',children:"Rails.application.routes.draw do\n  namespace :api do\n    resources :protected, only: [:index]\n  end\nend\n"})})]})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},87531:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ruby",metastring:'title="app.rb"',children:"require 'sinatra'\nrequire 'json'\nrequire_relative 'auth_middleware'\nrequire_relative 'auth_constants'\nrequire_relative 'auth_info'\nrequire_relative 'authorization_error'\nrequire_relative 'auth_helpers'\nrequire_relative 'jwt_validator'\n\n# \u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u9069\u7528\nuse AuthMiddleware\n\nget '/api/protected' do\n  content_type :json\n\n  # env \u304b\u3089\u8a8d\u8a3c\u60c5\u5831\u306b\u30a2\u30af\u30bb\u30b9\n  auth = env['auth']\n  { auth: auth.to_h }.to_json\nend\n\n# \u30d1\u30d6\u30ea\u30c3\u30af\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\uff08\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u306b\u3088\u308b\u4fdd\u8b77\u306a\u3057\uff09\nget '/' do\n  content_type :json\n  { message: \"\u30d1\u30d6\u30ea\u30c3\u30af\u30a8\u30f3\u30c9\u30dd\u30a4\u30f3\u30c8\" }.to_json\nend\n"})})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},38448:(e,n,t)=>{t.d(n,{Ay:()=>g,RM:()=>p});var r=t(25105),o=t(79621),a=t(33435),i=t(38552),s=t(22002);function c(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",metastring:'title="middleware.rs"',children:"use crate::{AuthInfo, AuthorizationError, extract_bearer_token};\nuse crate::jwt_validator::JwtValidator;\nuse actix_web::{\n    dev::{forward_ready, Service, ServiceRequest, ServiceResponse, Transform},\n    web, Error, HttpMessage, HttpResponse,\n};\nuse futures::future::{ok, Ready};\nuse std::sync::Arc;\n\npub struct JwtMiddleware {\n    validator: Arc<JwtValidator>,\n}\n\nimpl JwtMiddleware {\n    pub fn new(validator: Arc<JwtValidator>) -> Self {\n        Self { validator }\n    }\n}\n\nimpl<S, B> Transform<S, ServiceRequest> for JwtMiddleware\nwhere\n    S: Service<ServiceRequest, Response = ServiceResponse<B>, Error = Error>,\n    S::Future: 'static,\n    B: 'static,\n{\n    type Response = ServiceResponse<B>;\n    type Error = Error;\n    type InitError = ();\n    type Transform = JwtMiddlewareService<S>;\n    type Future = Ready<Result<Self::Transform, Self::InitError>>;\n\n    fn new_transform(&self, service: S) -> Self::Future {\n        ok(JwtMiddlewareService {\n            service,\n            validator: self.validator.clone(),\n        })\n    }\n}\n\npub struct JwtMiddlewareService<S> {\n    service: S,\n    validator: Arc<JwtValidator>,\n}\n\nimpl<S, B> Service<ServiceRequest> for JwtMiddlewareService<S>\nwhere\n    S: Service<ServiceRequest, Response = ServiceResponse<B>, Error = Error>,\n    S::Future: 'static,\n    B: 'static,\n{\n    type Response = ServiceResponse<B>;\n    type Error = Error;\n    type Future = futures::future::LocalBoxFuture<'static, Result<Self::Response, Self::Error>>;\n\n    forward_ready!(service);\n\n    fn call(&self, req: ServiceRequest) -> Self::Future {\n        let validator = self.validator.clone();\n\n        Box::pin(async move {\n            let authorization = req\n                .headers()\n                .get(\"authorization\")\n                .and_then(|h| h.to_str().ok());\n\n            match extract_bearer_token(authorization)\n                .and_then(|token| validator.validate_jwt(token))\n            {\n                Ok(auth_info) => {\n                    // \u8a8d\u8a3c\u60c5\u5831\u3092\u30ea\u30af\u30a8\u30b9\u30c8\u62e1\u5f35\u306b\u4fdd\u5b58\u3057\u3001\u6c4e\u7528\u7684\u306b\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\n                    req.extensions_mut().insert(auth_info);\n                    let fut = self.service.call(req);\n                    fut.await\n                }\n                Err(e) => {\n                    let response = HttpResponse::build(\n                        actix_web::http::StatusCode::from_u16(e.status_code)\n                            .unwrap_or(actix_web::http::StatusCode::FORBIDDEN),\n                    )\n                    .json(serde_json::json!({ \"error\": e.message }));\n\n                    Ok(req.into_response(response))\n                }\n            }\n        })\n    }\n}\n"})})}function l(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",metastring:'title="middleware.rs"',children:'use crate::{AuthInfo, AuthorizationError, extract_bearer_token};\nuse crate::jwt_validator::JwtValidator;\nuse axum::{\n    extract::Request,\n    http::{HeaderMap, StatusCode},\n    middleware::Next,\n    response::{IntoResponse, Response},\n    Extension, Json,\n};\nuse serde_json::json;\nuse std::sync::Arc;\n\n// JWT \u30df\u30c9\u30eb\u30a6\u30a7\u30a2\npub async fn jwt_middleware(\n    Extension(validator): Extension<Arc<JwtValidator>>,\n    headers: HeaderMap,\n    mut request: Request,\n    next: Next,\n) -> Result<Response, AuthorizationError> {\n    // Authorization \u30d8\u30c3\u30c0\u30fc\u304b\u3089\u30c8\u30fc\u30af\u30f3\u3092\u53d6\u5f97\n    let authorization = headers\n        .get("authorization")\n        .and_then(|h| h.to_str().ok());\n\n    let token = extract_bearer_token(authorization)?;\n    let auth_info = validator.validate_jwt(token)?;\n\n    // \u8a8d\u8a3c\u60c5\u5831\u3092\u30ea\u30af\u30a8\u30b9\u30c8\u62e1\u5f35\u306b\u683c\u7d0d\u3057\u3001\u6c4e\u7528\u7684\u306b\u5229\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\n    request.extensions_mut().insert(auth_info);\n\n    Ok(next.run(request).await)\n}\n\n// AuthorizationError \u3092\u30ec\u30b9\u30dd\u30f3\u30b9\u3078\u5909\u63db\nimpl IntoResponse for AuthorizationError {\n    fn into_response(self) -> Response {\n        let status = StatusCode::from_u16(self.status_code).unwrap_or(StatusCode::FORBIDDEN);\n        (status, Json(json!({ "error": self.message }))).into_response()\n    }\n}\n'})})}function d(e){const n={code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",metastring:'title="guards.rs"',children:"use crate::{AuthInfo, AuthorizationError, extract_bearer_token};\nuse crate::jwt_validator::JwtValidator;\nuse rocket::{\n    http::Status,\n    outcome::Outcome,\n    request::{self, FromRequest, Request},\n    State,\n};\n\n#[rocket::async_trait]\nimpl<'r> FromRequest<'r> for AuthInfo {\n    type Error = AuthorizationError;\n\n    async fn from_request(req: &'r Request<'_>) -> request::Outcome<Self, Self::Error> {\n        let validator = match req.guard::<&State<JwtValidator>>().await {\n            Outcome::Success(validator) => validator,\n            Outcome::Failure((status, _)) => {\n                return Outcome::Failure((\n                    status,\n                    AuthorizationError::with_status(\"JWT validator not found\", 500),\n                ))\n            }\n            Outcome::Forward(()) => {\n                return Outcome::Forward(())\n            }\n        };\n\n        let authorization = req.headers().get_one(\"authorization\");\n\n        match extract_bearer_token(authorization)\n            .and_then(|token| validator.validate_jwt(token))\n        {\n            Ok(auth_info) => Outcome::Success(auth_info),\n            Err(e) => {\n                let status = Status::from_code(e.status_code).unwrap_or(Status::Forbidden);\n                Outcome::Failure((status, e))\n            }\n        }\n    }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"\uff08\u3053\u306e\u30b3\u30fc\u30c9\u306f Rust \u306e\u8a8d\u53ef (Authorization) \u30ac\u30fc\u30c9\u306e\u5b9f\u88c5\u4f8b\u3067\u3059\u3002\u30b3\u30fc\u30c9\u5185\u306e\u8b58\u5225\u5b50\u3084\u69cb\u9020\u4f53\u540d\u3001\u95a2\u6570\u540d\u306a\u3069\u306f\u7ffb\u8a33\u305b\u305a\u3001\u305d\u306e\u307e\u307e\u306b\u3057\u3066\u3044\u307e\u3059\u3002\uff09"})]})}const u=Object.freeze({axum:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}),{}),"actix-web":(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}),{}),rocket:(0,r.jsx)((function(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}),{})}),p=[];function h(e){const n={a:"a",code:"code",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://github.com/Keats/jsonwebtoken",children:"jsonwebtoken"})," \u3092\u4f7f\u7528\u3057\u3066 JWT \u306e\u691c\u8a3c\u3092\u884c\u3044\u307e\u3059\u3002\u5fc5\u8981\u306a\u4f9d\u5b58\u95a2\u4fc2\u3092 ",(0,r.jsx)(n.code,{children:"Cargo.toml"})," \u306b\u8ffd\u52a0\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",metastring:'title="Cargo.toml"',children:'[dependencies]\njsonwebtoken = "9.0"\nserde = { version = "1.0", features = ["derive"] }\nserde_json = "1.0"\nreqwest = { version = "0.11", features = ["json"] }\ntokio = { version = "1.0", features = ["full"] }\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u307e\u305a\u3001JWT \u691c\u8a3c\u3092\u51e6\u7406\u3059\u308b\u305f\u3081\u306e\u5171\u901a\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u3092\u8ffd\u52a0\u3057\u307e\u3059\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",metastring:'title="jwt_validator.rs"',children:'use crate::{AuthInfo, AuthorizationError, ISSUER, JWKS_URI};\nuse jsonwebtoken::{decode, decode_header, Algorithm, DecodingKey, Validation};\nuse serde_json::Value;\nuse std::collections::HashMap;\n\npub struct JwtValidator {\n    jwks: HashMap<String, DecodingKey>,\n}\n\nimpl JwtValidator {\n    pub async fn new() -> Result<Self, AuthorizationError> {\n        let jwks = Self::fetch_jwks().await?;\n        Ok(Self { jwks })\n    }\n\n    async fn fetch_jwks() -> Result<HashMap<String, DecodingKey>, AuthorizationError> {\n        let response = reqwest::get(JWKS_URI).await.map_err(|e| {\n            AuthorizationError::with_status(format!("Failed to fetch JWKS: {}", e), 401)\n        })?;\n\n        let jwks: Value = response.json().await.map_err(|e| {\n            AuthorizationError::with_status(format!("Failed to parse JWKS: {}", e), 401)\n        })?;\n\n        let mut keys = HashMap::new();\n\n        if let Some(keys_array) = jwks["keys"].as_array() {\n            for key in keys_array {\n                if let (Some(kid), Some(kty), Some(n), Some(e)) = (\n                    key["kid"].as_str(),\n                    key["kty"].as_str(),\n                    key["n"].as_str(),\n                    key["e"].as_str(),\n                ) {\n                    if kty == "RSA" {\n                        if let Ok(decoding_key) = DecodingKey::from_rsa_components(n, e) {\n                            keys.insert(kid.to_string(), decoding_key);\n                        }\n                    }\n                }\n            }\n        }\n\n        if keys.is_empty() {\n            return Err(AuthorizationError::with_status("No valid keys found in JWKS", 401));\n        }\n\n        Ok(keys)\n    }\n\n    pub fn validate_jwt(&self, token: &str) -> Result<AuthInfo, AuthorizationError> {\n        let header = decode_header(token).map_err(|e| {\n            AuthorizationError::with_status(format!("Invalid token header: {}", e), 401)\n        })?;\n\n        let kid = header.kid.ok_or_else(|| {\n            AuthorizationError::with_status("Token missing kid claim", 401)\n        })?;\n\n        let key = self.jwks.get(&kid).ok_or_else(|| {\n            AuthorizationError::with_status("Unknown key ID", 401)\n        })?;\n\n        let mut validation = Validation::new(Algorithm::RS256);\n        validation.set_issuer(&[ISSUER]);\n        validation.validate_aud = false; // \u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9\u306f\u624b\u52d5\u3067\u691c\u8a3c\u3057\u307e\u3059\n\n        let token_data = decode::<Value>(token, key, &validation).map_err(|e| {\n            AuthorizationError::with_status(format!("Invalid token: {}", e), 401)\n        })?;\n\n        let claims = token_data.claims;\n        self.verify_payload(&claims)?;\n\n        Ok(self.create_auth_info(claims))\n    }\n\n    fn verify_payload(&self, claims: &Value) -> Result<(), AuthorizationError> {\n        // \u6a29\u9650\u30e2\u30c7\u30eb\u306b\u57fa\u3065\u3044\u305f\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\u3092\u3053\u3053\u306b\u5b9f\u88c5\u3057\u307e\u3059\n        // \u4e0b\u8a18\u306e\u6a29\u9650\u30e2\u30c7\u30eb\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u8aac\u660e\u3057\u307e\u3059\n        Ok(())\n    }\n\n    fn create_auth_info(&self, claims: Value) -> AuthInfo {\n        let scopes = claims["scope"]\n            .as_str()\n            .map(|s| s.split(\' \').map(|s| s.to_string()).collect())\n            .unwrap_or_default();\n\n        let audience = match &claims["aud"] {\n            Value::Array(arr) => arr.iter().filter_map(|v| v.as_str().map(|s| s.to_string())).collect(),\n            Value::String(s) => vec![s.clone()],\n            _ => vec![],\n        };\n\n        AuthInfo::new(\n            claims["sub"].as_str().unwrap_or_default().to_string(),\n            claims["client_id"].as_str().map(|s| s.to_string()),\n            claims["organization_id"].as_str().map(|s| s.to_string()),\n            scopes,\n            audience,\n        )\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u6b21\u306b\u3001\u30a2\u30af\u30bb\u30b9\u30c8\u30fc\u30af\u30f3\u3092\u691c\u8a3c\u3059\u308b\u30df\u30c9\u30eb\u30a6\u30a7\u30a2\u3092\u5b9f\u88c5\u3057\u307e\u3059\uff1a"}),"\n",e.framework?u[e.framework]:(0,r.jsx)(s.A,{groupId:"api-framework",children:Object.entries(u).map((([e,n])=>(0,r.jsx)(i.A,{value:e,label:(0,a.My)(e),children:n},e)))}),"\n",(0,r.jsxs)(n.p,{children:["\u6a29\u9650\u30e2\u30c7\u30eb\u306b\u5fdc\u3058\u3066\u3001",(0,r.jsx)(n.code,{children:"JwtValidator"})," \u5185\u3067\u9069\u5207\u306a\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\u3092\u5b9f\u88c5\u3057\u3066\u304f\u3060\u3055\u3044\uff1a"]}),"\n",(0,r.jsxs)(s.A,{groupId:"permission-models",children:[(0,r.jsx)(i.A,{value:"global-api-resources",label:"\u30b0\u30ed\u30fc\u30d0\u30eb API \u30ea\u30bd\u30fc\u30b9",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",metastring:'title="jwt_validator.rs"',children:'fn verify_payload(&self, claims: &Value) -> Result<(), AuthorizationError> {\n    // \u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9\u30af\u30ec\u30fc\u30e0\u304c API \u30ea\u30bd\u30fc\u30b9\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n    let audiences = match &claims["aud"] {\n        Value::Array(arr) => arr.iter().filter_map(|v| v.as_str()).collect::<Vec<_>>(),\n        Value::String(s) => vec![s.as_str()],\n        _ => vec![],\n    };\n\n    if !audiences.contains(&"https://your-api-resource-indicator") {\n        return Err(AuthorizationError::new("Invalid audience"));\n    }\n\n    // \u30b0\u30ed\u30fc\u30d0\u30eb API \u30ea\u30bd\u30fc\u30b9\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u3092\u78ba\u8a8d\n    let required_scopes = vec!["api:read", "api:write"]; // \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n    let scopes = claims["scope"]\n        .as_str()\n        .map(|s| s.split(\' \').collect::<Vec<_>>())\n        .unwrap_or_default();\n\n    for required_scope in &required_scopes {\n        if !scopes.contains(required_scope) {\n            return Err(AuthorizationError::new("Insufficient scope"));\n        }\n    }\n\n    Ok(())\n}\n'})})}),(0,r.jsx)(i.A,{value:"organization-permissions",label:"\u7d44\u7e54\uff08\u975e API\uff09\u6a29\u9650",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",metastring:'title="jwt_validator.rs"',children:'fn verify_payload(&self, claims: &Value) -> Result<(), AuthorizationError> {\n    // \u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9\u30af\u30ec\u30fc\u30e0\u304c\u7d44\u7e54\u5f62\u5f0f\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n    let audiences = match &claims["aud"] {\n        Value::Array(arr) => arr.iter().filter_map(|v| v.as_str()).collect::<Vec<_>>(),\n        Value::String(s) => vec![s.as_str()],\n        _ => vec![],\n    };\n\n    let has_org_audience = audiences.iter().any(|aud| aud.starts_with("urn:logto:organization:"));\n    if !has_org_audience {\n        return Err(AuthorizationError::new("Invalid audience for organization permissions"));\n    }\n\n    // \u7d44\u7e54 ID \u304c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\u304c\u5fc5\u8981\u306a\u5834\u5408\u3042\u308a\uff09\n    let expected_org_id = "your-organization-id"; // \u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\n    let expected_aud = format!("urn:logto:organization:{}", expected_org_id);\n    if !audiences.contains(&expected_aud.as_str()) {\n        return Err(AuthorizationError::new("Organization ID mismatch"));\n    }\n\n    // \u5fc5\u8981\u306a\u7d44\u7e54\u30b9\u30b3\u30fc\u30d7\u3092\u78ba\u8a8d\n    let required_scopes = vec!["invite:users", "manage:settings"]; // \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n    let scopes = claims["scope"]\n        .as_str()\n        .map(|s| s.split(\' \').collect::<Vec<_>>())\n        .unwrap_or_default();\n\n    for required_scope in &required_scopes {\n        if !scopes.contains(required_scope) {\n            return Err(AuthorizationError::new("Insufficient organization scope"));\n        }\n    }\n\n    Ok(())\n}\n'})})}),(0,r.jsx)(i.A,{value:"organization-level-api-resources",label:"\u7d44\u7e54\u30ec\u30d9\u30eb\u306e API \u30ea\u30bd\u30fc\u30b9",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",metastring:'title="jwt_validator.rs"',children:'fn verify_payload(&self, claims: &Value) -> Result<(), AuthorizationError> {\n    // \u30aa\u30fc\u30c7\u30a3\u30a8\u30f3\u30b9\u30af\u30ec\u30fc\u30e0\u304c API \u30ea\u30bd\u30fc\u30b9\u30a4\u30f3\u30b8\u30b1\u30fc\u30bf\u30fc\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\n    let audiences = match &claims["aud"] {\n        Value::Array(arr) => arr.iter().filter_map(|v| v.as_str()).collect::<Vec<_>>(),\n        Value::String(s) => vec![s.as_str()],\n        _ => vec![],\n    };\n\n    if !audiences.contains(&"https://your-api-resource-indicator") {\n        return Err(AuthorizationError::new("Invalid audience for organization-level API resources"));\n    }\n\n    // \u7d44\u7e54 ID \u304c\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u4e00\u81f4\u3059\u308b\u304b\u78ba\u8a8d\uff08\u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\u304c\u5fc5\u8981\u306a\u5834\u5408\u3042\u308a\uff09\n    let expected_org_id = "your-organization-id"; // \u30ea\u30af\u30a8\u30b9\u30c8\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u62bd\u51fa\n    let org_id = claims["organization_id"].as_str().unwrap_or_default();\n    if expected_org_id != org_id {\n        return Err(AuthorizationError::new("Organization ID mismatch"));\n    }\n\n    // \u7d44\u7e54\u30ec\u30d9\u30eb\u306e API \u30ea\u30bd\u30fc\u30b9\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u3092\u78ba\u8a8d\n    let required_scopes = vec!["api:read", "api:write"]; // \u5b9f\u969b\u306b\u5fc5\u8981\u306a\u30b9\u30b3\u30fc\u30d7\u306b\u7f6e\u304d\u63db\u3048\u3066\u304f\u3060\u3055\u3044\n    let scopes = claims["scope"]\n        .as_str()\n        .map(|s| s.split(\' \').collect::<Vec<_>>())\n        .unwrap_or_default();\n\n    for required_scope in &required_scopes {\n        if !scopes.contains(required_scope) {\n            return Err(AuthorizationError::new("Insufficient organization-level API scopes"));\n        }\n    }\n\n    Ok(())\n}\n'})})})]})]})}function g(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},85669:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",metastring:'title="lib.rs"',children:'use serde::{Deserialize, Serialize};\nuse std::fmt;\n\npub const JWKS_URI: &str = "https://your-tenant.logto.app/oidc/jwks";\npub const ISSUER: &str = "https://your-tenant.logto.app/oidc";\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct AuthInfo {\n    pub sub: String,\n    pub client_id: Option<String>,\n    pub organization_id: Option<String>,\n    pub scopes: Vec<String>,\n    pub audience: Vec<String>,\n}\n\nimpl AuthInfo {\n    pub fn new(\n        sub: String,\n        client_id: Option<String>,\n        organization_id: Option<String>,\n        scopes: Vec<String>,\n        audience: Vec<String>,\n    ) -> Self {\n        Self {\n            sub,\n            client_id,\n            organization_id,\n            scopes,\n            audience,\n        }\n    }\n}\n\n#[derive(Debug)]\npub struct AuthorizationError {\n    pub message: String,\n    pub status_code: u16,\n}\n\nimpl AuthorizationError {\n    pub fn new(message: impl Into<String>) -> Self {\n        Self {\n            message: message.into(),\n            status_code: 403,\n        }\n    }\n\n    pub fn with_status(message: impl Into<String>, status_code: u16) -> Self {\n        Self {\n            message: message.into(),\n            status_code,\n        }\n    }\n}\n\nimpl fmt::Display for AuthorizationError {\n    fn fmt(&self, f: &mut fmt::Formatter<\'_>) -> fmt::Result {\n        write!(f, "{}", self.message)\n    }\n}\n\nimpl std::error::Error for AuthorizationError {}\n\npub fn extract_bearer_token(authorization: Option<&str>) -> Result<&str, AuthorizationError> {\n    let auth_header = authorization.ok_or_else(|| {\n        AuthorizationError::with_status("Authorization \u30d8\u30c3\u30c0\u30fc\u304c\u3042\u308a\u307e\u305b\u3093 (Authorization header is missing)", 401)\n    })?;\n\n    if !auth_header.starts_with("Bearer ") {\n        return Err(AuthorizationError::with_status(\n            "Authorization \u30d8\u30c3\u30c0\u30fc\u306f \\"Bearer \\" \u3067\u59cb\u307e\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059 (Authorization header must start with \\"Bearer \\")",\n            401,\n        ));\n    }\n\n    Ok(&auth_header[7..]) // \'Bearer \' \u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u524a\u9664 (Remove \'Bearer \' prefix)\n}\n'})})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},5545:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",metastring:'title="main.rs"',children:'use actix_web::{middleware::Logger, web, App, HttpRequest, HttpServer, Result};\nuse serde_json::{json, Value};\nuse std::sync::Arc;\n\nmod lib;\nmod jwt_validator;\nmod middleware as jwt_middleware;\n\nuse lib::AuthInfo;\nuse jwt_validator::JwtValidator;\nuse jwt_middleware::JwtMiddleware;\n\n#[actix_web::main]\nasync fn main() -> std::io::Result<()> {\n    let validator = Arc::new(JwtValidator::new().await.expect("Failed to initialize JWT validator"));\n\n    HttpServer::new(move || {\n        App::new()\n            .app_data(web::Data::new(validator.clone()))\n            .wrap(Logger::default())\n            .service(\n                web::scope("/api/protected")\n                    .wrap(JwtMiddleware::new(validator.clone()))\n                    .route("", web::get().to(protected_handler))\n            )\n    })\n    .bind("127.0.0.1:8080")?\n    .run()\n    .await\n}\n\nasync fn protected_handler(req: HttpRequest) -> Result<web::Json<Value>> {\n    // \u30ea\u30af\u30a8\u30b9\u30c8\u62e1\u5f35\u304b\u3089\u8a8d\u8a3c\u60c5\u5831 (AuthInfo) \u3092\u53d6\u5f97\n    let auth = req.extensions().get::<AuthInfo>().unwrap();\n    Ok(web::Json(json!({ "auth": auth })))\n}\n'})})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},15326:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",metastring:'title="main.rs"',children:'use axum::{\n    extract::Extension,\n    http::StatusCode,\n    middleware,\n    response::Json,\n    routing::get,\n    Router,\n};\nuse serde_json::{json, Value};\nuse std::sync::Arc;\nuse tower_http::cors::CorsLayer;\n\nmod lib;\nmod jwt_validator;\nmod middleware as jwt_middleware;\n\nuse lib::AuthInfo;\nuse jwt_validator::JwtValidator;\n\n#[tokio::main]\nasync fn main() {\n    let validator = Arc::new(JwtValidator::new().await.expect("JWT \u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u306e\u521d\u671f\u5316\u306b\u5931\u6557\u3057\u307e\u3057\u305f"));\n\n    let app = Router::new()\n        .route("/api/protected", get(protected_handler))\n        .layer(middleware::from_fn(jwt_middleware::jwt_middleware))\n        .layer(Extension(validator))\n        .layer(CorsLayer::permissive());\n\n    let listener = tokio::net::TcpListener::bind("0.0.0.0:3000").await.unwrap();\n    axum::serve(listener, app).await.unwrap();\n}\n\nasync fn protected_handler(Extension(auth): Extension<AuthInfo>) -> Json<Value> {\n    // Extension \u304b\u3089\u76f4\u63a5\u8a8d\u8a3c\u60c5\u5831 (auth information) \u306b\u30a2\u30af\u30bb\u30b9\n    Json(json!({ "auth": auth }))\n}\n'})})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},59965:(e,n,t)=>{t.d(n,{Ay:()=>s,RM:()=>a});var r=t(25105),o=t(79621);const a=[];function i(e){const n={code:"code",pre:"pre",...(0,o.R)(),...e.components};return(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",metastring:'title="main.rs"',children:'use rocket::{get, launch, routes, serde::json::Json};\nuse serde_json::{json, Value};\n\nmod lib;\nmod jwt_validator;\nmod guards;\n\nuse lib::AuthInfo;\nuse jwt_validator::JwtValidator;\n\n#[get("/api/protected")]\nfn protected_handler(auth: AuthInfo) -> Json<Value> {\n    // \u30ea\u30af\u30a8\u30b9\u30c8\u30ac\u30fc\u30c9\u304b\u3089\u8a8d\u8a3c (Authentication) \u60c5\u5831\u3078\u76f4\u63a5\u30a2\u30af\u30bb\u30b9\n    Json(json!({ "auth": auth }))\n}\n\n#[launch]\nasync fn rocket() -> _ {\n    let validator = JwtValidator::new().await.expect("JWT \u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u306e\u521d\u671f\u5316\u306b\u5931\u6557\u3057\u307e\u3057\u305f");\n\n    rocket::build()\n        .manage(validator)\n        .mount("/", routes![protected_handler])\n}\n'})})}function s(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(i,{...e})}):i(e)}},38552:(e,n,t)=>{t.d(n,{A:()=>i});t(58101);var r=t(13526);const o={tabItem:"tabItem_dgSZ"};var a=t(25105);function i(e){let{children:n,hidden:t,className:i}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,r.A)(o.tabItem,i),hidden:t,children:n})}},22002:(e,n,t)=>{t.d(n,{A:()=>v});var r=t(58101),o=t(13526),a=t(60755),i=t(55234),s=t(6635),c=t(4100),l=t(35661),d=t(42752);function u(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:t}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:t,attributes:r,default:o}}=e;return{value:n,label:t,attributes:r,default:o}}))}(t);return function(e){const n=(0,l.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function h(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function g(e){let{queryString:n=!1,groupId:t}=e;const o=(0,i.W6)(),a=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,c.aZ)(a),(0,r.useCallback)((e=>{if(!a)return;const n=new URLSearchParams(o.location.search);n.set(a,e),o.replace({...o.location,search:n.toString()})}),[a,o])]}function m(e){const{defaultValue:n,queryString:t=!1,groupId:o}=e,a=p(e),[i,c]=(0,r.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!h({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const r=t.find((e=>e.default))??t[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:a}))),[l,u]=g({queryString:t,groupId:o}),[m,x]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[o,a]=(0,d.Dv)(t);return[o,(0,r.useCallback)((e=>{t&&a.set(e)}),[t,a])]}({groupId:o}),j=(()=>{const e=l??m;return h({value:e,tabValues:a})?e:null})();(0,s.A)((()=>{j&&c(j)}),[j]);return{selectedValue:i,selectValue:(0,r.useCallback)((e=>{if(!h({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);c(e),u(e),x(e)}),[u,x,a]),tabValues:a}}var x=t(21929);const j={tabList:"tabList_osvQ",tabItem:"tabItem_dc4O"};var f=t(25105);function y(e){let{className:n,block:t,selectedValue:r,selectValue:i,tabValues:s}=e;const c=[],{blockElementScrollPositionUntilNextRender:l}=(0,a.a_)(),d=e=>{const n=e.currentTarget,t=c.indexOf(n),o=s[t].value;o!==r&&(l(n),i(o))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=c.indexOf(e.currentTarget)+1;n=c[t]??c[0];break}case"ArrowLeft":{const t=c.indexOf(e.currentTarget)-1;n=c[t]??c[c.length-1];break}}n?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.A)("tabs",{"tabs--block":t},n),children:s.map((e=>{let{value:n,label:t,attributes:a}=e;return(0,f.jsx)("li",{role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:e=>{c.push(e)},onKeyDown:u,onClick:d,...a,className:(0,o.A)("tabs__item",j.tabItem,a?.className,{"tabs__item--active":r===n}),children:t??n},n)}))})}function A(e){let{lazy:n,children:t,selectedValue:a}=e;const i=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=i.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:(0,o.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:i.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==a})))})}function w(e){const n=m(e);return(0,f.jsxs)("div",{className:(0,o.A)("tabs-container",j.tabList),children:[(0,f.jsx)(y,{...n,...e}),(0,f.jsx)(A,{...n,...e})]})}function v(e){const n=(0,x.A)();return(0,f.jsx)(w,{...e,children:u(e.children)},String(n))}},33435:(e,n,t)=>{t.d(n,{Id:()=>i,My:()=>a});const r=Object.freeze({dotnet:{name:".NET"},go:{name:"Go"},java:{name:"Java"},nodejs:{name:"Node.js"},php:{name:"PHP"},python:{name:"Python"},ruby:{name:"Ruby"},rust:{name:"Rust"}}),o=Object.freeze({express:{name:"Express.js",language:"nodejs"},koa:{name:"Koa.js",language:"nodejs"},fastify:{name:"Fastify",language:"nodejs"},hapi:{name:"Hapi.js",language:"nodejs"},nestjs:{name:"NestJS",language:"nodejs"},gin:{name:"Gin",language:"go"},fiber:{name:"Fiber",language:"go"},echo:{name:"Echo",language:"go"},chi:{name:"Chi",language:"go"},"spring-boot":{name:"Spring Boot",language:"java"},quarkus:{name:"Quarkus",language:"java"},micronaut:{name:"Micronaut",language:"java"},"vertx-web":{name:"Vert.x Web",language:"java"},laravel:{name:"Laravel",language:"php"},symfony:{name:"Symfony",language:"php"},slim:{name:"Slim",language:"php"},rails:{name:"Ruby on Rails",language:"ruby"},sinatra:{name:"Sinatra",language:"ruby"},grape:{name:"Grape",language:"ruby"},fastapi:{name:"FastAPI",language:"python"},flask:{name:"Flask",language:"python"},django:{name:"Django",language:"python"},"django-rest":{name:"Django REST Framework",language:"python"},axum:{name:"Axum",language:"rust"},"actix-web":{name:"Actix Web",language:"rust"},rocket:{name:"Rocket",language:"rust"},"aspnet-core":{name:"ASP.NET Core",language:"dotnet"}}),a=e=>o[e].name,i=e=>r[o[e].language].name},79621:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>s});var r=t(58101);const o={},a=r.createContext(o);function i(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);